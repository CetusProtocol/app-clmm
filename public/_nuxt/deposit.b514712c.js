import{a as ht,b as xt,n as mt,d as de,u as Nt,c as qe,s as vt,e as He,T as Ct,p as _t,f as Re,g as Tt}from"./pool.ce20f726.js";import{a as Ve,r as O,m as M,y as It,D as Ie,e as et,o as $,f as x,c as Ge,x as J,h as r,t as At,G as Zt,H as ft,v as se,u as ce,F as rt,J as kt,p as qt,k as Mt,l as $t,E as wt,C as Bt,q as Gt,s as Pt,z as ut,i as Oe,w as pt,j as Rt,L as Jt,b as Kt,B as Qt}from"./entry.2dd50c58.js";/* empty css              */import{s as ot,m as Yt,l as Vt,b as ei,a as ti,_ as ii}from"./transform.a62c018f.js";import{D as o}from"./decimal.0e8aa3f1.js";import{u as yt,a as ni}from"./sha256.9a4c5be7.js";import{d as Ot,_ as Ft,c as Ut,a as zt,b as ai}from"./new-liquidity-title.fe84290b.js";import{i as gt}from"./import-icon.de3e6c66.js";/* empty css              */import"./decimal.633e31ee.js";import{positionError as Qe,fromCoin as b,toCoin as p,tickList as Ye,direction as Fe,minPrice as U,maxPrice as I,currentPriceTab as E,currentPrice as lt,currentPriceReverse as bt,defaultMinPrice as ct,defaultMaxPrice as dt,toggle as jt,isInputTotalAmount as je,priceConfigObj as Je,fromCoinAmount as k,toCoinAmount as w,fixedFromCoin as we,resetTickList as St,resetData as oi}from"./data.dc082158.js";import{_ as ri}from"./coin-select.d5599512.js";import{_ as li}from"./viewDetail.ed0eb9d8.js";import{b as si}from"./new-add-or-create.8b0072ea.js";import{u as ui}from"./notifi.2c9256f5.js";import{_ as ci,a as di}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.d6c53352.js";import"./lock.e6497a1a.js";/* empty css              *//* empty css              */import"./tick.505fdad3.js";import"./token-warning.935b982c.js";import"./refresh-icon.5430d4f6.js";/* empty css              */import"./swap-setting.d3eb68e9.js";/* empty css              */import"./img-no-Positions_2x.18b71407.js";import"./status-block.6a0365c1.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.9489431d.js";import"./index.ee56d16a.js";function Lt(e,c,he){const ue=new o(10).pow(c-he);return new o(1.0001).pow(e).mul(ue)}const mi=Ve({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,c){const he=O(""),ue=O(""),B=M(()=>{var n,y,d,v,F,ee;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((y=e.poolInfo)!=null&&y.coinA.decimals)&&((d=e.poolInfo)!=null&&d.coinB.decimals)?a.sqrtPriceX64ToPrice((v=e.poolInfo)==null?void 0:v.current_sqrt_price,(F=e.poolInfo)==null?void 0:F.coinA.decimals,(ee=e.poolInfo)==null?void 0:ee.coinB.decimals).toString():"0"}),Ce=M(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number(B.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number(B.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),W=M(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number(B.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number(B.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),z=yt(),P=M(()=>z),Z=M(()=>P.value.chainName?ht(P.value.chainName):{}),{TickMath:a,getNearestTickByTick:N}=Z.value,K=(n=[])=>{let y=6;const d=Math.abs(Number(n[0])-Number(n[n.length-1]));return d>=6?y=0:d>=1?y=1:d>=.1?y=2:d>=.01?y=3:d>=.001?y=4:d>=1e-4?y=5:d>=1e-5?y=6:d>=1e-6?y=7:d>=1e-7&&(y=8),y},Se=(n,y=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const d=Number(e.poolInfo.current_tick_index);let v=d+100*y,F=d-100*y,ee,ie;if(e.maxPrice==="∞")ie=Z.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ie=a.priceToTickIndex(new o(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ie=a.priceToTickIndex(new o(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ie=443636}if(e.minPrice==="0")ee=Z.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ee=a.priceToTickIndex(new o(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ee=a.priceToTickIndex(new o(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ee=-443636}let ke=0;if(e.currentPriceTab!=="full range"){if(d>=ee&&d<=ie){const C=d-ee,Q=ie-d;ke=Math.max(Math.abs(C),Math.abs(Q))}else d<ee?ke=Math.abs(ie-d):ke=Math.abs(d-ee);v=d+ke+100*y,F=d-ke-100*y}else{const C=(Math.abs(d)>5e3,2e4);v=d+C*y,F=d-C*y}F<-443636&&(F=-443636),v>443636&&(v=443636);const f=new o(n.liquidity).div(Math.pow(10,8)).toString(),A=e.tickList,q=[],S=[];let L={};for(let C=0;C<A.length;C++){if(L=A[C],L.index<=d&&L.index>=F){if(q.length<1&&C!==0){const Q=A[C-1];q.unshift({...Q,index:F,source:"left"})}q.unshift(L)}else if(L.index>d&&L.index<=v&&(S.push(L),q.length<1&&C!==0)){const Q=A[C-1];q.push({...Q,index:F,source:"left"})}if(L.index>v){const Q=A[C];if(S.push({...Q,index:v,source:"right"}),q.length<1&&C!==0){const Ke=A[C-1];q.push({...Ke,index:F,source:"left"})}break}}let G="0";for(let C=q.length-1;C>=0;C--)G=new o(G).plus(new o(q[C].liquidityNet.toString()).div(Math.pow(10,8))).toString(),q[C].liquityAmount=G;let j=f;for(let C=0;C<S.length;C++)j=new o(j).plus(new o(S[C].liquidityNet.toString()).div(Math.pow(10,8))).toString(),S[C].liquityAmount=j;let te=[];const R=A&&A.length>0?{index:d,liquityAmount:Number(f)}:{index:d,liquityAmount:0};(q.length>0||S.length>0)&&(te=[...q.reverse(),R,...S],e.direction||(te=te.reverse()));const Ue=[];A.forEach(C=>{Ue.push({...C,liquidityGross:C.liquidityGross.toString(),liquidityNet:C.liquidityNet.toString()})}),V(te,F,v,ee,ie,d)}};let ye=O(!1);const m=O(!1);It(()=>{const n=document.body.clientWidth;m.value=!0,n<750?ye.value=!1:ye.value=!0,window.onresize=()=>{document.body.clientWidth<750?ye.value=!1:ye.value=!0,Se(e.poolInfo,e.zoom)}});const V=(n,y,d,v,F,ee)=>{let ie,ke;e.direction?(ie=e.before7dContractPriceLowest?a.priceToTickIndex(new o(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ke=e.before7dContractPriceHighest?a.priceToTickIndex(new o(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ie=e.before7dContractPriceLowest?a.priceToTickIndex(new o(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ke=e.before7dContractPriceHighest?a.priceToTickIndex(new o(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const f={top:30,right:35,bottom:20,left:80};let A,q;ye.value?(A=460-f.left-f.right,q=205-f.top-f.bottom):(A=340-f.left-f.right,q=205-f.top-f.bottom);const S=d-y,L=parseInt(String(S/4));let G=[y+L/4,y+L,y+2*L,d-L,d-L/4];const j=y,te=d,R=A/(te-j);e.currentPriceTab==="full range"&&(G=[y,y+2*L,d]);const Ue=G.map(l=>e.direction?Lt(l,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new o(1).div(Lt(l,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),C=K(Ue);ot("#chart").selectAll("*").remove();const Q=ot("#chart").attr("width",A+f.left+f.right).attr("height",q+f.top+f.bottom).append("g").attr("transform",`translate(${f.left},${f.right})`),Ke=Yt(n,function(l){return Number(Math.abs(l.liquityAmount))})||0,Le=Vt().range([0,q]).domain([Ke,0]);ei().rangeRound([0,A]).padding(.1);const i=Q.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");P.value.theme=="default"?i.attr("x",function(l,s){return s===0?0:e.direction?Math.abs(l.index-j)*R:Math.abs(te-l.index)*R}).attr("y",function(l,s){return e.direction?s===n.length-1?0:Le(l.liquityAmount):s===n.length-1?0:Le(n[s+1].liquityAmount)}).attr("width",function(l,s){return s===0&&n.length===1&&l.liquityAmount>0?A:(e.direction,s!==n.length-1?Math.abs(n[s+1].index-l.index)*R:0)}).attr("height",function(l,s){return s===0&&n.length===1&&l.liquityAmount>0?q:e.direction?s===n.length-1?0:q-Le(l.liquityAmount):s===n.length-1?0:q-Le(n[s+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):i.attr("x",function(l,s){return s===0?0:e.direction?Math.abs(l.index-j)*R:Math.abs(te-l.index)*R}).attr("y",function(l,s){return e.direction?s===n.length-1?0:Le(Math.abs(l.liquityAmount)):s===n.length-1?0:Le(Math.abs(n[s+1].liquityAmount))}).attr("width",function(l,s){return s===0&&n.length===1&&l.liquityAmount>0?A:(e.direction,s!==n.length-1?Math.abs(n[s+1].index-l.index)*R:0)}).attr("height",function(l,s){if(s===0&&n.length===1&&l.liquityAmount>0)return q;if(e.direction)return s===n.length-1?0:Number(l.liquityAmount)?q-Le(Math.abs(l.liquityAmount)):0;{if(s===n.length-1)return 0;const ze=q-Le(Math.abs(n[s+1].liquityAmount));return Number(n[s+1].liquityAmount)?ze:0}}).attr("fill",function(l,s){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(l,s){return"#417494"});const g=Q.append("g");g.append("line").attr("x1",0).attr("y1",155).attr("x2",A).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const _=g.append("g");let T=0;if(e.direction){for(let l=0;l<G.length;l++){const s=de(Ue[l],C)||"0";Ue.push(s);const ze=Math.abs(G[l]-j)*R;let fe=0;for(let pe=0;pe<s.length;pe++)s[pe]==="1"?fe+=4.02:s[pe]==="."?fe+=2.64:s[pe]==="7"?fe+=5.48:fe+=6;_.append("text").text(s).attr("x",ze-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}T=Math.abs(ee-j)*R}else{for(let l=G.length-1;l>=0;l--){const s=de(Ue[l],C)||0;Ue.push(s);const ze=Math.abs(G[l]-te)*R;let fe=0;for(let pe=0;pe<s.length;pe++)s[pe]==="1"?fe+=4.02:s[pe]==="."?fe+=2.64:s[pe]==="7"?fe+=5.48:fe+=6;_.append("text").text(s).attr("x",ze-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}T=Math.abs(ee-te)*R}(P.value.theme=="default"?Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+T+", 0)");let H,me,De,Xe;e.direction?(H=v<j?-100:parseInt(String(Math.abs(v-j)*R)),me=F<j?-100:parseInt(String(Math.abs(F-j)*R)),De=ie<j?-100:Math.abs(ie-j)*R,Xe=ke<j?-100:Math.abs(ke-j)*R):(me=v<j?-100:Math.abs(te-v)*R,H=F<j?-100:Math.abs(te-F)*R,Xe=ie<j?-100:Math.abs(te-ie)*R,De=ke<j?-100:Math.abs(te-ke)*R),e.minPrice==="0"&&(H=0),e.maxPrice==="∞"&&(me=A),ye.value,he.value=A-H+87+"px",ue.value=me+98+"px",ie&&De<A&&Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+De+", 0)"),ke&&Xe<A&&Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Xe+", 0)");const Te=Q.append("g").attr("id","left-handle"),ve=Q.append("g").attr("id","right-handle");P.value.theme=="default"?(Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Te.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),Te.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),ve.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),ve.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),ve.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Te.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),Te.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),ve.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),ve.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),ve.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),Te.attr("transform","translate("+H+", 0)"),ve.attr("transform","translate("+me+", 0)");const xe=ti().extent([[0,0],[A,q]]).handleSize(30).on("end",it);Q.append("g").attr("class","brush").call(xe).call(xe.move,[H,me]);function it(l){if(!l.sourceEvent||!l.selection)return;Te.attr("transform","translate("+l.selection[0]+", 0)"),ve.attr("transform","translate("+l.selection[1]+", 0)"),ye.value,he.value=A-l.selection[0]+87+"px",ue.value=l.selection[1]+74+"px";let s,ze,fe=0,pe=0;e.direction?(fe=N(parseInt(String(l.selection[0]/R+j)),Number(e.poolInfo.tickSpacing)),s=a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=N(parseInt(String(l.selection[1]/R+j)),Number(e.poolInfo.tickSpacing)),ze=a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()):(pe=N(te-l.selection[0]/R,Number(e.poolInfo.tickSpacing)),s=1/a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),fe=N(te-l.selection[1]/R,Number(e.poolInfo.tickSpacing)),ze=1/a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),c.emit("onChangeMinPrice",String(de(String(s),6))),c.emit("onChangeMaxPrice",String(de(String(ze),6)))}P.value.theme=="default"?ot(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):ot(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632"),m.value=!1};return O(""),Ie(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom],([n,y,d,v,F])=>{n&&y&&d&&(n!=null&&n.liquidity)&&Se(n,F)},{immediate:!0}),{store:P,loading:m,rangeSizeLower:Ce,rangeSizeUpper:W,rangeSizeLowerPosition:he,rangeSizeUpperPosition:ue,decimalFormat:xt,numberformat:mt}}});const vi=e=>(qt("data-v-cde4ccfd"),e=e(),Mt(),e),fi={class:"chart-box"},pi={class:"chart"},gi=vi(()=>r("svg",{id:"chart"},null,-1));function bi(e,c,he,ue,B,Ce){const W=kt;return $(),x(rt,null,[e.tickList&&e.tickList.length>0&&e.loading?($(),Ge(W,{key:0})):J("",!0),r("div",fi,[At(r("div",pi,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?($(),x("div",{key:0,class:"range-size range-size-lower",style:ft({right:e.rangeSizeLowerPosition})},se(("numberformat"in e?e.numberformat:ce(mt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):J("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?($(),x("div",{key:1,class:"range-size range-size-upper",style:ft({left:e.rangeSizeUpperPosition})},se(("numberformat"in e?e.numberformat:ce(mt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):J("",!0),gi],512),[[Zt,!e.loading]])])],64)}const Ht=et(mi,[["render",bi],["__scopeId","data-v-cde4ccfd"]]),hi=Ve({props:{lever:{type:String,default:""}},setup(){return{}}});const ki=e=>(qt("data-v-619778e2"),e=e(),Mt(),e),wi={class:"lever"},yi=ki(()=>r("div",{class:"lever-title"},"Leverage",-1)),Ci={class:"lever-text"};function _i(e,c,he,ue,B,Ce){return $(),x("div",wi,[yi,r("div",Ci,se(e.lever),1)])}const Ti=et(hi,[["render",_i],["__scopeId","data-v-619778e2"]]),Pi=Ve({components:{NewLiquidityD3Chart:Ht,NewLiquidityPrice:Ot},setup(){const{t:e,locale:c}=$t(),he=O("liquidity"),ue=yt(),B=M(()=>ue),Ce=M(()=>B.value.chainName),W=Nt(),z=M(()=>W),P=M(()=>B.value.chainName?ht(B.value.chainName):{});It(()=>{Qe.value=!1});const Z=wt(),a=M(()=>{let i=null;for(let g=0;g<z.value.poolConfigList.length;g++){const _=z.value.poolConfigList[g];_.address==Z.query.poolAddress&&(i=_)}return i}),N=M(()=>{let i=null;for(const g in z.value.poolsObj){const _=z.value.poolsObj[g];_.address==Z.query.poolAddress&&(i=_)}return i}),K=O(),Se=O(!0),ye=async(i,g)=>{if(g){Ye.value=[],m.value=[],Se.value=!0;const _=i.token_a.decimals,T=i.token_b.decimals;lt.value=Ct.sqrtPriceX64ToPrice(i==null?void 0:i.current_sqrt_price,_,T).toString(),bt.value=new o(1).div(Ct.sqrtPriceX64ToPrice(i==null?void 0:i.current_sqrt_price,_,T)).toString(),b.value=i.needReverse?i.token_b:i.token_a,p.value=i.needReverse?i.token_a:i.token_b,K.value=i.needReverse,i.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Fe.value=!0:Fe.value=!1;let _e={poolAddress:i.address,coinTypeA:i.coin_a_address,coinTypeB:i.coin_b_address};const H=await P.value.getTicks(_e);Ye.value=H?P.value.getTickDataFromUrlData(H):[],Se.value=!1,n(i)}},m=O([]),V=O(),n=i=>{const g=i.token_a.decimals,_=i.token_b.decimals;let T=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[i.address]&&z.value.poolPriceConfigObj[i.address].recommend_ranges||{};const _e=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[i.address]&&z.value.poolPriceConfigObj[i.address].type||"";let H,me;const De=i.current_tick_index;V.value=i.current_tick_index,H=De-Number(i.type=="unstable"?Number(i.tickSpacing)*2:Number(i.tickSpacing)*3),me=De+Number(i.type=="unstable"?Number(i.tickSpacing)*2:Number(i.tickSpacing)*3);const Xe=P.value.TickMath.tickIndexToPrice(H,g,_).toString(),Te=P.value.TickMath.tickIndexToPrice(me,g,_).toString();T["full range"]={lower:P.value.TickUtil.getMinIndex(Number(N.value.tickSpacing)),upper:P.value.TickUtil.getMaxIndex(Number(N.value.tickSpacing))},T.custom={lower:H,upper:me,minPrice:Xe,maxPrice:Te};const ve=[];for(let xe in T)T[xe]&&ve.push({...T[xe],key:xe});_e&&ve&&ve.length>2?i.isSelfBuilt?E.value="custom":_e=="stable"?E.value="suggested":E.value="passive":E.value="custom",m.value=ve,Je.value=T,v({key:E.value,...T[E.value]})},y=O(""),d=O(""),v=i=>{E.value=i.key.toLowerCase();const g=N.value.token_a.decimals,_=N.value.token_b.decimals,{lower:T,upper:_e}=i;je.value=!1;const H=P.value.TickMath.tickIndexToPrice(T,g,_).toString(),me=P.value.TickMath.tickIndexToPrice(_e,g,_).toString();if(i.key=="full range"){y.value=T,d.value=_e,F();return}Fe.value?(ct.value=String(H),U.value=String(H),dt.value=String(me),I.value=String(me),y.value=T,d.value=_e):(ct.value=String(1/Number(me)),U.value=String(1/Number(me)),dt.value=String(1/Number(H)),I.value=String(1/Number(H)),y.value=P.value.TickMath.priceToTickIndex(new o(1/Number(me)),g,_),d.value=P.value.TickMath.priceToTickIndex(new o(1/Number(H)),g,_))},F=i=>{U.value="0",I.value="∞"};Ie(()=>N.value,(i,g)=>{(!g&&i&&!qe(i)||g&&i&&g.address!==i.address)&&ye(i,!g||i.address!==g.address)},{immediate:!0}),Bt(()=>{b.value=O(),p.value=O(),Ye.value=[]}),Ie(()=>[a.value,N.value,z.value.recommendRangesObj],(i,g)=>{var _,T;(!g||i[0]&&i[1]&&i[2]&&!qe(i[0])&&!qe(i[1]&&!qe(i[2]))||((_=i[0])==null?void 0:_.address)!==((T=g[0])==null?void 0:T.address))&&i[0]&&i[2]&&!qe(i[0])&&!qe(i[2])&&W.setSinglePool(i[0],i[2],Ce.value)},{immediate:!0,deep:!0});const ee=i=>{if(Ce.value=="Sui")switch(i){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(i){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ie=i=>{switch(i){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},ke=i=>{var _,T;const g=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[(_=N.value)==null?void 0:_.address]&&z.value.poolPriceConfigObj[(T=N.value)==null?void 0:T.address].type||"";if(m.value.length>2)if(g=="unstable")switch(i){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(i){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(g=="unstable")switch(i){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(i){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},f=O(1),A=()=>{const i=f.value/2;f.value=i},q=()=>{const i=f.value*2;f.value=i},S=M(()=>{var i,g,_;return!N.value||qe(B.value.addressHistTokens)||!B.value.addressHistTokens[(i=N.value)==null?void 0:i.poolAddress]?null:Object.fromEntries((_=B.value.addressHistTokens[(g=N.value)==null?void 0:g.poolAddress])==null?void 0:_.data.map(T=>[T.key,T.value]))}),L=O(30),G=O("30D"),j=M(()=>Fe.value?S.value&&de(L.value==7?S.value.before_7_d_contract_price_lowest:L.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest,6)||0:S.value&&de(new o(1).div(L.value==7?S.value.before_7_d_contract_price_highest:L.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest).toString(),6)||0),te=M(()=>Fe.value?S.value&&de(L.value==7?S.value.before_7_d_contract_price_highest:L.value==24?S.value.before_24_h_contract_price_highest:S.value.before_30_d_contract_price_highest,6)||0:(S.value&&de(1/Number(L.value==7?S.value.before_7_d_contract_price_lowest:L.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6))==1/0?0:S.value&&de(1/Number(L.value==7?S.value.before_7_d_contract_price_lowest:L.value==24?S.value.before_24_h_contract_price_lowest:S.value.before_30_d_contract_price_lowest),6)||0),R=M(()=>{const i=Number(U.value),g=Number(I.value);if(U.value==I.value||E.value=="full range")return"--";if(U.value&&I.value&&U.value!=="0"&&I.value!=="∞"){const _=vt(1/(1-Number((i/g)**.25)),2);return Number(_)>0?_+"x":"--"}else return 1}),Ue=M(()=>{var i,g,_,T,_e,H;return((i=b.value)==null?void 0:i.isSelfBuilt)||((g=p.value)==null?void 0:g.isSelfBuilt)||((T=z.value.tokensObj[(_=b.value)==null?void 0:_.address])==null?void 0:T.isSelfBuilt)||((H=z.value.tokensObj[(_e=p.value)==null?void 0:_e.address])==null?void 0:H.isSelfBuilt)}),C=i=>{i!==U.value&&E.value=="full range"?v({key:"custom",...m.value.custom}):E.value!=="full range"&&E.value!=="custom"?(E.value="custom",U.value=i):U.value=i},Q=i=>{i!==I.value&&E.value=="full range"?v({key:"custom",...m.value.custom}):E.value!=="full range"&&E.value!=="custom"?(E.value="custom",i=="0"?I.value="∞":I.value=i):i=="0"?I.value="∞":I.value=i};return Ie(()=>[U.value,I.value],([i,g])=>{},{deep:!0,immediate:!0}),{positionError:Qe,getCoinIcon:i=>{var g;return(i==null?void 0:i.logoURI)||(i==null?void 0:i.logo_url)||((g=z.value.tokensObj[i==null?void 0:i.address])==null?void 0:g.logo_url)||(B.value.theme==="default"?gt("/image/coins/unknown.png"):gt("/image/coins/sui-unknown.png"))},chainName:Ce,store:B,currentTab:he,currentPrice:lt,currentPriceReverse:bt,fromCoin:b,toCoin:p,direction:Fe,needReverse:K,addCommom:He,decimalUi:de,priceTablList:m,currentPriceTab:E,sliderStyle:ke,poolInfo:N,tickList:Ye,getPriceTabImage:ee,getPriceTabText:ie,defaultMinPrice:ct,defaultMaxPrice:dt,minPrice:U,maxPrice:I,currentTick:V,chartLoading:Se,zoomOut:A,zoomIn:q,zoom:f,priceTab:v,before7dContractPriceLowest:j,before7dContractPriceHighest:te,aprRewardsTime:G,lever:R,aprRewardsParameter:L,isSelfBuilt:Ue,priceRangeChangeMin:C,priceRangeChangeMax:Q,toggle:jt,getPirceTabTips:i=>{switch(i){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},timeList:[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}]}}});const Si={class:"new-liquidity-left"},Li=r("span",{class:"selectRange"},"Select Range",-1),Ni={class:"price-info"},Ii={class:"left"},Ai={class:"base-coin"},qi={class:"base-coin-title"},Mi=r("span",null,"Base coin",-1),$i=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),Bi=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),Ri=[$i,Bi],Oi={class:"base-coin-bottom"},Fi={alt:""},Ui={class:"current-price"},zi=r("div",{class:"current-price-title"},"Current Price",-1),ji={key:0,class:"from-pre-to"},Hi={class:"right"},Xi={class:"price-range"},Ei={class:"left"},Wi={class:"price-slider"},Di={class:"slider"},xi=r("div",{class:"slider-ratio-content"},null,-1),Zi=[xi],Gi={class:"price-tab-list"},Ji=["onClick"],Ki=["src"],Qi={class:"right"},Yi={class:"price-zoom"},Vi={class:"current-price"},en=r("div",{class:"current-price-title"},"Current Price",-1),tn={key:0,class:"from-pre-to"},nn={class:"price-zoom-right"},an={class:"leverage"},on=r("div",{class:"left"},null,-1),rn={class:"right"},ln={class:"right-time"},sn={key:0,class:"day-7-price-range"},un=r("i",null,null,-1),cn={class:"gray"},dn={class:"time-list"},mn=["onClick"],vn={class:"right-price-h5"},fn={class:"apr-leverage"},pn={key:0,class:"position-tips"},gn=["src"],bn={class:"error"};function hn(e,c,he,ue,B,Ce){var K,Se,ye,m,V,n,y,d;const W=Jt,z=Ht,P=kt,Z=Ti,a=Ot,N=Gt("image");return $(),x("div",Si,[Li,r("div",Ni,[r("div",Ii,[r("div",Ai,[r("div",qi,[Mi,r("div",{class:"change-price",onClick:c[0]||(c[0]=(...v)=>e.toggle&&e.toggle(...v))},Ri)]),r("div",Oi,[At(r("img",Fi,null,512),[[N,e.getCoinIcon(e.fromCoin)]]),r("span",null,se((K=e.fromCoin)==null?void 0:K.symbol),1)])]),r("div",Ui,[zi,r("div",null,[r("span",null,se(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPrice,6)):("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?($(),x("span",ji,se((Se=e.toCoin)==null?void 0:Se.symbol)+" per "+se((ye=e.fromCoin)==null?void 0:ye.symbol),1)):J("",!0)])])]),r("div",Hi,[e.currentTab=="liquidity"?($(),x("div",{key:0,class:"zoom-out",onClick:c[1]||(c[1]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):J("",!0),e.currentTab=="liquidity"?($(),x("div",{key:1,class:"zoom-in",onClick:c[2]||(c[2]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):J("",!0)])]),r("div",Xi,[r("div",Ei,[r("div",Wi,[r("div",Di,[r("div",{class:"slider-ratio",style:ft(e.sliderStyle(e.currentPriceTab))},Zi,4)])]),r("div",Gi,[($(!0),x(rt,null,Pt(e.priceTablList,v=>($(),x("div",{key:v.key,class:ut(["price-tab-item",e.currentPriceTab==v.key?"price-tab-item-active":""]),onClick:F=>e.priceTab(v)},[Oe(W,{placement:"bottom","arrow-point-at-center":""},{title:pt(()=>[Rt(se(e.getPirceTabTips(v.key)),1)]),default:pt(()=>[r("img",{src:e.getPriceTabImage(v.key),alt:""},null,8,Ki),r("span",null,se(e.getPriceTabText(v.key)),1)]),_:2},1024)],10,Ji))),128))])]),r("div",Qi,[r("div",Yi,[r("div",Vi,[en,r("div",null,[r("span",null,se(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPrice,6)):("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?($(),x("span",tn,se(e.direction&&!e.needReverse?`${(m=e.fromCoin)==null?void 0:m.symbol} per ${(V=e.toCoin)==null?void 0:V.symbol}`:`${(n=e.toCoin)==null?void 0:n.symbol} per ${(y=e.fromCoin)==null?void 0:y.symbol}`),1)):J("",!0)])]),r("div",nn,[e.currentTab=="liquidity"?($(),x("div",{key:0,class:"zoom-out",onClick:c[3]||(c[3]=(...v)=>e.zoomOut&&e.zoomOut(...v))}," + ")):J("",!0),e.currentTab=="liquidity"?($(),x("div",{key:1,class:"zoom-in",onClick:c[4]||(c[4]=(...v)=>e.zoomIn&&e.zoomIn(...v))}," - ")):J("",!0)])]),e.fromCoin&&e.toCoin&&e.poolInfo&&e.currentTab=="liquidity"&&e.tickList.length>0?($(),Ge(z,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):J("",!0),((d=e.tickList)==null?void 0:d.length)<=0&&e.chartLoading?($(),Ge(P,{key:1})):J("",!0)])]),r("div",an,[on,r("div",rn,[r("div",ln,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?($(),x("div",sn,[un,r("span",cn,se(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,se(("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceLowest,6)))+" - "+se(("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceHighest,6))),1)])):J("",!0),r("div",dn,[($(!0),x(rt,null,Pt(e.timeList,v=>($(),x("div",{key:v.value,class:ut(["time-item",v.value==e.aprRewardsParameter?"time-item-active":""]),onClick:F=>e.aprRewardsParameter=v.value},se(v.label),11,mn))),128))])]),r("div",vn,[r("span",null,se(("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceLowest,6)))+" - "+se(("addCommom"in e?e.addCommom:ce(He))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceHighest,6))),1)])])]),r("div",{class:ut(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[r("div",fn,[Oe(Z,{lever:e.lever},null,8,["lever"])]),Oe(a,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?($(),x("div",pn,[r("img",{src:("importIcon"in e?e.importIcon:ce(gt))("/image/icon-tips-error@2x.png"),alt:""},null,8,gn),r("p",bn,se(e.$t("tips.positionError")),1)])):J("",!0)],2)])}const Xt=et(Pi,[["render",hn]]),kn=Ve({components:{NewLiquidityTitle:Ft,NewLiquidityAssetsCard:Ut,NewLiquidityDepositRatio:zt},setup(){const{t:e,locale:c}=$t(),he=yt(),ue=M(()=>he),B=M(()=>ue.value.chainName),Ce=Nt(),W=M(()=>Ce),z=ni(),P=M(()=>z),Z=wt(),a=M(()=>{let t=null;for(const u in W.value.poolsObj){const h=W.value.poolsObj[u];h.address==Z.query.poolAddress&&(t=h)}return t}),N=O(!1),K=O(!1),Se=M(()=>ue.value.theme),ye=async(t,u)=>{b.value=t.needReverse?t.token_b:t.token_a,p.value=t.needReverse?t.token_a:t.token_b,k.value="",w.value=""};Ie(()=>a.value,(t,u)=>{(!u&&t&&!qe(t)||u&&t&&u.address!==t.address)&&ye(t,!u||t.address!==u.address)},{immediate:!0});const m=M(()=>P.value.assets&&b.value&&P.value.assets[b.value.address]?_t(P.value.assets[b.value.address].balance,b.value.decimals):"0"),V=M(()=>P.value.assets&&p.value&&P.value.assets[p.value.address]?_t(P.value.assets[p.value.address].balance,p.value.decimals):"0"),n=t=>{t==="fromCoin"?(we.value=!0,B.value==="Aptos"?k.value=Number(m.value)>0?b.value.symbol=="APT"?new o(Number(m.value)).sub(new o(.1)).lt(new o(0))?"0":new o(Number(m.value)).sub(new o(.1)).toString():String(m.value):"":k.value=Number(m.value)>0?b.value.symbol=="SUI"?new o(Number(m.value)).sub(new o(.05)).lt(new o(0))?"0":new o(Number(m.value)).sub(new o(.05)).toString():String(m.value):""):(we.value=!1,B.value==="Aptos"?w.value=Number(V.value)>0?p.value.symbol=="APT"?new o(Number(V.value)).sub(new o(.1)).lt(new o(0))?"0":new o(Number(V.value)).sub(new o(.1)).toString():String(V.value):"":w.value=Number(V.value)>0?p.value.symbol=="SUI"?new o(Number(V.value)).sub(new o(.05)).lt(new o(0))?"0":new o(Number(V.value)).sub(new o(.05)).toString():String(V.value):"")},y=t=>{t==="fromCoin"?(we.value=!0,k.value=Number(m.value)>0?vt(new o(Number(m.value)).div(2).toString(),b.value.decimals).toString():""):(we.value=!1,w.value=Number(V.value)>0?vt(new o(Number(V.value)).div(2).toString(),p.value.decimals).toString():"")},d=O(),v=O(),F=O(),ee=O(!1),ie=t=>{var u,h,ne,X;d.value=t,t==="fromCoin"?(v.value=((u=p.value)==null?void 0:u.address)||"",F.value=Z.query.actions=="new-position"?(h=b.value)==null?void 0:h.address:a.value.needReverse?a.value.token_b.address:a.value.token_a.address):(v.value=((ne=b.value)==null?void 0:ne.address)||"",F.value=Z.query.actions=="new-position"?(X=p.value)==null?void 0:X.address:a.value.needReverse?a.value.token_a.address:a.value.token_b.address),ee.value=!0},ke=t=>{var ne,X,ae,oe,Y,re,le,ge;const u=a.value.needReverse?a.value.token_b:a.value.token_a,h=a.value.needReverse?a.value.token_a:a.value.token_b;d.value==="fromCoin"?(((ne=b.value)==null?void 0:ne.address)===(u==null?void 0:u.address)||!((X=b.value)!=null&&X.address)?(p.value&&t.address.toLowerCase()===((ae=p)==null?void 0:ae.value.address.toLowerCase())&&(p.value=null),b.value=t):(b.value&&t.address.toLowerCase()===((oe=b)==null?void 0:oe.value.address.toLowerCase())&&(b.value=null),p.value=t),Z.query.action||(Z.query.fee="")):((Y=p.value)==null?void 0:Y.address)===(h==null?void 0:h.address)||!((re=p.value)!=null&&re.address)?(b.value&&t.address.toLowerCase()===((le=b)==null?void 0:le.value.address.toLowerCase())&&(b.value=null),p.value=t):(p.value&&t.address.toLowerCase()===((ge=p)==null?void 0:ge.value.address.toLowerCase())&&(p.value=null),b.value=t),ee.value=!1},f=M(()=>ue.value.chainName?ht(ue.value.chainName):{}),A=M(()=>ue.value.slippage),q=O(),S=async()=>{var Me,Ae,$e,Be;if(je.value||!U.value&&!I.value)return!1;if(!k.value&&!w.value&&!U.value&&!I.value)return;const t=a.value||{};if(qe(t))return;const{TickUtil:u,TickMath:h,getNearestTickByTick:ne}=f.value,X=t==null?void 0:t.token_a.decimals,ae=t==null?void 0:t.token_b.decimals;let oe,Y,re,le,ge,Pe,Ee,Ze,Ne=t==null?void 0:t.current_tick_index,D;if(t.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===p.value.address.toLowerCase()?D=!0:D=!1,U.value==="0"&&I.value==="∞")re=u.getMinIndex(Number(t.tickSpacing)),le=u.getMaxIndex(Number(t.tickSpacing)),ge=h.tickIndexToSqrtPriceX64(re),Pe=h.tickIndexToSqrtPriceX64(le);else if(E.value=="custom"){D?(oe=Number(U.value),Y=Number(I.value)):(oe=I.value!=="∞"?new o(1).div(I.value).toString():1/0,Y=new o(1).div(U.value).toString());try{Ee=oe==0?-443636:h.priceToTickIndex(new o(oe),X,ae)}catch{Ee=-443636}try{Ze=h.priceToTickIndex(new o(Y),X,ae)}catch{Ze=443636}re=ne(Ee,Number(t.tickSpacing)),le=ne(Ze,Number(t.tickSpacing));try{ge=h.priceToSqrtPriceX64(new o(oe),X,ae)}catch{(Y===1/0||Y==="∞")&&(ge=h.tickIndexToSqrtPriceX64(u.getMinIndex(Number(t.tickSpacing))))}try{Pe=h.priceToSqrtPriceX64(new o(Y),X,ae)}catch{(Y===1/0||Y==="∞")&&(Pe=h.tickIndexToSqrtPriceX64(u.getMaxIndex(Number(t.tickSpacing))))}}else re=(Me=Je.value[E.value])==null?void 0:Me.lower,le=(Ae=Je.value[E.value])==null?void 0:Ae.upper,ge=h.tickIndexToSqrtPriceX64(re),Pe=h.tickIndexToSqrtPriceX64(le);if(I.value!=="∞"&&re>=le){N.value=!0,k.value="",K.value=!0,w.value="";return}if(I.value==="∞"||Ne>=re&&Ne<=le){N.value=!1,K.value=!1;let be;if(k.value||w.value){if(we.value){const st=new o(k.value).mul(Math.pow(10,b.value.decimals)).toString();be=new Re(st)}else{const st=new o(w.value).mul(Math.pow(10,p.value.decimals)).toString();be=new Re(st)}const{liquidityAmount:We,tokenMaxA:nt,tokenMaxB:at,tokenMaxAOrigin:Wt,tokenMaxBOrigin:Dt}=f.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:t.token_a,tokenB:t.token_b,lowerTick:re,upperTick:le,coinAmount:be,iscoinA:D?we.value:!we.value,roundUp:!0,slippage:Number(A.value)/100,curSqrtPrice:new Re(t.current_sqrt_price)});q.value={liquidityAmount:We,tokenMaxA:nt,tokenMaxB:at,tokenMaxAOrigin:Wt,tokenMaxBOrigin:Dt},D?we.value?w.value=Number(at)>0?at:"":k.value=Number(nt)>0?nt:"":we.value?w.value=nt:k.value=at}}else if(Ne>le){if(D?k.value="":w.value="",N.value=D,K.value=!D,k.value||w.value){let be;if(D){const We=new o(w.value).mul(Math.pow(10,($e=p.value)==null?void 0:$e.decimals)).toString();be=new Re(We),q.value={liquidityAmount:f.value.estimateLiquidityForCoinB(ge,Pe,be),tokenMaxA:0,tokenMaxB:w.value}}else{const We=new o(k.value).mul(Math.pow(10,(Be=b.value)==null?void 0:Be.decimals)).toString();be=new Re(We),q.value={liquidityAmount:f.value.estimateLiquidityForCoinB(ge,Pe,be),tokenMaxA:0,tokenMaxB:k.value}}}}else if(Ne<re){if(N.value=!D,K.value=D,D?w.value="":k.value="",k.value||w.value){let be;if(D){const We=new o(k.value).mul(Math.pow(10,b.value.decimals)).toString();be=new Re(We),q.value={liquidityAmount:f.value.estimateLiquidityForCoinA(ge,Pe,be),tokenMaxA:k.value,tokenMaxB:0}}else{const We=new o(w.value).mul(Math.pow(10,p.value.decimals)).toString();be=new Re(We),q.value={liquidityAmount:f.value.estimateLiquidityForCoinA(ge,Pe,be),tokenMaxA:w.value,tokenMaxB:0}}}}else N.value=!0,k.value="",K.value=!0,w.value=""};Ie(k,(t,u)=>{t==""&&we.value&&(w.value=""),t&&we.value&&!je.value&&S()}),Ie(w,(t,u)=>{t==""&&!we.value&&(k.value=""),t&&!we.value&&!je.value&&S()}),Ie(()=>Fe.value,(t,u)=>{k.value&&w.value&&S()}),Ie(()=>[b.value,p.value],([t,u])=>{t&&u&&(N.value=!1,K.value=!1)});const L=O("--"),G=M(()=>W.value.RATES),j=()=>{const t=G.value&&G.value[b.value.address]&&G.value[b.value.address].price,u=G.value&&G.value[p.value.address]&&G.value[p.value.address].price;if(t&&u){const h=new o(k.value>0?k.value:0).mul(t),ne=new o(w.value>0?w.value:0).mul(u),X=h.add(ne).toNumber();L.value=X>0&&X<.01?"$<0.01":"$"+He(X,2)}else L.value="--"};Ie(()=>[k.value,w.value,je.value],([t,u,h])=>{(t||u)&&!h?j():(!t||!u)&&!h&&(L.value="--")},{immediate:!0}),Ie(()=>L,t=>{},{immediate:!0});const te=O(),R=async()=>{var D,Me;if(!U.value&&!I.value)return!1;if(!k.value&&!w.value&&!U.value&&!I.value)return;const t=a.value;if(qe(t))return;const{TickUtil:u,TickMath:h,getNearestTickByTick:ne}=f.value,X=t==null?void 0:t.token_a.decimals,ae=t==null?void 0:t.token_b.decimals;let oe,Y,re,le,ge,Pe,Ee;if(t.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Ee=!0:Ee=!1,U.value==="0"&&I.value==="∞")re=u.getMinIndex(Number(t.tickSpacing)),le=u.getMaxIndex(Number(t.tickSpacing));else if(E.value=="custom"){Ee?(oe=Number(U.value),Y=Number(I.value)):(oe=new o(1).div(I.value).toString(),Y=new o(1).div(U.value).toString());try{ge=oe==0?-443636:h.priceToTickIndex(new o(oe),X,ae)}catch{ge=-443636}try{Pe=h.priceToTickIndex(new o(Y),X,ae)}catch{Pe=443636}re=ne(ge,Number(t.tickSpacing)),le=ne(Pe,Number(t.tickSpacing))}else re=(D=Je.value[E.value])==null?void 0:D.lower,le=(Me=Je.value[E.value])==null?void 0:Me.upper;const Ze=G.value[t==null?void 0:t.token_a.address].price,Ne=G.value[t==null?void 0:t.token_b.address].price;Fe.value?new Re(t.current_sqrt_price):new Re(1/t.current_sqrt_price);try{const{amountA:Ae,amountB:$e,tokenAmountsInfo:Be}=await f.value.estCoinAmountsFromTotalAmount({lowerTick:re,upperTick:le,decimalsA:X,decimalsB:ae,curSqrtPrice:new Re(t.current_sqrt_price),totalAmount:L.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:Ne});te.value=Be,t.needReverse?Fe.value?(k.value=Ae,w.value=$e):(k.value=$e,w.value=Ae):(k.value=Ae,w.value=$e)}catch{}};Ie([U,I],([t,u])=>{je.value?je.value&&R():S(),u!=="∞"&&Number(t)!==0&&Number(u)!==0&&Number(t)>=Number(u)?Qe.value=!0:Qe.value=!1,Number(t)==0&&Number(u)==0&&lt.value&&(Qe.value=!0)},{deep:!0,immediate:!0});const Ue=t=>{const u=t.replace(/[^\d.]/g,""),h="$"+He(u);je.value=!0,L.value=h,u>0?R():(k.value="",w.value="")},C=O(!1),{setTransactionTxid:Q,setTransactionDesc:Ke,setIsShowWaiting:Le,setIsShowSuccess:tt,setPositiomNum:i,setIsShowRejected:g}=he,_=ui(),T=M(()=>W.value.currentPositionInfo),_e=O(!1),H=async t=>{var ge,Pe,Ee,Ze;C.value=!1,W.value.currentPositionInfo={},Q(""),Ke(e("tips.increaseLiquiditySuccess",{from:N.value?"":`${k.value} ${(ge=b.value)==null?void 0:ge.symbol}`,and:!N.value&&!K.value?"and":"",to:K.value?"":`${w.value} ${(Pe=p.value)==null?void 0:Pe.symbol}`})),Le(!0);const u=Fe.value?we.value:!we.value;let h,ne,X,ae,oe,Y;const re=a.value.token_a.decimals,le=a.value.token_b.decimals;if(U.value==="0"&&I.value==="∞")X=f.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),ae=f.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing));else if(E.value=="custom"){Fe.value?(h=Number(U.value),ne=Number(I.value)):(h=new o(1).div(I.value).toString(),ne=new o(1).div(U.value).toString());try{oe=h==0?f.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)):f.value.TickMath.priceToTickIndex(new o(h),re,le)}catch{oe=f.value.TickUtil.getMinIndex(Number(a.value.tickSpacing))}try{Y=f.value.TickMath.priceToTickIndex(new o(ne),re,le)}catch{Y=f.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))}X=f.value.getNearestTickByTick(oe,Number(a.value.tickSpacing)),ae=f.value.getNearestTickByTick(Y,Number(a.value.tickSpacing))}else X=Je.value[E.value].lower,ae=Je.value[E.value].upper;try{let Ne;je.value?Ne=await f.value.getCreateAddLiquidityPayload({pool:a.value,curSqrtPrice:new Re(a.value.current_sqrt_price),tickLower:X,tickUpper:ae,slippage:Number(A.value)/100,tokenAmounts:te.value}):Ne=await f.value.getAddLiquidityTransactionPayload({pool:{poolAddress:a.value.poolAddress,token_a:a.value.token_a,token_b:a.value.token_b},amount:we.value?k.value:w.value,fix_amount_a:u,tick_lower:X,tick_upper:ae,index:0,slippage:Number(A.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new Re(a.value.current_sqrt_price)});let D;if(B.value==="Aptos")D=await P.value.currentWallet.signAndSubmitTransaction(Ne);else{const Me=await P.value.currentWallet.signAndExecuteTransactionBlock(Ne);D=f.value.handleTx(Me)}if(D&&D.hash){Q(D.hash),Le(!1),tt(!0);let Me;a.value.needReverse?a.value.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Me=!1:Me=!0:a.value.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Me=!0:Me=!1;const Ae={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:N.value?"":`${k.value} ${(Ee=b.value)==null?void 0:Ee.symbol}`,and:!N.value&&!K.value?"and":"",to:K.value?"":`${w.value} ${(Ze=p.value)==null?void 0:Ze.symbol}`}),hash:D.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};B.value!=="Aptos"&&(Ae.res=D.res),f.value.showTransitionPending(Ae);const $e=await f.value.watchTransaction(Ae,!0);if($e.status){if(tt(!1),W.value.setCurrentPositionLoading(!0),_e.value=!0,B.value==="Aptos"){if(await W.value.setCurrentPositionInfo($e.nftInfo[0].data.id.creator,$e.nftInfo[0].data.id.collection,$e.nftInfo[0].data.name,B.value),t)try{await _.subscribePosition({pool_address:T.value.poolAddress,position_index:T.value.index},T.value.nftHash)}catch{}}else{const Be=$e.nftInfo,be=await Tt(2e3);if(await W.value.setCurrentPositionInfo(Be==null?void 0:Be.pool,"","",B.value,Be==null?void 0:Be.position),await Tt(1e3),t)try{await _.subscribePosition({pool_address:T.value.poolAddress,position_index:T.value.index},T.value.nftHash)}catch{}}setTimeout(()=>{Ce.updateCurrentPools(a.value.poolAddress,B.value),f.value.getAccount(P.value.address)},3e3),setTimeout(async()=>{St(f,a)},3e3)}i()}else Le(!1),g(!0);k.value="",w.value=""}catch{k.value="",w.value="",Le(!1),g(!0)}},me=M(()=>!!(!k.value&&!w.value||Number(k.value)>Number(m.value)||Number(w.value)>Number(V.value)||Xe.value!==e("button.addLiquidity")&&Xe.value!==e("newAdd.preview")||a.value&&a.value&&a.value.is_pause||Number(k.value)<=0&&Number(w.value)<=0||!N.value&&Number(k.value)==0||!K.value&&Number(w.value)==0)),De=M(()=>!b.value||!p.value),Xe=M(()=>a.value&&a.value.is_pause?"Pool Closed":!b.value||!p.value||De.value?e("modal.selectTokenModalTitle"):Number(k.value)>Number(m.value)?e("button.insufficientBalance",{name:b.value.symbol}):Number(w.value)>Number(V.value)?e("button.insufficientBalance",{name:p.value.symbol}):!Number(k.value)&&!Number(w.value)?e("button.enterAmount"):I.value!=="∞"&&Number(U.value)>=Number(I.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),Te=O({}),ve=O({}),xe=O(!1),it=(t,u)=>{const h=localStorage.getItem(t.address);W.value.tokensObj&&W.value.tokensObj[t.address]&&W.value.tokensObj[t.address].isSelfBuilt&&!h&&(u=="fromCoin"&&(Te.value=t),u=="toCoin"&&(ve.value=t),xe.value=!0)};Ie(()=>[b.value,p.value],([t,u])=>{t&&!qe(t)&&it(t,"fromCoin"),u&&!qe(u)&&it(u,"toCoin")},{immediate:!0});const l=Kt(),s=()=>{B.value!=="Aptos"?l.push("/pool/list"):l.push("/pools")},ze=t=>{je.value,H(t)},fe=()=>{Z.query.action!=="create-pool"&&Z.query.actions!=="new-position"&&(St(f,a),S(),Ce.updateCurrentPools(a.value.poolAddress,B.value)),Ce.setPoolConfigList(B.value,ue.value.filterCoinsObj)},pe=M(()=>{var h,ne,X,ae,oe,Y;const t=(X=G.value[(ne=(h=b)==null?void 0:h.value)==null?void 0:ne.address])==null?void 0:X.price,u=(Y=G.value[(oe=(ae=p)==null?void 0:ae.value)==null?void 0:oe.address])==null?void 0:Y.price;return!!(t&&u)});return Ie(()=>[Z,W.value.tokensObj],([t,u])=>{var h;u&&!qe(u)&&(p.value||(p.value=W.value.tokensObj[(h=t==null?void 0:t.query)==null?void 0:h.toCoin]))},{immediate:!0,deep:!0}),{positionError:Qe,decimalUi:de,poolInfo:a,fromCoinAmount:k,toCoinAmount:w,fromCoin:b,toCoin:p,theme:Se,showFromCoinLock:N,showToCoinLock:K,fromCoinBlance:m,toCoinBlance:V,maxBtnSelect:n,halfBtnSelect:y,fixedFromCoin:we,openCoinSelect:ie,currentCoinKey:d,existingCoins:v,lastSelectCoin:F,showCoinSelect:ee,onCoinSelect:ke,liquidityTotalAmount:L,toggle:jt,onInput:Ue,isInputTotalAmount:je,isViewDetail:_e,addLiquidityBtnDisabled:me,addLiquidityBtnText:Xe,isShowTokenWarning:xe,chainName:B,closeTokenWarning:s,warningFromCoin:Te,warningToCoin:ve,isShowLiquidityModal:C,currentPrice:lt,currentPriceReverse:bt,currentPriceTab:E,minPrice:U,maxPrice:I,toAdd:H,direction:Fe,wallet:P,getAddLiquidityType:ze,clickRefresh:fe,isShowtotalAmount:pe}}});const wn={class:"new-liquidity-right"},yn={class:"deposit-title"},Cn={class:"card-container"},_n={key:0,class:"lock"},Tn={class:"card-item"},Pn={class:"card-item"},Sn={key:0,class:"total-amount"},Ln=r("span",null,"Total Amount",-1);function Nn(e,c,he,ue,B,Ce){const W=Ft,z=ai,P=Ut,Z=ii,a=zt,N=Qt,K=ri,Se=li,ye=si;return $(),x("div",wn,[r("div",yn,[Oe(W,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",Cn,[e.positionError?($(),x("div",_n,[Oe(z)])):J("",!0),r("div",Tn,[Oe(P,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":c[0]||(c[0]=m=>e.fromCoinAmount=m),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:c[1]||(c[1]=m=>e.maxBtnSelect("fromCoin")),onOnHalf:c[2]||(c[2]=m=>e.halfBtnSelect("fromCoin")),onOnInput:c[3]||(c[3]=m=>{e.fromCoinAmount=m,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:c[4]||(c[4]=m=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?($(),Ge(Z,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):J("",!0)]),r("div",Pn,[Oe(P,{modelValue:e.toCoinAmount,"onUpdate:modelValue":c[5]||(c[5]=m=>e.toCoinAmount=m),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:c[6]||(c[6]=m=>e.maxBtnSelect("toCoin")),onOnHalf:c[7]||(c[7]=m=>e.halfBtnSelect("toCoin")),onOnInput:c[8]||(c[8]=m=>{e.toCoinAmount=m,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:c[9]||(c[9]=m=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?($(),Ge(Z,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):J("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?($(),x("img",{key:1,class:"add",src:ci,alt:"",onClick:c[10]||(c[10]=(...m)=>e.toggle&&e.toggle(...m))})):J("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?($(),x("img",{key:2,class:"add",src:di,alt:"",onClick:c[11]||(c[11]=(...m)=>e.toggle&&e.toggle(...m))})):J("",!0)]),e.isShowtotalAmount?($(),x("div",Sn,[Ln,r("span",null,se(e.liquidityTotalAmount)+" ",1)])):J("",!0),Oe(a,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Oe(N,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:c[12]||(c[12]=m=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:pt(()=>[Rt(se(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?($(),Ge(K,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:c[13]||(c[13]=m=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):J("",!0),e.isViewDetail?($(),Ge(Se,{key:2,"pool-info":e.poolInfo,onOnClose:c[14]||(c[14]=m=>e.isViewDetail=!1)},null,8,["pool-info"])):J("",!0),e.isShowLiquidityModal?($(),Ge(ye,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:c[15]||(c[15]=m=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):J("",!0)])}const Et=et(kn,[["render",Nn]]),In=Ve({components:{NewLiquidityLeft:Xt,NewLiquidityRight:Et},setup(){Bt(()=>{oi()});const e=wt();return{tickList:Ye,route:e}}});const An={key:0,class:"loading-spin-liquidity loading-global"},qn={class:"privide-liquidity"};function Mn(e,c,he,ue,B,Ce){var Z,a;const W=kt,z=Xt,P=Et;return $(),x(rt,null,[!e.tickList&&((a=(Z=e.route)==null?void 0:Z.query)!=null&&a.poolAddress)?($(),x("div",An,[Oe(W)])):J("",!0),r("div",qn,[Oe(z),Oe(P)])],64)}const da=et(In,[["render",Mn],["__scopeId","data-v-fc58011a"]]);export{da as default};
