import{b as wt,j as Zt,n as ft,d as me,u as It,c as Se,s as pt,a as Ne,T as rt,E as ct,p as _t,e as Oe,l as Tt}from"./pool.b6ad4907.js";import{a as tt,r as B,l as q,J as Lt,q as qe,e as it,o as R,f as G,t as At,P as Gt,h as r,Q as gt,v as ue,u as de,x as te,c as Ke,S as qt,p as Mt,k as $t,y as Bt,m as yt,N as Rt,s as Jt,F as bt,G as Pt,C as dt,i as Ue,w as ht,j as Ft,R as Kt,b as Qt,B as Yt}from"./entry.4aebf40a.js";/* empty css              */import{s as lt,m as Vt,l as ei,b as ti,a as ii}from"./transform.c672907f.js";import{D as a}from"./decimal.0e8aa3f1.js";import{u as Ct,a as ni}from"./sha256.934be29f.js";import{d as Ot,_ as Ut,c as zt,a as jt,b as ai}from"./new-liquidity-title.aa7bba99.js";import{i as kt}from"./import-icon.de3e6c66.js";/* empty css              */import"./decimal.633e31ee.js";import{positionError as Qe,fromCoin as h,toCoin as f,tickList as Ve,direction as ze,minPrice as O,maxPrice as N,currentPriceTab as U,currentPrice as et,currentPriceReverse as st,defaultMinPrice as mt,defaultMaxPrice as vt,toggle as Ht,isInputTotalAmount as xe,priceConfigObj as Je,fromCoinAmount as y,toCoinAmount as C,fixedFromCoin as ye,resetTickList as St,resetData as oi}from"./data.ac0c4b20.js";import{_ as ri}from"./coin-lock.e193677a.js";import{_ as li}from"./coin-select.b29e1b4e.js";import{_ as si}from"./viewDetail.14e46a03.js";import{a as ui}from"./new-add-or-create.dccf5e14.js";import{u as ci}from"./notifi.7f66e5ce.js";import{_ as di,a as mi}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.b6df0565.js";/* empty css              *//* empty css              */import"./token-warning.b3318f28.js";import"./swap-setting.d08e8e11.js";/* empty css              */import"./img-lock_2x.498a6293.js";import"./img-no-Positions_2x.f6633954.js";import"./status-block.184ca277.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.c62f79bb.js";import"./index.bab95d66.js";function Nt(e,d,ke){const ce=new a(10).pow(d-ke);return new a(1.0001).pow(e).mul(ce)}const vi=tt({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,d){const ke=B(""),ce=B(""),M=q(()=>{var n,s,m,x,F,Y;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((s=e.poolInfo)!=null&&s.coinA.decimals)&&((m=e.poolInfo)!=null&&m.coinB.decimals)?o.sqrtPriceX64ToPrice((x=e.poolInfo)==null?void 0:x.current_sqrt_price,(F=e.poolInfo)==null?void 0:F.coinA.decimals,(Y=e.poolInfo)==null?void 0:Y.coinB.decimals).toString():"0"}),_e=q(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number(M.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),H=q(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number(M.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),z=Ct(),T=q(()=>z),J=q(()=>T.value.chainName?wt(T.value.chainName):{}),{TickMath:o,getNearestTickByTick:S}=J.value,Q=(n=[])=>{let s=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?s=0:m>=1?s=1:m>=.1?s=2:m>=.01?s=3:m>=.001?s=4:m>=1e-4?s=5:m>=1e-5?s=6:m>=1e-6?s=7:m>=1e-7&&(s=8),s},Ie=(n,s=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);let x=m+100*s,F=m-100*s,Y,ie;if(e.maxPrice==="∞")ie=J.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ie=o.priceToTickIndex(new a(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ie=o.priceToTickIndex(new a(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ie=443636}if(e.minPrice==="0")Y=J.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?Y=o.priceToTickIndex(new a(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):Y=o.priceToTickIndex(new a(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{Y=-443636}let we=0;if(e.currentPriceTab!=="full range"){if(m>=Y&&m<=ie){const _=m-Y,V=ie-m;we=Math.max(Math.abs(_),Math.abs(V))}else m<Y?we=Math.abs(ie-m):we=Math.abs(m-Y);x=m+we+100*s,F=m-we-100*s}else{const _=(Math.abs(m)>5e3,2e4);x=m+_*s,F=m-_*s}F<-443636&&(F=-443636),x>443636&&(x=443636);const p=new a(n.liquidity).div(Math.pow(10,8)).toString(),P=e.tickList,A=[],ve=[];let g={};for(let _=0;_<P.length;_++){if(g=P[_],g.index<=m&&g.index>=F){if(A.length<1&&_!==0){const V=P[_-1];A.unshift({...V,index:F,source:"left"})}A.unshift(g)}else if(g.index>m&&g.index<=x&&(ve.push(g),A.length<1&&_!==0)){const V=P[_-1];A.push({...V,index:F,source:"left"})}if(g.index>x){const V=P[_];if(ve.push({...V,index:x,source:"right"}),A.length<1&&_!==0){const Ge=P[_-1];A.push({...Ge,index:F,source:"left"})}break}}let L="0";for(let _=A.length-1;_>=0;_--)L=new a(L).plus(new a(A[_].liquidityNet.toString()).div(Math.pow(10,8))).toString(),A[_].liquityAmount=L;let D=p;for(let _=0;_<ve.length;_++)D=new a(D).plus(new a(ve[_].liquidityNet.toString()).div(Math.pow(10,8))).toString(),ve[_].liquityAmount=D;let K=[];const $=P&&P.length>0?{index:m,liquityAmount:Number(p)}:{index:m,liquityAmount:0};(A.length>0||ve.length>0)&&(K=[...A.reverse(),$,...ve],e.direction||(K=K.reverse()));const je=[];P.forEach(_=>{je.push({..._,liquidityGross:_.liquidityGross.toString(),liquidityNet:_.liquidityNet.toString()})}),W(K,F,x,Y,ie,m)}};let Ce=B(!1);const k=B(!1);Lt(()=>{const n=document.body.clientWidth;k.value=!0,n<750?Ce.value=!1:Ce.value=!0,window.onresize=()=>{document.body.clientWidth<750?Ce.value=!1:Ce.value=!0,Ie(e.poolInfo,e.zoom)}});const W=(n,s,m,x,F,Y)=>{let ie,we;e.direction?(ie=e.before7dContractPriceLowest?o.priceToTickIndex(new a(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",we=e.before7dContractPriceHighest?o.priceToTickIndex(new a(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ie=e.before7dContractPriceLowest?o.priceToTickIndex(new a(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",we=e.before7dContractPriceHighest?o.priceToTickIndex(new a(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const p={top:30,right:35,bottom:20,left:80};let P,A;Ce.value?(P=460-p.left-p.right,A=205-p.top-p.bottom):(P=340-p.left-p.right,A=205-p.top-p.bottom);const ve=m-s,g=parseInt(String(ve/4));let L=[s+g/4,s+g,s+2*g,m-g,m-g/4];const D=s,K=m,$=P/(K-D);e.currentPriceTab==="full range"&&(L=[s,s+2*g,m]);const je=L.map(l=>e.direction?Nt(l,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new a(1).div(Nt(l,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),_=Q(je);lt("#chart").selectAll("*").remove();const V=lt("#chart").attr("width",P+p.left+p.right).attr("height",A+p.top+p.bottom).append("g").attr("transform",`translate(${p.left},${p.right})`),Ge=Vt(n,function(l){return Number(Math.abs(l.liquityAmount))})||0,Le=ei().range([0,A]).domain([Ge,0]);ti().rangeRound([0,P]).padding(.1);const Ye=V.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");T.value.theme=="default"?Ye.attr("x",function(l,u){return u===0?0:e.direction?Math.abs(l.index-D)*$:Math.abs(K-l.index)*$}).attr("y",function(l,u){return e.direction?u===n.length-1?0:Le(l.liquityAmount):u===n.length-1?0:Le(n[u+1].liquityAmount)}).attr("width",function(l,u){return u===0&&n.length===1&&l.liquityAmount>0?P:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-l.index)*$:0)}).attr("height",function(l,u){return u===0&&n.length===1&&l.liquityAmount>0?A:e.direction?u===n.length-1?0:A-Le(l.liquityAmount):u===n.length-1?0:A-Le(n[u+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ye.attr("x",function(l,u){return u===0?0:e.direction?Math.abs(l.index-D)*$:Math.abs(K-l.index)*$}).attr("y",function(l,u){return e.direction?u===n.length-1?0:Le(Math.abs(l.liquityAmount)):u===n.length-1?0:Le(Math.abs(n[u+1].liquityAmount))}).attr("width",function(l,u){return u===0&&n.length===1&&l.liquityAmount>0?P:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-l.index)*$:0)}).attr("height",function(l,u){if(u===0&&n.length===1&&l.liquityAmount>0)return A;if(e.direction)return u===n.length-1?0:Number(l.liquityAmount)?A-Le(Math.abs(l.liquityAmount)):0;{if(u===n.length-1)return 0;const He=A-Le(Math.abs(n[u+1].liquityAmount));return Number(n[u+1].liquityAmount)?He:0}}).attr("fill",function(l,u){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(l,u){return"#417494"});const t=V.append("g");t.append("line").attr("x1",0).attr("y1",155).attr("x2",P).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const v=t.append("g");let b=0;if(e.direction){for(let l=0;l<L.length;l++){const u=me(je[l],_)||"0";je.push(u);const He=Math.abs(L[l]-D)*$;let pe=0;for(let ge=0;ge<u.length;ge++)u[ge]==="1"?pe+=4.02:u[ge]==="."?pe+=2.64:u[ge]==="7"?pe+=5.48:pe+=6;v.append("text").text(u).attr("x",He-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}b=Math.abs(Y-D)*$}else{for(let l=L.length-1;l>=0;l--){const u=me(je[l],_)||0;je.push(u);const He=Math.abs(L[l]-K)*$;let pe=0;for(let ge=0;ge<u.length;ge++)u[ge]==="1"?pe+=4.02:u[ge]==="."?pe+=2.64:u[ge]==="7"?pe+=5.48:pe+=6;v.append("text").text(u).attr("x",He-pe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}b=Math.abs(Y-K)*$}(T.value.theme=="default"?V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+b+", 0)");let E,X,ne,Me;e.direction?(E=x<D?-100:parseInt(String(Math.abs(x-D)*$)),X=F<D?-100:parseInt(String(Math.abs(F-D)*$)),ne=ie<D?-100:Math.abs(ie-D)*$,Me=we<D?-100:Math.abs(we-D)*$):(X=x<D?-100:Math.abs(K-x)*$,E=F<D?-100:Math.abs(K-F)*$,Me=ie>K?-100:Math.abs(K-ie)*$,ne=we>K?-100:Math.abs(K-we)*$),e.minPrice==="0"&&(E=0),e.maxPrice==="∞"&&(X=P),Ce.value,ke.value=P-E+87+"px",ce.value=X+98+"px",ie&&ne<P&&V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+ne+", 0)"),we&&Me<P&&V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Me+", 0)");const fe=V.append("g").attr("id","left-handle"),Te=V.append("g").attr("id","right-handle");T.value.theme=="default"?(fe.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),fe.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),fe.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),fe.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Te.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),Te.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(fe.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),fe.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),fe.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),fe.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Te.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),Te.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),fe.attr("transform","translate("+E+", 0)"),Te.attr("transform","translate("+X+", 0)");const Ee=ii().extent([[0,0],[P,A]]).handleSize(30).on("end",De);V.append("g").attr("class","brush").call(Ee).call(Ee.move,[E,X]);function De(l){if(!l.sourceEvent||!l.selection)return;fe.attr("transform","translate("+l.selection[0]+", 0)"),Te.attr("transform","translate("+l.selection[1]+", 0)"),Ce.value,ke.value=P-l.selection[0]+87+"px",ce.value=l.selection[1]+74+"px";let u,He,pe=0,ge=0;e.direction?(pe=S(parseInt(String(l.selection[0]/$+D)),Number(e.poolInfo.tickSpacing)),u=o.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ge=S(parseInt(String(l.selection[1]/$+D)),Number(e.poolInfo.tickSpacing)),He=o.tickIndexToPrice(ge,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()):(ge=S(K-l.selection[0]/$,Number(e.poolInfo.tickSpacing)),u=1/o.tickIndexToPrice(ge,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=S(K-l.selection[1]/$,Number(e.poolInfo.tickSpacing)),He=1/o.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),d.emit("onChangeMinPrice",String(me(String(u),6))),d.emit("onChangeMaxPrice",String(me(String(He),6)))}T.value.theme=="default"?lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):lt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};return B(""),qe(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,s,m,x,F,Y])=>{n&&s&&m&&(n!=null&&n.liquidity)&&Ie(n,F)},{immediate:!0}),{store:T,loading:k,rangeSizeLower:_e,rangeSizeUpper:H,rangeSizeLowerPosition:ke,rangeSizeUpperPosition:ce,decimalFormat:Zt,numberformat:ft}}});const fi=e=>(Mt("data-v-60bd7ae2"),e=e(),$t(),e),pi={class:"chart-box"},gi={class:"chart"},bi=fi(()=>r("svg",{id:"chart"},null,-1));function hi(e,d,ke,ce,M,_e){const H=qt;return R(),G("div",pi,[At(r("div",gi,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),G("div",{key:0,class:"range-size range-size-lower",style:gt({right:e.rangeSizeLowerPosition})},ue(("numberformat"in e?e.numberformat:de(ft))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):te("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),G("div",{key:1,class:"range-size range-size-upper",style:gt({left:e.rangeSizeUpperPosition})},ue(("numberformat"in e?e.numberformat:de(ft))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):te("",!0),bi],512),[[Gt,!e.chartLoading]]),e.chartLoading?(R(),Ke(H,{key:0})):te("",!0)])}const xt=it(vi,[["render",hi],["__scopeId","data-v-60bd7ae2"]]),ki=tt({props:{lever:{type:String,default:""}},setup(){return{}}});const wi=e=>(Mt("data-v-619778e2"),e=e(),$t(),e),yi={class:"lever"},Ci=wi(()=>r("div",{class:"lever-title"},"Leverage",-1)),_i={class:"lever-text"};function Ti(e,d,ke,ce,M,_e){return R(),G("div",yi,[Ci,r("div",_i,ue(e.lever),1)])}const Pi=it(ki,[["render",Ti],["__scopeId","data-v-619778e2"]]),Si=tt({components:{NewLiquidityD3Chart:xt,NewLiquidityPrice:Ot},setup(){const{t:e,locale:d}=Bt(),ke=B("liquidity"),ce=Ct(),M=q(()=>ce),_e=q(()=>M.value.chainName),H=It(),z=q(()=>H),T=q(()=>M.value.chainName?wt(M.value.chainName):{});Lt(()=>{Qe.value=!1});const J=yt(),o=q(()=>{let t=null;for(let v=0;v<z.value.poolConfigList.length;v++){const b=z.value.poolConfigList[v];b.address==J.query.poolAddress&&(t=b)}return t}),S=q(()=>{let t=null;for(const v in z.value.poolsObj){const b=z.value.poolsObj[v];b.address==J.query.poolAddress&&(t=b)}return t}),Q=B(),Ie=B(!0),Ce=async(t,v)=>{var b,I;if(Ie.value=!0,v){Ve.value=[],W.value=[];const E=t.token_a.decimals,X=t.token_b.decimals,ne=rt.tickIndexToPrice(t.current_tick_index,E,X);ct(rt.priceToTickIndex(new a(ne),(b=t.token_a)==null?void 0:b.decimals,(I=t.token_b)==null?void 0:I.decimals),Number(t.tickSpacing)),et.value=ne.toString(),st.value=new a(1).div(ne).toString(),h.value=t.needReverse?t.token_b:t.token_a,f.value=t.needReverse?t.token_a:t.token_b,Q.value=t.needReverse,t.token_a.address.toLowerCase()===h.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===f.value.address.toLowerCase()?ze.value=!0:ze.value=!1;let Me={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const fe=await T.value.getTicks(Me);Ve.value=fe?T.value.getTickDataFromUrlData(fe):[],Ie.value=!1,s(t)}},k=t=>{var E,X;const v=t.token_a.decimals,b=t.token_b.decimals,I=rt.tickIndexToPrice(t.current_tick_index,v,b);ct(rt.priceToTickIndex(new a(I),(E=t.token_a)==null?void 0:E.decimals,(X=t.token_b)==null?void 0:X.decimals),Number(t.tickSpacing)),et.value=I.toString(),st.value=new a(1).div(I).toString()},W=B([]),n=B(),s=t=>{const v=t.token_a.decimals,b=t.token_b.decimals;let I=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].recommend_ranges||{};const E=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].type||"";let X,ne;const Me=ct(t.current_tick_index,t.tickSpacing);n.value=t.current_tick_index,X=Me-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),ne=Me+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const fe=T.value.TickMath.tickIndexToPrice(X,v,b).toString(),Te=T.value.TickMath.tickIndexToPrice(ne,v,b).toString();I["full range"]={lower:T.value.TickUtil.getMinIndex(Number(S.value.tickSpacing)),upper:T.value.TickUtil.getMaxIndex(Number(S.value.tickSpacing))},I.custom={lower:X,upper:ne,minPrice:fe,maxPrice:Te};const Ee=[];for(let De in I)I[De]&&Ee.push({...I[De],key:De});E&&Ee&&Ee.length>2?t.isSelfBuilt?U.value="custom":E=="stable"?U.value="suggested":U.value="passive":U.value="custom",W.value=Ee,Je.value=I,F({key:U.value,...I[U.value]})},m=B(""),x=B(""),F=t=>{U.value=t.key.toLowerCase();const v=S.value.token_a.decimals,b=S.value.token_b.decimals,{lower:I,upper:E}=t;xe.value=!1;const X=T.value.TickMath.tickIndexToPrice(I,v,b).toString(),ne=T.value.TickMath.tickIndexToPrice(E,v,b).toString();if(t.key=="full range"){m.value=I,x.value=E,Y();return}ze.value?(mt.value=String(X),O.value=String(X),vt.value=String(ne),N.value=String(ne),m.value=I,x.value=E):(mt.value=String(1/Number(ne)),O.value=String(1/Number(ne)),vt.value=String(1/Number(X)),N.value=String(1/Number(X)),m.value=T.value.TickMath.priceToTickIndex(new a(1/Number(ne)),v,b),x.value=T.value.TickMath.priceToTickIndex(new a(1/Number(X)),v,b))},Y=t=>{O.value="0",N.value="∞"};qe(()=>S.value,(t,v)=>{(!v&&t&&!Se(t)||v&&t&&v.address!==t.address)&&Ce(t,!v||t.address!==v.address),t&&!Se(t)&&k(t)},{immediate:!0}),Rt(()=>{h.value=B(),f.value=B(),Ve.value=[]}),qe(()=>[o.value,S.value,z.value.recommendRangesObj],(t,v)=>{var b,I;(!v||t[0]&&t[1]&&t[2]&&!Se(t[0])&&!Se(t[1]&&!Se(t[2]))||((b=t[0])==null?void 0:b.address)!==((I=v[0])==null?void 0:I.address))&&t[0]&&t[2]&&!Se(t[0])&&!Se(t[2])&&H.setSinglePool(t[0],t[2],_e.value)},{immediate:!0,deep:!0});const ie=t=>{if(_e.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},we=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},p=t=>{var b,I;const v=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[(b=S.value)==null?void 0:b.address]&&z.value.poolPriceConfigObj[(I=S.value)==null?void 0:I.address].type||"";if(W.value.length>2)if(v=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(v=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},P=B(1),A=()=>{const t=P.value/2;P.value=t},ve=()=>{const t=P.value*2;P.value=t},g=q(()=>{var t,v,b;return!S.value||Se(M.value.addressHistTokens)||!M.value.addressHistTokens[(t=S.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((b=M.value.addressHistTokens[(v=S.value)==null?void 0:v.poolAddress])==null?void 0:b.data.map(I=>[I.key,I.value]))}),L=B(30),D=B("30D"),K=q(()=>ze.value?g.value&&me(L.value==7?g.value.before_7_d_contract_price_lowest:L.value==24?g.value.before_24_h_contract_price_lowest:g.value.before_30_d_contract_price_lowest,6)||0:g.value&&me(new a(1).div(L.value==7?g.value.before_7_d_contract_price_highest:L.value==24?g.value.before_24_h_contract_price_highest:g.value.before_30_d_contract_price_highest).toString(),6)||0),$=q(()=>ze.value?g.value&&me(L.value==7?g.value.before_7_d_contract_price_highest:L.value==24?g.value.before_24_h_contract_price_highest:g.value.before_30_d_contract_price_highest,6)||0:(g.value&&me(1/Number(L.value==7?g.value.before_7_d_contract_price_lowest:L.value==24?g.value.before_24_h_contract_price_lowest:g.value.before_30_d_contract_price_lowest),6))==1/0?0:g.value&&me(1/Number(L.value==7?g.value.before_7_d_contract_price_lowest:L.value==24?g.value.before_24_h_contract_price_lowest:g.value.before_30_d_contract_price_lowest),6)||0),je=q(()=>{const t=Number(O.value),v=Number(N.value);if(O.value=="0"&&N.value=="∞"||U.value=="full range")return"1x";if(O.value==N.value||U.value=="full range")return"--";if(O.value&&N.value&&O.value!=="0"&&N.value!=="∞"){const b=pt(1/(1-Number((t/v)**.25)),2);return Number(b)>0?b+"x":"--"}else return 1}),_=q(()=>{var t,v,b,I,E,X;return((t=h.value)==null?void 0:t.isSelfBuilt)||((v=f.value)==null?void 0:v.isSelfBuilt)||((I=z.value.tokensObj[(b=h.value)==null?void 0:b.address])==null?void 0:I.isSelfBuilt)||((X=z.value.tokensObj[(E=f.value)==null?void 0:E.address])==null?void 0:X.isSelfBuilt)}),V=(t,v)=>{t!==O.value&&U.value=="full range"?F({key:"custom",...W.value.custom}):U.value!=="full range"&&U.value!=="custom"?(U.value="custom",O.value=t):O.value=t},Ge=(t,v)=>{t!==N.value&&U.value=="full range"?F({key:"custom",...W.value.custom}):U.value!=="full range"&&U.value!=="custom"?(U.value="custom",t=="0"?N.value="∞":N.value=t):t=="0"?N.value="∞":N.value=t};return qe(()=>[O.value,N.value],([t,v])=>{},{deep:!0,immediate:!0}),{positionError:Qe,getCoinIcon:t=>{var v;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((v=z.value.tokensObj[t==null?void 0:t.address])==null?void 0:v.logo_url)||(M.value.theme==="default"?kt("/image/coins/unknown.png"):kt("/image/coins/sui-unknown.png"))},chainName:_e,store:M,currentTab:ke,currentPrice:et,currentPriceReverse:st,fromCoin:h,toCoin:f,direction:ze,needReverse:Q,addCommom:Ne,decimalUi:me,priceTablList:W,currentPriceTab:U,sliderStyle:p,poolInfo:S,tickList:Ve,getPriceTabImage:ie,getPriceTabText:we,defaultMinPrice:mt,defaultMaxPrice:vt,minPrice:O,maxPrice:N,currentTick:n,chartLoading:Ie,zoomOut:A,zoomIn:ve,zoom:P,priceTab:F,before7dContractPriceLowest:K,before7dContractPriceHighest:$,aprRewardsTime:D,lever:je,aprRewardsParameter:L,isSelfBuilt:_,priceRangeChangeMin:V,priceRangeChangeMax:Ge,toggle:Ht,getPirceTabTips:t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},timeList:[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}]}}});const Ni={class:"new-liquidity-left"},Ii=r("span",{class:"selectRange"},"Select Range",-1),Li={class:"price-info"},Ai={class:"left"},qi={class:"base-coin"},Mi={class:"base-coin-title"},$i=r("span",null,"Base coin",-1),Bi=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),Ri=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),Fi=[Bi,Ri],Oi={class:"base-coin-bottom"},Ui={alt:""},zi={class:"current-price"},ji=r("div",{class:"current-price-title"},"Current Price",-1),Hi={key:0,class:"from-pre-to"},xi={class:"right"},Ei={class:"price-range"},Xi={class:"left"},Wi={class:"price-slider"},Di={class:"slider"},Zi=r("div",{class:"slider-ratio-content"},null,-1),Gi=[Zi],Ji={class:"price-tab-list"},Ki=["onClick"],Qi=["src"],Yi={class:"right"},Vi={class:"price-zoom"},en={class:"current-price"},tn=r("div",{class:"current-price-title"},"Current Price",-1),nn={key:0,class:"from-pre-to"},an={class:"price-zoom-right"},on={class:"leverage"},rn=r("div",{class:"left"},null,-1),ln={class:"right"},sn={class:"right-time"},un={key:0,class:"day-7-price-range"},cn=r("i",null,null,-1),dn={class:"gray"},mn={class:"time-list"},vn=["onClick"],fn={class:"right-price-h5"},pn={class:"apr-leverage"},gn={key:0,class:"position-tips"},bn=["src"],hn={class:"error"};function kn(e,d,ke,ce,M,_e){var S,Q,Ie,Ce,k,W,n;const H=Kt,z=xt,T=Pi,J=Ot,o=Jt("image");return R(),G("div",Ni,[Ii,r("div",Li,[r("div",Ai,[r("div",qi,[r("div",Mi,[$i,r("div",{class:"change-price",onClick:d[0]||(d[0]=(...s)=>e.toggle&&e.toggle(...s))},Fi)]),r("div",Oi,[At(r("img",Ui,null,512),[[o,e.getCoinIcon(e.fromCoin)]]),r("span",null,ue((S=e.fromCoin)==null?void 0:S.symbol),1)])]),r("div",zi,[ji,r("div",null,[r("span",null,ue(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPrice,6)):("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),G("span",Hi,ue((Q=e.toCoin)==null?void 0:Q.symbol)+" per "+ue((Ie=e.fromCoin)==null?void 0:Ie.symbol),1)):te("",!0)])])]),r("div",xi,[e.currentTab=="liquidity"?(R(),G("div",{key:0,class:"zoom-out",onClick:d[1]||(d[1]=(...s)=>e.zoomOut&&e.zoomOut(...s))}," + ")):te("",!0),e.currentTab=="liquidity"?(R(),G("div",{key:1,class:"zoom-in",onClick:d[2]||(d[2]=(...s)=>e.zoomIn&&e.zoomIn(...s))}," - ")):te("",!0)])]),r("div",Ei,[r("div",Xi,[r("div",Wi,[r("div",Di,[r("div",{class:"slider-ratio",style:gt(e.sliderStyle(e.currentPriceTab))},Gi,4)])]),r("div",Ji,[(R(!0),G(bt,null,Pt(e.priceTablList,s=>(R(),G("div",{key:s.key,class:dt(["price-tab-item",e.currentPriceTab==s.key?"price-tab-item-active":""]),onClick:m=>e.priceTab(s)},[Ue(H,{placement:"bottom","arrow-point-at-center":""},{title:ht(()=>[Ft(ue(e.getPirceTabTips(s.key)),1)]),default:ht(()=>[r("img",{src:e.getPriceTabImage(s.key),alt:""},null,8,Qi),r("span",null,ue(e.getPriceTabText(s.key)),1)]),_:2},1024)],10,Ki))),128))])]),r("div",Yi,[r("div",Vi,[r("div",en,[tn,r("div",null,[r("span",null,ue(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPrice,6)):("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),G("span",nn,ue(e.direction&&!e.needReverse?`${(Ce=e.fromCoin)==null?void 0:Ce.symbol} per ${(k=e.toCoin)==null?void 0:k.symbol}`:`${(W=e.toCoin)==null?void 0:W.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):te("",!0)])]),r("div",an,[e.currentTab=="liquidity"?(R(),G("div",{key:0,class:"zoom-out",onClick:d[3]||(d[3]=(...s)=>e.zoomOut&&e.zoomOut(...s))}," + ")):te("",!0),e.currentTab=="liquidity"?(R(),G("div",{key:1,class:"zoom-in",onClick:d[4]||(d[4]=(...s)=>e.zoomIn&&e.zoomIn(...s))}," - ")):te("",!0)])]),e.poolInfo?(R(),Ke(z,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):te("",!0)])]),r("div",on,[rn,r("div",ln,[r("div",sn,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(R(),G("div",un,[cn,r("span",dn,ue(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,ue(("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceHighest,6))),1)])):te("",!0),r("div",mn,[(R(!0),G(bt,null,Pt(e.timeList,s=>(R(),G("div",{key:s.value,class:dt(["time-item",s.value==e.aprRewardsParameter?"time-item-active":""]),onClick:m=>e.aprRewardsParameter=s.value},ue(s.label),11,vn))),128))])]),r("div",fn,[r("span",null,ue(("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:de(Ne))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceHighest,6))),1)])])]),r("div",{class:dt(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[r("div",pn,[Ue(T,{lever:e.lever},null,8,["lever"])]),Ue(J,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(R(),G("div",gn,[r("img",{src:("importIcon"in e?e.importIcon:de(kt))("/image/icon-tips-error@2x.png"),alt:""},null,8,bn),r("p",hn,ue(e.$t("tips.positionError")),1)])):te("",!0)],2)])}const Et=it(Si,[["render",kn]]),wn=tt({components:{NewLiquidityTitle:Ut,NewLiquidityAssetsCard:zt,NewLiquidityDepositRatio:jt},setup(){const{t:e,locale:d}=Bt(),ke=Ct(),ce=q(()=>ke),M=q(()=>ce.value.chainName),_e=It(),H=q(()=>_e),z=ni(),T=q(()=>z),J=yt(),o=q(()=>{let i=null;for(const c in H.value.poolsObj){const w=H.value.poolsObj[c];w.address==J.query.poolAddress&&(i=w)}return i}),S=B(!1),Q=B(!1),Ie=q(()=>ce.value.theme),Ce=async(i,c)=>{h.value=i.needReverse?i.token_b:i.token_a,f.value=i.needReverse?i.token_a:i.token_b,y.value="",C.value=""},k=q(()=>T.value.assets&&h.value&&T.value.assets[h.value.address]?_t(T.value.assets[h.value.address].balance,h.value.decimals):"0"),W=q(()=>T.value.assets&&f.value&&T.value.assets[f.value.address]?_t(T.value.assets[f.value.address].balance,f.value.decimals):"0"),n=i=>{i==="fromCoin"?(ye.value=!0,M.value==="Aptos"?y.value=Number(k.value)>0?h.value.symbol=="APT"?new a(Number(k.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(k.value)).sub(new a(.1)).toString():String(k.value):"":y.value=Number(k.value)>0?h.value.symbol=="SUI"?new a(Number(k.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(k.value)).sub(new a(.05)).toString():String(k.value):""):(ye.value=!1,M.value==="Aptos"?C.value=Number(W.value)>0?f.value.symbol=="APT"?new a(Number(W.value)).sub(new a(.1)).lt(new a(0))?"0":new a(Number(W.value)).sub(new a(.1)).toString():String(W.value):"":C.value=Number(W.value)>0?f.value.symbol=="SUI"?new a(Number(W.value)).sub(new a(.05)).lt(new a(0))?"0":new a(Number(W.value)).sub(new a(.05)).toString():String(W.value):"")},s=i=>{i==="fromCoin"?(ye.value=!0,y.value=Number(k.value)>0?pt(new a(Number(k.value)).div(2).toString(),h.value.decimals).toString():""):(ye.value=!1,C.value=Number(W.value)>0?pt(new a(Number(W.value)).div(2).toString(),f.value.decimals).toString():"")},m=B(),x=B(),F=B(),Y=B(!1),ie=i=>{var c,w,ae,j;m.value=i,i==="fromCoin"?(x.value=((c=f.value)==null?void 0:c.address)||"",F.value=J.query.actions=="new-position"?(w=h.value)==null?void 0:w.address:o.value.needReverse?o.value.token_b.address:o.value.token_a.address):(x.value=((ae=h.value)==null?void 0:ae.address)||"",F.value=J.query.actions=="new-position"?(j=f.value)==null?void 0:j.address:o.value.needReverse?o.value.token_a.address:o.value.token_b.address),Y.value=!0},we=i=>{var ae,j,oe,re,ee,le,se,be;const c=o.value.needReverse?o.value.token_b:o.value.token_a,w=o.value.needReverse?o.value.token_a:o.value.token_b;m.value==="fromCoin"?(((ae=h.value)==null?void 0:ae.address)===(c==null?void 0:c.address)||!((j=h.value)!=null&&j.address)?(f.value&&i.address.toLowerCase()===((oe=f)==null?void 0:oe.value.address.toLowerCase())&&(f.value=null),h.value=i):(h.value&&i.address.toLowerCase()===((re=h)==null?void 0:re.value.address.toLowerCase())&&(h.value=null),f.value=i),J.query.action||(J.query.fee="")):((ee=f.value)==null?void 0:ee.address)===(w==null?void 0:w.address)||!((le=f.value)!=null&&le.address)?(h.value&&i.address.toLowerCase()===((se=h)==null?void 0:se.value.address.toLowerCase())&&(h.value=null),f.value=i):(f.value&&i.address.toLowerCase()===((be=f)==null?void 0:be.value.address.toLowerCase())&&(f.value=null),h.value=i),Y.value=!1},p=q(()=>ce.value.chainName?wt(ce.value.chainName):{}),P=q(()=>ce.value.slippage),A=B(),ve=async()=>{var Be,$e,Re,Fe;if(xe.value||!O.value&&!N.value)return!1;if(!y.value&&!C.value&&!O.value&&!N.value)return;const i=o.value||{};if(Se(i))return;const{TickUtil:c,TickMath:w,getNearestTickByTick:ae}=p.value,j=i==null?void 0:i.token_a.decimals,oe=i==null?void 0:i.token_b.decimals;let re,ee,le,se,be,Pe,Xe,Ze,Ae=i==null?void 0:i.current_tick_index,Z;if(i.token_a.address.toLowerCase()===h.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===f.value.address.toLowerCase()?Z=!0:Z=!1,O.value==="0"&&N.value==="∞")le=c.getMinIndex(Number(i.tickSpacing)),se=c.getMaxIndex(Number(i.tickSpacing)),be=w.tickIndexToSqrtPriceX64(le),Pe=w.tickIndexToSqrtPriceX64(se);else if(U.value=="custom"){Z?(re=O.value,ee=N.value):(re=N.value!=="∞"?new a(1).div(N.value).toString():1/0,ee=new a(1).div(O.value).toString());try{Xe=new a(re).equals(new a(0))?-443636:w.priceToTickIndex(new a(re),j,oe)}catch{Xe=-443636}try{Ze=w.priceToTickIndex(new a(ee),j,oe)}catch{Ze=443636}le=ae(Xe,Number(i.tickSpacing),!0),se=ae(Ze,Number(i.tickSpacing),!0);try{be=w.priceToSqrtPriceX64(new a(re),j,oe)}catch{(ee===1/0||ee==="∞")&&(be=w.tickIndexToSqrtPriceX64(c.getMinIndex(Number(i.tickSpacing))))}try{Pe=w.priceToSqrtPriceX64(new a(ee),j,oe)}catch{(ee===1/0||ee==="∞")&&(Pe=w.tickIndexToSqrtPriceX64(c.getMaxIndex(Number(i.tickSpacing))))}}else le=(Be=Je.value[U.value])==null?void 0:Be.lower,se=($e=Je.value[U.value])==null?void 0:$e.upper,be=w.tickIndexToSqrtPriceX64(le),Pe=w.tickIndexToSqrtPriceX64(se);if(N.value!=="∞"&&le>=se){S.value=!0,y.value="",Q.value=!0,C.value="";return}if(N.value==="∞"||Ae>=le&&Ae<se){S.value=!1,Q.value=!1;let he;if(y.value||C.value){if(ye.value){const ut=new a(y.value).mul(Math.pow(10,h.value.decimals)).toString();he=new Oe(ut)}else{const ut=new a(C.value).mul(Math.pow(10,f.value.decimals)).toString();he=new Oe(ut)}const{liquidityAmount:We,tokenMaxA:at,tokenMaxB:ot,tokenMaxAOrigin:Wt,tokenMaxBOrigin:Dt}=p.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:i.token_a,tokenB:i.token_b,lowerTick:le,upperTick:se,coinAmount:he,iscoinA:Z?ye.value:!ye.value,roundUp:!0,slippage:Number(P.value)/100,curSqrtPrice:new Oe(i.current_sqrt_price)});A.value={liquidityAmount:We,tokenMaxA:at,tokenMaxB:ot,tokenMaxAOrigin:Wt,tokenMaxBOrigin:Dt},Z?ye.value?C.value=Number(ot)>0?ot:"":y.value=Number(at)>0?at:"":ye.value?C.value=at:y.value=ot}}else if(Ae>=se){if(Z?y.value="":C.value="",S.value=Z,Q.value=!Z,y.value||C.value){let he;if(Z){const We=new a(C.value).mul(Math.pow(10,(Re=f.value)==null?void 0:Re.decimals)).toString();he=new Oe(We),A.value={liquidityAmount:p.value.estimateLiquidityForCoinB(be,Pe,he),tokenMaxA:0,tokenMaxB:C.value}}else{const We=new a(y.value).mul(Math.pow(10,(Fe=h.value)==null?void 0:Fe.decimals)).toString();he=new Oe(We),A.value={liquidityAmount:p.value.estimateLiquidityForCoinB(be,Pe,he),tokenMaxA:0,tokenMaxB:y.value}}}}else if(Ae<le){if(S.value=!Z,Q.value=Z,Z?C.value="":y.value="",y.value||C.value){let he;if(Z){const We=new a(y.value).mul(Math.pow(10,h.value.decimals)).toString();he=new Oe(We),A.value={liquidityAmount:p.value.estimateLiquidityForCoinA(be,Pe,he),tokenMaxA:y.value,tokenMaxB:0}}else{const We=new a(C.value).mul(Math.pow(10,f.value.decimals)).toString();he=new Oe(We),A.value={liquidityAmount:p.value.estimateLiquidityForCoinA(be,Pe,he),tokenMaxA:C.value,tokenMaxB:0}}}}else S.value=!0,y.value="",Q.value=!0,C.value=""};qe(()=>o.value,(i,c)=>{(!c&&i&&!Se(i)||c&&i&&c.address!==i.address)&&Ce(i,!c||i.address!==c.address),i&&!Se(i)&&ve()},{immediate:!0}),qe(y,(i,c)=>{i==""&&ye.value&&(C.value=""),i&&ye.value&&!xe.value&&ve()}),qe(C,(i,c)=>{i==""&&!ye.value&&(y.value=""),i&&!ye.value&&!xe.value&&ve()}),qe(()=>ze.value,(i,c)=>{ve()}),qe(()=>[h.value,f.value],([i,c])=>{i&&c&&(S.value=!1,Q.value=!1)});const g=B("--"),L=q(()=>H.value.RATES),D=()=>{const i=L.value&&L.value[h.value.address]&&L.value[h.value.address].price,c=L.value&&L.value[f.value.address]&&L.value[f.value.address].price;if(i&&c){const w=new a(y.value>0?y.value:0).mul(i),ae=new a(C.value>0?C.value:0).mul(c),j=w.add(ae).toNumber();g.value=j>0&&j<.01?"<$0.01":"$"+Ne(j,2)}else g.value="--"};qe(()=>[y.value,C.value,xe.value],([i,c,w])=>{(i||c)&&!w?D():(!i||!c)&&!w&&(g.value="--")},{immediate:!0}),qe(()=>g,i=>{},{immediate:!0});const K=B(),$=async()=>{var Z,Be;if(!O.value&&!N.value)return!1;if(!y.value&&!C.value&&!O.value&&!N.value)return;const i=o.value;if(Se(i))return;const{TickUtil:c,TickMath:w,getNearestTickByTick:ae}=p.value,j=i==null?void 0:i.token_a.decimals,oe=i==null?void 0:i.token_b.decimals;let re,ee,le,se,be,Pe,Xe;if(i.token_a.address.toLowerCase()===h.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===f.value.address.toLowerCase()?Xe=!0:Xe=!1,O.value==="0"&&N.value==="∞")le=c.getMinIndex(Number(i.tickSpacing)),se=c.getMaxIndex(Number(i.tickSpacing));else if(U.value=="custom"){Xe?(re=Number(O.value),ee=Number(N.value)):(re=new a(1).div(N.value).toString(),ee=new a(1).div(O.value).toString());try{be=re==0?-443636:w.priceToTickIndex(new a(re),j,oe)}catch{be=-443636}try{Pe=w.priceToTickIndex(new a(ee),j,oe)}catch{Pe=443636}le=ae(be,Number(i.tickSpacing),!0),se=ae(Pe,Number(i.tickSpacing),!0)}else le=(Z=Je.value[U.value])==null?void 0:Z.lower,se=(Be=Je.value[U.value])==null?void 0:Be.upper;const Ze=L.value[i==null?void 0:i.token_a.address].price,Ae=L.value[i==null?void 0:i.token_b.address].price;ze.value?new Oe(i.current_sqrt_price):new Oe(1/i.current_sqrt_price);try{const{amountA:$e,amountB:Re,tokenAmountsInfo:Fe}=await p.value.estCoinAmountsFromTotalAmount({lowerTick:le,upperTick:se,decimalsA:j,decimalsB:oe,curSqrtPrice:new Oe(i.current_sqrt_price),totalAmount:g.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:Ae});K.value=Fe,i.needReverse?ze.value?(y.value=$e,C.value=Re):(y.value=Re,C.value=$e):(y.value=$e,C.value=Re)}catch{}};qe([O,N],([i,c])=>{xe.value?xe.value&&$():ve(),c!=="∞"&&Number(i)!==0&&Number(c)!==0&&Number(i)>=Number(c)?Qe.value=!0:Qe.value=!1,Number(i)==0&&Number(c)==0&&et.value&&(Qe.value=!0)},{deep:!0,immediate:!0});const je=i=>{const c=i.replace(/[^\d.]/g,""),w="$"+Ne(c);xe.value=!0,g.value=w,c>0?$():(y.value="",C.value="")},_=B(!1),{setTransactionTxid:V,setTransactionDesc:Ge,setIsShowWaiting:Le,setIsShowSuccess:nt,setPositiomNum:Ye,setIsShowRejected:t}=ke,v=ci(),b=q(()=>H.value.currentPositionInfo),I=B(!1),E=async i=>{var be,Pe,Xe,Ze;_.value=!1,H.value.currentPositionInfo={},V(""),Ge(e("tips.increaseLiquiditySuccess",{from:S.value?"":`${Ne(y.value)} ${(be=h.value)==null?void 0:be.symbol}`,and:!S.value&&!Q.value?"and":"",to:Q.value?"":`${Ne(C.value)} ${(Pe=f.value)==null?void 0:Pe.symbol}`})),Le(!0);const c=ze.value?ye.value:!ye.value;let w,ae,j,oe,re,ee;const le=o.value.token_a.decimals,se=o.value.token_b.decimals;if(O.value==="0"&&N.value==="∞")j=p.value.TickUtil.getMinIndex(Number(o.value.tickSpacing)),oe=p.value.TickUtil.getMaxIndex(Number(o.value.tickSpacing));else if(U.value=="custom"){ze.value?(w=Number(O.value),ae=Number(N.value)):(w=new a(1).div(N.value).toString(),ae=new a(1).div(O.value).toString());try{re=w==0?p.value.TickUtil.getMinIndex(Number(o.value.tickSpacing)):p.value.TickMath.priceToTickIndex(new a(Number(w).toFixed(6)),le,se)}catch{re=p.value.TickUtil.getMinIndex(Number(o.value.tickSpacing))}try{ee=p.value.TickMath.priceToTickIndex(new a(Number(ae).toFixed(6)),le,se)}catch{ee=p.value.TickUtil.getMaxIndex(Number(o.value.tickSpacing))}j=p.value.getNearestTickByTick(re,Number(o.value.tickSpacing),!0),oe=p.value.getNearestTickByTick(ee,Number(o.value.tickSpacing),!0)}else j=Je.value[U.value].lower,oe=Je.value[U.value].upper;try{let Ae;xe.value?Ae=await p.value.getCreateAddLiquidityPayload({pool:o.value,curSqrtPrice:new Oe(o.value.current_sqrt_price),tickLower:j,tickUpper:oe,slippage:Number(P.value)/100,tokenAmounts:K.value}):Ae=await p.value.getAddLiquidityTransactionPayload({pool:{poolAddress:o.value.poolAddress,token_a:o.value.token_a,token_b:o.value.token_b},amount:ye.value?y.value:C.value,fix_amount_a:c,tick_lower:j,tick_upper:oe,index:0,slippage:Number(P.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new Oe(o.value.current_sqrt_price)});let Z;if(M.value==="Aptos")Z=await T.value.currentWallet.signAndSubmitTransaction(Ae);else{const Be=await T.value.currentWallet.signAndExecuteTransactionBlock(Ae);Z=p.value.handleTx(Be)}if(Z&&Z.hash){V(Z.hash),Le(!1),nt(!0);let Be;o.value.needReverse?o.value.token_a.address.toLowerCase()===h.value.address.toLowerCase()&&o.value.token_b.address.toLowerCase()===f.value.address.toLowerCase()?Be=!1:Be=!0:o.value.token_a.address.toLowerCase()===h.value.address.toLowerCase()&&o.value.token_b.address.toLowerCase()===f.value.address.toLowerCase()?Be=!0:Be=!1;const $e={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:S.value?"":`${Ne(y.value)} ${(Xe=h.value)==null?void 0:Xe.symbol}`,and:!S.value&&!Q.value?"and":"",to:Q.value?"":`${Ne(C.value)} ${(Ze=f.value)==null?void 0:Ze.symbol}`}),hash:Z.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};M.value!=="Aptos"&&($e.res=Z.res),p.value.showTransitionPending($e);const Re=await p.value.watchTransaction($e,!0);if(Re.status){if(nt(!1),H.value.setCurrentPositionLoading(!0),I.value=!0,M.value==="Aptos"){if(await H.value.setCurrentPositionInfo(Re.nftInfo[0].data.id.creator,Re.nftInfo[0].data.id.collection,Re.nftInfo[0].data.name,M.value),i)try{await v.subscribePosition({pool_address:b.value.poolAddress,position_index:b.value.index},b.value.nftHash)}catch{}}else{const Fe=Re.nftInfo,he=await Tt(2e3);if(await H.value.setCurrentPositionInfo(Fe==null?void 0:Fe.pool,"","",M.value,Fe==null?void 0:Fe.position),await Tt(1e3),i)try{await v.subscribePosition({pool_address:b.value.poolAddress,position_index:b.value.index},b.value.nftHash)}catch{}}setTimeout(()=>{_e.updateCurrentPools(o.value.poolAddress,M.value),p.value.getAccount(T.value.address)},3e3),setTimeout(async()=>{St(p,o)},3e3)}Ye()}else Le(!1),t(!0);y.value="",C.value=""}catch{y.value="",C.value="",Le(!1),t(!0)}},X=q(()=>!!(!y.value&&!C.value||Number(y.value)>Number(k.value)||Number(C.value)>Number(W.value)||Me.value!==e("button.addLiquidity")&&Me.value!==e("newAdd.preview")||o.value&&o.value&&o.value.is_pause||Number(y.value)<=0&&Number(C.value)<=0||!S.value&&Number(y.value)==0||!Q.value&&Number(C.value)==0)),ne=q(()=>!h.value||!f.value),Me=q(()=>o.value&&o.value.is_pause?"Pool Closed":!h.value||!f.value||ne.value?e("modal.selectTokenModalTitle"):Number(y.value)>Number(k.value)?e("button.insufficientBalance",{name:h.value.symbol}):Number(C.value)>Number(W.value)?e("button.insufficientBalance",{name:f.value.symbol}):!Number(y.value)&&!Number(C.value)?e("button.enterAmount"):N.value!=="∞"&&Number(O.value)>=Number(N.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),fe=B({}),Te=B({}),Ee=B(!1),De=(i,c)=>{const w=localStorage.getItem(i.address);H.value.tokensObj&&H.value.tokensObj[i.address]&&H.value.tokensObj[i.address].isSelfBuilt&&!w&&(c=="fromCoin"&&(fe.value=i),c=="toCoin"&&(Te.value=i),Ee.value=!0)};qe(()=>[h.value,f.value],([i,c])=>{i&&!Se(i)&&De(i,"fromCoin"),c&&!Se(c)&&De(c,"toCoin")},{immediate:!0});const l=Qt(),u=()=>{M.value!=="Aptos"?l.push("/pool/list"):l.push("/pools")},He=i=>{xe.value,E(i)},pe=()=>{J.query.action!=="create-pool"&&J.query.actions!=="new-position"&&(St(p,o),ve(),_e.updateCurrentPools(o.value.poolAddress,M.value)),_e.setPoolConfigList(M.value,ce.value.filterCoinsObj)},ge=q(()=>{var w,ae,j,oe,re,ee;const i=(j=L.value[(ae=(w=h)==null?void 0:w.value)==null?void 0:ae.address])==null?void 0:j.price,c=(ee=L.value[(re=(oe=f)==null?void 0:oe.value)==null?void 0:re.address])==null?void 0:ee.price;return!!(i&&c)});return qe(()=>[J,H.value.tokensObj],([i,c])=>{var w;c&&!Se(c)&&(f.value||(f.value=H.value.tokensObj[(w=i==null?void 0:i.query)==null?void 0:w.toCoin]))},{immediate:!0,deep:!0}),{positionError:Qe,decimalUi:me,poolInfo:o,fromCoinAmount:y,toCoinAmount:C,fromCoin:h,toCoin:f,theme:Ie,showFromCoinLock:S,showToCoinLock:Q,fromCoinBlance:k,toCoinBlance:W,maxBtnSelect:n,halfBtnSelect:s,fixedFromCoin:ye,openCoinSelect:ie,currentCoinKey:m,existingCoins:x,lastSelectCoin:F,showCoinSelect:Y,onCoinSelect:we,liquidityTotalAmount:g,toggle:Ht,onInput:je,isInputTotalAmount:xe,isViewDetail:I,addLiquidityBtnDisabled:X,addLiquidityBtnText:Me,isShowTokenWarning:Ee,chainName:M,closeTokenWarning:u,warningFromCoin:fe,warningToCoin:Te,isShowLiquidityModal:_,currentPrice:et,currentPriceReverse:st,currentPriceTab:U,minPrice:O,maxPrice:N,toAdd:E,direction:ze,wallet:T,getAddLiquidityType:He,clickRefresh:pe,isShowtotalAmount:ge}}});const yn={class:"new-liquidity-right"},Cn={class:"deposit-title"},_n={class:"card-container"},Tn={key:0,class:"lock"},Pn={class:"card-item"},Sn={class:"card-item"},Nn={key:0,class:"total-amount"},In=r("span",null,"Total Amount",-1);function Ln(e,d,ke,ce,M,_e){const H=Ut,z=ai,T=zt,J=ri,o=jt,S=Yt,Q=li,Ie=si,Ce=ui;return R(),G("div",yn,[r("div",Cn,[Ue(H,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",_n,[e.positionError?(R(),G("div",Tn,[Ue(z)])):te("",!0),r("div",Pn,[Ue(T,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":d[0]||(d[0]=k=>e.fromCoinAmount=k),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:d[1]||(d[1]=k=>e.maxBtnSelect("fromCoin")),onOnHalf:d[2]||(d[2]=k=>e.halfBtnSelect("fromCoin")),onOnInput:d[3]||(d[3]=k=>{e.fromCoinAmount=k,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:d[4]||(d[4]=k=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(R(),Ke(J,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),r("div",Sn,[Ue(T,{modelValue:e.toCoinAmount,"onUpdate:modelValue":d[5]||(d[5]=k=>e.toCoinAmount=k),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:d[6]||(d[6]=k=>e.maxBtnSelect("toCoin")),onOnHalf:d[7]||(d[7]=k=>e.halfBtnSelect("toCoin")),onOnInput:d[8]||(d[8]=k=>{e.toCoinAmount=k,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:d[9]||(d[9]=k=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(R(),Ke(J,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(R(),G("img",{key:1,class:"add",src:di,alt:"",onClick:d[10]||(d[10]=(...k)=>e.toggle&&e.toggle(...k))})):te("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(R(),G("img",{key:2,class:"add",src:mi,alt:"",onClick:d[11]||(d[11]=(...k)=>e.toggle&&e.toggle(...k))})):te("",!0)]),e.isShowtotalAmount?(R(),G("div",Nn,[In,r("span",null,ue(e.liquidityTotalAmount)+" ",1)])):te("",!0),Ue(o,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Ue(S,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:d[12]||(d[12]=k=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:ht(()=>[Ft(ue(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(R(),Ke(Q,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:d[13]||(d[13]=k=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):te("",!0),e.isViewDetail?(R(),Ke(Ie,{key:2,"pool-info":e.poolInfo,onOnClose:d[14]||(d[14]=k=>e.isViewDetail=!1)},null,8,["pool-info"])):te("",!0),e.isShowLiquidityModal?(R(),Ke(Ce,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:d[15]||(d[15]=k=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):te("",!0)])}const Xt=it(wn,[["render",Ln]]),An=tt({components:{NewLiquidityLeft:Et,NewLiquidityRight:Xt},setup(){Rt(()=>{oi()});const e=yt();return{tickList:Ve,route:e}}});const qn={key:0,class:"loading-spin-liquidity loading-global"},Mn={class:"privide-liquidity"};function $n(e,d,ke,ce,M,_e){var J,o;const H=qt,z=Et,T=Xt;return R(),G(bt,null,[!e.tickList&&((o=(J=e.route)==null?void 0:J.query)!=null&&o.poolAddress)?(R(),G("div",qn,[Ue(H)])):te("",!0),r("div",Mn,[Ue(z),Ue(T)])],64)}const da=it(An,[["render",$n],["__scopeId","data-v-fc58011a"]]);export{da as default};
