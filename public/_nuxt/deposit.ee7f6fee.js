import{b as ht,i as Dt,n as dt,d as de,u as Nt,c as Me,s as mt,a as Se,T as yt,p as Ct,e as Oe,j as _t}from"./pool.dbcfb6f6.js";import{a as Ve,r as B,l as q,J as Lt,q as Ae,e as et,o as R,f as D,t as It,P as Zt,h as o,Q as vt,v as se,u as ce,x as V,c as Je,S as At,p as qt,k as Mt,y as $t,m as kt,N as Bt,s as Gt,F as ft,G as Tt,C as st,i as Fe,w as pt,j as Rt,R as Jt,b as Kt,B as Qt}from"./entry.02c0c2d5.js";/* empty css              */import{s as rt,m as Yt,l as Vt,b as ei,a as ti}from"./transform.c672907f.js";import{D as r}from"./decimal.0e8aa3f1.js";import{u as wt,a as ii}from"./sha256.67839be0.js";import{d as Ot,_ as Ft,c as Ut,a as zt,b as ni}from"./new-liquidity-title.331e3830.js";import{i as gt}from"./import-icon.de3e6c66.js";/* empty css              */import"./decimal.633e31ee.js";import{positionError as Qe,fromCoin as b,toCoin as p,tickList as Ye,direction as Ue,minPrice as O,maxPrice as L,currentPriceTab as F,currentPrice as ot,currentPriceReverse as bt,defaultMinPrice as ut,defaultMaxPrice as ct,toggle as jt,isInputTotalAmount as He,priceConfigObj as Ge,fromCoinAmount as k,toCoinAmount as w,fixedFromCoin as we,resetTickList as Pt,resetData as ai}from"./data.2e00d4d8.js";import{_ as ri}from"./coin-lock.f409a951.js";import{_ as oi}from"./coin-select.d6abf542.js";import{_ as li}from"./viewDetail.99239134.js";import{a as si}from"./new-add-or-create.38b93060.js";import{u as ui}from"./notifi.2c78fb1d.js";import{_ as ci,a as di}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.dbe7c627.js";/* empty css              *//* empty css              */import"./tick.505fdad3.js";import"./token-warning.182710a5.js";import"./refresh-icon.156e05fe.js";/* empty css              */import"./swap-setting.f24a7c5f.js";/* empty css              */import"./img-lock_2x.dac5f758.js";import"./img-no-Positions_2x.2ae920d2.js";import"./status-block.727b1f21.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.8ae43f2a.js";import"./index.18bae8ba.js";function St(e,d,he){const ue=new r(10).pow(d-he);return new r(1.0001).pow(e).mul(ue)}const mi=Ve({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,d){const he=B(""),ue=B(""),M=q(()=>{var n,l,m,z,x,K;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((l=e.poolInfo)!=null&&l.coinA.decimals)&&((m=e.poolInfo)!=null&&m.coinB.decimals)?a.sqrtPriceX64ToPrice((z=e.poolInfo)==null?void 0:z.current_sqrt_price,(x=e.poolInfo)==null?void 0:x.coinA.decimals,(K=e.poolInfo)==null?void 0:K.coinB.decimals).toString():"0"}),Ce=q(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number(M.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),E=q(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number(M.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),U=wt(),T=q(()=>U),Z=q(()=>T.value.chainName?ht(T.value.chainName):{}),{TickMath:a,getNearestTickByTick:S}=Z.value,J=(n=[])=>{let l=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?l=0:m>=1?l=1:m>=.1?l=2:m>=.01?l=3:m>=.001?l=4:m>=1e-4?l=5:m>=1e-5?l=6:m>=1e-6?l=7:m>=1e-7&&(l=8),l},Ne=(n,l=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);let z=m+100*l,x=m-100*l,K,ie;if(e.maxPrice==="∞")ie=Z.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ie=a.priceToTickIndex(new r(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ie=a.priceToTickIndex(new r(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ie=443636}if(e.minPrice==="0")K=Z.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?K=a.priceToTickIndex(new r(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):K=a.priceToTickIndex(new r(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{K=-443636}let ke=0;if(e.currentPriceTab!=="full range"){if(m>=K&&m<=ie){const y=m-K,Q=ie-m;ke=Math.max(Math.abs(y),Math.abs(Q))}else m<K?ke=Math.abs(ie-m):ke=Math.abs(m-K);z=m+ke+100*l,x=m-ke-100*l}else{const y=(Math.abs(m)>5e3,2e4);z=m+y*l,x=m-y*l}x<-443636&&(x=-443636),z>443636&&(z=443636);const v=new r(n.liquidity).div(Math.pow(10,8)).toString(),I=e.tickList,A=[],P=[];let N={};for(let y=0;y<I.length;y++){if(N=I[y],N.index<=m&&N.index>=x){if(A.length<1&&y!==0){const Q=I[y-1];A.unshift({...Q,index:x,source:"left"})}A.unshift(N)}else if(N.index>m&&N.index<=z&&(P.push(N),A.length<1&&y!==0)){const Q=I[y-1];A.push({...Q,index:x,source:"left"})}if(N.index>z){const Q=I[y];if(P.push({...Q,index:z,source:"right"}),A.length<1&&y!==0){const Ke=I[y-1];A.push({...Ke,index:x,source:"left"})}break}}let G="0";for(let y=A.length-1;y>=0;y--)G=new r(G).plus(new r(A[y].liquidityNet.toString()).div(Math.pow(10,8))).toString(),A[y].liquityAmount=G;let j=v;for(let y=0;y<P.length;y++)j=new r(j).plus(new r(P[y].liquidityNet.toString()).div(Math.pow(10,8))).toString(),P[y].liquityAmount=j;let te=[];const $=I&&I.length>0?{index:m,liquityAmount:Number(v)}:{index:m,liquityAmount:0};(A.length>0||P.length>0)&&(te=[...A.reverse(),$,...P],e.direction||(te=te.reverse()));const ze=[];I.forEach(y=>{ze.push({...y,liquidityGross:y.liquidityGross.toString(),liquidityNet:y.liquidityNet.toString()})}),ee(te,x,z,K,ie,m)}};let ye=B(!1);const f=B(!1);Lt(()=>{const n=document.body.clientWidth;f.value=!0,n<750?ye.value=!1:ye.value=!0,window.onresize=()=>{document.body.clientWidth<750?ye.value=!1:ye.value=!0,Ne(e.poolInfo,e.zoom)}});const ee=(n,l,m,z,x,K)=>{let ie,ke;e.direction?(ie=e.before7dContractPriceLowest?a.priceToTickIndex(new r(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ke=e.before7dContractPriceHighest?a.priceToTickIndex(new r(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ie=e.before7dContractPriceLowest?a.priceToTickIndex(new r(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ke=e.before7dContractPriceHighest?a.priceToTickIndex(new r(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const v={top:30,right:35,bottom:20,left:80};let I,A;ye.value?(I=460-v.left-v.right,A=205-v.top-v.bottom):(I=340-v.left-v.right,A=205-v.top-v.bottom);const P=m-l,N=parseInt(String(P/4));let G=[l+N/4,l+N,l+2*N,m-N,m-N/4];const j=l,te=m,$=I/(te-j);e.currentPriceTab==="full range"&&(G=[l,l+2*N,m]);const ze=G.map(s=>e.direction?St(s,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new r(1).div(St(s,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),y=J(ze);rt("#chart").selectAll("*").remove();const Q=rt("#chart").attr("width",I+v.left+v.right).attr("height",A+v.top+v.bottom).append("g").attr("transform",`translate(${v.left},${v.right})`),Ke=Yt(n,function(s){return Number(Math.abs(s.liquityAmount))})||0,Le=Vt().range([0,A]).domain([Ke,0]);ei().rangeRound([0,I]).padding(.1);const i=Q.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");T.value.theme=="default"?i.attr("x",function(s,u){return u===0?0:e.direction?Math.abs(s.index-j)*$:Math.abs(te-s.index)*$}).attr("y",function(s,u){return e.direction?u===n.length-1?0:Le(s.liquityAmount):u===n.length-1?0:Le(n[u+1].liquityAmount)}).attr("width",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?I:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-s.index)*$:0)}).attr("height",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?A:e.direction?u===n.length-1?0:A-Le(s.liquityAmount):u===n.length-1?0:A-Le(n[u+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):i.attr("x",function(s,u){return u===0?0:e.direction?Math.abs(s.index-j)*$:Math.abs(te-s.index)*$}).attr("y",function(s,u){return e.direction?u===n.length-1?0:Le(Math.abs(s.liquityAmount)):u===n.length-1?0:Le(Math.abs(n[u+1].liquityAmount))}).attr("width",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?I:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-s.index)*$:0)}).attr("height",function(s,u){if(u===0&&n.length===1&&s.liquityAmount>0)return A;if(e.direction)return u===n.length-1?0:Number(s.liquityAmount)?A-Le(Math.abs(s.liquityAmount)):0;{if(u===n.length-1)return 0;const je=A-Le(Math.abs(n[u+1].liquityAmount));return Number(n[u+1].liquityAmount)?je:0}}).attr("fill",function(s,u){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(s,u){return"#417494"});const g=Q.append("g");g.append("line").attr("x1",0).attr("y1",155).attr("x2",I).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const C=g.append("g");let _=0;if(e.direction){for(let s=0;s<G.length;s++){const u=de(ze[s],y)||"0";ze.push(u);const je=Math.abs(G[s]-j)*$;let fe=0;for(let pe=0;pe<u.length;pe++)u[pe]==="1"?fe+=4.02:u[pe]==="."?fe+=2.64:u[pe]==="7"?fe+=5.48:fe+=6;C.append("text").text(u).attr("x",je-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}_=Math.abs(K-j)*$}else{for(let s=G.length-1;s>=0;s--){const u=de(ze[s],y)||0;ze.push(u);const je=Math.abs(G[s]-te)*$;let fe=0;for(let pe=0;pe<u.length;pe++)u[pe]==="1"?fe+=4.02:u[pe]==="."?fe+=2.64:u[pe]==="7"?fe+=5.48:fe+=6;C.append("text").text(u).attr("x",je-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}_=Math.abs(K-te)*$}(T.value.theme=="default"?Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+_+", 0)");let H,me,We,Xe;e.direction?(H=z<j?-100:parseInt(String(Math.abs(z-j)*$)),me=x<j?-100:parseInt(String(Math.abs(x-j)*$)),We=ie<j?-100:Math.abs(ie-j)*$,Xe=ke<j?-100:Math.abs(ke-j)*$):(me=z<j?-100:Math.abs(te-z)*$,H=x<j?-100:Math.abs(te-x)*$,Xe=ie<j?-100:Math.abs(te-ie)*$,We=ke<j?-100:Math.abs(te-ke)*$),e.minPrice==="0"&&(H=0),e.maxPrice==="∞"&&(me=I),ye.value,he.value=I-H+87+"px",ue.value=me+98+"px",ie&&We<I&&Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+We+", 0)"),ke&&Xe<I&&Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+Xe+", 0)");const Te=Q.append("g").attr("id","left-handle"),ve=Q.append("g").attr("id","right-handle");T.value.theme=="default"?(Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Te.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),Te.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),ve.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),ve.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),ve.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Te.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),Te.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),ve.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),ve.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),ve.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),Te.attr("transform","translate("+H+", 0)"),ve.attr("transform","translate("+me+", 0)");const De=ti().extent([[0,0],[I,A]]).handleSize(30).on("end",it);Q.append("g").attr("class","brush").call(De).call(De.move,[H,me]);function it(s){if(!s.sourceEvent||!s.selection)return;Te.attr("transform","translate("+s.selection[0]+", 0)"),ve.attr("transform","translate("+s.selection[1]+", 0)"),ye.value,he.value=I-s.selection[0]+87+"px",ue.value=s.selection[1]+74+"px";let u,je,fe=0,pe=0;e.direction?(fe=S(parseInt(String(s.selection[0]/$+j)),Number(e.poolInfo.tickSpacing)),u=a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=S(parseInt(String(s.selection[1]/$+j)),Number(e.poolInfo.tickSpacing)),je=a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()):(pe=S(te-s.selection[0]/$,Number(e.poolInfo.tickSpacing)),u=1/a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),fe=S(te-s.selection[1]/$,Number(e.poolInfo.tickSpacing)),je=1/a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),d.emit("onChangeMinPrice",String(de(String(u),6))),d.emit("onChangeMaxPrice",String(de(String(je),6)))}T.value.theme=="default"?rt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):rt(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};return B(""),Ae(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,l,m,z,x,K])=>{n&&l&&m&&(n!=null&&n.liquidity)&&Ne(n,x)},{immediate:!0}),{store:T,loading:f,rangeSizeLower:Ce,rangeSizeUpper:E,rangeSizeLowerPosition:he,rangeSizeUpperPosition:ue,decimalFormat:Dt,numberformat:dt}}});const vi=e=>(qt("data-v-2cded100"),e=e(),Mt(),e),fi={class:"chart-box"},pi={class:"chart"},gi=vi(()=>o("svg",{id:"chart"},null,-1));function bi(e,d,he,ue,M,Ce){const E=At;return R(),D("div",fi,[It(o("div",pi,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),D("div",{key:0,class:"range-size range-size-lower",style:vt({right:e.rangeSizeLowerPosition})},se(("numberformat"in e?e.numberformat:ce(dt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):V("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),D("div",{key:1,class:"range-size range-size-upper",style:vt({left:e.rangeSizeUpperPosition})},se(("numberformat"in e?e.numberformat:ce(dt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):V("",!0),gi],512),[[Zt,!e.chartLoading]]),e.chartLoading?(R(),Je(E,{key:0})):V("",!0)])}const Ht=et(mi,[["render",bi],["__scopeId","data-v-2cded100"]]),hi=Ve({props:{lever:{type:String,default:""}},setup(){return{}}});const ki=e=>(qt("data-v-619778e2"),e=e(),Mt(),e),wi={class:"lever"},yi=ki(()=>o("div",{class:"lever-title"},"Leverage",-1)),Ci={class:"lever-text"};function _i(e,d,he,ue,M,Ce){return R(),D("div",wi,[yi,o("div",Ci,se(e.lever),1)])}const Ti=et(hi,[["render",_i],["__scopeId","data-v-619778e2"]]),Pi=Ve({components:{NewLiquidityD3Chart:Ht,NewLiquidityPrice:Ot},setup(){const{t:e,locale:d}=$t(),he=B("liquidity"),ue=wt(),M=q(()=>ue),Ce=q(()=>M.value.chainName),E=Nt(),U=q(()=>E),T=q(()=>M.value.chainName?ht(M.value.chainName):{});Lt(()=>{Qe.value=!1});const Z=kt(),a=q(()=>{let i=null;for(let g=0;g<U.value.poolConfigList.length;g++){const C=U.value.poolConfigList[g];C.address==Z.query.poolAddress&&(i=C)}return i}),S=q(()=>{let i=null;for(const g in U.value.poolsObj){const C=U.value.poolsObj[g];C.address==Z.query.poolAddress&&(i=C)}return i}),J=B(),Ne=B(!0),ye=async(i,g)=>{if(Ne.value=!0,g){Ye.value=[],f.value=[];const C=i.token_a.decimals,_=i.token_b.decimals;ot.value=yt.sqrtPriceX64ToPrice(i==null?void 0:i.current_sqrt_price,C,_).toString(),bt.value=new r(1).div(yt.sqrtPriceX64ToPrice(i==null?void 0:i.current_sqrt_price,C,_)).toString(),b.value=i.needReverse?i.token_b:i.token_a,p.value=i.needReverse?i.token_a:i.token_b,J.value=i.needReverse,i.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Ue.value=!0:Ue.value=!1;let _e={poolAddress:i.address,coinTypeA:i.coin_a_address,coinTypeB:i.coin_b_address};const H=await T.value.getTicks(_e);Ye.value=H?T.value.getTickDataFromUrlData(H):[],Ne.value=!1,n(i)}},f=B([]),ee=B(),n=i=>{const g=i.token_a.decimals,C=i.token_b.decimals;let _=U.value.poolPriceConfigObj&&U.value.poolPriceConfigObj[i.address]&&U.value.poolPriceConfigObj[i.address].recommend_ranges||{};const _e=U.value.poolPriceConfigObj&&U.value.poolPriceConfigObj[i.address]&&U.value.poolPriceConfigObj[i.address].type||"";let H,me;const We=i.current_tick_index;ee.value=i.current_tick_index,H=We-Number(i.type=="unstable"?Number(i.tickSpacing)*2:Number(i.tickSpacing)*3),me=We+Number(i.type=="unstable"?Number(i.tickSpacing)*2:Number(i.tickSpacing)*3);const Xe=T.value.TickMath.tickIndexToPrice(H,g,C).toString(),Te=T.value.TickMath.tickIndexToPrice(me,g,C).toString();_["full range"]={lower:T.value.TickUtil.getMinIndex(Number(S.value.tickSpacing)),upper:T.value.TickUtil.getMaxIndex(Number(S.value.tickSpacing))},_.custom={lower:H,upper:me,minPrice:Xe,maxPrice:Te};const ve=[];for(let De in _)_[De]&&ve.push({..._[De],key:De});_e&&ve&&ve.length>2?i.isSelfBuilt?F.value="custom":_e=="stable"?F.value="suggested":F.value="passive":F.value="custom",f.value=ve,Ge.value=_,z({key:F.value,..._[F.value]})},l=B(""),m=B(""),z=i=>{F.value=i.key.toLowerCase();const g=S.value.token_a.decimals,C=S.value.token_b.decimals,{lower:_,upper:_e}=i;He.value=!1;const H=T.value.TickMath.tickIndexToPrice(_,g,C).toString(),me=T.value.TickMath.tickIndexToPrice(_e,g,C).toString();if(i.key=="full range"){l.value=_,m.value=_e,x();return}Ue.value?(ut.value=String(H),O.value=String(H),ct.value=String(me),L.value=String(me),l.value=_,m.value=_e):(ut.value=String(1/Number(me)),O.value=String(1/Number(me)),ct.value=String(1/Number(H)),L.value=String(1/Number(H)),l.value=T.value.TickMath.priceToTickIndex(new r(1/Number(me)),g,C),m.value=T.value.TickMath.priceToTickIndex(new r(1/Number(H)),g,C))},x=i=>{O.value="0",L.value="∞"};Ae(()=>S.value,(i,g)=>{(!g&&i&&!Me(i)||g&&i&&g.address!==i.address)&&ye(i,!g||i.address!==g.address)},{immediate:!0}),Bt(()=>{b.value=B(),p.value=B(),Ye.value=[]}),Ae(()=>[a.value,S.value,U.value.recommendRangesObj],(i,g)=>{var C,_;(!g||i[0]&&i[1]&&i[2]&&!Me(i[0])&&!Me(i[1]&&!Me(i[2]))||((C=i[0])==null?void 0:C.address)!==((_=g[0])==null?void 0:_.address))&&i[0]&&i[2]&&!Me(i[0])&&!Me(i[2])&&E.setSinglePool(i[0],i[2],Ce.value)},{immediate:!0,deep:!0});const K=i=>{if(Ce.value=="Sui")switch(i){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(i){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ie=i=>{switch(i){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},ke=i=>{var C,_;const g=U.value.poolPriceConfigObj&&U.value.poolPriceConfigObj[(C=S.value)==null?void 0:C.address]&&U.value.poolPriceConfigObj[(_=S.value)==null?void 0:_.address].type||"";if(f.value.length>2)if(g=="unstable")switch(i){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(i){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(g=="unstable")switch(i){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(i){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},v=B(1),I=()=>{const i=v.value/2;v.value=i},A=()=>{const i=v.value*2;v.value=i},P=q(()=>{var i,g,C;return!S.value||Me(M.value.addressHistTokens)||!M.value.addressHistTokens[(i=S.value)==null?void 0:i.poolAddress]?null:Object.fromEntries((C=M.value.addressHistTokens[(g=S.value)==null?void 0:g.poolAddress])==null?void 0:C.data.map(_=>[_.key,_.value]))}),N=B(30),G=B("30D"),j=q(()=>Ue.value?P.value&&de(N.value==7?P.value.before_7_d_contract_price_lowest:N.value==24?P.value.before_24_h_contract_price_lowest:P.value.before_30_d_contract_price_lowest,6)||0:P.value&&de(new r(1).div(N.value==7?P.value.before_7_d_contract_price_highest:N.value==24?P.value.before_24_h_contract_price_highest:P.value.before_30_d_contract_price_highest).toString(),6)||0),te=q(()=>Ue.value?P.value&&de(N.value==7?P.value.before_7_d_contract_price_highest:N.value==24?P.value.before_24_h_contract_price_highest:P.value.before_30_d_contract_price_highest,6)||0:(P.value&&de(1/Number(N.value==7?P.value.before_7_d_contract_price_lowest:N.value==24?P.value.before_24_h_contract_price_lowest:P.value.before_30_d_contract_price_lowest),6))==1/0?0:P.value&&de(1/Number(N.value==7?P.value.before_7_d_contract_price_lowest:N.value==24?P.value.before_24_h_contract_price_lowest:P.value.before_30_d_contract_price_lowest),6)||0),$=q(()=>{const i=Number(O.value),g=Number(L.value);if(O.value=="0"&&L.value=="∞"||F.value=="full range")return"1x";if(O.value==L.value||F.value=="full range")return"--";if(O.value&&L.value&&O.value!=="0"&&L.value!=="∞"){const C=mt(1/(1-Number((i/g)**.25)),2);return Number(C)>0?C+"x":"--"}else return 1}),ze=q(()=>{var i,g,C,_,_e,H;return((i=b.value)==null?void 0:i.isSelfBuilt)||((g=p.value)==null?void 0:g.isSelfBuilt)||((_=U.value.tokensObj[(C=b.value)==null?void 0:C.address])==null?void 0:_.isSelfBuilt)||((H=U.value.tokensObj[(_e=p.value)==null?void 0:_e.address])==null?void 0:H.isSelfBuilt)}),y=i=>{i!==O.value&&F.value=="full range"?z({key:"custom",...f.value.custom}):F.value!=="full range"&&F.value!=="custom"?(F.value="custom",O.value=i):O.value=i},Q=i=>{i!==L.value&&F.value=="full range"?z({key:"custom",...f.value.custom}):F.value!=="full range"&&F.value!=="custom"?(F.value="custom",i=="0"?L.value="∞":L.value=i):i=="0"?L.value="∞":L.value=i};return Ae(()=>[O.value,L.value],([i,g])=>{},{deep:!0,immediate:!0}),{positionError:Qe,getCoinIcon:i=>{var g;return(i==null?void 0:i.logoURI)||(i==null?void 0:i.logo_url)||((g=U.value.tokensObj[i==null?void 0:i.address])==null?void 0:g.logo_url)||(M.value.theme==="default"?gt("/image/coins/unknown.png"):gt("/image/coins/sui-unknown.png"))},chainName:Ce,store:M,currentTab:he,currentPrice:ot,currentPriceReverse:bt,fromCoin:b,toCoin:p,direction:Ue,needReverse:J,addCommom:Se,decimalUi:de,priceTablList:f,currentPriceTab:F,sliderStyle:ke,poolInfo:S,tickList:Ye,getPriceTabImage:K,getPriceTabText:ie,defaultMinPrice:ut,defaultMaxPrice:ct,minPrice:O,maxPrice:L,currentTick:ee,chartLoading:Ne,zoomOut:I,zoomIn:A,zoom:v,priceTab:z,before7dContractPriceLowest:j,before7dContractPriceHighest:te,aprRewardsTime:G,lever:$,aprRewardsParameter:N,isSelfBuilt:ze,priceRangeChangeMin:y,priceRangeChangeMax:Q,toggle:jt,getPirceTabTips:i=>{switch(i){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},timeList:[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}]}}});const Si={class:"new-liquidity-left"},Ni=o("span",{class:"selectRange"},"Select Range",-1),Li={class:"price-info"},Ii={class:"left"},Ai={class:"base-coin"},qi={class:"base-coin-title"},Mi=o("span",null,"Base coin",-1),$i=o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})],-1),Bi=o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})],-1),Ri=[$i,Bi],Oi={class:"base-coin-bottom"},Fi={alt:""},Ui={class:"current-price"},zi=o("div",{class:"current-price-title"},"Current Price",-1),ji={key:0,class:"from-pre-to"},Hi={class:"right"},Xi={class:"price-range"},Ei={class:"left"},xi={class:"price-slider"},Wi={class:"slider"},Di=o("div",{class:"slider-ratio-content"},null,-1),Zi=[Di],Gi={class:"price-tab-list"},Ji=["onClick"],Ki=["src"],Qi={class:"right"},Yi={class:"price-zoom"},Vi={class:"current-price"},en=o("div",{class:"current-price-title"},"Current Price",-1),tn={key:0,class:"from-pre-to"},nn={class:"price-zoom-right"},an={class:"leverage"},rn=o("div",{class:"left"},null,-1),on={class:"right"},ln={class:"right-time"},sn={key:0,class:"day-7-price-range"},un=o("i",null,null,-1),cn={class:"gray"},dn={class:"time-list"},mn=["onClick"],vn={class:"right-price-h5"},fn={class:"apr-leverage"},pn={key:0,class:"position-tips"},gn=["src"],bn={class:"error"};function hn(e,d,he,ue,M,Ce){var S,J,Ne,ye,f,ee,n;const E=Jt,U=Ht,T=Ti,Z=Ot,a=Gt("image");return R(),D("div",Si,[Ni,o("div",Li,[o("div",Ii,[o("div",Ai,[o("div",qi,[Mi,o("div",{class:"change-price",onClick:d[0]||(d[0]=(...l)=>e.toggle&&e.toggle(...l))},Ri)]),o("div",Oi,[It(o("img",Fi,null,512),[[a,e.getCoinIcon(e.fromCoin)]]),o("span",null,se((S=e.fromCoin)==null?void 0:S.symbol),1)])]),o("div",Ui,[zi,o("div",null,[o("span",null,se(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPrice,6)):("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),D("span",ji,se((J=e.toCoin)==null?void 0:J.symbol)+" per "+se((Ne=e.fromCoin)==null?void 0:Ne.symbol),1)):V("",!0)])])]),o("div",Hi,[e.currentTab=="liquidity"?(R(),D("div",{key:0,class:"zoom-out",onClick:d[1]||(d[1]=(...l)=>e.zoomOut&&e.zoomOut(...l))}," + ")):V("",!0),e.currentTab=="liquidity"?(R(),D("div",{key:1,class:"zoom-in",onClick:d[2]||(d[2]=(...l)=>e.zoomIn&&e.zoomIn(...l))}," - ")):V("",!0)])]),o("div",Xi,[o("div",Ei,[o("div",xi,[o("div",Wi,[o("div",{class:"slider-ratio",style:vt(e.sliderStyle(e.currentPriceTab))},Zi,4)])]),o("div",Gi,[(R(!0),D(ft,null,Tt(e.priceTablList,l=>(R(),D("div",{key:l.key,class:st(["price-tab-item",e.currentPriceTab==l.key?"price-tab-item-active":""]),onClick:m=>e.priceTab(l)},[Fe(E,{placement:"bottom","arrow-point-at-center":""},{title:pt(()=>[Rt(se(e.getPirceTabTips(l.key)),1)]),default:pt(()=>[o("img",{src:e.getPriceTabImage(l.key),alt:""},null,8,Ki),o("span",null,se(e.getPriceTabText(l.key)),1)]),_:2},1024)],10,Ji))),128))])]),o("div",Qi,[o("div",Yi,[o("div",Vi,[en,o("div",null,[o("span",null,se(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPrice,6)):("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),D("span",tn,se(e.direction&&!e.needReverse?`${(ye=e.fromCoin)==null?void 0:ye.symbol} per ${(f=e.toCoin)==null?void 0:f.symbol}`:`${(ee=e.toCoin)==null?void 0:ee.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):V("",!0)])]),o("div",nn,[e.currentTab=="liquidity"?(R(),D("div",{key:0,class:"zoom-out",onClick:d[3]||(d[3]=(...l)=>e.zoomOut&&e.zoomOut(...l))}," + ")):V("",!0),e.currentTab=="liquidity"?(R(),D("div",{key:1,class:"zoom-in",onClick:d[4]||(d[4]=(...l)=>e.zoomIn&&e.zoomIn(...l))}," - ")):V("",!0)])]),e.poolInfo?(R(),Je(U,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):V("",!0)])]),o("div",an,[rn,o("div",on,[o("div",ln,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(R(),D("div",sn,[un,o("span",cn,se(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),o("span",null,se(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceLowest,6)))+" - "+se(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceHighest,6))),1)])):V("",!0),o("div",dn,[(R(!0),D(ft,null,Tt(e.timeList,l=>(R(),D("div",{key:l.value,class:st(["time-item",l.value==e.aprRewardsParameter?"time-item-active":""]),onClick:m=>e.aprRewardsParameter=l.value},se(l.label),11,mn))),128))])]),o("div",vn,[o("span",null,se(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceLowest,6)))+" - "+se(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceHighest,6))),1)])])]),o("div",{class:st(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[o("div",fn,[Fe(T,{lever:e.lever},null,8,["lever"])]),Fe(Z,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(R(),D("div",pn,[o("img",{src:("importIcon"in e?e.importIcon:ce(gt))("/image/icon-tips-error@2x.png"),alt:""},null,8,gn),o("p",bn,se(e.$t("tips.positionError")),1)])):V("",!0)],2)])}const Xt=et(Pi,[["render",hn]]),kn=Ve({components:{NewLiquidityTitle:Ft,NewLiquidityAssetsCard:Ut,NewLiquidityDepositRatio:zt},setup(){const{t:e,locale:d}=$t(),he=wt(),ue=q(()=>he),M=q(()=>ue.value.chainName),Ce=Nt(),E=q(()=>Ce),U=ii(),T=q(()=>U),Z=kt(),a=q(()=>{let t=null;for(const c in E.value.poolsObj){const h=E.value.poolsObj[c];h.address==Z.query.poolAddress&&(t=h)}return t}),S=B(!1),J=B(!1),Ne=q(()=>ue.value.theme),ye=async(t,c)=>{b.value=t.needReverse?t.token_b:t.token_a,p.value=t.needReverse?t.token_a:t.token_b,k.value="",w.value=""};Ae(()=>a.value,(t,c)=>{(!c&&t&&!Me(t)||c&&t&&c.address!==t.address)&&ye(t,!c||t.address!==c.address)},{immediate:!0});const f=q(()=>T.value.assets&&b.value&&T.value.assets[b.value.address]?Ct(T.value.assets[b.value.address].balance,b.value.decimals):"0"),ee=q(()=>T.value.assets&&p.value&&T.value.assets[p.value.address]?Ct(T.value.assets[p.value.address].balance,p.value.decimals):"0"),n=t=>{t==="fromCoin"?(we.value=!0,M.value==="Aptos"?k.value=Number(f.value)>0?b.value.symbol=="APT"?new r(Number(f.value)).sub(new r(.1)).lt(new r(0))?"0":new r(Number(f.value)).sub(new r(.1)).toString():String(f.value):"":k.value=Number(f.value)>0?b.value.symbol=="SUI"?new r(Number(f.value)).sub(new r(.05)).lt(new r(0))?"0":new r(Number(f.value)).sub(new r(.05)).toString():String(f.value):""):(we.value=!1,M.value==="Aptos"?w.value=Number(ee.value)>0?p.value.symbol=="APT"?new r(Number(ee.value)).sub(new r(.1)).lt(new r(0))?"0":new r(Number(ee.value)).sub(new r(.1)).toString():String(ee.value):"":w.value=Number(ee.value)>0?p.value.symbol=="SUI"?new r(Number(ee.value)).sub(new r(.05)).lt(new r(0))?"0":new r(Number(ee.value)).sub(new r(.05)).toString():String(ee.value):"")},l=t=>{t==="fromCoin"?(we.value=!0,k.value=Number(f.value)>0?mt(new r(Number(f.value)).div(2).toString(),b.value.decimals).toString():""):(we.value=!1,w.value=Number(ee.value)>0?mt(new r(Number(ee.value)).div(2).toString(),p.value.decimals).toString():"")},m=B(),z=B(),x=B(),K=B(!1),ie=t=>{var c,h,ne,X;m.value=t,t==="fromCoin"?(z.value=((c=p.value)==null?void 0:c.address)||"",x.value=Z.query.actions=="new-position"?(h=b.value)==null?void 0:h.address:a.value.needReverse?a.value.token_b.address:a.value.token_a.address):(z.value=((ne=b.value)==null?void 0:ne.address)||"",x.value=Z.query.actions=="new-position"?(X=p.value)==null?void 0:X.address:a.value.needReverse?a.value.token_a.address:a.value.token_b.address),K.value=!0},ke=t=>{var ne,X,ae,re,Y,oe,le,ge;const c=a.value.needReverse?a.value.token_b:a.value.token_a,h=a.value.needReverse?a.value.token_a:a.value.token_b;m.value==="fromCoin"?(((ne=b.value)==null?void 0:ne.address)===(c==null?void 0:c.address)||!((X=b.value)!=null&&X.address)?(p.value&&t.address.toLowerCase()===((ae=p)==null?void 0:ae.value.address.toLowerCase())&&(p.value=null),b.value=t):(b.value&&t.address.toLowerCase()===((re=b)==null?void 0:re.value.address.toLowerCase())&&(b.value=null),p.value=t),Z.query.action||(Z.query.fee="")):((Y=p.value)==null?void 0:Y.address)===(h==null?void 0:h.address)||!((oe=p.value)!=null&&oe.address)?(b.value&&t.address.toLowerCase()===((le=b)==null?void 0:le.value.address.toLowerCase())&&(b.value=null),p.value=t):(p.value&&t.address.toLowerCase()===((ge=p)==null?void 0:ge.value.address.toLowerCase())&&(p.value=null),b.value=t),K.value=!1},v=q(()=>ue.value.chainName?ht(ue.value.chainName):{}),I=q(()=>ue.value.slippage),A=B(),P=async()=>{var $e,qe,Be,Re;if(He.value||!O.value&&!L.value)return!1;if(!k.value&&!w.value&&!O.value&&!L.value)return;const t=a.value||{};if(Me(t))return;const{TickUtil:c,TickMath:h,getNearestTickByTick:ne}=v.value,X=t==null?void 0:t.token_a.decimals,ae=t==null?void 0:t.token_b.decimals;let re,Y,oe,le,ge,Pe,Ee,Ze,Ie=t==null?void 0:t.current_tick_index,W;if(t.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===p.value.address.toLowerCase()?W=!0:W=!1,O.value==="0"&&L.value==="∞")oe=c.getMinIndex(Number(t.tickSpacing)),le=c.getMaxIndex(Number(t.tickSpacing)),ge=h.tickIndexToSqrtPriceX64(oe),Pe=h.tickIndexToSqrtPriceX64(le);else if(F.value=="custom"){W?(re=Number(O.value),Y=Number(L.value)):(re=L.value!=="∞"?new r(1).div(L.value).toString():1/0,Y=new r(1).div(O.value).toString());try{Ee=re==0?-443636:h.priceToTickIndex(new r(re),X,ae)}catch{Ee=-443636}try{Ze=h.priceToTickIndex(new r(Y),X,ae)}catch{Ze=443636}oe=ne(Ee,Number(t.tickSpacing)),le=ne(Ze,Number(t.tickSpacing));try{ge=h.priceToSqrtPriceX64(new r(re),X,ae)}catch{(Y===1/0||Y==="∞")&&(ge=h.tickIndexToSqrtPriceX64(c.getMinIndex(Number(t.tickSpacing))))}try{Pe=h.priceToSqrtPriceX64(new r(Y),X,ae)}catch{(Y===1/0||Y==="∞")&&(Pe=h.tickIndexToSqrtPriceX64(c.getMaxIndex(Number(t.tickSpacing))))}}else oe=($e=Ge.value[F.value])==null?void 0:$e.lower,le=(qe=Ge.value[F.value])==null?void 0:qe.upper,ge=h.tickIndexToSqrtPriceX64(oe),Pe=h.tickIndexToSqrtPriceX64(le);if(L.value!=="∞"&&oe>=le){S.value=!0,k.value="",J.value=!0,w.value="";return}if(L.value==="∞"||Ie>=oe&&Ie<=le){S.value=!1,J.value=!1;let be;if(k.value||w.value){if(we.value){const lt=new r(k.value).mul(Math.pow(10,b.value.decimals)).toString();be=new Oe(lt)}else{const lt=new r(w.value).mul(Math.pow(10,p.value.decimals)).toString();be=new Oe(lt)}const{liquidityAmount:xe,tokenMaxA:nt,tokenMaxB:at,tokenMaxAOrigin:xt,tokenMaxBOrigin:Wt}=v.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:t.token_a,tokenB:t.token_b,lowerTick:oe,upperTick:le,coinAmount:be,iscoinA:W?we.value:!we.value,roundUp:!0,slippage:Number(I.value)/100,curSqrtPrice:new Oe(t.current_sqrt_price)});A.value={liquidityAmount:xe,tokenMaxA:nt,tokenMaxB:at,tokenMaxAOrigin:xt,tokenMaxBOrigin:Wt},W?we.value?w.value=Number(at)>0?at:"":k.value=Number(nt)>0?nt:"":we.value?w.value=nt:k.value=at}}else if(Ie>le){if(W?k.value="":w.value="",S.value=W,J.value=!W,k.value||w.value){let be;if(W){const xe=new r(w.value).mul(Math.pow(10,(Be=p.value)==null?void 0:Be.decimals)).toString();be=new Oe(xe),A.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ge,Pe,be),tokenMaxA:0,tokenMaxB:w.value}}else{const xe=new r(k.value).mul(Math.pow(10,(Re=b.value)==null?void 0:Re.decimals)).toString();be=new Oe(xe),A.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ge,Pe,be),tokenMaxA:0,tokenMaxB:k.value}}}}else if(Ie<oe){if(S.value=!W,J.value=W,W?w.value="":k.value="",k.value||w.value){let be;if(W){const xe=new r(k.value).mul(Math.pow(10,b.value.decimals)).toString();be=new Oe(xe),A.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ge,Pe,be),tokenMaxA:k.value,tokenMaxB:0}}else{const xe=new r(w.value).mul(Math.pow(10,p.value.decimals)).toString();be=new Oe(xe),A.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ge,Pe,be),tokenMaxA:w.value,tokenMaxB:0}}}}else S.value=!0,k.value="",J.value=!0,w.value=""};Ae(k,(t,c)=>{t==""&&we.value&&(w.value=""),t&&we.value&&!He.value&&P()}),Ae(w,(t,c)=>{t==""&&!we.value&&(k.value=""),t&&!we.value&&!He.value&&P()}),Ae(()=>Ue.value,(t,c)=>{P()}),Ae(()=>[b.value,p.value],([t,c])=>{t&&c&&(S.value=!1,J.value=!1)});const N=B("--"),G=q(()=>E.value.RATES),j=()=>{const t=G.value&&G.value[b.value.address]&&G.value[b.value.address].price,c=G.value&&G.value[p.value.address]&&G.value[p.value.address].price;if(t&&c){const h=new r(k.value>0?k.value:0).mul(t),ne=new r(w.value>0?w.value:0).mul(c),X=h.add(ne).toNumber();N.value=X>0&&X<.01?"<$0.01":"$"+Se(X,2)}else N.value="--"};Ae(()=>[k.value,w.value,He.value],([t,c,h])=>{(t||c)&&!h?j():(!t||!c)&&!h&&(N.value="--")},{immediate:!0}),Ae(()=>N,t=>{},{immediate:!0});const te=B(),$=async()=>{var W,$e;if(!O.value&&!L.value)return!1;if(!k.value&&!w.value&&!O.value&&!L.value)return;const t=a.value;if(Me(t))return;const{TickUtil:c,TickMath:h,getNearestTickByTick:ne}=v.value,X=t==null?void 0:t.token_a.decimals,ae=t==null?void 0:t.token_b.decimals;let re,Y,oe,le,ge,Pe,Ee;if(t.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Ee=!0:Ee=!1,O.value==="0"&&L.value==="∞")oe=c.getMinIndex(Number(t.tickSpacing)),le=c.getMaxIndex(Number(t.tickSpacing));else if(F.value=="custom"){Ee?(re=Number(O.value),Y=Number(L.value)):(re=new r(1).div(L.value).toString(),Y=new r(1).div(O.value).toString());try{ge=re==0?-443636:h.priceToTickIndex(new r(re),X,ae)}catch{ge=-443636}try{Pe=h.priceToTickIndex(new r(Y),X,ae)}catch{Pe=443636}oe=ne(ge,Number(t.tickSpacing)),le=ne(Pe,Number(t.tickSpacing))}else oe=(W=Ge.value[F.value])==null?void 0:W.lower,le=($e=Ge.value[F.value])==null?void 0:$e.upper;const Ze=G.value[t==null?void 0:t.token_a.address].price,Ie=G.value[t==null?void 0:t.token_b.address].price;Ue.value?new Oe(t.current_sqrt_price):new Oe(1/t.current_sqrt_price);try{const{amountA:qe,amountB:Be,tokenAmountsInfo:Re}=await v.value.estCoinAmountsFromTotalAmount({lowerTick:oe,upperTick:le,decimalsA:X,decimalsB:ae,curSqrtPrice:new Oe(t.current_sqrt_price),totalAmount:N.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:Ie});te.value=Re,t.needReverse?Ue.value?(k.value=qe,w.value=Be):(k.value=Be,w.value=qe):(k.value=qe,w.value=Be)}catch{}};Ae([O,L],([t,c])=>{He.value?He.value&&$():P(),c!=="∞"&&Number(t)!==0&&Number(c)!==0&&Number(t)>=Number(c)?Qe.value=!0:Qe.value=!1,Number(t)==0&&Number(c)==0&&ot.value&&(Qe.value=!0)},{deep:!0,immediate:!0});const ze=t=>{const c=t.replace(/[^\d.]/g,""),h="$"+Se(c);He.value=!0,N.value=h,c>0?$():(k.value="",w.value="")},y=B(!1),{setTransactionTxid:Q,setTransactionDesc:Ke,setIsShowWaiting:Le,setIsShowSuccess:tt,setPositiomNum:i,setIsShowRejected:g}=he,C=ui(),_=q(()=>E.value.currentPositionInfo),_e=B(!1),H=async t=>{var ge,Pe,Ee,Ze;y.value=!1,E.value.currentPositionInfo={},Q(""),Ke(e("tips.increaseLiquiditySuccess",{from:S.value?"":`${Se(k.value)} ${(ge=b.value)==null?void 0:ge.symbol}`,and:!S.value&&!J.value?"and":"",to:J.value?"":`${Se(w.value)} ${(Pe=p.value)==null?void 0:Pe.symbol}`})),Le(!0);const c=Ue.value?we.value:!we.value;let h,ne,X,ae,re,Y;const oe=a.value.token_a.decimals,le=a.value.token_b.decimals;if(O.value==="0"&&L.value==="∞")X=v.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),ae=v.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing));else if(F.value=="custom"){Ue.value?(h=Number(O.value),ne=Number(L.value)):(h=new r(1).div(L.value).toString(),ne=new r(1).div(O.value).toString());try{re=h==0?v.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)):v.value.TickMath.priceToTickIndex(new r(h),oe,le)}catch{re=v.value.TickUtil.getMinIndex(Number(a.value.tickSpacing))}try{Y=v.value.TickMath.priceToTickIndex(new r(ne),oe,le)}catch{Y=v.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))}X=v.value.getNearestTickByTick(re,Number(a.value.tickSpacing)),ae=v.value.getNearestTickByTick(Y,Number(a.value.tickSpacing))}else X=Ge.value[F.value].lower,ae=Ge.value[F.value].upper;try{let Ie;He.value?Ie=await v.value.getCreateAddLiquidityPayload({pool:a.value,curSqrtPrice:new Oe(a.value.current_sqrt_price),tickLower:X,tickUpper:ae,slippage:Number(I.value)/100,tokenAmounts:te.value}):Ie=await v.value.getAddLiquidityTransactionPayload({pool:{poolAddress:a.value.poolAddress,token_a:a.value.token_a,token_b:a.value.token_b},amount:we.value?k.value:w.value,fix_amount_a:c,tick_lower:X,tick_upper:ae,index:0,slippage:Number(I.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new Oe(a.value.current_sqrt_price)});let W;if(M.value==="Aptos")W=await T.value.currentWallet.signAndSubmitTransaction(Ie);else{const $e=await T.value.currentWallet.signAndExecuteTransactionBlock(Ie);W=v.value.handleTx($e)}if(W&&W.hash){Q(W.hash),Le(!1),tt(!0);let $e;a.value.needReverse?a.value.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===p.value.address.toLowerCase()?$e=!1:$e=!0:a.value.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===p.value.address.toLowerCase()?$e=!0:$e=!1;const qe={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:S.value?"":`${Se(k.value)} ${(Ee=b.value)==null?void 0:Ee.symbol}`,and:!S.value&&!J.value?"and":"",to:J.value?"":`${Se(w.value)} ${(Ze=p.value)==null?void 0:Ze.symbol}`}),hash:W.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};M.value!=="Aptos"&&(qe.res=W.res),v.value.showTransitionPending(qe);const Be=await v.value.watchTransaction(qe,!0);if(Be.status){if(tt(!1),E.value.setCurrentPositionLoading(!0),_e.value=!0,M.value==="Aptos"){if(await E.value.setCurrentPositionInfo(Be.nftInfo[0].data.id.creator,Be.nftInfo[0].data.id.collection,Be.nftInfo[0].data.name,M.value),t)try{await C.subscribePosition({pool_address:_.value.poolAddress,position_index:_.value.index},_.value.nftHash)}catch{}}else{const Re=Be.nftInfo,be=await _t(2e3);if(await E.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",M.value,Re==null?void 0:Re.position),await _t(1e3),t)try{await C.subscribePosition({pool_address:_.value.poolAddress,position_index:_.value.index},_.value.nftHash)}catch{}}setTimeout(()=>{Ce.updateCurrentPools(a.value.poolAddress,M.value),v.value.getAccount(T.value.address)},3e3),setTimeout(async()=>{Pt(v,a)},3e3)}i()}else Le(!1),g(!0);k.value="",w.value=""}catch{k.value="",w.value="",Le(!1),g(!0)}},me=q(()=>!!(!k.value&&!w.value||Number(k.value)>Number(f.value)||Number(w.value)>Number(ee.value)||Xe.value!==e("button.addLiquidity")&&Xe.value!==e("newAdd.preview")||a.value&&a.value&&a.value.is_pause||Number(k.value)<=0&&Number(w.value)<=0||!S.value&&Number(k.value)==0||!J.value&&Number(w.value)==0)),We=q(()=>!b.value||!p.value),Xe=q(()=>a.value&&a.value.is_pause?"Pool Closed":!b.value||!p.value||We.value?e("modal.selectTokenModalTitle"):Number(k.value)>Number(f.value)?e("button.insufficientBalance",{name:b.value.symbol}):Number(w.value)>Number(ee.value)?e("button.insufficientBalance",{name:p.value.symbol}):!Number(k.value)&&!Number(w.value)?e("button.enterAmount"):L.value!=="∞"&&Number(O.value)>=Number(L.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),Te=B({}),ve=B({}),De=B(!1),it=(t,c)=>{const h=localStorage.getItem(t.address);E.value.tokensObj&&E.value.tokensObj[t.address]&&E.value.tokensObj[t.address].isSelfBuilt&&!h&&(c=="fromCoin"&&(Te.value=t),c=="toCoin"&&(ve.value=t),De.value=!0)};Ae(()=>[b.value,p.value],([t,c])=>{t&&!Me(t)&&it(t,"fromCoin"),c&&!Me(c)&&it(c,"toCoin")},{immediate:!0});const s=Kt(),u=()=>{M.value!=="Aptos"?s.push("/pool/list"):s.push("/pools")},je=t=>{He.value,H(t)},fe=()=>{Z.query.action!=="create-pool"&&Z.query.actions!=="new-position"&&(Pt(v,a),P(),Ce.updateCurrentPools(a.value.poolAddress,M.value)),Ce.setPoolConfigList(M.value,ue.value.filterCoinsObj)},pe=q(()=>{var h,ne,X,ae,re,Y;const t=(X=G.value[(ne=(h=b)==null?void 0:h.value)==null?void 0:ne.address])==null?void 0:X.price,c=(Y=G.value[(re=(ae=p)==null?void 0:ae.value)==null?void 0:re.address])==null?void 0:Y.price;return!!(t&&c)});return Ae(()=>[Z,E.value.tokensObj],([t,c])=>{var h;c&&!Me(c)&&(p.value||(p.value=E.value.tokensObj[(h=t==null?void 0:t.query)==null?void 0:h.toCoin]))},{immediate:!0,deep:!0}),{positionError:Qe,decimalUi:de,poolInfo:a,fromCoinAmount:k,toCoinAmount:w,fromCoin:b,toCoin:p,theme:Ne,showFromCoinLock:S,showToCoinLock:J,fromCoinBlance:f,toCoinBlance:ee,maxBtnSelect:n,halfBtnSelect:l,fixedFromCoin:we,openCoinSelect:ie,currentCoinKey:m,existingCoins:z,lastSelectCoin:x,showCoinSelect:K,onCoinSelect:ke,liquidityTotalAmount:N,toggle:jt,onInput:ze,isInputTotalAmount:He,isViewDetail:_e,addLiquidityBtnDisabled:me,addLiquidityBtnText:Xe,isShowTokenWarning:De,chainName:M,closeTokenWarning:u,warningFromCoin:Te,warningToCoin:ve,isShowLiquidityModal:y,currentPrice:ot,currentPriceReverse:bt,currentPriceTab:F,minPrice:O,maxPrice:L,toAdd:H,direction:Ue,wallet:T,getAddLiquidityType:je,clickRefresh:fe,isShowtotalAmount:pe}}});const wn={class:"new-liquidity-right"},yn={class:"deposit-title"},Cn={class:"card-container"},_n={key:0,class:"lock"},Tn={class:"card-item"},Pn={class:"card-item"},Sn={key:0,class:"total-amount"},Nn=o("span",null,"Total Amount",-1);function Ln(e,d,he,ue,M,Ce){const E=Ft,U=ni,T=Ut,Z=ri,a=zt,S=Qt,J=oi,Ne=li,ye=si;return R(),D("div",wn,[o("div",yn,[Fe(E,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),o("div",Cn,[e.positionError?(R(),D("div",_n,[Fe(U)])):V("",!0),o("div",Tn,[Fe(T,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":d[0]||(d[0]=f=>e.fromCoinAmount=f),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:d[1]||(d[1]=f=>e.maxBtnSelect("fromCoin")),onOnHalf:d[2]||(d[2]=f=>e.halfBtnSelect("fromCoin")),onOnInput:d[3]||(d[3]=f=>{e.fromCoinAmount=f,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:d[4]||(d[4]=f=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(R(),Je(Z,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),o("div",Pn,[Fe(T,{modelValue:e.toCoinAmount,"onUpdate:modelValue":d[5]||(d[5]=f=>e.toCoinAmount=f),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:d[6]||(d[6]=f=>e.maxBtnSelect("toCoin")),onOnHalf:d[7]||(d[7]=f=>e.halfBtnSelect("toCoin")),onOnInput:d[8]||(d[8]=f=>{e.toCoinAmount=f,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:d[9]||(d[9]=f=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(R(),Je(Z,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):V("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(R(),D("img",{key:1,class:"add",src:ci,alt:"",onClick:d[10]||(d[10]=(...f)=>e.toggle&&e.toggle(...f))})):V("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(R(),D("img",{key:2,class:"add",src:di,alt:"",onClick:d[11]||(d[11]=(...f)=>e.toggle&&e.toggle(...f))})):V("",!0)]),e.isShowtotalAmount?(R(),D("div",Sn,[Nn,o("span",null,se(e.liquidityTotalAmount)+" ",1)])):V("",!0),Fe(a,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Fe(S,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:d[12]||(d[12]=f=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:pt(()=>[Rt(se(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(R(),Je(J,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:d[13]||(d[13]=f=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):V("",!0),e.isViewDetail?(R(),Je(Ne,{key:2,"pool-info":e.poolInfo,onOnClose:d[14]||(d[14]=f=>e.isViewDetail=!1)},null,8,["pool-info"])):V("",!0),e.isShowLiquidityModal?(R(),Je(ye,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:d[15]||(d[15]=f=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):V("",!0)])}const Et=et(kn,[["render",Ln]]),In=Ve({components:{NewLiquidityLeft:Xt,NewLiquidityRight:Et},setup(){Bt(()=>{ai()});const e=kt();return{tickList:Ye,route:e}}});const An={key:0,class:"loading-spin-liquidity loading-global"},qn={class:"privide-liquidity"};function Mn(e,d,he,ue,M,Ce){var Z,a;const E=At,U=Xt,T=Et;return R(),D(ft,null,[!e.tickList&&((a=(Z=e.route)==null?void 0:Z.query)!=null&&a.poolAddress)?(R(),D("div",An,[Fe(E)])):V("",!0),o("div",qn,[Fe(U),Fe(T)])],64)}const va=et(In,[["render",Mn],["__scopeId","data-v-fc58011a"]]);export{va as default};
