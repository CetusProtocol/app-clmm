import{b as ht,j as Dt,n as dt,d as me,u as Nt,c as $e,s as mt,a as Se,T as yt,E as Zt,p as Ct,e as Oe,l as _t}from"./pool.6f004d8f.js";import{a as Ve,r as B,l as q,J as It,q as Ae,e as et,o as R,f as D,t as Lt,P as Gt,h as r,Q as vt,v as ue,u as de,x as ee,c as Je,S as At,p as qt,k as Mt,y as $t,m as kt,N as Bt,s as Jt,F as ft,G as Tt,C as st,i as Ue,w as pt,j as Rt,R as Kt,b as Qt,B as Yt}from"./entry.83514ac3.js";/* empty css              */import{s as ot,m as Vt,l as ei,b as ti,a as ii}from"./transform.c672907f.js";import{D as o}from"./decimal.0e8aa3f1.js";import{u as wt,a as ni}from"./sha256.ce3fdf76.js";import{d as Ft,_ as Ot,c as Ut,a as zt,b as ai}from"./new-liquidity-title.2d7a9487.js";import{i as gt}from"./import-icon.de3e6c66.js";/* empty css              */import"./decimal.633e31ee.js";import{positionError as Qe,fromCoin as b,toCoin as g,tickList as Ye,direction as ze,minPrice as F,maxPrice as I,currentPriceTab as O,currentPrice as rt,currentPriceReverse as bt,defaultMinPrice as ut,defaultMaxPrice as ct,toggle as jt,isInputTotalAmount as Ee,priceConfigObj as Ge,fromCoinAmount as k,toCoinAmount as w,fixedFromCoin as we,resetTickList as Pt,resetData as oi}from"./data.1870ccd8.js";import{_ as ri}from"./coin-lock.16975562.js";import{_ as li}from"./coin-select.5b195578.js";import{_ as si}from"./viewDetail.492a4620.js";import{a as ui}from"./new-add-or-create.404709b1.js";import{u as ci}from"./notifi.786a243b.js";import{_ as di,a as mi}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.6065d510.js";/* empty css              *//* empty css              */import"./token-warning.c0a2d32a.js";import"./refresh-icon.aba478e6.js";/* empty css              */import"./swap-setting.a282e8e5.js";/* empty css              */import"./img-lock_2x.337c6d91.js";import"./img-no-Positions_2x.ade8dc0b.js";import"./status-block.43eff085.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.b7565dab.js";import"./index.3f6ce871.js";function St(e,d,he){const ce=new o(10).pow(d-he);return new o(1.0001).pow(e).mul(ce)}const vi=Ve({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,d){const he=B(""),ce=B(""),M=q(()=>{var n,l,m,z,E,K;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((l=e.poolInfo)!=null&&l.coinA.decimals)&&((m=e.poolInfo)!=null&&m.coinB.decimals)?a.sqrtPriceX64ToPrice((z=e.poolInfo)==null?void 0:z.current_sqrt_price,(E=e.poolInfo)==null?void 0:E.coinA.decimals,(K=e.poolInfo)==null?void 0:K.coinB.decimals).toString():"0"}),Ce=q(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number(M.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),x=q(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number(M.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number(M.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),U=wt(),T=q(()=>U),Z=q(()=>T.value.chainName?ht(T.value.chainName):{}),{TickMath:a,getNearestTickByTick:S}=Z.value,J=(n=[])=>{let l=6;const m=Math.abs(Number(n[0])-Number(n[n.length-1]));return m>=6?l=0:m>=1?l=1:m>=.1?l=2:m>=.01?l=3:m>=.001?l=4:m>=1e-4?l=5:m>=1e-5?l=6:m>=1e-6?l=7:m>=1e-7&&(l=8),l},Ne=(n,l=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const m=Number(e.poolInfo.current_tick_index);let z=m+100*l,E=m-100*l,K,ne;if(e.maxPrice==="∞")ne=Z.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ne=a.priceToTickIndex(new o(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ne=a.priceToTickIndex(new o(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ne=443636}if(e.minPrice==="0")K=Z.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?K=a.priceToTickIndex(new o(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):K=a.priceToTickIndex(new o(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{K=-443636}let ke=0;if(e.currentPriceTab!=="full range"){if(m>=K&&m<=ne){const y=m-K,Q=ne-m;ke=Math.max(Math.abs(y),Math.abs(Q))}else m<K?ke=Math.abs(ne-m):ke=Math.abs(m-K);z=m+ke+100*l,E=m-ke-100*l}else{const y=(Math.abs(m)>5e3,2e4);z=m+y*l,E=m-y*l}E<-443636&&(E=-443636),z>443636&&(z=443636);const v=new o(n.liquidity).div(Math.pow(10,8)).toString(),L=e.tickList,A=[],P=[];let N={};for(let y=0;y<L.length;y++){if(N=L[y],N.index<=m&&N.index>=E){if(A.length<1&&y!==0){const Q=L[y-1];A.unshift({...Q,index:E,source:"left"})}A.unshift(N)}else if(N.index>m&&N.index<=z&&(P.push(N),A.length<1&&y!==0)){const Q=L[y-1];A.push({...Q,index:E,source:"left"})}if(N.index>z){const Q=L[y];if(P.push({...Q,index:z,source:"right"}),A.length<1&&y!==0){const Ke=L[y-1];A.push({...Ke,index:E,source:"left"})}break}}let G="0";for(let y=A.length-1;y>=0;y--)G=new o(G).plus(new o(A[y].liquidityNet.toString()).div(Math.pow(10,8))).toString(),A[y].liquityAmount=G;let j=v;for(let y=0;y<P.length;y++)j=new o(j).plus(new o(P[y].liquidityNet.toString()).div(Math.pow(10,8))).toString(),P[y].liquityAmount=j;let ie=[];const $=L&&L.length>0?{index:m,liquityAmount:Number(v)}:{index:m,liquityAmount:0};(A.length>0||P.length>0)&&(ie=[...A.reverse(),$,...P],e.direction||(ie=ie.reverse()));const je=[];L.forEach(y=>{je.push({...y,liquidityGross:y.liquidityGross.toString(),liquidityNet:y.liquidityNet.toString()})}),te(ie,E,z,K,ne,m)}};let ye=B(!1);const f=B(!1);It(()=>{const n=document.body.clientWidth;f.value=!0,n<750?ye.value=!1:ye.value=!0,window.onresize=()=>{document.body.clientWidth<750?ye.value=!1:ye.value=!0,Ne(e.poolInfo,e.zoom)}});const te=(n,l,m,z,E,K)=>{let ne,ke;e.direction?(ne=e.before7dContractPriceLowest?a.priceToTickIndex(new o(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ke=e.before7dContractPriceHighest?a.priceToTickIndex(new o(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ne=e.before7dContractPriceLowest?a.priceToTickIndex(new o(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",ke=e.before7dContractPriceHighest?a.priceToTickIndex(new o(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const v={top:30,right:35,bottom:20,left:80};let L,A;ye.value?(L=460-v.left-v.right,A=205-v.top-v.bottom):(L=340-v.left-v.right,A=205-v.top-v.bottom);const P=m-l,N=parseInt(String(P/4));let G=[l+N/4,l+N,l+2*N,m-N,m-N/4];const j=l,ie=m,$=L/(ie-j);e.currentPriceTab==="full range"&&(G=[l,l+2*N,m]);const je=G.map(s=>e.direction?St(s,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new o(1).div(St(s,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),y=J(je);ot("#chart").selectAll("*").remove();const Q=ot("#chart").attr("width",L+v.left+v.right).attr("height",A+v.top+v.bottom).append("g").attr("transform",`translate(${v.left},${v.right})`),Ke=Vt(n,function(s){return Number(Math.abs(s.liquityAmount))})||0,Ie=ei().range([0,A]).domain([Ke,0]);ti().rangeRound([0,L]).padding(.1);const i=Q.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");T.value.theme=="default"?i.attr("x",function(s,u){return u===0?0:e.direction?Math.abs(s.index-j)*$:Math.abs(ie-s.index)*$}).attr("y",function(s,u){return e.direction?u===n.length-1?0:Ie(s.liquityAmount):u===n.length-1?0:Ie(n[u+1].liquityAmount)}).attr("width",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?L:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-s.index)*$:0)}).attr("height",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?A:e.direction?u===n.length-1?0:A-Ie(s.liquityAmount):u===n.length-1?0:A-Ie(n[u+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):i.attr("x",function(s,u){return u===0?0:e.direction?Math.abs(s.index-j)*$:Math.abs(ie-s.index)*$}).attr("y",function(s,u){return e.direction?u===n.length-1?0:Ie(Math.abs(s.liquityAmount)):u===n.length-1?0:Ie(Math.abs(n[u+1].liquityAmount))}).attr("width",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?L:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-s.index)*$:0)}).attr("height",function(s,u){if(u===0&&n.length===1&&s.liquityAmount>0)return A;if(e.direction)return u===n.length-1?0:Number(s.liquityAmount)?A-Ie(Math.abs(s.liquityAmount)):0;{if(u===n.length-1)return 0;const xe=A-Ie(Math.abs(n[u+1].liquityAmount));return Number(n[u+1].liquityAmount)?xe:0}}).attr("fill",function(s,u){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(s,u){return"#417494"});const p=Q.append("g");p.append("line").attr("x1",0).attr("y1",155).attr("x2",L).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const C=p.append("g");let _=0;if(e.direction){for(let s=0;s<G.length;s++){const u=me(je[s],y)||"0";je.push(u);const xe=Math.abs(G[s]-j)*$;let fe=0;for(let pe=0;pe<u.length;pe++)u[pe]==="1"?fe+=4.02:u[pe]==="."?fe+=2.64:u[pe]==="7"?fe+=5.48:fe+=6;C.append("text").text(u).attr("x",xe-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}_=Math.abs(K-j)*$}else{for(let s=G.length-1;s>=0;s--){const u=me(je[s],y)||0;je.push(u);const xe=Math.abs(G[s]-ie)*$;let fe=0;for(let pe=0;pe<u.length;pe++)u[pe]==="1"?fe+=4.02:u[pe]==="."?fe+=2.64:u[pe]==="7"?fe+=5.48:fe+=6;C.append("text").text(u).attr("x",xe-fe/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}_=Math.abs(K-ie)*$}(T.value.theme=="default"?Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+_+", 0)");let X,Y,He,qe;e.direction?(X=z<j?-100:parseInt(String(Math.abs(z-j)*$)),Y=E<j?-100:parseInt(String(Math.abs(E-j)*$)),He=ne<j?-100:Math.abs(ne-j)*$,qe=ke<j?-100:Math.abs(ke-j)*$):(Y=z<j?-100:Math.abs(ie-z)*$,X=E<j?-100:Math.abs(ie-E)*$,qe=ne<j?-100:Math.abs(ie-ne)*$,He=ke<j?-100:Math.abs(ie-ke)*$),e.minPrice==="0"&&(X=0),e.maxPrice==="∞"&&(Y=L),ye.value,he.value=L-X+87+"px",ce.value=Y+98+"px",ne&&He<L&&Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+He+", 0)"),ke&&qe<L&&Q.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+qe+", 0)");const Te=Q.append("g").attr("id","left-handle"),ve=Q.append("g").attr("id","right-handle");T.value.theme=="default"?(Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Te.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),Te.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),ve.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),ve.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),ve.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Te.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),Te.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),ve.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),ve.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),ve.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),ve.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),Te.attr("transform","translate("+X+", 0)"),ve.attr("transform","translate("+Y+", 0)");const De=ii().extent([[0,0],[L,A]]).handleSize(30).on("end",it);Q.append("g").attr("class","brush").call(De).call(De.move,[X,Y]);function it(s){if(!s.sourceEvent||!s.selection)return;Te.attr("transform","translate("+s.selection[0]+", 0)"),ve.attr("transform","translate("+s.selection[1]+", 0)"),ye.value,he.value=L-s.selection[0]+87+"px",ce.value=s.selection[1]+74+"px";let u,xe,fe=0,pe=0;e.direction?(fe=S(parseInt(String(s.selection[0]/$+j)),Number(e.poolInfo.tickSpacing)),u=a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),pe=S(parseInt(String(s.selection[1]/$+j)),Number(e.poolInfo.tickSpacing)),xe=a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()):(pe=S(ie-s.selection[0]/$,Number(e.poolInfo.tickSpacing)),u=1/a.tickIndexToPrice(pe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),fe=S(ie-s.selection[1]/$,Number(e.poolInfo.tickSpacing)),xe=1/a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),d.emit("onChangeMinPrice",String(me(String(u),6))),d.emit("onChangeMaxPrice",String(me(String(xe),6)))}T.value.theme=="default"?ot(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):ot(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};return B(""),Ae(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,l,m,z,E,K])=>{n&&l&&m&&(n!=null&&n.liquidity)&&Ne(n,E)},{immediate:!0}),{store:T,loading:f,rangeSizeLower:Ce,rangeSizeUpper:x,rangeSizeLowerPosition:he,rangeSizeUpperPosition:ce,decimalFormat:Dt,numberformat:dt}}});const fi=e=>(qt("data-v-00e9c224"),e=e(),Mt(),e),pi={class:"chart-box"},gi={class:"chart"},bi=fi(()=>r("svg",{id:"chart"},null,-1));function hi(e,d,he,ce,M,Ce){const x=At;return R(),D("div",pi,[Lt(r("div",gi,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),D("div",{key:0,class:"range-size range-size-lower",style:vt({right:e.rangeSizeLowerPosition})},ue(("numberformat"in e?e.numberformat:de(dt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):ee("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),D("div",{key:1,class:"range-size range-size-upper",style:vt({left:e.rangeSizeUpperPosition})},ue(("numberformat"in e?e.numberformat:de(dt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):ee("",!0),bi],512),[[Gt,!e.chartLoading]]),e.chartLoading?(R(),Je(x,{key:0})):ee("",!0)])}const Ht=et(vi,[["render",hi],["__scopeId","data-v-00e9c224"]]),ki=Ve({props:{lever:{type:String,default:""}},setup(){return{}}});const wi=e=>(qt("data-v-619778e2"),e=e(),Mt(),e),yi={class:"lever"},Ci=wi(()=>r("div",{class:"lever-title"},"Leverage",-1)),_i={class:"lever-text"};function Ti(e,d,he,ce,M,Ce){return R(),D("div",yi,[Ci,r("div",_i,ue(e.lever),1)])}const Pi=et(ki,[["render",Ti],["__scopeId","data-v-619778e2"]]),Si=Ve({components:{NewLiquidityD3Chart:Ht,NewLiquidityPrice:Ft},setup(){const{t:e,locale:d}=$t(),he=B("liquidity"),ce=wt(),M=q(()=>ce),Ce=q(()=>M.value.chainName),x=Nt(),U=q(()=>x),T=q(()=>M.value.chainName?ht(M.value.chainName):{});It(()=>{Qe.value=!1});const Z=kt(),a=q(()=>{let i=null;for(let p=0;p<U.value.poolConfigList.length;p++){const C=U.value.poolConfigList[p];C.address==Z.query.poolAddress&&(i=C)}return i}),S=q(()=>{let i=null;for(const p in U.value.poolsObj){const C=U.value.poolsObj[p];C.address==Z.query.poolAddress&&(i=C)}return i}),J=B(),Ne=B(!0),ye=async(i,p)=>{var C,_;if(Ne.value=!0,p){Ye.value=[],f.value=[];const _e=i.token_a.decimals,X=i.token_b.decimals,Y=yt.tickIndexToPrice(i.current_tick_index,_e,X);Zt(yt.priceToTickIndex(new o(Y),(C=i.token_a)==null?void 0:C.decimals,(_=i.token_b)==null?void 0:_.decimals),Number(i.tickSpacing)),rt.value=Y.toString(),bt.value=new o(1).div(Y).toString(),b.value=i.needReverse?i.token_b:i.token_a,g.value=i.needReverse?i.token_a:i.token_b,J.value=i.needReverse,i.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===g.value.address.toLowerCase()?ze.value=!0:ze.value=!1;let He={poolAddress:i.address,coinTypeA:i.coin_a_address,coinTypeB:i.coin_b_address};const qe=await T.value.getTicks(He);Ye.value=qe?T.value.getTickDataFromUrlData(qe):[],Ne.value=!1,n(i)}},f=B([]),te=B(),n=i=>{const p=i.token_a.decimals,C=i.token_b.decimals;let _=U.value.poolPriceConfigObj&&U.value.poolPriceConfigObj[i.address]&&U.value.poolPriceConfigObj[i.address].recommend_ranges||{};const _e=U.value.poolPriceConfigObj&&U.value.poolPriceConfigObj[i.address]&&U.value.poolPriceConfigObj[i.address].type||"";let X,Y;const He=i.current_tick_index;te.value=i.current_tick_index,X=He-Number(i.type=="unstable"?Number(i.tickSpacing)*2:Number(i.tickSpacing)*3),Y=He+Number(i.type=="unstable"?Number(i.tickSpacing)*2:Number(i.tickSpacing)*3);const qe=T.value.TickMath.tickIndexToPrice(X,p,C).toString(),Te=T.value.TickMath.tickIndexToPrice(Y,p,C).toString();_["full range"]={lower:T.value.TickUtil.getMinIndex(Number(S.value.tickSpacing)),upper:T.value.TickUtil.getMaxIndex(Number(S.value.tickSpacing))},_.custom={lower:X,upper:Y,minPrice:qe,maxPrice:Te};const ve=[];for(let De in _)_[De]&&ve.push({..._[De],key:De});_e&&ve&&ve.length>2?i.isSelfBuilt?O.value="custom":_e=="stable"?O.value="suggested":O.value="passive":O.value="custom",f.value=ve,Ge.value=_,z({key:O.value,..._[O.value]})},l=B(""),m=B(""),z=i=>{O.value=i.key.toLowerCase();const p=S.value.token_a.decimals,C=S.value.token_b.decimals,{lower:_,upper:_e}=i;Ee.value=!1;const X=T.value.TickMath.tickIndexToPrice(_,p,C).toString(),Y=T.value.TickMath.tickIndexToPrice(_e,p,C).toString();if(i.key=="full range"){l.value=_,m.value=_e,E();return}ze.value?(ut.value=String(X),F.value=String(X),ct.value=String(Y),I.value=String(Y),l.value=_,m.value=_e):(ut.value=String(1/Number(Y)),F.value=String(1/Number(Y)),ct.value=String(1/Number(X)),I.value=String(1/Number(X)),l.value=T.value.TickMath.priceToTickIndex(new o(1/Number(Y)),p,C),m.value=T.value.TickMath.priceToTickIndex(new o(1/Number(X)),p,C))},E=i=>{F.value="0",I.value="∞"};Ae(()=>S.value,(i,p)=>{(!p&&i&&!$e(i)||p&&i&&p.address!==i.address)&&ye(i,!p||i.address!==p.address)},{immediate:!0}),Bt(()=>{b.value=B(),g.value=B(),Ye.value=[]}),Ae(()=>[a.value,S.value,U.value.recommendRangesObj],(i,p)=>{var C,_;(!p||i[0]&&i[1]&&i[2]&&!$e(i[0])&&!$e(i[1]&&!$e(i[2]))||((C=i[0])==null?void 0:C.address)!==((_=p[0])==null?void 0:_.address))&&i[0]&&i[2]&&!$e(i[0])&&!$e(i[2])&&x.setSinglePool(i[0],i[2],Ce.value)},{immediate:!0,deep:!0});const K=i=>{if(Ce.value=="Sui")switch(i){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(i){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},ne=i=>{switch(i){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},ke=i=>{var C,_;const p=U.value.poolPriceConfigObj&&U.value.poolPriceConfigObj[(C=S.value)==null?void 0:C.address]&&U.value.poolPriceConfigObj[(_=S.value)==null?void 0:_.address].type||"";if(f.value.length>2)if(p=="unstable")switch(i){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(i){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(p=="unstable")switch(i){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(i){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},v=B(1),L=()=>{const i=v.value/2;v.value=i},A=()=>{const i=v.value*2;v.value=i},P=q(()=>{var i,p,C;return!S.value||$e(M.value.addressHistTokens)||!M.value.addressHistTokens[(i=S.value)==null?void 0:i.poolAddress]?null:Object.fromEntries((C=M.value.addressHistTokens[(p=S.value)==null?void 0:p.poolAddress])==null?void 0:C.data.map(_=>[_.key,_.value]))}),N=B(30),G=B("30D"),j=q(()=>ze.value?P.value&&me(N.value==7?P.value.before_7_d_contract_price_lowest:N.value==24?P.value.before_24_h_contract_price_lowest:P.value.before_30_d_contract_price_lowest,6)||0:P.value&&me(new o(1).div(N.value==7?P.value.before_7_d_contract_price_highest:N.value==24?P.value.before_24_h_contract_price_highest:P.value.before_30_d_contract_price_highest).toString(),6)||0),ie=q(()=>ze.value?P.value&&me(N.value==7?P.value.before_7_d_contract_price_highest:N.value==24?P.value.before_24_h_contract_price_highest:P.value.before_30_d_contract_price_highest,6)||0:(P.value&&me(1/Number(N.value==7?P.value.before_7_d_contract_price_lowest:N.value==24?P.value.before_24_h_contract_price_lowest:P.value.before_30_d_contract_price_lowest),6))==1/0?0:P.value&&me(1/Number(N.value==7?P.value.before_7_d_contract_price_lowest:N.value==24?P.value.before_24_h_contract_price_lowest:P.value.before_30_d_contract_price_lowest),6)||0),$=q(()=>{const i=Number(F.value),p=Number(I.value);if(F.value=="0"&&I.value=="∞"||O.value=="full range")return"1x";if(F.value==I.value||O.value=="full range")return"--";if(F.value&&I.value&&F.value!=="0"&&I.value!=="∞"){const C=mt(1/(1-Number((i/p)**.25)),2);return Number(C)>0?C+"x":"--"}else return 1}),je=q(()=>{var i,p,C,_,_e,X;return((i=b.value)==null?void 0:i.isSelfBuilt)||((p=g.value)==null?void 0:p.isSelfBuilt)||((_=U.value.tokensObj[(C=b.value)==null?void 0:C.address])==null?void 0:_.isSelfBuilt)||((X=U.value.tokensObj[(_e=g.value)==null?void 0:_e.address])==null?void 0:X.isSelfBuilt)}),y=(i,p)=>{i!==F.value&&O.value=="full range"?z({key:"custom",...f.value.custom}):O.value!=="full range"&&O.value!=="custom"?(O.value="custom",F.value=i):F.value=i},Q=(i,p)=>{i!==I.value&&O.value=="full range"?z({key:"custom",...f.value.custom}):O.value!=="full range"&&O.value!=="custom"?(O.value="custom",i=="0"?I.value="∞":I.value=i):i=="0"?I.value="∞":I.value=i};return Ae(()=>[F.value,I.value],([i,p])=>{},{deep:!0,immediate:!0}),{positionError:Qe,getCoinIcon:i=>{var p;return(i==null?void 0:i.logoURI)||(i==null?void 0:i.logo_url)||((p=U.value.tokensObj[i==null?void 0:i.address])==null?void 0:p.logo_url)||(M.value.theme==="default"?gt("/image/coins/unknown.png"):gt("/image/coins/sui-unknown.png"))},chainName:Ce,store:M,currentTab:he,currentPrice:rt,currentPriceReverse:bt,fromCoin:b,toCoin:g,direction:ze,needReverse:J,addCommom:Se,decimalUi:me,priceTablList:f,currentPriceTab:O,sliderStyle:ke,poolInfo:S,tickList:Ye,getPriceTabImage:K,getPriceTabText:ne,defaultMinPrice:ut,defaultMaxPrice:ct,minPrice:F,maxPrice:I,currentTick:te,chartLoading:Ne,zoomOut:L,zoomIn:A,zoom:v,priceTab:z,before7dContractPriceLowest:j,before7dContractPriceHighest:ie,aprRewardsTime:G,lever:$,aprRewardsParameter:N,isSelfBuilt:je,priceRangeChangeMin:y,priceRangeChangeMax:Q,toggle:jt,getPirceTabTips:i=>{switch(i){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},timeList:[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}]}}});const Ni={class:"new-liquidity-left"},Ii=r("span",{class:"selectRange"},"Select Range",-1),Li={class:"price-info"},Ai={class:"left"},qi={class:"base-coin"},Mi={class:"base-coin-title"},$i=r("span",null,"Base coin",-1),Bi=r("svg",{class:"icon icon-up","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_up1"})],-1),Ri=r("svg",{class:"icon icon-down","aria-hidden":"true"},[r("use",{"xlink:href":"#icon-exchange_down1"})],-1),Fi=[Bi,Ri],Oi={class:"base-coin-bottom"},Ui={alt:""},zi={class:"current-price"},ji=r("div",{class:"current-price-title"},"Current Price",-1),Hi={key:0,class:"from-pre-to"},xi={class:"right"},Ei={class:"price-range"},Xi={class:"left"},Wi={class:"price-slider"},Di={class:"slider"},Zi=r("div",{class:"slider-ratio-content"},null,-1),Gi=[Zi],Ji={class:"price-tab-list"},Ki=["onClick"],Qi=["src"],Yi={class:"right"},Vi={class:"price-zoom"},en={class:"current-price"},tn=r("div",{class:"current-price-title"},"Current Price",-1),nn={key:0,class:"from-pre-to"},an={class:"price-zoom-right"},on={class:"leverage"},rn=r("div",{class:"left"},null,-1),ln={class:"right"},sn={class:"right-time"},un={key:0,class:"day-7-price-range"},cn=r("i",null,null,-1),dn={class:"gray"},mn={class:"time-list"},vn=["onClick"],fn={class:"right-price-h5"},pn={class:"apr-leverage"},gn={key:0,class:"position-tips"},bn=["src"],hn={class:"error"};function kn(e,d,he,ce,M,Ce){var S,J,Ne,ye,f,te,n;const x=Kt,U=Ht,T=Pi,Z=Ft,a=Jt("image");return R(),D("div",Ni,[Ii,r("div",Li,[r("div",Ai,[r("div",qi,[r("div",Mi,[$i,r("div",{class:"change-price",onClick:d[0]||(d[0]=(...l)=>e.toggle&&e.toggle(...l))},Fi)]),r("div",Oi,[Lt(r("img",Ui,null,512),[[a,e.getCoinIcon(e.fromCoin)]]),r("span",null,ue((S=e.fromCoin)==null?void 0:S.symbol),1)])]),r("div",zi,[ji,r("div",null,[r("span",null,ue(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPrice,6)):("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),D("span",Hi,ue((J=e.toCoin)==null?void 0:J.symbol)+" per "+ue((Ne=e.fromCoin)==null?void 0:Ne.symbol),1)):ee("",!0)])])]),r("div",xi,[e.currentTab=="liquidity"?(R(),D("div",{key:0,class:"zoom-out",onClick:d[1]||(d[1]=(...l)=>e.zoomOut&&e.zoomOut(...l))}," + ")):ee("",!0),e.currentTab=="liquidity"?(R(),D("div",{key:1,class:"zoom-in",onClick:d[2]||(d[2]=(...l)=>e.zoomIn&&e.zoomIn(...l))}," - ")):ee("",!0)])]),r("div",Ei,[r("div",Xi,[r("div",Wi,[r("div",Di,[r("div",{class:"slider-ratio",style:vt(e.sliderStyle(e.currentPriceTab))},Gi,4)])]),r("div",Ji,[(R(!0),D(ft,null,Tt(e.priceTablList,l=>(R(),D("div",{key:l.key,class:st(["price-tab-item",e.currentPriceTab==l.key?"price-tab-item-active":""]),onClick:m=>e.priceTab(l)},[Ue(x,{placement:"bottom","arrow-point-at-center":""},{title:pt(()=>[Rt(ue(e.getPirceTabTips(l.key)),1)]),default:pt(()=>[r("img",{src:e.getPriceTabImage(l.key),alt:""},null,8,Qi),r("span",null,ue(e.getPriceTabText(l.key)),1)]),_:2},1024)],10,Ki))),128))])]),r("div",Yi,[r("div",Vi,[r("div",en,[tn,r("div",null,[r("span",null,ue(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPrice,6)):("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),D("span",nn,ue(e.direction&&!e.needReverse?`${(ye=e.fromCoin)==null?void 0:ye.symbol} per ${(f=e.toCoin)==null?void 0:f.symbol}`:`${(te=e.toCoin)==null?void 0:te.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):ee("",!0)])]),r("div",an,[e.currentTab=="liquidity"?(R(),D("div",{key:0,class:"zoom-out",onClick:d[3]||(d[3]=(...l)=>e.zoomOut&&e.zoomOut(...l))}," + ")):ee("",!0),e.currentTab=="liquidity"?(R(),D("div",{key:1,class:"zoom-in",onClick:d[4]||(d[4]=(...l)=>e.zoomIn&&e.zoomIn(...l))}," - ")):ee("",!0)])]),e.poolInfo?(R(),Je(U,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):ee("",!0)])]),r("div",on,[rn,r("div",ln,[r("div",sn,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(R(),D("div",un,[cn,r("span",dn,ue(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),r("span",null,ue(("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceHighest,6))),1)])):ee("",!0),r("div",mn,[(R(!0),D(ft,null,Tt(e.timeList,l=>(R(),D("div",{key:l.value,class:st(["time-item",l.value==e.aprRewardsParameter?"time-item-active":""]),onClick:m=>e.aprRewardsParameter=l.value},ue(l.label),11,vn))),128))])]),r("div",fn,[r("span",null,ue(("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceLowest,6)))+" - "+ue(("addCommom"in e?e.addCommom:de(Se))(("decimalUi"in e?e.decimalUi:de(me))(e.before7dContractPriceHighest,6))),1)])])]),r("div",{class:st(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[r("div",pn,[Ue(T,{lever:e.lever},null,8,["lever"])]),Ue(Z,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(R(),D("div",gn,[r("img",{src:("importIcon"in e?e.importIcon:de(gt))("/image/icon-tips-error@2x.png"),alt:""},null,8,bn),r("p",hn,ue(e.$t("tips.positionError")),1)])):ee("",!0)],2)])}const xt=et(Si,[["render",kn]]),wn=Ve({components:{NewLiquidityTitle:Ot,NewLiquidityAssetsCard:Ut,NewLiquidityDepositRatio:zt},setup(){const{t:e,locale:d}=$t(),he=wt(),ce=q(()=>he),M=q(()=>ce.value.chainName),Ce=Nt(),x=q(()=>Ce),U=ni(),T=q(()=>U),Z=kt(),a=q(()=>{let t=null;for(const c in x.value.poolsObj){const h=x.value.poolsObj[c];h.address==Z.query.poolAddress&&(t=h)}return t}),S=B(!1),J=B(!1),Ne=q(()=>ce.value.theme),ye=async(t,c)=>{b.value=t.needReverse?t.token_b:t.token_a,g.value=t.needReverse?t.token_a:t.token_b,k.value="",w.value=""};Ae(()=>a.value,(t,c)=>{(!c&&t&&!$e(t)||c&&t&&c.address!==t.address)&&ye(t,!c||t.address!==c.address)},{immediate:!0});const f=q(()=>T.value.assets&&b.value&&T.value.assets[b.value.address]?Ct(T.value.assets[b.value.address].balance,b.value.decimals):"0"),te=q(()=>T.value.assets&&g.value&&T.value.assets[g.value.address]?Ct(T.value.assets[g.value.address].balance,g.value.decimals):"0"),n=t=>{t==="fromCoin"?(we.value=!0,M.value==="Aptos"?k.value=Number(f.value)>0?b.value.symbol=="APT"?new o(Number(f.value)).sub(new o(.1)).lt(new o(0))?"0":new o(Number(f.value)).sub(new o(.1)).toString():String(f.value):"":k.value=Number(f.value)>0?b.value.symbol=="SUI"?new o(Number(f.value)).sub(new o(.05)).lt(new o(0))?"0":new o(Number(f.value)).sub(new o(.05)).toString():String(f.value):""):(we.value=!1,M.value==="Aptos"?w.value=Number(te.value)>0?g.value.symbol=="APT"?new o(Number(te.value)).sub(new o(.1)).lt(new o(0))?"0":new o(Number(te.value)).sub(new o(.1)).toString():String(te.value):"":w.value=Number(te.value)>0?g.value.symbol=="SUI"?new o(Number(te.value)).sub(new o(.05)).lt(new o(0))?"0":new o(Number(te.value)).sub(new o(.05)).toString():String(te.value):"")},l=t=>{t==="fromCoin"?(we.value=!0,k.value=Number(f.value)>0?mt(new o(Number(f.value)).div(2).toString(),b.value.decimals).toString():""):(we.value=!1,w.value=Number(te.value)>0?mt(new o(Number(te.value)).div(2).toString(),g.value.decimals).toString():"")},m=B(),z=B(),E=B(),K=B(!1),ne=t=>{var c,h,ae,H;m.value=t,t==="fromCoin"?(z.value=((c=g.value)==null?void 0:c.address)||"",E.value=Z.query.actions=="new-position"?(h=b.value)==null?void 0:h.address:a.value.needReverse?a.value.token_b.address:a.value.token_a.address):(z.value=((ae=b.value)==null?void 0:ae.address)||"",E.value=Z.query.actions=="new-position"?(H=g.value)==null?void 0:H.address:a.value.needReverse?a.value.token_a.address:a.value.token_b.address),K.value=!0},ke=t=>{var ae,H,oe,re,V,le,se,ge;const c=a.value.needReverse?a.value.token_b:a.value.token_a,h=a.value.needReverse?a.value.token_a:a.value.token_b;m.value==="fromCoin"?(((ae=b.value)==null?void 0:ae.address)===(c==null?void 0:c.address)||!((H=b.value)!=null&&H.address)?(g.value&&t.address.toLowerCase()===((oe=g)==null?void 0:oe.value.address.toLowerCase())&&(g.value=null),b.value=t):(b.value&&t.address.toLowerCase()===((re=b)==null?void 0:re.value.address.toLowerCase())&&(b.value=null),g.value=t),Z.query.action||(Z.query.fee="")):((V=g.value)==null?void 0:V.address)===(h==null?void 0:h.address)||!((le=g.value)!=null&&le.address)?(b.value&&t.address.toLowerCase()===((se=b)==null?void 0:se.value.address.toLowerCase())&&(b.value=null),g.value=t):(g.value&&t.address.toLowerCase()===((ge=g)==null?void 0:ge.value.address.toLowerCase())&&(g.value=null),b.value=t),K.value=!1},v=q(()=>ce.value.chainName?ht(ce.value.chainName):{}),L=q(()=>ce.value.slippage),A=B(),P=async()=>{var Be,Me,Re,Fe;if(Ee.value||!F.value&&!I.value)return!1;if(!k.value&&!w.value&&!F.value&&!I.value)return;const t=a.value||{};if($e(t))return;const{TickUtil:c,TickMath:h,getNearestTickByTick:ae}=v.value,H=t==null?void 0:t.token_a.decimals,oe=t==null?void 0:t.token_b.decimals;let re,V,le,se,ge,Pe,Xe,Ze,Le=t==null?void 0:t.current_tick_index,W;if(t.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===g.value.address.toLowerCase()?W=!0:W=!1,F.value==="0"&&I.value==="∞")le=c.getMinIndex(Number(t.tickSpacing)),se=c.getMaxIndex(Number(t.tickSpacing)),ge=h.tickIndexToSqrtPriceX64(le),Pe=h.tickIndexToSqrtPriceX64(se);else if(O.value=="custom"){W?(re=F.value,V=I.value):(re=I.value!=="∞"?new o(1).div(I.value).toString():1/0,V=new o(1).div(F.value).toString());try{Xe=new o(re).equals(new o(0))?-443636:h.priceToTickIndex(new o(re),H,oe)}catch{Xe=-443636}try{Ze=h.priceToTickIndex(new o(V),H,oe)}catch{Ze=443636}le=ae(Xe,Number(t.tickSpacing),!0),se=ae(Ze,Number(t.tickSpacing),!0);try{ge=h.priceToSqrtPriceX64(new o(re),H,oe)}catch{(V===1/0||V==="∞")&&(ge=h.tickIndexToSqrtPriceX64(c.getMinIndex(Number(t.tickSpacing))))}try{Pe=h.priceToSqrtPriceX64(new o(V),H,oe)}catch{(V===1/0||V==="∞")&&(Pe=h.tickIndexToSqrtPriceX64(c.getMaxIndex(Number(t.tickSpacing))))}}else le=(Be=Ge.value[O.value])==null?void 0:Be.lower,se=(Me=Ge.value[O.value])==null?void 0:Me.upper,ge=h.tickIndexToSqrtPriceX64(le),Pe=h.tickIndexToSqrtPriceX64(se);if(I.value!=="∞"&&le>=se){S.value=!0,k.value="",J.value=!0,w.value="";return}if(I.value==="∞"||Le>=le&&Le<se){S.value=!1,J.value=!1;let be;if(k.value||w.value){if(we.value){const lt=new o(k.value).mul(Math.pow(10,b.value.decimals)).toString();be=new Oe(lt)}else{const lt=new o(w.value).mul(Math.pow(10,g.value.decimals)).toString();be=new Oe(lt)}const{liquidityAmount:We,tokenMaxA:nt,tokenMaxB:at,tokenMaxAOrigin:Xt,tokenMaxBOrigin:Wt}=v.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:t.token_a,tokenB:t.token_b,lowerTick:le,upperTick:se,coinAmount:be,iscoinA:W?we.value:!we.value,roundUp:!0,slippage:Number(L.value)/100,curSqrtPrice:new Oe(t.current_sqrt_price)});A.value={liquidityAmount:We,tokenMaxA:nt,tokenMaxB:at,tokenMaxAOrigin:Xt,tokenMaxBOrigin:Wt},W?we.value?w.value=Number(at)>0?at:"":k.value=Number(nt)>0?nt:"":we.value?w.value=nt:k.value=at}}else if(Le>=se){if(W?k.value="":w.value="",S.value=W,J.value=!W,k.value||w.value){let be;if(W){const We=new o(w.value).mul(Math.pow(10,(Re=g.value)==null?void 0:Re.decimals)).toString();be=new Oe(We),A.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ge,Pe,be),tokenMaxA:0,tokenMaxB:w.value}}else{const We=new o(k.value).mul(Math.pow(10,(Fe=b.value)==null?void 0:Fe.decimals)).toString();be=new Oe(We),A.value={liquidityAmount:v.value.estimateLiquidityForCoinB(ge,Pe,be),tokenMaxA:0,tokenMaxB:k.value}}}}else if(Le<le){if(S.value=!W,J.value=W,W?w.value="":k.value="",k.value||w.value){let be;if(W){const We=new o(k.value).mul(Math.pow(10,b.value.decimals)).toString();be=new Oe(We),A.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ge,Pe,be),tokenMaxA:k.value,tokenMaxB:0}}else{const We=new o(w.value).mul(Math.pow(10,g.value.decimals)).toString();be=new Oe(We),A.value={liquidityAmount:v.value.estimateLiquidityForCoinA(ge,Pe,be),tokenMaxA:w.value,tokenMaxB:0}}}}else S.value=!0,k.value="",J.value=!0,w.value=""};Ae(k,(t,c)=>{t==""&&we.value&&(w.value=""),t&&we.value&&!Ee.value&&P()}),Ae(w,(t,c)=>{t==""&&!we.value&&(k.value=""),t&&!we.value&&!Ee.value&&P()}),Ae(()=>ze.value,(t,c)=>{P()}),Ae(()=>[b.value,g.value],([t,c])=>{t&&c&&(S.value=!1,J.value=!1)});const N=B("--"),G=q(()=>x.value.RATES),j=()=>{const t=G.value&&G.value[b.value.address]&&G.value[b.value.address].price,c=G.value&&G.value[g.value.address]&&G.value[g.value.address].price;if(t&&c){const h=new o(k.value>0?k.value:0).mul(t),ae=new o(w.value>0?w.value:0).mul(c),H=h.add(ae).toNumber();N.value=H>0&&H<.01?"<$0.01":"$"+Se(H,2)}else N.value="--"};Ae(()=>[k.value,w.value,Ee.value],([t,c,h])=>{(t||c)&&!h?j():(!t||!c)&&!h&&(N.value="--")},{immediate:!0}),Ae(()=>N,t=>{},{immediate:!0});const ie=B(),$=async()=>{var W,Be;if(!F.value&&!I.value)return!1;if(!k.value&&!w.value&&!F.value&&!I.value)return;const t=a.value;if($e(t))return;const{TickUtil:c,TickMath:h,getNearestTickByTick:ae}=v.value,H=t==null?void 0:t.token_a.decimals,oe=t==null?void 0:t.token_b.decimals;let re,V,le,se,ge,Pe,Xe;if(t.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===g.value.address.toLowerCase()?Xe=!0:Xe=!1,F.value==="0"&&I.value==="∞")le=c.getMinIndex(Number(t.tickSpacing)),se=c.getMaxIndex(Number(t.tickSpacing));else if(O.value=="custom"){Xe?(re=Number(F.value),V=Number(I.value)):(re=new o(1).div(I.value).toString(),V=new o(1).div(F.value).toString());try{ge=re==0?-443636:h.priceToTickIndex(new o(re),H,oe)}catch{ge=-443636}try{Pe=h.priceToTickIndex(new o(V),H,oe)}catch{Pe=443636}le=ae(ge,Number(t.tickSpacing),!0),se=ae(Pe,Number(t.tickSpacing),!0)}else le=(W=Ge.value[O.value])==null?void 0:W.lower,se=(Be=Ge.value[O.value])==null?void 0:Be.upper;const Ze=G.value[t==null?void 0:t.token_a.address].price,Le=G.value[t==null?void 0:t.token_b.address].price;ze.value?new Oe(t.current_sqrt_price):new Oe(1/t.current_sqrt_price);try{const{amountA:Me,amountB:Re,tokenAmountsInfo:Fe}=await v.value.estCoinAmountsFromTotalAmount({lowerTick:le,upperTick:se,decimalsA:H,decimalsB:oe,curSqrtPrice:new Oe(t.current_sqrt_price),totalAmount:N.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:Le});ie.value=Fe,t.needReverse?ze.value?(k.value=Me,w.value=Re):(k.value=Re,w.value=Me):(k.value=Me,w.value=Re)}catch{}};Ae([F,I],([t,c])=>{Ee.value?Ee.value&&$():P(),c!=="∞"&&Number(t)!==0&&Number(c)!==0&&Number(t)>=Number(c)?Qe.value=!0:Qe.value=!1,Number(t)==0&&Number(c)==0&&rt.value&&(Qe.value=!0)},{deep:!0,immediate:!0});const je=t=>{const c=t.replace(/[^\d.]/g,""),h="$"+Se(c);Ee.value=!0,N.value=h,c>0?$():(k.value="",w.value="")},y=B(!1),{setTransactionTxid:Q,setTransactionDesc:Ke,setIsShowWaiting:Ie,setIsShowSuccess:tt,setPositiomNum:i,setIsShowRejected:p}=he,C=ci(),_=q(()=>x.value.currentPositionInfo),_e=B(!1),X=async t=>{var ge,Pe,Xe,Ze;y.value=!1,x.value.currentPositionInfo={},Q(""),Ke(e("tips.increaseLiquiditySuccess",{from:S.value?"":`${Se(k.value)} ${(ge=b.value)==null?void 0:ge.symbol}`,and:!S.value&&!J.value?"and":"",to:J.value?"":`${Se(w.value)} ${(Pe=g.value)==null?void 0:Pe.symbol}`})),Ie(!0);const c=ze.value?we.value:!we.value;let h,ae,H,oe,re,V;const le=a.value.token_a.decimals,se=a.value.token_b.decimals;if(F.value==="0"&&I.value==="∞")H=v.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),oe=v.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing));else if(O.value=="custom"){ze.value?(h=Number(F.value),ae=Number(I.value)):(h=new o(1).div(I.value).toString(),ae=new o(1).div(F.value).toString());try{re=h==0?v.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)):v.value.TickMath.priceToTickIndex(new o(Number(h).toFixed(6)),le,se)}catch{re=v.value.TickUtil.getMinIndex(Number(a.value.tickSpacing))}try{V=v.value.TickMath.priceToTickIndex(new o(Number(ae).toFixed(6)),le,se)}catch{V=v.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))}H=v.value.getNearestTickByTick(re,Number(a.value.tickSpacing),!0),oe=v.value.getNearestTickByTick(V,Number(a.value.tickSpacing),!0)}else H=Ge.value[O.value].lower,oe=Ge.value[O.value].upper;try{let Le;Ee.value?Le=await v.value.getCreateAddLiquidityPayload({pool:a.value,curSqrtPrice:new Oe(a.value.current_sqrt_price),tickLower:H,tickUpper:oe,slippage:Number(L.value)/100,tokenAmounts:ie.value}):Le=await v.value.getAddLiquidityTransactionPayload({pool:{poolAddress:a.value.poolAddress,token_a:a.value.token_a,token_b:a.value.token_b},amount:we.value?k.value:w.value,fix_amount_a:c,tick_lower:H,tick_upper:oe,index:0,slippage:Number(L.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new Oe(a.value.current_sqrt_price)});let W;if(M.value==="Aptos")W=await T.value.currentWallet.signAndSubmitTransaction(Le);else{const Be=await T.value.currentWallet.signAndExecuteTransactionBlock(Le);W=v.value.handleTx(Be)}if(W&&W.hash){Q(W.hash),Ie(!1),tt(!0);let Be;a.value.needReverse?a.value.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===g.value.address.toLowerCase()?Be=!1:Be=!0:a.value.token_a.address.toLowerCase()===b.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===g.value.address.toLowerCase()?Be=!0:Be=!1;const Me={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:S.value?"":`${Se(k.value)} ${(Xe=b.value)==null?void 0:Xe.symbol}`,and:!S.value&&!J.value?"and":"",to:J.value?"":`${Se(w.value)} ${(Ze=g.value)==null?void 0:Ze.symbol}`}),hash:W.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};M.value!=="Aptos"&&(Me.res=W.res),v.value.showTransitionPending(Me);const Re=await v.value.watchTransaction(Me,!0);if(Re.status){if(tt(!1),x.value.setCurrentPositionLoading(!0),_e.value=!0,M.value==="Aptos"){if(await x.value.setCurrentPositionInfo(Re.nftInfo[0].data.id.creator,Re.nftInfo[0].data.id.collection,Re.nftInfo[0].data.name,M.value),t)try{await C.subscribePosition({pool_address:_.value.poolAddress,position_index:_.value.index},_.value.nftHash)}catch{}}else{const Fe=Re.nftInfo,be=await _t(2e3);if(await x.value.setCurrentPositionInfo(Fe==null?void 0:Fe.pool,"","",M.value,Fe==null?void 0:Fe.position),await _t(1e3),t)try{await C.subscribePosition({pool_address:_.value.poolAddress,position_index:_.value.index},_.value.nftHash)}catch{}}setTimeout(()=>{Ce.updateCurrentPools(a.value.poolAddress,M.value),v.value.getAccount(T.value.address)},3e3),setTimeout(async()=>{Pt(v,a)},3e3)}i()}else Ie(!1),p(!0);k.value="",w.value=""}catch{k.value="",w.value="",Ie(!1),p(!0)}},Y=q(()=>!!(!k.value&&!w.value||Number(k.value)>Number(f.value)||Number(w.value)>Number(te.value)||qe.value!==e("button.addLiquidity")&&qe.value!==e("newAdd.preview")||a.value&&a.value&&a.value.is_pause||Number(k.value)<=0&&Number(w.value)<=0||!S.value&&Number(k.value)==0||!J.value&&Number(w.value)==0)),He=q(()=>!b.value||!g.value),qe=q(()=>a.value&&a.value.is_pause?"Pool Closed":!b.value||!g.value||He.value?e("modal.selectTokenModalTitle"):Number(k.value)>Number(f.value)?e("button.insufficientBalance",{name:b.value.symbol}):Number(w.value)>Number(te.value)?e("button.insufficientBalance",{name:g.value.symbol}):!Number(k.value)&&!Number(w.value)?e("button.enterAmount"):I.value!=="∞"&&Number(F.value)>=Number(I.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),Te=B({}),ve=B({}),De=B(!1),it=(t,c)=>{const h=localStorage.getItem(t.address);x.value.tokensObj&&x.value.tokensObj[t.address]&&x.value.tokensObj[t.address].isSelfBuilt&&!h&&(c=="fromCoin"&&(Te.value=t),c=="toCoin"&&(ve.value=t),De.value=!0)};Ae(()=>[b.value,g.value],([t,c])=>{t&&!$e(t)&&it(t,"fromCoin"),c&&!$e(c)&&it(c,"toCoin")},{immediate:!0});const s=Qt(),u=()=>{M.value!=="Aptos"?s.push("/pool/list"):s.push("/pools")},xe=t=>{Ee.value,X(t)},fe=()=>{Z.query.action!=="create-pool"&&Z.query.actions!=="new-position"&&(Pt(v,a),P(),Ce.updateCurrentPools(a.value.poolAddress,M.value)),Ce.setPoolConfigList(M.value,ce.value.filterCoinsObj)},pe=q(()=>{var h,ae,H,oe,re,V;const t=(H=G.value[(ae=(h=b)==null?void 0:h.value)==null?void 0:ae.address])==null?void 0:H.price,c=(V=G.value[(re=(oe=g)==null?void 0:oe.value)==null?void 0:re.address])==null?void 0:V.price;return!!(t&&c)});return Ae(()=>[Z,x.value.tokensObj],([t,c])=>{var h;c&&!$e(c)&&(g.value||(g.value=x.value.tokensObj[(h=t==null?void 0:t.query)==null?void 0:h.toCoin]))},{immediate:!0,deep:!0}),{positionError:Qe,decimalUi:me,poolInfo:a,fromCoinAmount:k,toCoinAmount:w,fromCoin:b,toCoin:g,theme:Ne,showFromCoinLock:S,showToCoinLock:J,fromCoinBlance:f,toCoinBlance:te,maxBtnSelect:n,halfBtnSelect:l,fixedFromCoin:we,openCoinSelect:ne,currentCoinKey:m,existingCoins:z,lastSelectCoin:E,showCoinSelect:K,onCoinSelect:ke,liquidityTotalAmount:N,toggle:jt,onInput:je,isInputTotalAmount:Ee,isViewDetail:_e,addLiquidityBtnDisabled:Y,addLiquidityBtnText:qe,isShowTokenWarning:De,chainName:M,closeTokenWarning:u,warningFromCoin:Te,warningToCoin:ve,isShowLiquidityModal:y,currentPrice:rt,currentPriceReverse:bt,currentPriceTab:O,minPrice:F,maxPrice:I,toAdd:X,direction:ze,wallet:T,getAddLiquidityType:xe,clickRefresh:fe,isShowtotalAmount:pe}}});const yn={class:"new-liquidity-right"},Cn={class:"deposit-title"},_n={class:"card-container"},Tn={key:0,class:"lock"},Pn={class:"card-item"},Sn={class:"card-item"},Nn={key:0,class:"total-amount"},In=r("span",null,"Total Amount",-1);function Ln(e,d,he,ce,M,Ce){const x=Ot,U=ai,T=Ut,Z=ri,a=zt,S=Yt,J=li,Ne=si,ye=ui;return R(),D("div",yn,[r("div",Cn,[Ue(x,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),r("div",_n,[e.positionError?(R(),D("div",Tn,[Ue(U)])):ee("",!0),r("div",Pn,[Ue(T,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":d[0]||(d[0]=f=>e.fromCoinAmount=f),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:d[1]||(d[1]=f=>e.maxBtnSelect("fromCoin")),onOnHalf:d[2]||(d[2]=f=>e.halfBtnSelect("fromCoin")),onOnInput:d[3]||(d[3]=f=>{e.fromCoinAmount=f,e.fixedFromCoin=!0,e.isInputTotalAmount=!1}),onOnSelect:d[4]||(d[4]=f=>e.openCoinSelect("fromCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(R(),Je(Z,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):ee("",!0)]),r("div",Sn,[Ue(T,{modelValue:e.toCoinAmount,"onUpdate:modelValue":d[5]||(d[5]=f=>e.toCoinAmount=f),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:d[6]||(d[6]=f=>e.maxBtnSelect("toCoin")),onOnHalf:d[7]||(d[7]=f=>e.halfBtnSelect("toCoin")),onOnInput:d[8]||(d[8]=f=>{e.toCoinAmount=f,e.fixedFromCoin=!1,e.isInputTotalAmount=!1}),onOnSelect:d[9]||(d[9]=f=>e.openCoinSelect("toCoin"))},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(R(),Je(Z,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):ee("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(R(),D("img",{key:1,class:"add",src:di,alt:"",onClick:d[10]||(d[10]=(...f)=>e.toggle&&e.toggle(...f))})):ee("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(R(),D("img",{key:2,class:"add",src:mi,alt:"",onClick:d[11]||(d[11]=(...f)=>e.toggle&&e.toggle(...f))})):ee("",!0)]),e.isShowtotalAmount?(R(),D("div",Nn,[In,r("span",null,ue(e.liquidityTotalAmount)+" ",1)])):ee("",!0),Ue(a,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Ue(S,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:d[12]||(d[12]=f=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:pt(()=>[Rt(ue(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(R(),Je(J,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:d[13]||(d[13]=f=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):ee("",!0),e.isViewDetail?(R(),Je(Ne,{key:2,"pool-info":e.poolInfo,onOnClose:d[14]||(d[14]=f=>e.isViewDetail=!1)},null,8,["pool-info"])):ee("",!0),e.isShowLiquidityModal?(R(),Je(ye,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:d[15]||(d[15]=f=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):ee("",!0)])}const Et=et(wn,[["render",Ln]]),An=Ve({components:{NewLiquidityLeft:xt,NewLiquidityRight:Et},setup(){Bt(()=>{oi()});const e=kt();return{tickList:Ye,route:e}}});const qn={key:0,class:"loading-spin-liquidity loading-global"},Mn={class:"privide-liquidity"};function $n(e,d,he,ce,M,Ce){var Z,a;const x=At,U=xt,T=Et;return R(),D(ft,null,[!e.tickList&&((a=(Z=e.route)==null?void 0:Z.query)!=null&&a.poolAddress)?(R(),D("div",qn,[Ue(x)])):ee("",!0),r("div",Mn,[Ue(U),Ue(T)])],64)}const va=et(An,[["render",$n],["__scopeId","data-v-fc58011a"]]);export{va as default};
