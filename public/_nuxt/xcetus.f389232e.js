import{S as A,f as O,am as f,s as p,D as l,c as P,p as y,a as B}from"./pool.391d046d.js";import{_ as C}from"./index.383699e2.js";import{a0 as F,m as R,N as V,a1 as W}from"./entry.0485e02f.js";function h(s){const i={fullRpcUrl:localStorage.getItem(`${s}-currentRpc`)||C[s||"Sui"].fullRpcUrl,faucetURL:localStorage.getItem(`${s}-currentRpc`)||C[s||"Sui"].faucetURL,simulationAccount:C[s||"Sui"].simulationAccount,xcetus:C[s||"Sui"].xcetus},e=F(new A(i)),r=O(),c=R(()=>r);V(()=>{c.value.address&&(e.senderAddress=c.value.address)});const u=async t=>await e.XCetusModule.getOwnerLockCetuss(t),v=async(t,n)=>f.getAvailableXCetus(t,n),w=async t=>await e.XCetusModule.getOwnerCetusCoins(t),m=async t=>await e.XCetusModule.getOwnerVeNFT(t),M=async(t,n)=>{const a={amount:t};n&&(a.venft_id=n);const o=await e.XCetusModule.convertPayload(a);return d(o)},g=async()=>{const t=await e.XCetusModule.mintVeNFTPayload();return d(t)},X=async(t,n)=>{const a=await e.XCetusModule.redeemNum(t,n);return{amountOut:a.amountOut,percent:p(new l(a.percent).mul(new l(100)).toString(),2)}},S=async(t,n)=>{const a=await e.XCetusModule.reverseRedeemNum(t,n);return{amountOut:a.amountOut,percent:p(new l(a.percent).mul(new l(100)).toString(),2)}},x=async(t,n,a)=>{const o=await e.XCetusModule.redeemLockPayload({venft_id:n,amount:t,lock_day:a});return d(o)},b=t=>f.getLockingCetuss(t),k=async(t,n)=>{const a=await e.XCetusModule.getLockCetus(t);if(a&&f.isLocked(a)){const o=e.XCetusModule.cancelRedeemPayload({venft_id:n,lock_id:t});return d(o)}},L=async(t,n)=>{const a=await e.XCetusModule.getLockCetus(t);if(a&&!f.isLocked(a)){const o=await e.XCetusModule.redeemPayload({venft_id:n,lock_id:t});return d(o)}},N=async()=>{const t=await e.XCetusModule.getDividendManager();return{nextStartTime:Number(f.getNextStartTime(t).toString()),...t}},T=async(t,n)=>{const a=await e.XCetusModule.getVeNFTDividendInfo(n.venft_dividends.id,t);return{rewards:a&&a.rewards||[]}},_=async t=>{const n=await e.XCetusModule.getDividendManager();if(n.bonus_types.length>0){const a=await e.XCetusModule.redeemDividendPayload(t,n.bonus_types);return d(a)}},D=async t=>{const n=await e.XCetusModule.getDividendManager();if(n.bonus_types.length>0){const a=await e.XCetusModule.redeemDividendV2Payload(t,n.bonus_types);return d(a)}},I=async t=>{const n=await e.XCetusModule.getOwnerVeNFT(t);if(n){const a=await e.XCetusModule.getXcetusManager(),o=new l(n.xcetus_balance).div(a.treasury).mul(100).toString();return Number(o)>0&&Number(o)<.01?"<0.01":p(o,2)}else return 0},d=t=>({transactionBlock:t,options:{showEffects:!0,showEvents:!0,showInput:!0,showRawInput:!0,showObjectChanges:!0,showBalanceChanges:!0}});return{getOwnerLockCetuss:u,getOwnerCetusCoins:w,getOwnerVeNFT:m,depositCetus:M,getMintVeNFTPayload:g,redeemNum:X,getRedeemLockPayload:x,getAvailableXCetus:v,getLockingCetuss:b,getCancelRedeemPayload:k,getVeNFTDividendInfo:T,reverseRedeemNum:S,getRedeemPayload:L,getRedeemDividendPayload:_,getMyShare:I,getDividendManager:N,getPeriod:t=>{const n=Date.now()/1e3,{start_time:a,interval_day:o}=t;return Math.ceil((n-a)/(o*24*3600))},getRedeemDividendV2Payload:D}}const q=W("xcetus",{state:()=>({venft_id:"",xWhaleBalance:"--",venftInfo:{},pendingAmount:"--",whaleBalance:"--",ownerLocks:[],availableXwhale:"--",redeemingXwhale:"--",nextStartTime:"",xcetusShare:"--",pendingCoinInfo:{},cetusApr:"",claimLoading:"",dividendManagerInfo:{}}),actions:{async getOwnerVeNFT(s){const i=h("Sui");try{const e=await i.getOwnerVeNFT(s);e&&!P(e)?(this.venft_id=e.id,this.xWhaleBalance=y(e.xcetus_balance,9),this.venftInfo={id:e.id,type:e.type,index:e.index,xcetus_balance:e.xcetus_balance},this.getVeNFTDividendInfo()):(this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0")}catch{this.xWhaleBalance="0",this.availableXwhale="0",this.redeemingXwhale="0",this.pendingAmount="0"}},async getVeNFTDividendInfo(){const s=h("Sui"),i=B("Sui");try{const e=await s.getVeNFTDividendInfo(this.venft_id,this.dividendManagerInfo),r=await s.getPeriod(this.dividendManagerInfo);let c=0;if(e&&e.rewards){for(let u=0;u<e.rewards.length;u++)if(e.rewards[u].period<r){const v=e.rewards[u].rewards;for(let w=0;w<v.length;w++){const m=v[w];let g=(await i.getTokenList()).filter(X=>X.address==m.coin_type)[0];g||(g=(await i.getTokenListByCoinType([m.coin_type]))[0]),this.pendingCoinInfo=g,c+=Number(y(m.amount,g.decimals))}}this.pendingAmount=p(c,6)}else this.pendingAmount="0"}catch{this.pendingAmount="0"}},async getDividendManager(){const i=await h("Sui").getDividendManager();this.nextStartTime=i.nextStartTime,this.dividendManagerInfo=i,this.getVeNFTDividendInfo()},async getAccountWhaleBalance(s){const e=await h("Sui").getOwnerCetusCoins(s);if(e&&e.length>0){let r=new l(0);e.forEach(c=>{r=r.add(y(c.balance.toString(),9))}),this.whaleBalance=r}else this.whaleBalance="0"},async getOwnerLockCetuss(s){const r=(await h("Sui").getOwnerLockCetuss(s)).sort((c,u)=>c.locked_until_time-u.locked_until_time);this.ownerLocks=r,this.setClaimLoading(""),this.getAvailableXCetus()},async getAvailableXCetus(){const i=await h("Sui").getAvailableXCetus(this.venftInfo,this.ownerLocks);this.availableXwhale=y(i,9),this.redeemingXwhale=this.xWhaleBalance!=="--"?new l(this.xWhaleBalance).sub(new l(this.availableXwhale)).toString():"--"},async getMyShare(s){const e=await h("Sui").getMyShare(s);this.xcetusShare=Number(e)>0&&Number(e)<.01?"<0.01":e},async getXcetusApr(){const{data:s}=await fetch(`${C.Sui.api}/v2/sui/storm/dividend_rewards`).then(e=>e.json()),i=s.apr&&s.apr.replace("%","");this.cetusApr=Number(i)>0&&Number(i)<.01?"<0.01":i},loginOut(){this.venft_id="",this.xWhaleBalance="--",this.venftInfo={},this.pendingAmount="--",this.whaleBalance="--",this.ownerLocks=[],this.availableXwhale="--",this.redeemingXwhale="--",this.xcetusShare="--"},setClaimLoading(s){this.claimLoading=s}}});export{h as a,q as u};
