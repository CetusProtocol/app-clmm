var Bs=Object.defineProperty;var Ls=(e,t,s)=>t in e?Bs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var $=(e,t,s)=>(Ls(e,typeof t!="symbol"?t+"":t,s),s);import{L as Ks,M as F,N as ge,O as P,P as p,Q as j,R as C,S as Se,J as d,U as w,V as he,W as es,X as St,Y as H,T as L,Z as Me,_ as Ke,$ as ht,a0 as qs,a1 as Fs,a2 as ts,a3 as Tt,a4 as qe,a5 as Ce,a6 as Us,a7 as Vs,a8 as ze,a9 as Ne,aa as Kt,ab as qt,e as O,C as re,ac as Gs,ad as Xs,ae as Ft,af as at,ag as rt,ah as zs}from"./pool.dbcfb6f6.js";import{s as r,d as x,o as _,g as T,h as k,i as Ve,j as se,k as R,m as S,p as f,q as _e,t as Ge,v as ss,w as y,x as V,y as ee,B as I,z as Ws,A as Js,C as me,D as Hs,E as st,F as gt,G as Ys,H as Zs,I as Qs}from"./sha256.67839be0.js";import{D as z}from"./decimal.0e8aa3f1.js";const is=32;function ei(e){return ti(e)&&si(e)===is}function K(e,t=!1){let s=e.toLowerCase();return!t&&s.startsWith("0x")&&(s=s.slice(2)),`0x${s.padStart(is*2,"0")}`}function ie(e,t=!1){return K(e,t)}function ti(e){return/^(0x|0X)?[a-fA-F0-9]+$/.test(e)&&e.length%2===0}function si(e){return/^(0x|0X)/.test(e)?(e.length-2)/2:e.length/2}r();r();r();r();r();r();const xe=x([_({AddressOwner:r()}),_({ObjectOwner:r()}),_({Shared:_({initial_shared_version:T(r())})}),k("Immutable")]),ii=Ve("SuiJsonValue",()=>!0),ni=x([_({u32:r()}),_({u64:r()}),_({f64:r()})]);_({attributes:se(r(),T(ni)),featureFlags:se(r(),R()),maxSupportedProtocolVersion:r(),minSupportedProtocolVersion:r(),protocolVersion:r()});x([r(),k("package")]);const oe=_({digest:r(),objectId:r(),version:x([S(),r()])}),oi=_({payment:f(oe),owner:r(),price:r(),budget:r()}),ai=_e(oe,_({type:r(),owner:xe,previousTransaction:r()})),ri=se(r(),Ge()),ci=se(r(),ss()),di=_({type:r(),fields:ri,hasPublicTransfer:R()}),ft=_({disassembled:ci}),ui=x([_e(di,_({dataType:k("moveObject")})),_e(ft,_({dataType:k("package")}))]),li=_({type:r(),hasPublicTransfer:R(),version:r(),bcsBytes:r()}),_i=_({id:r(),moduleMap:se(r(),r())}),pi=x([_e(li,_({dataType:k("moveObject")})),_e(_i,_({dataType:k("package")}))]);BigInt(1e9);r();const ns=_({code:r(),error:y(r()),object_id:y(r()),parent_object_id:y(r()),version:y(r()),digest:y(r())}),mi=_({data:T(y(se(r(),r()))),error:T(y(ns))}),hi=x([mi,y(se(r(),r()))]),os=_({objectId:r(),version:r(),digest:r(),type:T(y(r())),content:T(y(ui)),bcs:T(y(pi)),owner:T(y(xe)),previousTransaction:T(y(r())),storageRebate:T(y(r())),display:T(y(hi))});_({showType:T(y(R())),showContent:T(y(R())),showBcs:T(y(R())),showOwner:T(y(R())),showPreviousTransaction:T(y(R())),showStorageRebate:T(y(R())),showDisplay:T(y(R()))});x([k("Exists"),k("notExists"),k("Deleted")]);f(ai);const gi=_({data:T(y(os)),error:T(y(ns))});function fi(e){return e.data}function yi(e){if(e.error&&"object_id"in e.error&&"version"in e.error&&"digest"in e.error){const t=e.error;return{objectId:t.object_id,version:t.version,digest:t.digest}}}function ki(e){if("reference"in e)return e.reference;const t=fi(e);return t?{objectId:t.objectId,version:t.version,digest:t.digest}:yi(e)}_({objectId:r(),atCheckpoint:y(S())});_({data:f(gi),nextCursor:y(T(r())),hasNextPage:R()});x([_({details:os,status:k("VersionFound")}),_({details:r(),status:k("ObjectNotExists")}),_({details:oe,status:k("ObjectDeleted")}),_({details:V([r(),S()]),status:k("VersionNotFound")}),_({details:_({asked_version:S(),latest_version:S(),object_id:r()}),status:k("VersionTooHigh")})]);const as=_({txDigest:r(),eventSeq:r()}),rs=_({id:as,packageId:r(),transactionModule:r(),sender:r(),type:r(),parsedJson:y(se(r(),Ge())),bcs:y(r()),timestampMs:y(r())});_({data:f(rs),nextCursor:T(as),hasNextPage:R()});r();const bi=_({epoch:r(),storage_charge:r(),computation_charge:r(),storage_rebate:r(),epoch_start_timestamp_ms:y(r())}),vi=_({epoch:r(),round:r(),commit_timestamp_ms:r()}),wi=_({objects:f(r())}),ne=x([k("GasCoin"),_({Input:S()}),_({Result:S()}),_({NestedResult:V([S(),S()])})]),Ci=_({arguments:y(f(ne)),type_arguments:y(f(r())),package:r(),module:r(),function:r()}),Si=x([_({MoveCall:Ci}),_({TransferObjects:V([f(ne),ne])}),_({SplitCoins:V([ne,f(ne)])}),_({MergeCoins:V([ne,f(ne)])}),_({Publish:x([V([ft,f(r())]),f(r())])}),_({Upgrade:x([V([ft,f(r()),r(),ne]),V([f(r()),r(),ne])])}),_({MakeMoveVec:V([T(r()),f(ne)])})]),Ti=x([_({type:k("pure"),valueType:T(r()),value:ii}),_({type:k("object"),objectType:k("immOrOwnedObject"),objectId:r(),version:r(),digest:r()}),_({type:k("object"),objectType:k("sharedObject"),objectId:r(),initialSharedVersion:r(),mutable:R()})]),Pi=_({transactions:f(Si),inputs:f(Ti)}),ji=x([_e(bi,_({kind:k("ChangeEpoch")})),_e(vi,_({kind:k("ConsensusCommitPrologue")})),_e(wi,_({kind:k("Genesis")})),_e(Pi,_({kind:k("ProgrammableTransaction")}))]),cs=_({messageVersion:k("v1"),transaction:ji,sender:r(),gasData:oi});r();const Oi=x([r(),f(r())]);_({epoch:r(),signature:Oi,signers_map:f(S())});const Ai=_({computationCost:r(),storageCost:r(),storageRebate:r(),nonRefundableStorageFee:r()}),xi=x([k("success"),k("failure")]),Ii=_({status:xi,error:y(r())}),We=_({owner:xe,reference:oe}),Di=_({objectId:r(),sequenceNumber:r()}),Pt=_({messageVersion:k("v1"),status:Ii,executedEpoch:r(),modifiedAtVersions:y(f(Di)),gasUsed:Ai,sharedObjects:y(f(oe)),transactionDigest:r(),created:y(f(We)),mutated:y(f(We)),unwrapped:y(f(We)),deleted:y(f(oe)),unwrappedThenDeleted:y(f(oe)),wrapped:y(f(oe)),gasObject:We,eventsDigest:T(y(r())),dependencies:y(f(r()))}),jt=f(rs),Ei=V([f(S()),r()]),Mi=V([ne,f(S()),r()]),Ni=_({mutableReferenceOutputs:y(f(Mi)),returnValues:y(f(Ei))});_({effects:Pt,events:jt,results:y(f(Ni)),error:y(r())});r();const $i=_({data:cs,txSignatures:f(r())}),Ri=_({type:k("published"),packageId:r(),version:r(),digest:r(),modules:f(r())}),Bi=_({type:k("transferred"),sender:r(),recipient:xe,objectType:r(),objectId:r(),version:r(),digest:r()}),Li=_({type:k("mutated"),sender:r(),owner:xe,objectType:r(),objectId:r(),version:r(),previousVersion:r(),digest:r()}),Ki=_({type:k("deleted"),sender:r(),objectType:r(),objectId:r(),version:r()}),qi=_({type:k("wrapped"),sender:r(),objectType:r(),objectId:r(),version:r()}),Fi=_({type:k("created"),sender:r(),owner:xe,objectType:r(),objectId:r(),version:r(),digest:r()}),ds=x([Ri,Bi,Li,Ki,qi,Fi]),us=_({owner:xe,coinType:r(),amount:r()}),Ui=_({digest:r(),transaction:y($i),effects:y(Pt),events:y(jt),timestampMs:y(r()),checkpoint:y(r()),confirmedLocalExecution:y(R()),objectChanges:y(f(ds)),balanceChanges:y(f(us)),errors:y(f(r()))});_({showInput:y(R()),showEffects:y(R()),showEvents:y(R()),showObjectChanges:y(R()),showBalanceChanges:y(R())});_({data:f(Ui),nextCursor:T(r()),hasNextPage:R()});_({effects:Pt,events:jt,objectChanges:f(ds),balanceChanges:f(us),input:y(cs)});const Vi=x([r(),_({Object:r()})]);f(Vi);const Gi=_({address:r(),name:r()}),Xi=x([k("Private"),k("Public"),k("Friend")]),Ot=_({abilities:f(r())}),zi=_({constraints:Ot,isPhantom:R()}),Wi=_({TypeParameter:S()}),ct=V([_({module:r(),package:r(),function:r()}),r()]);_({rank3Days:f(ct),rank7Days:f(ct),rank30Days:f(ct)});function ls(e){if(!e)return!1;if(typeof e=="string"||ee(e,Wi)||_s(e))return!0;if(typeof e!="object")return!1;const t=e;return!!(ee(t.Reference,Re)||ee(t.MutableReference,Re)||ee(t.Vector,Re))}const Re=Ve("SuiMoveNormalizedType",ls);function _s(e){if(!e||typeof e!="object")return!1;const t=e;if(!t.Struct||typeof t.Struct!="object")return!1;const s=t.Struct;return!(typeof s.address!="string"||typeof s.module!="string"||typeof s.name!="string"||!Array.isArray(s.typeArguments)||!s.typeArguments.every(i=>ls(i)))}Ve("SuiMoveNormalizedStructType",_s);const Ji=_({visibility:Xi,isEntry:R(),typeParameters:f(Ot),parameters:f(Re),return:f(Re)}),Hi=_({name:r(),type:Re}),Yi=_({abilities:Ot,typeParameters:f(zi),fields:f(Hi)}),Zi=_({fileFormatVersion:S(),address:r(),name:r(),friends:f(Gi),structs:se(r(),Yi),exposedFunctions:se(r(),Ji)});se(r(),Zi);function ps(e){return typeof e=="object"&&"MutableReference"in e?e.MutableReference:void 0}function Qi(e){return typeof e=="object"&&"Reference"in e?e.Reference:void 0}function ms(e){if(typeof e=="object"&&"Struct"in e)return e;const t=Qi(e),s=ps(e);if(typeof t=="object"&&"Struct"in t)return t;if(typeof s=="object"&&"Struct"in s)return s}const en=_({apy:S(),address:r()});_({epoch:r(),apys:f(en)});_({value:S()});const tn=_({stakedSuiId:r(),stakeRequestEpoch:r(),stakeActiveEpoch:r(),principal:r(),status:x([k("Active"),k("Pending"),k("Unstaked")]),estimatedReward:y(r())});_({validatorAddress:r(),stakingPool:r(),stakes:f(tn)});const sn=_({balance:_({value:S()}),distribution_counter:S(),current_distribution_amount:S(),stake_subsidy_period_length:S(),stake_subsidy_decrease_rate:S()});_({type:r(),fields:sn});_({value:S()});const nn=_({id:r(),size:S(),head:_({vec:f()}),tail:_({vec:f()})});_({id:r(),size:S()});_({type:r(),fields:nn});const on=_({exchangeRates:_({id:r(),size:S()}),id:r(),pendingStake:S(),pendingPoolTokenWithdraw:S(),pendingTotalSuiWithdraw:S(),poolTokenBalance:S(),rewardsPool:_({value:S()}),activationEpoch:_({vec:f()}),deactivationEpoch:_({vec:f()}),suiBalance:S()});_({type:r(),fields:on});const an=f(V([r(),r()]));_({epoch:r(),validators:an});const hs=_({suiAddress:r(),protocolPubkeyBytes:r(),networkPubkeyBytes:r(),workerPubkeyBytes:r(),proofOfPossessionBytes:r(),operationCapId:r(),name:r(),description:r(),imageUrl:r(),projectUrl:r(),p2pAddress:r(),netAddress:r(),primaryAddress:r(),workerAddress:r(),nextEpochProtocolPubkeyBytes:T(r()),nextEpochProofOfPossession:T(r()),nextEpochNetworkPubkeyBytes:T(r()),nextEpochWorkerPubkeyBytes:T(r()),nextEpochNetAddress:T(r()),nextEpochP2pAddress:T(r()),nextEpochPrimaryAddress:T(r()),nextEpochWorkerAddress:T(r()),votingPower:r(),gasPrice:r(),commissionRate:r(),nextEpochStake:r(),nextEpochGasPrice:r(),nextEpochCommissionRate:r(),stakingPoolId:r(),stakingPoolActivationEpoch:T(r()),stakingPoolDeactivationEpoch:T(r()),stakingPoolSuiBalance:r(),rewardsPool:r(),poolTokenBalance:r(),pendingStake:r(),pendingPoolTokenWithdraw:r(),pendingTotalSuiWithdraw:r(),exchangeRatesId:r(),exchangeRatesSize:r()});_({epoch:r(),protocolVersion:r(),systemStateVersion:r(),storageFundTotalObjectStorageRebates:r(),storageFundNonRefundableBalance:r(),referenceGasPrice:r(),safeMode:R(),safeModeStorageRewards:r(),safeModeComputationRewards:r(),safeModeStorageRebates:r(),safeModeNonRefundableStorageFee:r(),epochStartTimestampMs:r(),epochDurationMs:r(),stakeSubsidyStartEpoch:r(),maxValidatorCount:r(),minValidatorJoiningStake:r(),validatorLowStakeThreshold:r(),validatorVeryLowStakeThreshold:r(),validatorLowStakeGracePeriod:r(),stakeSubsidyBalance:r(),stakeSubsidyDistributionCounter:r(),stakeSubsidyCurrentDistributionAmount:r(),stakeSubsidyPeriodLength:r(),stakeSubsidyDecreaseRate:S(),totalStake:r(),activeValidators:f(hs),pendingActiveValidatorsId:r(),pendingActiveValidatorsSize:r(),pendingRemovals:f(r()),stakingPoolMappingsId:r(),stakingPoolMappingsSize:r(),inactivePoolsId:r(),inactivePoolsSize:r(),validatorCandidatesId:r(),validatorCandidatesSize:r(),atRiskValidators:f(V([r(),r()])),validatorReportRecords:f(V([r(),f(r())]))});const rn=_({coinType:r(),coinObjectId:r(),version:r(),digest:r(),balance:r(),previousTransaction:r()});_({data:f(rn),nextCursor:T(r()),hasNextPage:R()});_({coinType:r(),coinObjectCount:S(),totalBalance:r(),lockedBalance:_({epochId:y(S()),number:y(S())})});_({value:r()});const cn=_({lastCheckpointId:r(),epochEndTimestamp:r(),protocolVersion:r(),referenceGasPrice:r(),totalStake:r(),storageFundReinvestment:r(),storageCharge:r(),storageRebate:r(),storageFundBalance:r(),stakeSubsidyAmount:r(),totalGasFees:r(),totalStakeRewardsDistributed:r(),leftoverStorageFundInflow:r()}),dn=_({epoch:r(),validators:f(hs),epochTotalTransactions:r(),firstCheckpointId:r(),epochStartTimestamp:r(),endOfEpochInfo:T(cn),referenceGasPrice:T(S())});_({data:f(dn),nextCursor:T(r()),hasNextPage:R()});_({data:f(r()),hasNextPage:R(),nextCursor:T(r())});const un=x([k("DynamicField"),k("DynamicObject")]),ln=_({type:r(),value:Ge()}),_n=_({name:ln,bcsName:r(),type:un,objectType:r(),objectId:r(),version:S(),digest:r()});_({data:f(_n),nextCursor:T(r()),hasNextPage:R()});const pn=_({computationCost:r(),storageCost:r(),storageRebate:r(),nonRefundableStorageFee:r()});r();r();_({digest:f(S())});const gs=Ge();r();const mn=_({nextEpochCommittee:f(V([r(),r()])),nextEpochProtocolVersion:r(),epochCommitments:f(gs)});_({transaction:r(),effects:r()});const hn=_({epoch:r(),sequenceNumber:r(),digest:r(),networkTotalTransactions:r(),previousDigest:y(r()),epochRollingGasCostSummary:pn,timestampMs:r(),endOfEpochData:y(mn),validatorSignature:r(),transactions:f(r()),checkpointCommitments:f(gs)});_({data:f(hn),nextCursor:T(r()),hasNextPage:R()});_({currentTps:S(),tps30Days:S(),currentCheckpoint:r(),currentEpoch:r(),totalAddresses:r(),totalObjects:r(),totalPackages:r()});const gn=_({checkpoint:S(),epoch:S(),timestampMs:S(),cumulativeAddresses:S(),cumulativeActiveAddresses:S(),dailyActiveAddresses:S()});f(gn);const fs="0x2",At="0x1",fn="object",yn="ID",kn=`${fs}::sui::SUI`;ie("0x6");_({decimals:S(),name:r(),symbol:r(),description:r(),iconUrl:T(r()),id:T(r())});const bn="ascii",vn="String",wn="string",Cn="String",Sn="option",Tn="Option",Pn={address:fs,module:fn,name:yn},jn={address:At,module:bn,name:vn},On={address:At,module:wn,name:Cn},An={address:At,module:Sn,name:Tn},Je=(e,t)=>e.address===t.address&&e.module===t.module&&e.name===t.name;function xn(e){var s;const t=(s=ms(e))==null?void 0:s.Struct;return(t==null?void 0:t.address)==="0x2"&&(t==null?void 0:t.module)==="tx_context"&&(t==null?void 0:t.name)==="TxContext"}function dt(e,t){if(!(typeof t>"u")&&typeof t!==e)throw new Error(`Expect ${t} to be ${e}, received ${typeof t}`)}const In=["Address","Bool","U8","U16","U32","U64","U128","U256"];function yt(e,t){if(typeof e=="string"&&In.includes(e)){if(e in["U8","U16","U32","U64","U128","U256"])dt("number",t);else if(e==="Bool")dt("boolean",t);else if(e==="Address"&&(dt("string",t),t&&!ei(t)))throw new Error("Invalid Sui Address");return e.toLowerCase()}else if(typeof e=="string")throw new Error(`Unknown pure normalized type ${JSON.stringify(e,null,2)}`);if("Vector"in e){if((t===void 0||typeof t=="string")&&e.Vector==="U8")return"string";if(t!==void 0&&!Array.isArray(t))throw new Error(`Expect ${t} to be a array, received ${typeof t}`);const s=yt(e.Vector,t?t[0]:void 0);return s===void 0?void 0:`vector<${s}>`}if("Struct"in e){if(Je(e.Struct,jn))return"string";if(Je(e.Struct,On))return"utf8string";if(Je(e.Struct,Pn))return"address";if(Je(e.Struct,An)){const s={Vector:e.Struct.typeArguments[0]};return yt(s,t)}}}const Ie="vector",Dn={kind:"TransactionKind",sender:I.ADDRESS,gasData:"GasData",expiration:"TransactionExpiration"},En={enums:{"Option<T>":{None:null,Some:"T"},ObjectArg:{ImmOrOwned:"SuiObjectRef",Shared:"SharedObjectRef"},CallArg:{Pure:[Ie,I.U8],Object:"ObjectArg",ObjVec:[Ie,"ObjectArg"]},TypeTag:{bool:null,u8:null,u64:null,u128:null,address:null,signer:null,vector:"TypeTag",struct:"StructTag",u16:null,u32:null,u256:null},TransactionKind:{ProgrammableTransaction:"ProgrammableTransaction",ChangeEpoch:null,Genesis:null,ConsensusCommitPrologue:null},TransactionExpiration:{None:null,Epoch:"unsafe_u64"},TransactionData:{V1:"TransactionDataV1"}},structs:{SuiObjectRef:{objectId:I.ADDRESS,version:I.U64,digest:"ObjectDigest"},SharedObjectRef:{objectId:I.ADDRESS,initialSharedVersion:I.U64,mutable:I.BOOL},StructTag:{address:I.ADDRESS,module:I.STRING,name:I.STRING,typeParams:[Ie,"TypeTag"]},GasData:{payment:[Ie,"SuiObjectRef"],owner:I.ADDRESS,price:I.U64,budget:I.U64},SenderSignedData:{data:"TransactionData",txSignatures:[Ie,[Ie,I.U8]]},TransactionDataV1:Dn},aliases:{ObjectDigest:I.BASE58}},xt=new I({...Ws(),types:En});xt.registerType("utf8string",(e,t)=>{const s=Array.from(new TextEncoder().encode(t));return e.writeVec(s,(i,n)=>i.write8(n))},e=>{let t=e.readVec(s=>s.read8());return new TextDecoder().decode(new Uint8Array(t))});xt.registerType("unsafe_u64",(e,t)=>e.write64(t),e=>Number.parseInt(e.read64(),10));const Mn=/^vector<(.+)>$/,Nn=/^([^:]+)::([^:]+)::([^<]+)(<(.+)>)?/;class ue{static parseFromStr(t,s=!1){if(t==="address")return{address:null};if(t==="bool")return{bool:null};if(t==="u8")return{u8:null};if(t==="u16")return{u16:null};if(t==="u32")return{u32:null};if(t==="u64")return{u64:null};if(t==="u128")return{u128:null};if(t==="u256")return{u256:null};if(t==="signer")return{signer:null};const i=t.match(Mn);if(i)return{vector:ue.parseFromStr(i[1],s)};const n=t.match(Nn);if(n)return{struct:{address:s?K(n[1]):n[1],module:n[2],name:n[3],typeParams:n[5]===void 0?[]:ue.parseStructTypeArgs(n[5],s)}};throw new Error(`Encountered unexpected token when parsing type args for ${t}`)}static parseStructTypeArgs(t,s=!1){return Js(t).map(i=>ue.parseFromStr(i,s))}static tagToString(t){if("bool"in t)return"bool";if("u8"in t)return"u8";if("u16"in t)return"u16";if("u32"in t)return"u32";if("u64"in t)return"u64";if("u128"in t)return"u128";if("u256"in t)return"u256";if("address"in t)return"address";if("signer"in t)return"signer";if("vector"in t)return`vector<${ue.tagToString(t.vector)}>`;if("struct"in t){const s=t.struct,i=s.typeParams.map(ue.tagToString).join(", ");return`${s.address}::${s.module}::${s.name}${i?`<${i}>`:""}`}throw new Error("Invalid TypeTag")}}const ys="Argument",U="vector",$n="Option",Rn="CallArg",Ut="TypeTag",Bn="ProgrammableTransaction",kt="ProgrammableMoveCall",ks="Transaction",Vt="CompressedSignature",Gt="PublicKey",Xt="MultiSigPublicKey",zt="MultiSigPkMap",Ln="MultiSig",It="EnumKind",Kn=[It,ks],ce=[It,ys],bs="SimpleProgrammableMoveCall",te=new I(xt);Dt(te,"FixedArray[64]",64);Dt(te,"FixedArray[33]",33);Dt(te,"FixedArray[32]",32);te.registerStructType(Bn,{inputs:[U,Rn],transactions:[U,Kn]}).registerEnumType(ys,{GasCoin:null,Input:{index:I.U16},Result:{index:I.U16},NestedResult:{index:I.U16,resultIndex:I.U16}}).registerStructType(kt,{package:I.ADDRESS,module:I.STRING,function:I.STRING,type_arguments:[U,Ut],arguments:[U,ce]}).registerEnumType(ks,{MoveCall:bs,TransferObjects:{objects:[U,ce],address:ce},SplitCoins:{coin:ce,amounts:[U,ce]},MergeCoins:{destination:ce,sources:[U,ce]},Publish:{modules:[U,[U,I.U8]],dependencies:[U,I.ADDRESS]},MakeMoveVec:{type:[$n,Ut],objects:[U,ce]},Upgrade:{modules:[U,[U,I.U8]],dependencies:[U,I.ADDRESS],packageId:I.ADDRESS,ticket:ce}}).registerEnumType(Vt,{ED25519:["FixedArray[64]","u8"],Secp256k1:["FixedArray[64]","u8"],Secp256r1:["FixedArray[64]","u8"]}).registerEnumType(Gt,{ED25519:["FixedArray[32]","u8"],Secp256k1:["FixedArray[33]","u8"],Secp256r1:["FixedArray[33]","u8"]}).registerStructType(zt,{pubKey:Gt,weight:I.U8}).registerStructType(Xt,{pk_map:[U,zt],threshold:I.U16}).registerStructType(Ln,{sigs:[U,Vt],bitmap:I.U16,multisig_pk:Xt});te.registerType([It,"T"],function(t,s,i,n){const a={[s.kind]:s},[c]=i;return this.getTypeInterface(c)._encodeRaw.call(this,t,a,i,n)},function(t,s,i){const[n]=s,o=this.getTypeInterface(n)._decodeRaw.call(this,t,s,i),a=Object.keys(o)[0];return{kind:a,...o[a]}},e=>{if(typeof e!="object"&&!("kind"in e))throw new Error(`EnumKind: Missing property "kind" in the input ${JSON.stringify(e)}`);return!0});te.registerType(bs,function(t,s,i,n){const[o,a,c]=s.target.split("::"),u=s.typeArguments.map(l=>ue.parseFromStr(l,!0));return this.getTypeInterface(kt)._encodeRaw.call(this,t,{package:K(o),module:a,function:c,type_arguments:u,arguments:s.arguments},i,n)},function(t,s,i){let n=te.getTypeInterface(kt)._decodeRaw.call(this,t,s,i);return{target:[n.package,n.module,n.function].join("::"),arguments:n.arguments,typeArguments:n.type_arguments.map(ue.tagToString)}},e=>e.target.split("::").length===3);function Dt(e,t,s){e.registerType(t,function(n,o,a,c){if(o.length!==s)throw new Error(`Expected fixed array of length ${s}, got ${o.length}`);if(a.length!==1)throw new Error(`Expected one type parameter in a fixed array, got ${a.length}`);let[u]=typeof a[0]=="string"?[a[0],[]]:a[0];for(let l of o)this.getTypeInterface(u)._encodeRaw.call(this,n,l,a,c);return n},function(n,o,a){if(o.length!==1)throw new Error(`Expected one type parameter in a fixed array, got ${o.length}`);let c=[],[u]=typeof o[0]=="string"?[o[0],[]]:o[0];for(let l=0;l<s;l++)c.push(this.getTypeInterface(u)._decodeRaw.call(this,n,o,a));return c})}const qn=x([_({ImmOrOwned:oe}),_({Shared:_({objectId:r(),initialSharedVersion:x([me(),r()]),mutable:R()})})]),it=_({Pure:f(me())}),Fn=_({Object:qn}),Be=x([it,Fn]),le={Pure(e,t){return{Pure:Array.from(e instanceof Uint8Array?e:te.ser(t,e,{maxSize:1/0}).toBytes())}},ObjectRef({objectId:e,digest:t,version:s}){return{Object:{ImmOrOwned:{digest:t,version:s,objectId:K(e)}}}},SharedObjectRef({objectId:e,mutable:t,initialSharedVersion:s}){return{Object:{Shared:{mutable:t,initialSharedVersion:s,objectId:K(e)}}}}};function Wt(e){return typeof e=="string"?K(e):"ImmOrOwned"in e.Object?K(e.Object.ImmOrOwned.objectId):K(e.Object.Shared.objectId)}function Un(e){return typeof e=="object"&&"Object"in e&&"Shared"in e.Object?e.Object.Shared:void 0}function Vn(e){var t;return((t=Un(e))==null?void 0:t.mutable)??!1}function J(e,t){return Hs(e,t)}const nt=Symbol("transaction-argument-type"),Gn=e=>x([_({None:x([k(!0),k(null)])}),_({Some:e})]),Fe=_({kind:k("Input"),index:me(),value:y(Ge()),type:y(x([k("pure"),k("object")]))}),Et=[Fe,_({kind:k("GasCoin")}),_({kind:k("Result"),index:me()}),_({kind:k("NestedResult"),index:me(),resultIndex:me()})],Xn=x([...Et]),Oe=x([...Et]);Oe[nt]={kind:"object"};const vs=e=>{const t=x([...Et]);return t[nt]={kind:"pure",type:e},t},ws=_({kind:k("MoveCall"),target:Ve("target",r().validator),typeArguments:f(r()),arguments:f(Xn)}),Cs=_({kind:k("TransferObjects"),objects:f(Oe),address:vs(I.ADDRESS)}),Ss=_({kind:k("SplitCoins"),coin:Oe,amounts:f(vs("u64"))}),Ts=_({kind:k("MergeCoins"),destination:Oe,sources:f(Oe)}),Ps=_({kind:k("MakeMoveVec"),type:y(Gn(se(r(),ss()))),objects:f(Oe)}),js=_({kind:k("Publish"),modules:f(f(me())),dependencies:f(r())}),Os=_({kind:k("Upgrade"),modules:f(f(me())),dependencies:f(r()),packageId:r(),ticket:Oe}),As=[ws,Cs,Ss,Ts,js,Os,Ps],xs=x([...As]);function zn(e){return gt(e,xs),As.find(t=>ee(e,t))}const ke={MoveCall(e){return J({kind:"MoveCall",target:e.target,arguments:e.arguments??[],typeArguments:e.typeArguments??[]},ws)},TransferObjects(e,t){return J({kind:"TransferObjects",objects:e,address:t},Cs)},SplitCoins(e,t){return J({kind:"SplitCoins",coin:e,amounts:t},Ss)},MergeCoins(e,t){return J({kind:"MergeCoins",destination:e,sources:t},Ts)},Publish({modules:e,dependencies:t}){return J({kind:"Publish",modules:e.map(s=>typeof s=="string"?Array.from(st(s)):s),dependencies:t.map(s=>ie(s))},js)},Upgrade({modules:e,dependencies:t,packageId:s,ticket:i}){return J({kind:"Upgrade",modules:e.map(n=>typeof n=="string"?Array.from(st(n)):n),dependencies:t.map(n=>ie(n)),packageId:s,ticket:i},Os)},MakeMoveVec({type:e,objects:t}){return J({kind:"MakeMoveVec",type:e?{Some:ue.parseFromStr(e)}:{None:null},objects:t},Ps)}};function Wn(e,t){const s=Array.from(`${e}::`).map(n=>n.charCodeAt(0)),i=new Uint8Array(s.length+t.length);return i.set(s),i.set(t,s.length),Ys(i,{dkLen:32})}const Jn=y(T(x([_({Epoch:me()}),_({None:x([k(!0),k(null)])})]))),Jt=Ve("StringEncodedBigint",e=>{if(!["string","number","bigint"].includes(typeof e))return!1;try{return BigInt(e),!0}catch{return!1}}),Hn=_({budget:y(Jt),price:y(Jt),payment:y(f(oe)),owner:y(r())}),He=_({version:k(1),sender:y(r()),expiration:Jn,gasConfig:Hn,inputs:f(Fe),transactions:f(xs)});function Ht(e){return K(e).replace("0x","")}class pe{constructor(t){this.version=1,this.sender=t==null?void 0:t.sender,this.expiration=t==null?void 0:t.expiration,this.gasConfig=(t==null?void 0:t.gasConfig)??{},this.inputs=(t==null?void 0:t.inputs)??[],this.transactions=(t==null?void 0:t.transactions)??[]}static fromKindBytes(t){const s=te.de("TransactionKind",t),i=s==null?void 0:s.ProgrammableTransaction;if(!i)throw new Error("Unable to deserialize from bytes.");const n=J({version:1,gasConfig:{},inputs:i.inputs.map((o,a)=>J({kind:"Input",value:o,index:a,type:ee(o,it)?"pure":"object"},Fe)),transactions:i.transactions},He);return pe.restore(n)}static fromBytes(t){var a;const s=te.de("TransactionData",t),i=s==null?void 0:s.V1,n=(a=i==null?void 0:i.kind)==null?void 0:a.ProgrammableTransaction;if(!i||!n)throw new Error("Unable to deserialize from bytes.");const o=J({version:1,sender:i.sender,expiration:i.expiration,gasConfig:i.gasData,inputs:n.inputs.map((c,u)=>J({kind:"Input",value:c,index:u,type:ee(c,it)?"pure":"object"},Fe)),transactions:n.transactions},He);return pe.restore(o)}static restore(t){gt(t,He);const s=new pe;return Object.assign(s,t),s}static getDigestFromBytes(t){const s=Wn("TransactionData",t);return Zs(s)}build({maxSizeBytes:t=1/0,overrides:s,onlyTransactionKind:i}={}){const n=this.inputs.map(m=>(gt(m.value,Be),m.value)),o={ProgrammableTransaction:{inputs:n,transactions:this.transactions}};if(i)return te.ser("TransactionKind",o,{maxSize:t}).toBytes();const a=(s==null?void 0:s.expiration)??this.expiration,c=(s==null?void 0:s.sender)??this.sender,u={...this.gasConfig,...s==null?void 0:s.gasConfig};if(!c)throw new Error("Missing transaction sender");if(!u.budget)throw new Error("Missing gas budget");if(!u.payment)throw new Error("Missing gas payment");if(!u.price)throw new Error("Missing gas price");const l={sender:Ht(c),expiration:a||{None:!0},gasData:{payment:u.payment,owner:Ht(this.gasConfig.owner??c),price:BigInt(u.price),budget:BigInt(u.budget)},kind:{ProgrammableTransaction:{inputs:n,transactions:this.transactions}}};return te.ser("TransactionData",{V1:l},{maxSize:t}).toBytes()}getDigest(){const t=this.build({onlyTransactionKind:!1});return pe.getDigestFromBytes(t)}snapshot(){return J(this,He)}}var Mt=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},B=(e,t,s)=>(Mt(e,t,"read from private field"),s?s.call(e):t.get(e)),be=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},Ye=(e,t,s,i)=>(Mt(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),W=(e,t,s)=>(Mt(e,t,"access private method"),s),A,Qe,bt,Te,Ae,Nt,Is,$t,Ds,Rt,Es,Bt,Ms,et,vt;const Yn={maxPureArgumentSize:16*1024,maxTxGas:5e10,maxGasObjects:256,maxTxSizeBytes:128*1024};function Zn(e){const t={kind:"Result",index:e},s=[],i=n=>s[n]??(s[n]={kind:"NestedResult",index:e,resultIndex:n});return new Proxy(t,{set(){throw new Error("The transaction result is a proxy, and does not support setting properties directly")},get(n,o){if(o in n)return Reflect.get(n,o);if(o===Symbol.iterator)return function*(){let c=0;for(;;)yield i(c),c++};if(typeof o=="symbol")return;const a=parseInt(o,10);if(!(Number.isNaN(a)||a<0))return i(a)}})}function Ue(e){if(!e.client&&!e.provider)throw new Error("No provider passed to Transaction#build, but transaction data was not sufficient to build offline.");return e.client??e.provider}const Yt=Symbol.for("@mysten/transaction"),ut={maxTxGas:"max_tx_gas",maxGasObjects:"max_gas_payment_objects",maxTxSizeBytes:"max_tx_size_bytes",maxPureArgumentSize:"max_pure_argument_size"},Qn=1000n,eo=50,to=(e,t)=>Array.from({length:Math.ceil(e.length/t)},(s,i)=>e.slice(i*t,i*t+t)),so=class wt{constructor(t){be(this,Qe),be(this,Te),be(this,Nt),be(this,$t),be(this,Rt),be(this,Bt),be(this,et),be(this,A,void 0),Ye(this,A,new pe(t?t.blockData:void 0))}static is(t){return!!t&&typeof t=="object"&&t[Yt]===!0}static fromKind(t){const s=new wt;return Ye(s,A,pe.fromKindBytes(typeof t=="string"?st(t):t)),s}static from(t){const s=new wt;return typeof t!="string"||!t.startsWith("{")?Ye(s,A,pe.fromBytes(typeof t=="string"?st(t):t)):Ye(s,A,pe.restore(JSON.parse(t))),s}static get Transactions(){return ke}static get Inputs(){return le}setSender(t){B(this,A).sender=t}setSenderIfNotSet(t){B(this,A).sender||(B(this,A).sender=t)}setExpiration(t){B(this,A).expiration=t}setGasPrice(t){B(this,A).gasConfig.price=String(t)}setGasBudget(t){B(this,A).gasConfig.budget=String(t)}setGasOwner(t){B(this,A).gasConfig.owner=t}setGasPayment(t){B(this,A).gasConfig.payment=t.map(s=>Qs(s,oe))}get blockData(){return B(this,A).snapshot()}get[Yt](){return!0}get gas(){return{kind:"GasCoin"}}object(t){const s=Wt(t);return B(this,A).inputs.find(n=>n.type==="object"&&s===Wt(n.value))??W(this,Qe,bt).call(this,"object",t)}objectRef(...t){return this.object(le.ObjectRef(...t))}sharedObjectRef(...t){return this.object(le.SharedObjectRef(...t))}pure(t,s){return W(this,Qe,bt).call(this,"pure",t instanceof Uint8Array?le.Pure(t):s?le.Pure(t,s):t)}add(t){const s=B(this,A).transactions.push(t);return Zn(s-1)}splitCoins(...t){return this.add(ke.SplitCoins(...t))}mergeCoins(...t){return this.add(ke.MergeCoins(...t))}publish(...t){return this.add(ke.Publish(...t))}upgrade(...t){return this.add(ke.Upgrade(...t))}moveCall(...t){return this.add(ke.MoveCall(...t))}transferObjects(...t){return this.add(ke.TransferObjects(...t))}makeMoveVec(...t){return this.add(ke.MakeMoveVec(...t))}serialize(){return JSON.stringify(B(this,A).snapshot())}async sign(t){const{signer:s,...i}=t,n=await this.build(i);return s.signTransactionBlock(n)}async build(t={}){return await W(this,et,vt).call(this,t),B(this,A).build({maxSizeBytes:W(this,Te,Ae).call(this,"maxTxSizeBytes",t),onlyTransactionKind:t.onlyTransactionKind})}async getDigest(t={}){return await W(this,et,vt).call(this,t),B(this,A).getDigest()}};A=new WeakMap;Qe=new WeakSet;bt=function(e,t){const s=B(this,A).inputs.length,i=J({kind:"Input",value:typeof t=="bigint"?String(t):t,index:s,type:e},Fe);return B(this,A).inputs.push(i),i};Te=new WeakSet;Ae=function(e,{protocolConfig:t,limits:s}){if(s&&typeof s[e]=="number")return s[e];if(!t)return Yn[e];const i=t==null?void 0:t.attributes[ut[e]];if(!i)throw new Error(`Missing expected protocol config: "${ut[e]}"`);const n="u64"in i?i.u64:"u32"in i?i.u32:i.f64;if(!n)throw new Error(`Unexpected protocol config value found for: "${ut[e]}"`);return Number(n)};Nt=new WeakSet;Is=function(e){const t=W(this,Te,Ae).call(this,"maxPureArgumentSize",e);B(this,A).inputs.forEach((s,i)=>{if(ee(s.value,it)&&s.value.Pure.length>t)throw new Error(`Input at index ${i} is too large, max pure input size is ${t} bytes, got ${s.value.Pure.length} bytes`)})};$t=new WeakSet;Ds=async function(e){if(B(this,A).gasConfig.payment){const n=W(this,Te,Ae).call(this,"maxGasObjects",e);if(B(this,A).gasConfig.payment.length>n)throw new Error(`Payment objects exceed maximum amount: ${n}`)}if(e.onlyTransactionKind||B(this,A).gasConfig.payment)return;const t=B(this,A).gasConfig.owner??B(this,A).sender,i=(await Ue(e).getCoins({owner:t,coinType:kn})).data.filter(n=>!B(this,A).inputs.find(a=>ee(a.value,Be)&&"Object"in a.value&&"ImmOrOwned"in a.value.Object?n.coinObjectId===a.value.Object.ImmOrOwned.objectId:!1)).slice(0,W(this,Te,Ae).call(this,"maxGasObjects",e)-1).map(n=>({objectId:n.coinObjectId,digest:n.digest,version:n.version}));if(!i.length)throw new Error("No valid gas coins found for the transaction.");this.setGasPayment(i)};Rt=new WeakSet;Es=async function(e){e.onlyTransactionKind||B(this,A).gasConfig.price||this.setGasPrice(await Ue(e).getReferenceGasPrice())};Bt=new WeakSet;Ms=async function(e){const{inputs:t,transactions:s}=B(this,A),i=[],n=[];if(s.forEach(o=>{if(o.kind==="MoveCall"){o.arguments.some(u=>u.kind==="Input"&&!ee(t[u.index].value,Be))&&i.push(o);return}const a=zn(o);a.schema&&Object.entries(o).forEach(([c,u])=>{if(c==="kind")return;const l=a.schema[c],m=l.type==="array",h=m?l.schema[nt]:l[nt];if(!h)return;const g=b=>{const E=t[b];if(!E)throw new Error(`Missing input ${u.index}`);if(!ee(E.value,Be))if(h.kind==="object"&&typeof E.value=="string")n.push({id:E.value,input:E});else if(h.kind==="pure")E.value=le.Pure(E.value,h.type);else throw new Error("Unexpected input format.")};if(m)u.forEach(b=>{b.kind==="Input"&&g(b.index)});else{if(u.kind!=="Input")return;g(u.index)}})}),i.length&&await Promise.all(i.map(async o=>{const[a,c,u]=o.target.split("::"),l=await Ue(e).getNormalizedMoveFunction({package:ie(a),module:c,function:u}),h=l.parameters.length>0&&xn(l.parameters.at(-1))?l.parameters.slice(0,l.parameters.length-1):l.parameters;if(h.length!==o.arguments.length)throw new Error("Incorrect number of arguments.");h.forEach((g,b)=>{const E=o.arguments[b];if(E.kind!=="Input")return;const N=t[E.index];if(ee(N.value,Be))return;const M=N.value,D=yt(g,M);if(D){N.value=le.Pure(M,D);return}if(ms(g)!=null||typeof g=="object"&&"TypeParameter"in g){if(typeof M!="string")throw new Error(`Expect the argument to be an object id string, got ${JSON.stringify(M,null,2)}`);n.push({id:M,input:N,normalizedType:g});return}throw new Error(`Unknown call arg type ${JSON.stringify(g,null,2)} for value ${JSON.stringify(M,null,2)}`)})})),n.length){const o=[...new Set(n.map(({id:m})=>m))],a=to(o,eo),c=(await Promise.all(a.map(m=>Ue(e).multiGetObjects({ids:m,options:{showOwner:!0}})))).flat();let u=new Map(o.map((m,h)=>[m,c[h]]));const l=Array.from(u).filter(([m,h])=>h.error).map(([m,h])=>m);if(l.length)throw new Error(`The following input objects are invalid: ${l.join(", ")}`);n.forEach(({id:m,input:h,normalizedType:g})=>{var M;const b=u.get(m),E=(M=b.data)==null?void 0:M.owner,N=E&&typeof E=="object"&&"Shared"in E?E.Shared.initial_shared_version:void 0;if(N){const D=Vn(h.value)||g!=null&&ps(g)!=null;h.value=le.SharedObjectRef({objectId:m,initialSharedVersion:N,mutable:D})}else h.value=le.ObjectRef(ki(b))})}};et=new WeakSet;vt=async function(e){if(!e.onlyTransactionKind&&!B(this,A).sender)throw new Error("Missing transaction sender");const t=e.client||e.provider;if(!e.protocolConfig&&!e.limits&&t&&(e.protocolConfig=await t.getProtocolConfig()),await Promise.all([W(this,Rt,Es).call(this,e),W(this,Bt,Ms).call(this,e)]),!e.onlyTransactionKind&&(await W(this,$t,Ds).call(this,e),!B(this,A).gasConfig.budget)){const s=await Ue(e).dryRunTransactionBlock({transactionBlock:B(this,A).build({maxSizeBytes:W(this,Te,Ae).call(this,"maxTxSizeBytes",e),overrides:{gasConfig:{budget:String(W(this,Te,Ae).call(this,"maxTxGas",e)),payment:[]}}})});if(s.effects.status.status!=="success")throw new Error(`Dry run failed, could not automatically determine a budget: ${s.effects.status.error}`,{cause:s});const i=Qn*BigInt(this.blockData.gasConfig.price||1n),n=BigInt(s.effects.gasUsed.computationCost)+i,o=n+BigInt(s.effects.gasUsed.storageCost)-BigInt(s.effects.gasUsed.storageRebate);this.setGasBudget(o>n?o:n)}W(this,Nt,Is).call(this,e)};let v=so;BigInt(1e9);ie("0x6");ie("0x5");var lt="router",$e=1e4,ve=class{static buildPoolImmutables(e){const{fields:t}=e.value.fields.value;return{clmm_pool_id:C(t.clmm_pool_id).address,booster_type:C(t.booster_type.fields.name).source_address,pool_id:C(t.pool_id).address,coinTypeA:C(t.coin_type_a.fields.name).source_address,coinTypeB:C(t.coin_type_b.fields.name).source_address}}static buildPoolState(e){const t=j(e),s=[];return t.config.fields.contents.forEach(n=>{s.push({lock_day:Number(n.fields.key),multiplier:Number(d(n.fields.value).div($e))})}),{basic_percent:Number(d(t.basic_percent).div($e)),balances:{balances_handle:t.balances.fields.id.id,size:t.balances.fields.size},config:s,lock_positions:{lock_positions_handle:t.lock_positions.fields.id.id,size:t.lock_positions.fields.size},is_open:t.is_open,index:Number(t.index),pool_id:qe(e)}}static buildLockNFT(e){const t=C(qe(e)).address;return{lock_clmm_position:St(e),locked_nft_id:t}}static buildLockPositionInfo(e){const t=j(e),{value:s}=t.value.fields;return{type:s.type,position_id:s.fields.position_id,start_time:Number(s.fields.start_time),lock_period:Number(s.fields.lock_period),end_time:Number(s.fields.end_time),growth_rewarder:s.fields.growth_rewarder,rewarder_owned:s.fields.rewarder_owned,is_settled:s.fields.is_settled}}static isLocked(e){return e.end_time>Date.parse(new Date().toString())/1e3}},io=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=!1){var o;const{booster:t}=this._sdk.sdkOptions,s=`${t.package_id}_getPoolImmutables`,i=this.getCache(s,e),n=[];if(i!==void 0)n.push(...i);else{const a=[];(o=(await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(p(t).booster_pool_handle)).data)==null||o.forEach(l=>{a.push(l.objectId)});const u=await this._sdk.ClmmSDK.fullClient.batchGetObjects(a,{showContent:!0});for(const l of u){const m=j(l);if(m){const h=ve.buildPoolImmutables(m);this.updateCache(`${h.pool_id}_getPoolImmutable`,h,P),n.push(h)}}}return this.updateCache(s,n,P),n}async getPoolImmutable(e){const{booster:t}=this._sdk.sdkOptions,s=`${e}_getPoolImmutable`,i=this.getCache(s);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:p(t).booster_pool_handle,name:{type:"0x2::object::ID",value:e}}),o=j(n),a=ve.buildPoolImmutables(o);return this.updateCache(s,a,P),a}async getPools(){const e=[],s=(await this.getPoolImmutables()).map(n=>n.pool_id),i=await this._sdk.ClmmSDK.fullClient.batchGetObjects(s,{showType:!0,showContent:!0});for(const n of i){const o=ve.buildPoolState(n);if(o){const a={...await this.getPoolImmutable(o.pool_id),...o};e.push(a);const c=`${a.pool_id}_getPoolObject`;this.updateCache(c,a,P)}}return e}async getPool(e,t=!0){const s=`${e}_getPoolObject`,i=this.getCache(s,t),n=await this.getPoolImmutable(e);if(i!==void 0)return{...n,...i};const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),a=ve.buildPoolState(o),c={...n,...a};return this.updateCache(s,c,P),c}async getPoolHandleId(e){const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=j(t);return s?s.list.fields.id.id:""}async getBoosterInitConfigs(){var i;const{package_id:e}=this.sdk.sdkOptions.booster,t=(i=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitEvent`}))==null?void 0:i.data,s={booster_config_id:"",booster_pool_handle:""};return t.length>0&&t.forEach(n=>{const o=n.parsedJson;o&&(s.booster_config_id=o.config_id)}),s.booster_pool_handle=await this.getPoolHandleId(s.booster_config_id),s}async getOwnerBoosterPositions(e,t,s){const{booster:i}=this.sdk.sdkOptions,n=[],o=[],a=`${i.package_id}::lock_nft::LockNFT<${this._sdk.ClmmSDK.Position.buildPositionType()}>`,c=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{StructType:a}});for(const l of c.data)if(C(Se(l)).source_address===a&&l.data){const h=ve.buildLockNFT(l);this.updateCache(`${h.locked_nft_id}_getBoosterPositionById`,h,P),h&&(t===void 0||t===h.lock_clmm_position.pool)&&n.push(h)}const u=await this.getLockPositionInfos(s,n.map(l=>l.locked_nft_id));for(const l of n)for(const m of u)if(l.lock_clmm_position.pos_object_id===m.position_id){o.push({...l,...m});break}return o}async getBoosterPosition(e,t){const s=`${t}_getBoosterPositionById`,i=this.getCache(s);let n;if(i!==void 0)n=i;else{const a=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0,showOwner:!0}});n=ve.buildLockNFT(a),this.updateCache(s,n,P)}const o=await this.getLockPositionInfo(e,t);return{...n,...o}}async getLockPositionInfos(e,t=[]){var o;const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(e),i=[],n=[];return(o=s.data)==null||o.forEach(a=>{t.length>0?t.includes(a.name.value)&&i.push(a.objectId):i.push(a.objectId)}),i.length>0&&(await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showContent:!0})).forEach(c=>{const u=ve.buildLockPositionInfo(c);u&&n.push(u)}),n}async getLockPositionInfo(e,t){const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}});return ve.buildLockPositionInfo(s)}calculateXCetusRewarder(e,t,s){let i=t.basic_percent,n="0";e.forEach(c=>{c.coin_address===t.booster_type&&(console.log("find ",t.booster_type),n=c.amount_owed.toString())}),s.is_settled||t.config.forEach(c=>{c.lock_day===s.lock_period&&(i=c.multiplier)});const o=d(n).sub(s.growth_rewarder).mul(i);return d(s.rewarder_owned).add(o).toString()}lockPositionPayload(e){const{booster:t}=this.sdk.sdkOptions,{clmm_pool:s}=this.sdk.ClmmSDK.sdkOptions,i=new v;return i.moveCall({target:`${t.published_at}::${lt}::lock_position`,typeArguments:[e.booster_type,e.coinTypeA,e.coinTypeB],arguments:[i.pure(p(t).booster_config_id),i.pure(p(s).global_config_id),i.pure(e.booster_pool_id),i.pure(e.clmm_pool_id),i.pure(e.clmm_position_id),i.pure(e.lock_day),i.pure(w)]}),i}canceLockPositionPayload(e){const{booster:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${lt}::cancel_lock`,typeArguments:[e.booster_type],arguments:[s.pure(p(t).booster_config_id),s.pure(e.booster_pool_id),s.pure(e.lock_nft_id),s.pure(w)]}),s}redeemPayload(e){const{booster:t,xcetus:s}=this.sdk.sdkOptions,{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,n=new v,o=p(s);return n.moveCall({target:`${t.published_at}::${lt}::redeem`,typeArguments:[e.booster_type,e.coinTypeA,e.coinTypeB],arguments:[n.pure(p(t).booster_config_id),n.pure(p(i).global_config_id),n.pure(e.booster_pool_id),n.pure(e.lock_nft_id),n.pure(e.clmm_pool_id),n.pure(o.lock_manager_id),n.pure(o.xcetus_manager_id),n.pure(e.ve_nft_id),n.pure(w)]}),n}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}},X="router",Ns=1e9,G=class{static priceRealToFix(e,t,s){const i=d(t-s).toNumber();return Number(d(e).div(d(10).pow(d(i))).toString())}static priceFixToReal(e,t,s){const i=d(t-s).toNumber();return Number(d(e).mul(d(10).pow(d(i))).toString())}static raiseTotalAmount(e,t,s){const i=d(t-s).abs().toNumber();return t>s?Number(d(e.total_supply).mul(e.current_price).div(d(10).pow(d(i))).toString()):Number(d(e.total_supply).mul(e.current_price).mul(d(10).pow(d(i))).toString())}static buildLaunchPadPool(e){const t=Se(e),s=C(t),i=j(e),n={coin_type_sale:s.type_arguments[0],coin_type_raise:s.type_arguments[1],pool_address:ie(qe(e)),is_settle:i.is_settle,current_price:d(i.initialize_price).div(d(Ns)).toString(),price:i.initialize_price,min_price:"0",max_price:"0",sale_coin_amount:i.sale_coin,raise_coin_amount:i.raise_coin,total_purchase_amount:i.reality_raise_total,total_supply:i.sale_total,min_purchase:i.min_purchase,max_purchase:i.max_purchase,complete_raise_limit:i.least_raise_amount,softcap:i.softcap,max_raise_amount:i.hardcap,sale_decimals:0,raise_decimals:0,liquidity_injection_ratio:Number(i.liquidity_rate)/1e4,is_cancel:i.is_cancel,duration_summary:{start_time:Number(i.duration_manager.fields.start_time),end_time:0,settle_end_time:0,purchase_duration:Number(i.duration_manager.fields.activity_duration),settle_duration:Number(i.duration_manager.fields.settle_duration),lock_up_duration:Number(i.duration_manager.fields.locked_duration)},white_summary:{white_handle:i.white_list.fields.users.fields.id.id,protection_hard_cap:i.white_list.fields.hard_cap_total,protection_limit_used:i.white_list.fields.purchase_total,size:Number(i.white_list.fields.users.fields.size)},unused_sale:i.unused_sale,harvest_raise:i.harvest_raise,tick_spacing:Number(i.tick_spacing),owner:i.recipient,purchase_summary:{purchase_handle:i.purchase_list.fields.id.id,size:Number(i.purchase_list.fields.size)},pool_status:"Failed"};return G.updatePoolStatus(n),n}static updatePoolStatus(e){const t=Number(d(Date.now()/1e3).toFixed(0)),{duration_summary:s}=e,i=s.start_time+s.purchase_duration,n=i+s.settle_duration;if(s.end_time=i,s.settle_end_time=n,e.is_settle)e.pool_status="Ended";else if(e.is_cancel)e.pool_status="Canceled";else if(t<s.start_time)e.pool_status="Upcoming";else if(t>s.start_time&&t<i)e.pool_status="Live";else if(t>i&&t<n){const o=e.raise_coin_amount;Number(o)<Number(e.complete_raise_limit)?e.pool_status="Failed":e.pool_status="Settle"}return e}static async calculatePoolPrice(e,t){const s=await e.ClmmSDK.CetusConfig.getTokenListByCoinTypes([t.coin_type_sale,t.coin_type_raise]),i=s[t.coin_type_sale].decimals,n=s[t.coin_type_raise].decimals;t.min_price=this.priceFixToReal(Number(d(t.softcap).div(d(t.total_supply))),i,n).toString(),t.max_price=this.priceFixToReal(Number(d(t.max_raise_amount).div(d(t.total_supply))),i,n).toString(),t.current_price=this.priceFixToReal(Number(t.current_price),i,n).toString(),t.sale_decimals=i,t.raise_decimals=n}static async getWithdrawRaise(e){return e.pool_status==="Ended"?e.harvest_raise:"0"}static async getWithdrawSale(e){return e.pool_status==="Ended"?e.unused_sale:e.sale_coin_amount}static async getHistoryWithdrawRaise(e,t){if(t.pool_status==="Ended"){if(d(t.harvest_raise).equals(d(0))){const i=await e.Launchpad.getSettleEvent(t.pool_address);i&&(t.harvest_raise=i.unused_raise)}const s=O.min(new O(t.total_purchase_amount),new O(t.max_raise_amount));return d(s.toString()).mul(1-t.liquidity_injection_ratio).toString()}return"0"}static async getHistoryWithdrawSale(e,t){if(t.pool_status==="Ended"){const s=await e.Launchpad.getSettleEvent(t.pool_address);return s&&(t.unused_sale=s.unused_sale),t.unused_sale}return"0"}static async getOverrecruitReverseAmount(e,t){const s=await e.Launchpad.getPurchaseMarks(e.ClmmSDK.senderAddress,[t.pool_address],!1);if(s.length>0){const i=s[0].purchased_raise_amount,n=(await e.Launchpad.getPurchaseAmount(t.white_summary.white_handle,e.ClmmSDK.senderAddress)).safe_purchased_amount,{protection_limit_used:o}=t.white_summary;return d(i).sub(n).div(d(t.total_purchase_amount).sub(o)).mul(d(t.total_purchase_amount).sub(t.max_raise_amount)).toString()}return"0"}static async getCanPurchaseAmount(e,t){const s=await G.getOverrecruitReverseAmount(e,t),i=await e.Launchpad.getPurchaseMarks(e.ClmmSDK.senderAddress,[t.pool_address],!1);if(i){const n=i[0].purchased_raise_amount;d(n).sub(s).div(t.current_price)}return"0"}},no=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=[],t=0,s=100,i=!1){var m;const{package_id:n}=this._sdk.sdkOptions.launchpad;if(n===void 0)throw Error("sdk.sdkOptions.launchpad is undefined");const o=`${n}_getPoolImmutables`,a=this.getCache(o,i),c=[],u=[];if(a!==void 0&&c.push(...a),c.length===0)try{((m=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${n}::factory::CreatePoolEvent`}))==null?void 0:m.data).forEach(g=>{const b=g.parsedJson;b&&c.push({pool_address:b.pool_id,coin_type_sale:C(b.sale_coin.name).full_address,coin_type_raise:C(b.raise_coin.name).full_address})}),this.updateCache(o,c,P)}catch(h){console.log("getPoolImmutables",h)}const l=e.length>0;for(let h=0;h<c.length;h+=1){const g=c[h];if(!(l&&!e.includes(g.pool_address))){if(!l){const b=h;if(b<t||b>=t+s)continue}u.push(g)}}return u}async getPoolImmutablesWithPage(e="all",t=!1){const{package_id:s}=this._sdk.sdkOptions.launchpad,i=`${s}_getPoolImmutables`,n=[],o={data:[],hasNextPage:!1},a=e==="all";if(a){const c=this.getCache(i,t);c&&n.push(...c)}if(n.length===0)try{const c=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${s}::factory::CreatePoolEvent`},e);o.hasNextPage=c.hasNextPage,o.nextCursor=c.nextCursor,c.data.forEach(u=>{const l=u.parsedJson;l&&n.push({pool_address:l.pool_id,coin_type_sale:C(l.sale_coin.name).full_address,coin_type_raise:C(l.raise_coin.name).full_address})})}catch(c){console.log("getPoolImmutables",c)}return o.data=n,a&&this.updateCache(i,n,P),o}async getPools(e=[],t=0,s=100){const i=[];let n=[];e.length>0?n=[...e]:(await this.getPoolImmutables([],t,s,!1)).forEach(c=>{n.push(c.pool_address)});const o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(n,{showType:!0,showContent:!0});for(const a of o){const c=G.buildLaunchPadPool(a);await G.calculatePoolPrice(this._sdk,c),i.push(c);const u=`${c.pool_address}_getPoolObject`;this.updateCache(u,c,P)}return i}async getPool(e,t=!0){const s=`${e}_getPoolObject`,i=this.getCache(s,t);if(i!==void 0){const a=i;return G.updatePoolStatus(a),a}const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),o=G.buildLaunchPadPool(n);return await G.calculatePoolPrice(this._sdk,o),this.updateCache(s,o),o}async getInitConfig(e=!1){var u;const t=this._sdk.sdkOptions.launchpad.package_id,s=`${t}_getInitEvent`,i=this.getCache(s,e);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showPreviousTransaction:!0}}),o=es(n),a=(u=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({Transaction:o}))==null?void 0:u.data,c={pools_id:"",admin_cap_id:"",config_cap_id:""};return a.length>0&&(a.forEach(l=>{const m=l.parsedJson;if(m)switch(C(l.type).full_address){case`${t}::config::InitConfigEvent`:c.admin_cap_id=m.admin_cap_id,c.config_cap_id=m.config_cap_id;break;case`${t}::factory::InitFactoryEvent`:c.pools_id=m.pools_id;break}}),this.updateCache(s,c,P)),c}async getLockNFT(e,t=!1){const s=`${e}_getLockNFT`,i=this.getCache(s,t);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(!n.error)return St(n)}async getLockNFTList(e){var n;const{package_id:t}=this._sdk.ClmmSDK.sdkOptions.clmm_pool,{sdkOptions:s}=this._sdk,i=[];try{const o=(n=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${s.launchpad.package_id}::lock::LockNFTEvent`}))==null?void 0:n.data;for(const a of o){const c=a.parsedJson;if(c){const u={locked_time:Number(c.locked_time),end_lock_time:Number(c.end_lock_time),nft_type:c.nft_type_name.name,lock_nft_id:c.lock_nft_id,recipient:c.recipient};if(e===u.recipient&&`${t}`===C(u.nft_type).address){const l=await this.getLockNFT(u.lock_nft_id);if(l){const m=C(l.coin_type_a).full_address,h=C(l.coin_type_b).full_address;i.push({...l,coin_type_a:m,coin_type_b:h,...u})}}}}return i}catch(o){return console.log("getLockNFTList:",o),[]}}async creatPoolTransactionPayload(e){const{launchpad:t}=this.sdk.sdkOptions,s=p(t);if(this.assertLuanchpadConfig(),this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const i=G.priceRealToFix(Number(e.initialize_price),e.sale_decimals,e.raise_decimals),n=new v,o=d(e.total_supply).add(d(e.total_supply).mul(d(e.liquidity_rate))).toNumber(),a=await H.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,n,BigInt(o),e.coin_type_sale),c=[n.pure(s.admin_cap_id),n.pure(s.config_cap_id),n.pure(s.pools_id),n.pure(K(e.recipient)),n.pure((i*Ns).toString()),a,n.pure(e.total_supply.toString()),n.pure(e.min_purchase.toString()),n.pure(e.max_purchase.toString()),n.pure(e.least_raise_amount.toString()),n.pure(e.hardcap.toString()),n.pure((e.liquidity_rate*1e3).toString()),n.pure(e.start_time.toString()),n.pure(e.activity_duration.toString()),n.pure(e.settle_duration.toString()),n.pure(e.locked_duration.toString()),n.pure(e.tick_spacing.toString()),n.pure(w)],u=[e.coin_type_sale,e.coin_type_raise];return n.moveCall({target:`${t.published_at}::${X}::create_launch_pool`,typeArguments:u,arguments:c}),n}async creatPurchasePayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const s=new v,i=await H.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,s,BigInt(e.purchase_amount),e.coin_type_raise),n=(await this.getPurchaseMarks(this._sdk.ClmmSDK.senderAddress,[e.pool_address],!1))[0],o=[e.coin_type_sale,e.coin_type_raise];let a;return n?a=[s.pure(e.pool_address),s.pure(p(t).config_cap_id),s.pure(n.id),i,s.pure(e.purchase_amount.toString()),s.pure(w)]:a=[s.pure(e.pool_address),s.pure(p(t).config_cap_id),i,s.pure(e.purchase_amount.toString()),s.pure(w)],s.moveCall({target:`${t.published_at}::${X}::${n===void 0?"create_and_purchase":"purchase"}`,typeArguments:o,arguments:a}),s}async creatClaimPayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const s=(await this.getPurchaseMarks(this._sdk.ClmmSDK.senderAddress,[e.pool_address],!1))[0],i=new v,n=[e.coin_type_sale,e.coin_type_raise],o=[i.pure(e.pool_address),i.pure(p(t).config_cap_id),i.pure(s==null?void 0:s.id),i.pure(w)];return i.moveCall({target:`${t.published_at}::${X}::claim`,typeArguments:n,arguments:o}),i}async creatSettlePayload(e){var c;const{launchpad:t}=this.sdk.sdkOptions,{clmm_pool:s}=this.sdk.ClmmSDK.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");this.assertLuanchpadConfig();const i=p(s),{clmm_args:n}=e,o=new v;o.setSender(this.sdk.ClmmSDK.senderAddress);const a=[e.coin_type_sale,e.coin_type_raise];if(n){const u=n.opposite?L.priceToSqrtPriceX64(d(1).div(n.current_price),n.raise_decimals,n.sale_decimals).toString():L.priceToSqrtPriceX64(d(n.current_price),n.sale_decimals,n.raise_decimals).toString(),l=BigInt(u)<BigInt(n.clmm_sqrt_price),m=n.opposite?l?e.coin_type_raise:e.coin_type_sale:l?e.coin_type_sale:e.coin_type_raise,h=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,m);let g=Me.calculateTotalBalance(h);Me.isSuiCoin(m)&&(g-=BigInt(2e8));const E=(c=H.buildCoinInputForAmount(o,h,g,m))==null?void 0:c.transactionArgument,N=n.opposite?l?"settle_with_reverse_clmm_only_with_a":"settle_with_reverse_clmm_only_with_b":l?"settle_only_with_a":"settle_only_with_b",M=[o.pure(e.pool_address),o.pure(p(t).config_cap_id),o.pure(n.clmm_pool_address),o.pure(i.global_config_id),o.pure(u),E,o.pure(w)];o.moveCall({target:`${t.published_at}::${X}::${N}`,typeArguments:a,arguments:M})}else o.moveCall({target:`${t.published_at}::${X}::settle`,typeArguments:a,arguments:[o.pure(e.pool_address),o.pure(p(t).config_cap_id),o.pure(w)]});return o}creatWithdrawPayload(e){const{launchpad:t}=this.sdk.sdkOptions,s=new v,i=[e.coin_type_sale,e.coin_type_raise],n=[s.object(e.pool_address),s.object(p(t).config_cap_id),s.object(w)];return e.sale_amount>BigInt(0)&&s.moveCall({target:`${t.published_at}::${X}::withdraw_sale`,typeArguments:i,arguments:n}),e.raise_amount>BigInt(0)&&s.moveCall({target:`${t.published_at}::${X}::withdraw_raise`,typeArguments:i,arguments:n}),s}addUserToWhitelisPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const s=new v,i=[e.coin_type_sale,e.coin_type_raise];return e.user_addrs.forEach(n=>{const o=[s.object(p(t).admin_cap_id),s.object(p(t).config_cap_id),s.object(e.pool_address),s.object(n),s.pure(e.safe_limit_amount),s.object(w)];s.moveCall({target:`${t.published_at}::${X}::add_user_to_whitelist`,typeArguments:i,arguments:o})}),s}updateWhitelistCapPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const s=new v,i=[e.coin_type_sale,e.coin_type_raise];return e.safe_limit_amount>0&&s.moveCall({target:`${t.published_at}::${X}::update_whitelist_member_safe_limit_amount`,typeArguments:i,arguments:[s.object(p(t).admin_cap_id),s.object(p(t).config_cap_id),s.object(e.pool_address),s.pure(e.white_list_member),s.pure(e.safe_limit_amount),s.object(w)]}),e.hard_cap_total>0&&s.moveCall({target:`${t.published_at}::${X}::update_whitelist_hard_cap_total`,typeArguments:i,arguments:[s.object(p(t).admin_cap_id),s.object(p(t).config_cap_id),s.object(e.pool_address),s.pure(e.hard_cap_total),s.object(w)]}),s}creatRemoveWhitelistPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const s=new v,i=[e.coin_type_sale,e.coin_type_raise];return e.user_addrs.forEach(n=>{const o=[s.object(p(t).admin_cap_id),s.object(p(t).config_cap_id),s.object(e.pool_address),s.object(n),s.object(w)];s.moveCall({target:`${t.published_at}::${X}::remove_user_from_whitelist`,typeArguments:i,arguments:o})}),s}creatCancelPoolPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const s=new v,i=[e.coin_type_sale,e.coin_type_raise],n=[s.pure(p(t).admin_cap_id),s.pure(p(t).config_cap_id),s.pure(e.pool_address),s.pure(w)];return s.moveCall({target:`${t.published_at}::${X}::cancel`,typeArguments:i,arguments:n}),s}updateRecipientPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const s=new v,i=[e.coin_type_sale,e.coin_type_raise],n=[s.pure(p(t).admin_cap_id),s.pure(p(t).config_cap_id),s.pure(e.pool_address),s.pure(e.new_recipient),s.pure(w)];return s.moveCall({target:`${t.published_at}::${X}::update_recipient_address`,typeArguments:i,arguments:n}),s}updatePoolDuractionPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const s=new v,i=[e.coin_type_sale,e.coin_type_raise],n=[s.pure(p(t).admin_cap_id),s.pure(p(t).config_cap_id),s.pure(e.pool_address),s.pure(e.activity_duration),s.pure(e.settle_duration),s.pure(e.lock_duration),s.pure(w)];return s.moveCall({target:`${t.published_at}::${X}::update_pool_duration`,typeArguments:i,arguments:n}),s}creatUnlockNftPayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(p(t)===void 0)throw Error("getPackagerConfigs(launchpad)  is null");const s=new v,i=[e.nft_type],n=[s.pure(e.lock_nft),s.pure(w)];return s.moveCall({target:`${t.published_at}::lock::unlock_nft`,typeArguments:i,arguments:n}),s}async isAdminCap(e){const{launchpad:t}=this._sdk.sdkOptions;if(p(t)===void 0)throw Error("launchpad config is empty");const s=`${e}_isAdminCap`,i=this.getCache(s);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:p(t).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(n);const o=Ke(n),a=ht(n);let c=!1;return a&&o&&C(o).source_address===`${t.package_id}::config::AdminCap`&&(c=K(a.AddressOwner)===K(e)),this.updateCache(s,c,P),c}async isWhiteListUser(e,t){const s={type:"address",value:t};try{const i=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:s});return!!(i&&i.data)}catch{return!1}}async getPurchaseAmount(e,t){var i;const s={type:"address",value:t};try{const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:s}),o=j(n);if(console.log(o),o)return(i=o==null?void 0:o.value)==null?void 0:i.fields}catch{}return{safe_limit_amount:"0",safe_purchased_amount:"0"}}async getPurchaseMarks(e,t=[],s=!0){const{launchpad:i}=this._sdk.sdkOptions,n=`${t}_getPurchaseMark`,o=this.getCache(n,s);if(!s&&o!==void 0)return o;let a=null;const c=[];for(;;){const u=await this._sdk.ClmmSDK.fullClient.getOwnedObjects({owner:e,options:{showType:!0,showContent:!0,showDisplay:!0},cursor:a});for(const l of u.data){const{fields:m}=l.data.content;if(C(Se(l)).source_address===`${i.package_id}::pool::PurchaseMark`){console.log("fields: ",m);const g={id:m.id.id,pool_id:C(m.pool_id).address,purchased_raise_amount:m.purchase_total,obtain_sale_amount:m.obtain_sale_amount,used_raise_amount:m.used_raise_amount};t.length>0?t.includes(g.pool_id)&&c.push(g):c.push(g)}}if(u.hasNextPage)a=u.nextCursor;else break}return this.updateCache(n,c,P),c}async getSettleEvent(e){const{launchpad:t}=this._sdk.sdkOptions,s=`${e}_getPurchaseMark`,i=this.getCache(s);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t.package_id}::pool::SettleEvent`});for(const o of n.data){const a=o.parsedJson;if(e===ie(a.pool_id)){const c={pool_id:a.pool_id,settle_price:a.settle_price,unused_sale:a.unused_sale,unused_raise:a.unused_raise,white_purchase_total:a.white_purchase_total};return this.updateCache(s,c,P),c}}}buildLaunchpadCoinType(e,t){return qs(this._sdk.sdkOptions.launchpad.package_id,"pool","PoolLiquidityCoin",[e,t])}assertLuanchpadConfig(){const{launchpad:e}=this.sdk.sdkOptions;if(p(e)===void 0)throw Error("sdk getPackagerConfigs(launchpad) is null")}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}},we=class{static buildPoolImmutables(e){const{fields:t}=e.value.fields.value;return{clmm_pool_id:C(t.clmm_pool_id).address,bonus_type:C(t.bonus_type.fields.name).source_address,pool_id:C(t.pool_id).address,coinTypeA:C(t.coin_type_a.fields.name).source_address,coinTypeB:C(t.coin_type_b.fields.name).source_address}}static buildPoolState(e){const t=j(e),s=[];return t.config.fields.contents.forEach(n=>{s.push({rate:Number(d(n.fields.key).div($e)),multiplier:Number(d(n.fields.value).div($e))})}),{balance:t.balance,config:s,is_open:t.is_open,index:Number(t.index),start_time:Number(t.start_time),interval_day:Number(t.interval_day),minimum_percent_to_reward:Number(d(t.minimum_percent_to_reward).div($e)),rewarders:{rewarder_handle:t.rewarders.fields.id.id,size:Number(t.rewarders.fields.size)},whale_nfts:{whale_nfts_handle:t.whale_nfts.fields.id.id,size:Number(t.whale_nfts.fields.size)},points:{point_handle:t.points.fields.id.id,size:Number(t.points.fields.size)}}}static buildMarkerPositions(e){const{contents:t}=e.value.fields.value.fields,s=[],i=e.id.id;return t.forEach(n=>{const{key:o,value:a}=n.fields,c={id:o,period_id:i,bonus_num:a.fields.bonus_num,point:a.fields.point,is_burn:a.fields.is_burn,point_after_multiplier:a.fields.point_after_multiplier,percent:Number(d(a.fields.percent).div($e)),fee_share_rate:0,is_redeemed:a.fields.is_redeemed};s.push(c)}),s}static buildPoolBonusInfo(e){const{fields:t,type:s}=e.value.fields.value;return{type:s,time:Number(t.time),settle_time:Number(t.settle_time),settled_num:t.settled_num,is_settled:t.is_settled,basis_bonus:t.basis_bonus,total_bonus:t.total_bonus,is_vacant:t.is_vacant,redeemed_num:t.redeemed_num}}static getBonusPercent(e,t){let s=0;for(const i of e)t>=i.rate&&i.rate>s&&(s=i.multiplier);return s}},Zt="router",oo=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=!1){var o;const{maker_bonus:t}=this._sdk.sdkOptions,s=`${t.package_id}_getPoolImmutables`,i=this.getCache(s,e),n=[];if(i!==void 0)n.push(...i);else{const a=[];(o=(await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(p(t).maker_pool_handle)).data)==null||o.forEach(l=>{a.push(l.objectId)});const u=await this._sdk.ClmmSDK.fullClient.batchGetObjects(a,{showContent:!0});for(const l of u){const m=j(l);m&&n.push(we.buildPoolImmutables(m))}}return n}async getPoolImmutable(e){const{maker_bonus:t}=this._sdk.sdkOptions,s=`${t.package_id}_getPoolImmutables`,i=this.getCache(s);if(i!==void 0){const a=i.filter(c=>e===c.pool_id);if(a.length>0)return a[0]}const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:p(t).maker_pool_handle,name:{type:"0x2::object::ID",value:e}}),o=j(n);return we.buildPoolImmutables(o)}async getPools(){const e=[],t=await this.getPoolImmutables(),s=t.map(o=>o.pool_id),i=await this._sdk.ClmmSDK.fullClient.batchGetObjects(s,{showType:!0,showContent:!0});let n=0;for(const o of i){const a=we.buildPoolState(o);if(a){const c={...t[n],...a};e.push(c);const u=`${c.pool_id}_getPoolObject`;this.updateCache(u,c,P)}n+=1}return e}async getPool(e,t=!0){const s=`${e}_getPoolObject`,i=this.getCache(s,t),n=await this.getPoolImmutable(e);if(i!==void 0)return i;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),a=we.buildPoolState(o),c={...n,...a};return this.updateCache(s,c,P),c}async getPoolHandleId(e){const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=j(t);return s?s.list.fields.id.id:""}async getMakerPoolPeriods(e,t=!1){const s=[],i=`${e.pool_id}_getMakerPoolPeriods`,n=this.getCache(i,t);return n!==void 0?n:((await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(e.whale_nfts.whale_nfts_handle)).data.forEach(a=>{const c={id:a.objectId,start_time:0,end_time:0,period:Number(a.name.value)};c.start_time=Number(d(e.start_time).add(d(e.interval_day).mul(24*3600).mul(c.period)).toFixed(0,z.ROUND_DOWN)),c.end_time=Number(d(c.start_time).add(d(e.interval_day).mul(24*3600)).toFixed(0,z.ROUND_DOWN)),s.push(c)}),this.updateCache(i,s,P),s)}async getMakerBonusInitConfigs(){var i;const{package_id:e}=this.sdk.sdkOptions.maker_bonus,t=(i=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitEvent`}))==null?void 0:i.data,s={maker_config_id:"",maker_pool_handle:""};return t.length>0&&t.forEach(n=>{const o=n.parsedJson;o&&(s.maker_config_id=o.config_id)}),s.maker_pool_handle=await this.getPoolHandleId(s.maker_config_id),s}async getPoolMarkerPositionList(e,t,s=!1){const i={},n=[];s||t.forEach(o=>{const a=`${e}_${o.period}_getPoolMarkerPositionList`,c=this.getCache(a);c!==void 0?i[o.period]=c:(i[o.period]=[],n.push(o))});try{n.length>0&&(await this._sdk.ClmmSDK.fullClient.batchGetObjects(n.map(c=>c.id),{showContent:!0})).forEach(c=>{const u=j(c),l=we.buildMarkerPositions(u);if(l.length>0){const{period_id:m}=l[0],h=t.filter(g=>g.id===m)[0];i[h.period]=l}});const o=[];for(const a in i)i[a].forEach(u=>{o.push(u)});if(o.length>0){const a=await this._sdk.ClmmSDK.Position.getSipmlePositionList(o.map(c=>c.id));for(const c of o)for(const u of a)if(c.id===u.pos_object_id){c.clmm_position=u;break}}}catch(o){console.log(o)}for(const o in i){const a=`${e}_${o}_getPoolMarkerPositionList`;this.updateCache(a,i[o],P)}return i}async updateXCetusRewarderAndFee(e,t,s){const i=await this.calculateTotalPointsAfterMultiper(e,s);for(const n of t)await this.calculateXCetusRewarder(e,n,s.period,i);return t}async calculateXCetusRewarder(e,t,s,i){const n=await this.getPoolBonusInfo(e.rewarders.rewarder_handle,s),{fee_share_rate:o}=this.calculateFeeShareRate(e,t,i),a=d(o).mul(n.total_bonus);return t.is_redeemed?t.bonus_num="0":t.bonus_num=a.toString(),t.bonus_num}calculateFeeShareRate(e,t,s){const i=we.getBonusPercent(e.config,t.percent),n=d(t.point).mul(i),o=d(n).div(s);return t.point_after_multiplier=n.toString(),t.fee_share_rate=Number(o),{fee_share_rate:Number(o),points_after_multiper:n.toString()}}async calculateTotalPointsAfterMultiper(e,t){const s=await this.getPoolMarkerPositionList(e.whale_nfts.whale_nfts_handle,[t]);let i=d(0);const n=s[t.period];for(const o of n){const a=we.getBonusPercent(e.config,o.percent),c=d(o.point).mul(a);i=i.add(c)}return i.toString()}async calculateAllXCetusRewarder(e){const t=this._sdk.ClmmSDK.senderAddress;let s=d(0);const i=[];for(const n of e){const o=await this._sdk.MakerModule.getMakerPoolPeriods(n),a=await this._sdk.MakerModule.getPoolMarkerPositionList(n.whale_nfts.whale_nfts_handle,o),c=[];for(const u of o){const l=a[u.period].filter(m=>{var h;return t.length===0?!1:((h=m.clmm_position)==null?void 0:h.owner)===t});l.length>0&&(await this._sdk.MakerModule.updateXCetusRewarderAndFee(n,l,u),l.forEach(m=>{var h;((h=m.clmm_position)==null?void 0:h.position_status)===Fs.Exists&&d(m.bonus_num).greaterThan(0)&&(s=s.add(m.bonus_num),c.includes(m.clmm_position.pos_object_id)||c.push(m.clmm_position.pos_object_id))}))}i.push({bonus_type:n.bonus_type,pool_id:n.pool_id,nft_ids:c})}return{claimtotal:s,claimRecord:i}}async getPoolBonusInfo(e,t,s=!1){const i=`${e}_${t}_getPoolBonusInfo`,n=this.getCache(i,s);if(n!==void 0)return n;const o=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"u64",value:t.toString()}}),a=j(o),c=we.buildPoolBonusInfo(a);return this.updateCache(i,c,he),c}claimPayload(e){const{maker_bonus:t,xcetus:s}=this.sdk.sdkOptions,i=new v;return i.moveCall({target:`${t.published_at}::${Zt}::claim`,typeArguments:[e.bonus_type],arguments:[i.pure(p(t).maker_config_id),i.pure(e.market_pool_id),i.pure(e.position_nft_id),i.pure(e.phase),i.pure(p(s).lock_manager_id),i.pure(p(s).xcetus_manager_id),i.pure(e.ve_nft_id)]}),i}claimAllPayload(e){const{maker_bonus:t,xcetus:s}=this.sdk.sdkOptions,i=new v;return e.whale_nfts.forEach(n=>{n.nft_ids.forEach(o=>{i.moveCall({target:`${t.published_at}::${Zt}::claim_all`,typeArguments:[n.bonus_type],arguments:[i.object(p(t).maker_config_id),i.object(n.pool_id),i.object(o),i.object(p(s).lock_manager_id),i.object(p(s).xcetus_manager_id),i.object(e.ve_nft_id)]})})}),i}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}},De="router",_t="router",Le=24*3600,ot=1e3,Q=1e11,Pe=class{static buildVeNFTDividendInfo(e){const t={id:e.id.id,ve_nft_id:e.name,rewards:[]};return e.value.fields.value.fields.dividends.fields.contents.forEach(s=>{const i=[];s.fields.value.fields.contents.forEach(n=>{i.push({coin_type:C(n.fields.key.fields.name).source_address,amount:n.fields.value})}),t.rewards.push({period:Number(s.fields.key),rewards:i})}),t}static buildDividendManager(e){const t={id:e.id.id,dividends:{id:e.dividends.fields.id.id,size:e.dividends.fields.size},venft_dividends:{id:e.venft_dividends.fields.id.id,size:e.venft_dividends.fields.size},bonus_types:[],start_time:Number(e.start_time),interval_day:Number(e.interval_day),balances:{id:e.balances.fields.id.id,size:e.balances.fields.size},is_open:e.is_open};return e.bonus_types.forEach(s=>{t.bonus_types.push(C(s.fields.name).source_address)}),t}static buildLockUpManager(e){return{id:e.id.id,balance:e.balance,treasury_manager:e.treasury_manager,extra_treasury:e.extra_treasury,lock_infos:{lock_handle_id:e.lock_infos.fields.id.id,size:Number(e.lock_infos.fields.size)},type_name:ts(e.type_name.fields.name),min_lock_day:Number(e.min_lock_day),max_lock_day:Number(e.max_lock_day),package_version:Number(e.package_version),max_percent_numerator:Number(e.max_percent_numerator),min_percent_numerator:Number(e.min_percent_numerator)}}static buildLockCetus(e){const t=e.fields,s={id:t.id.id,type:C(e.type).source_address,locked_start_time:Number(t.locked_start_time),locked_until_time:Number(t.locked_until_time),cetus_amount:t.balance,xcetus_amount:"0",lock_day:0};return s.lock_day=(s.locked_until_time-s.locked_start_time)/Le,s}static getAvailableXCetus(e,t){let s=d(0);return t.forEach(i=>{s=s.add(i.xcetus_amount)}),d(e.xcetus_balance).sub(s).toString()}static getWaitUnLockCetuss(e){return e.filter(t=>!Pe.isLocked(t))}static getLockingCetuss(e){return e.filter(t=>Pe.isLocked(t))}static isLocked(e){return e.locked_until_time>Date.parse(new Date().toString())/1e3}static buildDividendRewardTypeList(e){const t=new Set;return e.forEach(s=>{s.rewards.forEach(i=>{t.add(i.coin_type)})}),Array.from(t)}static getNextStartTime(e){const t=Date.now()/1e3,{start_time:s,interval_day:i}=e,n=Math.ceil((t-s)/(i*Le));return s+n*i*Le}},ao=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getOwnerVeNFT(e,t=!0){const{xcetus:s}=this.sdk.sdkOptions,i=`${e}_getLockUpManagerEvent`,n=this.getCache(i,t);if(n!==void 0)return n;let o;const a=`${s.package_id}::xcetus::VeNFT`;return(await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0},filter:{StructType:a}})).data.forEach(u=>{const l=C(Se(u)).source_address;if(l===a&&u.data&&u.data.content){const{fields:m}=u.data.content;o={...Tt(u),id:m.id.id,index:m.index,type:l,xcetus_balance:m.xcetus_balance},this.updateCache(i,o,P)}}),o}async getOwnerLockCetuss(e){const{xcetus:t}=this.sdk.sdkOptions,s=[],i=`${t.package_id}::lock_coin::LockedCoin<${this.buileCetusCoinType()}>`,n=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0},filter:{StructType:i}});for(const o of n.data)if(C(Se(o)).source_address===i&&o.data){const c=Pe.buildLockCetus(o.data.content);c.xcetus_amount=await this.getXCetusAmount(c.id),s.push(c)}return s}async getLockCetus(e){var s;const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}});if((s=t.data)!=null&&s.content){const i=Pe.buildLockCetus(t.data.content);return i.xcetus_amount=await this.getXCetusAmount(i.id),i}}async getOwnerCetusCoins(e){return await this._sdk.ClmmSDK.getOwnerCoinAssets(e,this.buileCetusCoinType())}mintVeNFTPayload(){const{xcetus:e}=this.sdk.sdkOptions,t=new v;return t.moveCall({target:`${e.published_at}::${De}::mint_venft`,typeArguments:[],arguments:[t.pure(p(e).xcetus_manager_id)]}),t}async convertPayload(e){const{xcetus:t}=this.sdk.sdkOptions,s=new v,i=this.buileCetusCoinType(),n=await H.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,s,BigInt(e.amount),i);return e.venft_id===void 0?s.moveCall({target:`${t.published_at}::${De}::mint_and_convert`,typeArguments:[],arguments:[s.object(p(t).lock_manager_id),s.object(p(t).xcetus_manager_id),n,s.pure(e.amount)]}):s.moveCall({target:`${t.published_at}::${De}::convert`,typeArguments:[],arguments:[s.object(p(t).lock_manager_id),s.object(p(t).xcetus_manager_id),n,s.pure(e.amount),s.pure(e.venft_id)]}),s}redeemLockPayload(e){const{xcetus:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${De}::redeem_lock`,typeArguments:[],arguments:[s.pure(p(t).lock_manager_id),s.pure(p(t).xcetus_manager_id),s.pure(e.venft_id),s.pure(e.amount),s.pure(e.lock_day),s.pure(w)]}),s}redeemPayload(e){const{xcetus:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${De}::redeem`,typeArguments:[],arguments:[s.pure(p(t).lock_manager_id),s.pure(p(t).xcetus_manager_id),s.pure(e.venft_id),s.pure(e.lock_id),s.pure(w)]}),s}redeemDividendPayload(e,t){const{xcetus:s,xcetus_dividends:i}=this.sdk.sdkOptions,n=new v;return t.forEach(o=>{n.moveCall({target:`${s.published_at}::${_t}::redeem`,typeArguments:[o],arguments:[n.object(p(i).dividend_manager_id),n.object(e)]})}),n}redeemDividendV2Payload(e,t,s){const{xcetus_dividends:i}=this.sdk.sdkOptions;let n=new v;return t.filter(a=>s.includes(a)).length>0&&(n=this.redeemDividendXTokenPayload(e,n)),t.forEach(a=>{s.includes(a)||n.moveCall({target:`${i.published_at}::${_t}::redeem_v2`,typeArguments:[a],arguments:[n.object(p(i).dividend_manager_id),n.object(e),n.object(w)]})}),n}redeemDividendXTokenPayload(e,t){const{xcetus_dividends:s,xcetus:i}=this.sdk.sdkOptions,{xcetus_manager_id:n,lock_manager_id:o}=p(i),{dividend_manager_id:a}=p(s);return t=t===void 0?new v:t,t.moveCall({target:`${s.published_at}::${_t}::redeem_xtoken`,typeArguments:[],arguments:[t.object(o),t.object(n),t.object(a),t.object(e),t.object(w)]}),t}buileCetusCoinType(){return`${this.sdk.sdkOptions.cetus_faucet.package_id}::cetus::CETUS`}buileXTokenCoinType(e=this._sdk.sdkOptions.xcetus.package_id,t="xcetus",s="XCETUS"){return`${e}::${t}::${s}`}cancelRedeemPayload(e){const{xcetus:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${De}::cancel_redeem_lock`,typeArguments:[],arguments:[s.pure(p(t).lock_manager_id),s.pure(p(t).xcetus_manager_id),s.pure(e.venft_id),s.pure(e.lock_id),s.pure(w)]}),s}async getInitConfigs(){var a,c;const{package_id:e}=this.sdk.sdkOptions.xcetus,t=`${e}_getInitFactoryEvent`,s=this.getCache(t);if(s!==void 0)return s;const i=(a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::xcetus::InitEvent`}))==null?void 0:a.data,n={xcetus_manager_id:"",lock_manager_id:"",lock_handle_id:""};i.length>0&&i.forEach(u=>{const l=u.parsedJson;l&&(n.xcetus_manager_id=l.xcetus_manager)});const o=(c=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::locking::InitializeEvent`}))==null?void 0:c.data;return o.length>0&&o.forEach(u=>{const l=u.parsedJson;l&&(n.lock_manager_id=l.lock_manager)}),n.lock_manager_id.length>0&&(n.lock_handle_id=(await this.getLockUpManager(n.lock_manager_id)).lock_infos.lock_handle_id),this.updateCache(t,n,P),n}async getLockUpManager(e=p(this.sdk.sdkOptions.xcetus).lock_manager_id,t=!1){const s=`${e}_getLockUpManager`,i=this.getCache(s,t);if(i!==void 0)return i;const n=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),o=Pe.buildLockUpManager(j(n));return this.updateCache(s,o,P),o}async getDividendConfigs(){var o;const{package_id:e}=this.sdk.sdkOptions.xcetus_dividends,t=`${e}_getDividendManagerEvent`,s=this.getCache(t);if(s!==void 0)return s;const i=(o=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::dividend::InitEvent`}))==null?void 0:o.data,n={dividend_manager_id:"",dividend_admin_id:"",dividend_settle_id:""};return i.length>0&&i.forEach(a=>{const c=a.parsedJson;c&&(n.dividend_manager_id=c.manager_id,n.dividend_admin_id=c.admin_id,n.dividend_settle_id=c.settle_id,this.updateCache(t,n,P))}),n}async getDividendManager(e=!1){const{dividend_manager_id:t}=p(this._sdk.sdkOptions.xcetus_dividends),s=`${t}_getDividendManager`,i=this.getCache(s,e);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),o=j(n),a=Pe.buildDividendManager(o);return this.updateCache(s,a,P),a}async getXcetusManager(e=!0){const{xcetus_manager_id:t}=p(this._sdk.sdkOptions.xcetus),s=`${t}_getXcetusManager`,i=this.getCache(s,e);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),o=j(n),a={id:o.id.id,index:Number(o.index),has_venft:{handle:o.has_venft.fields.id.id,size:o.has_venft.fields.size},nfts:{handle:o.nfts.fields.id.id,size:o.nfts.fields.size},total_locked:o.total_locked,treasury:o.treasury.fields.total_supply.fields.value};return this.updateCache(s,a),a}async getVeNFTDividendInfo(e,t){try{const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=j(s);return Pe.buildVeNFTDividendInfo(i)}catch{return}}async redeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const s=await this.getLockUpManager(p(this._sdk.sdkOptions.xcetus).lock_manager_id),i=d(Q).mul(d(s.max_lock_day).sub(d(t))).mul(d(s.max_percent_numerator).sub(d(s.min_percent_numerator))).div(d(s.max_lock_day).sub(d(s.min_lock_day))),n=d(Q).mul(d(s.max_percent_numerator)).sub(i).div(d(ot)).div(Q);return{amountOut:d(n).mul(d(e)).round().toString(),percent:n.toString()}}async reverseRedeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const s=await this.getLockUpManager(p(this._sdk.sdkOptions.xcetus).lock_manager_id),i=d(Q).mul(d(s.max_lock_day).sub(d(t))).mul(d(s.max_percent_numerator).sub(d(s.min_percent_numerator))).div(d(s.max_lock_day).sub(d(s.min_lock_day))),n=d(Q).mul(d(s.max_percent_numerator)).sub(i).div(d(ot)).div(Q);return{amountOut:d(e).div(n).toFixed(0,z.ROUND_UP),percent:n.toString()}}async getXCetusAmount(e){const{lock_handle_id:t}=p(this._sdk.sdkOptions.xcetus),s=`${e}_getXCetusAmount`,i=this.getCache(s);if(i!==void 0)return i;try{const n=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"0x2::object::ID",value:e}}),o=j(n);if(o){const{xcetus_amount:a}=o.value.fields.value.fields;return this.updateCache(s,a,P),a}}catch{}return"0"}async getVeNftAmount(e,t){try{const s=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=j(s);if(i){const{lock_amount:n,xcetus_amount:o}=i.value.fields.value.fields;return{lock_amount:n,xcetus_amount:o}}}catch{}return{lock_amount:"0",xcetus_amount:"0"}}async getPhaseDividendInfo(e,t=!1){const i=(await this.getDividendManager()).dividends.id,n=`${i}_${e}_getPhaseDividendInfo`,o=this._sdk.getCache(n,t);if(o)return o;try{const a=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:i,name:{type:"u64",value:e}}),c=j(a),u=c.value.fields.value.fields,l=u.redeemed_num.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),m=u.bonus_types.map(b=>b.fields.name),h=u.bonus.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),g={id:qe(a),phase:c.name,settled_num:u.settled_num,register_time:u.register_time,redeemed_num:l,is_settled:u.is_settled,bonus_types:m,bonus:h,phase_end_time:""};return this.updateCache(n,g),g}catch{}}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}},ro="factory",Z="oversubscribe_pool",$s=1e6,tt=1e18,Ee="router",pt="router",Ze="router",Qt={curve:{strategy:3,both_side:{div_width:10,ratios:[.333333,.266666,.2,.133333,.066666]},one_side:{div_width:5,ratios:[.333333,.266666,.2,.133333,.066666]}},bidAsk:{strategy:4,both_side:{div_width:10,ratios:[.172413793,.137931034,.103448276,.068965517,.034482759,.068965517,.103448276,.137931034,.172413793]},one_side:{div_width:5,ratios:[.066666667,.13333333,.2,.266666667,.333333333]}}};function co(e){return"master_address"in e}var mt="router",uo="vaults",lo=1e4,q=class{static buildIdoPoolImmutables(e){return{pool_address:ie(e.pool_id),coin_type_sale:C(e.sale_coin_type.name).full_address,coin_type_raise:C(e.raise_coin_type.name).full_address,tick_spacing:Number(e.tick_spacing),total_supply:e.total_supply,min_purchase:e.min_purchase_amount,max_purchase:e.max_purchase_amount}}static buildIdoPool(e){const t=Se(e),s=C(t),i=j(e),n={pool_address:ie(i.id.id),coin_type_sale:s.type_arguments[0],coin_type_raise:s.type_arguments[1],tick_spacing:Number(i.tick_spacing),total_supply:i.total_supply,min_purchase:i.min_purchase_amount,max_purchase:i.max_purchase_amount},o={start_time:Number(i.duration_manager.fields.start_time),lock_up_duration:Number(i.duration_manager.fields.lock_up_duration),purchase_duration:Number(i.duration_manager.fields.purchase_duration),end_time:0};o.end_time=o.start_time+o.purchase_duration;const a={complete_raise_limit:i.complete_raise_limit,liquidity_injection_ratio:d(i.liquidity_injection_ratio).div($s).toNumber(),current_sqrt_price_min:i.current_sqrt_price_min,current_sqrt_price_max:i.current_sqrt_price_max,owner:i.owner,sale_coin_amount:i.sale_coin,raise_coin_amount:i.raise_coin,price:i.price,current_price:i.price,duration_summary:o,is_cancelled:i.is_cancelled,is_liquidity_injected:i.is_liquidity_injected,liquidity_used_raise_amount:i.liquidity_used_raise_amount,liquidity_used_sale_amount:i.liquidity_used_sale_amount,purchase_summary:{size:Number(i.purchase_manager.fields.purchases.fields.size),purchase_handle:i.purchase_manager.fields.purchases.fields.id.id},total_purchase_amount:i.total_purchase_amount,white_summary:{white_list_id:i.white_list.fields.id.id,protection_limit_used:i.white_list.fields.protection_limit_used,protection_hard_cap:i.white_list.fields.protection_hard_cap,white_handle:i.white_list.fields.addresses.fields.id.id,size:Number(i.white_list.fields.addresses.fields.size)},pool_status:"Upcoming",max_raise_amount:"",sale_decimals:0,raise_decimals:0,is_withdrawn:i.is_withdrawn};return q.updatePoolStatus(a),{...n,...a}}static is_init_period(e){return Number(d(Date.now()/1e3).toFixed(0))<e.start_time}static is_purchase_period(e){const t=Number(d(Date.now()/1e3).toFixed(0));return t>=e.start_time&&t<=e.start_time+e.purchase_duration}static is_claim_period(e){const t=Number(d(Date.now()/1e3).toFixed(0)),s=e.start_time+e.purchase_duration;return t>s}static is_can_inject_liquidity(e){return!e.is_cancelled&&e.liquidity_injection_ratio!==0&&q.is_claim_period(e.duration_summary)&&!e.is_liquidity_injected}static is_can_withdraw(e){return e.is_withdrawn?!1:q.is_sale_failed(e)?!0:(e.liquidity_injection_ratio===0||e.is_liquidity_injected)&&q.is_claim_period(e.duration_summary)}static is_sale_failed(e){return!!(e.is_cancelled||q.is_claim_period(e.duration_summary)&&d(e.total_purchase_amount).lessThan(e.complete_raise_limit))}static buildPurchaseInfo(e){return{...e.value.fields.value.fields,owner:e.name}}static calculateRedeemAmount(e,t){let s,i;if(q.is_sale_failed(e))s="0",i="0";else if(t.is_redeemed)s=t.obtained_sale_amount,i=t.used_raise_amount;else if(d(e.total_purchase_amount).lessThanOrEqualTo(e.max_raise_amount))s=d(t.purchased_raise_amount).mul(tt).div(e.price).toString(),i=t.purchased_raise_amount;else{const o=q.redeemForSaleOversubcribe(e,t);s=o.user_obtained_sale_amount,i=o.user_used_raise_amount_ceil}s=z.floor(s);const n=z.floor(d(t.purchased_raise_amount).sub(i).toString());return{obtained_sale_amount:s,refunded_raise_amount:n}}static calculateWithdrawAmount(e){let t,s;const i=d(e.total_supply).mul(e.liquidity_injection_ratio);if(q.is_sale_failed(e))t="0",s=d(i).add(e.total_supply);else{const{max_raise_amount:n}=e;d(e.total_purchase_amount).greaterThanOrEqualTo(n)?(t=d(n).sub(e.liquidity_used_raise_amount).toString(),s="0"):(t=d(e.total_purchase_amount).sub(e.liquidity_used_raise_amount),s=d(e.total_supply).add(i).sub(e.liquidity_used_sale_amount).sub(q.get_sold_amount(e)))}return{obtained_raise_amount:z.floor(t).toString(),refunded_sale_amount:z.ceil(s).toString()}}static get_sold_amount(e){return d(e.total_purchase_amount).greaterThanOrEqualTo(e.max_raise_amount)?e.total_supply:d(e.total_purchase_amount).mul(tt).div(e.price)}static redeemForSaleOversubcribe(e,t){const s=t.protection_raise_amount,i=d(t.purchased_raise_amount).sub(s),n=e.max_raise_amount,{protection_limit_used:o}=e.white_summary,a=d(n).sub(o),c=d(e.total_purchase_amount).sub(o),u=z.ceil(i.mul(a).div(c).add(s)),l=z.floor(i.mul(a).div(c).add(s));return{user_obtained_sale_amount:z.floor(d(e.total_supply).mul(l).div(n)),user_used_raise_amount_ceil:u}}static raiseTotalAmount(e){const t=d(e.sale_decimals-e.raise_decimals).abs().toNumber();return e.sale_decimals>e.raise_decimals?d(e.total_supply).mul(e.current_price).div(d(10).pow(d(t))).toString():d(e.total_supply).mul(e.current_price).mul(d(10).pow(d(t))).toString()}static updatePoolStatus(e){const t=Number(d(Date.now()/1e3).toFixed(0)),s=e.duration_summary,i=s.start_time+s.purchase_duration;e.is_cancelled?e.pool_status="Canceled":t<s.start_time?e.pool_status="Upcoming":t>s.start_time&&t<i?e.pool_status="Live":d(e.total_purchase_amount).lessThan(e.complete_raise_limit)?e.pool_status="Failed":e.pool_status="Ended"}static async calculatePoolUiPrice(e,t){const s=await e.ClmmSDK.CetusConfig.getTokenListByCoinTypes([t.coin_type_sale,t.coin_type_raise]),i=s[t.coin_type_sale].decimals,n=s[t.coin_type_raise].decimals;t.current_price=G.priceFixToReal(Number(d(t.price).div(d(tt)).toString()),i,n).toString(),t.sale_decimals=i,t.raise_decimals=n,t.max_raise_amount=this.raiseTotalAmount(t)}},bo=class{constructor(e){$(this,"_sdk");this._sdk=e}async getPools(e=[],t=!1){const s=[];if(e.length>0){if(e.filter(n=>{const o=`${n}_getPool`,a=this._sdk.getCache(o,t);return a?(s.push(a),!1):!0}).length>0){const n=await this._sdk.ClmmSDK.fullClient.batchGetObjects(e,{showType:!0,showContent:!0});for(const o of n){const a=await this.buildIdoWarpPool(o);a&&s.push(a)}}}else{const i=await this._sdk.Launchpad.getPools(),n=await this._sdk.Ido.getPools();i.forEach(o=>{s.push({...o,version:"1"})}),n.forEach(o=>{s.push({...o,version:"2"})})}return s.forEach(i=>{const n=`${i.pool_address}_getPool`;this._sdk.updateCache(n,i)}),s}async getPool(e,t=!0){const s=`${e}_getPool`,i=this._sdk.getCache(s,t);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),o=await this.buildIdoWarpPool(n);return this._sdk.updateCache(s,o),o}async getJoinPools(e,t){const s=[],i=t.filter(o=>o.version==="1"),n=t.filter(o=>o.version==="2");if(i.length>0){const o=await this._sdk.Launchpad.getPurchaseMarks(e,i.map(a=>a.pool_address),!1);i.forEach(a=>{for(const c of o)if(c.pool_id===a.pool_address){s.push(a);break}})}for(const o of n)await this._sdk.Ido.getPurchaseInfo(o.purchase_summary.purchase_handle,e,!1)&&s.push(o);return s}async getOwnerPools(e,t){return t.filter(s=>s.owner===K(e))}async creatPurchasePayload(e,t){return e.version==="1"?await this._sdk.Launchpad.creatPurchasePayload({pool_address:e.pool_address,purchase_amount:t,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise}):await this._sdk.Ido.creatPurchasePayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,purchase_handle:e.purchase_summary.purchase_handle,raise_amount:t.toString()})}async creatRedeemPayload(e){return e.version==="1"?await this._sdk.Launchpad.creatClaimPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise}):await this._sdk.Ido.redeemPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,purchase_handle:e.purchase_summary.purchase_handle})}async creatWithdrawPayload(e){if(e.version==="1"){const s=await G.getWithdrawSale(e),i=await G.getWithdrawRaise(e);return this._sdk.Launchpad.creatWithdrawPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,sale_amount:BigInt(s),raise_amount:BigInt(i)})}return this._sdk.Ido.withdrawPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise})}unlockNftPayload(e,t){return e.version==="1"?this._sdk.Launchpad.creatUnlockNftPayload(t):this._sdk.Ido.unlockNftPayload({lock_nft_id:t.lock_nft,nft_type:t.nft_type})}async getLockNFTList(e){let t=[];return e.version==="1"&&(t=await this._sdk.Launchpad.getLockNFTList(e.owner)),t=await this._sdk.Ido.getLockNFTList(e.owner),t.filter(i=>i.coin_type_a===e.coin_type_sale&&i.coin_type_b===e.coin_type_raise||i.coin_type_a===e.coin_type_raise&&i.coin_type_b===e.coin_type_sale)}async isWhiteListUser(e,t){return t.version==="1"?await this._sdk.Launchpad.isWhiteListUser(t.white_summary.white_handle,e):!!await this._sdk.Ido.getWhiteProtectionLimit(t.white_summary.white_handle,e)}async getPurchaseInfo(e,t){if(t.version==="1"){const i=await this._sdk.Launchpad.getPurchaseMarks(e,[t.pool_address]);return i.length>0?i[0]:void 0}return await this._sdk.Ido.getPurchaseInfo(t.purchase_summary.purchase_handle,e)}async getwhiteProtectionInfo(e,t,s=!1){if(t.version==="1")return await this._sdk.Launchpad.getPurchaseAmount(t.white_summary.white_handle,e);const i=await this._sdk.Ido.getPurchaseInfo(t.purchase_summary.purchase_handle,e,s);if(i)return{safe_limit_amount:i.protection_raise_limit,safe_purchased_amount:i.protection_raise_amount};const n=await this._sdk.Ido.getWhiteProtectionLimit(t.white_summary.white_handle,e,!1);return n?{safe_limit_amount:n,safe_purchased_amount:"0"}:{safe_limit_amount:"0",safe_purchased_amount:"0"}}async calculateWithdrawAmount(e){if(e.version==="1"){const t=await G.getHistoryWithdrawRaise(this._sdk,e),s=await G.getHistoryWithdrawSale(this._sdk,e);return{obtained_raise_amount:t,refunded_sale_amount:s}}return q.calculateWithdrawAmount(e)}async buildIdoWarpPool(e){const t=Ke(e);if(C(t).address===this._sdk.sdkOptions.ido.package_id){const s=q.buildIdoPool(e);return await q.calculatePoolUiPrice(this._sdk,s),{...s,version:"2"}}if(C(t).address===this._sdk.sdkOptions.launchpad.package_id){const s=G.buildLaunchPadPool(e);return await G.calculatePoolPrice(this._sdk,s),{...s,version:"1"}}}},je=class{static buildVeNFTDividendInfo(e){const t={id:e.id.id,ve_nft_id:e.name,rewards:[]};return e.value.fields.value.fields.dividends.fields.contents.forEach(s=>{const i=[];s.fields.value.fields.contents.forEach(n=>{i.push({coin_type:C(n.fields.key.fields.name).source_address,amount:n.fields.value})}),t.rewards.push({period:Number(s.fields.key),rewards:i})}),t}static buildDividendManager(e){const t={id:e.id.id,dividends:{id:e.dividends.fields.id.id,size:e.dividends.fields.size},venft_dividends:{id:e.venft_dividends.fields.id.id,size:e.venft_dividends.fields.size},bonus_types:[],start_time:Number(e.start_time),interval_day:Number(e.interval_day),balances:{id:e.balances.fields.id.id,size:e.balances.fields.size},is_open:e.is_open};return e.bonus_types.forEach(s=>{t.bonus_types.push(C(s.fields.name).source_address)}),t}static buildLockUpManager(e){return{id:e.id.id,balance:e.balance,treasury_manager:e.treasury_manager,extra_treasury:e.extra_treasury,lock_infos:{lock_handle_id:e.lock_infos.fields.id.id,size:Number(e.lock_infos.fields.size)},type_name:ts(e.type_name.fields.name),min_lock_day:Number(e.min_lock_day),max_lock_day:Number(e.max_lock_day),package_version:Number(e.package_version),max_percent_numerator:Number(e.max_percent_numerator),min_percent_numerator:Number(e.min_percent_numerator)}}static buildLockToken(e){const t=e.fields,s={id:t.id.id,type:C(e.type).source_address,locked_start_time:Number(t.locked_start_time),locked_until_time:Number(t.locked_until_time),token_amount:t.balance,xtoken_amount:"0",lock_day:0};return s.lock_day=(s.locked_until_time-s.locked_start_time)/Le,s}static getAvailableXToken(e,t){let s=d(0);return t.forEach(i=>{s=s.add(i.xtoken_amount)}),d(e.xtoken_balance).sub(s).toString()}static getWaitUnLockTokens(e){return e.filter(t=>!je.isLocked(t))}static getLockingTokens(e){return e.filter(t=>je.isLocked(t))}static buildDividendRewardTypeList(e){const t=new Set;return e.forEach(s=>{s.rewards.forEach(i=>{t.add(i.coin_type)})}),Array.from(t)}static isLocked(e){return e.locked_until_time>Date.parse(new Date().toString())/1e3}static getNextStartTime(e,t=Le){const s=Date.now()/1e3,{start_time:i,interval_day:n}=e,o=Math.ceil((s-i)/(n*t));return i+o*n*t}},de=class{static getDefaultStrategyConfig(e){let t;switch(e){case 4:t=Qt.bidAsk;break;default:t=Qt.curve;break}return t}static geTickIndexRange(e,t,s,i){let n,o;switch(e=L.getInitializableTickIndex(e,t),i){case"left":e>0?(o=d(e).sub(t).toNumber(),n=d(e).mul(d(1).add(s)).toDecimalPlaces(0).toNumber()):(o=d(e).sub(t).toNumber(),n=d(e).mul(d(1).sub(s)).toDecimalPlaces(0).toNumber());break;case"right":e>0?(o=d(e).mul(d(1).add(s)).toDecimalPlaces(0).toNumber(),n=d(e).add(t).toNumber()):(o=d(e).mul(d(1).sub(s)).toDecimalPlaces(0).toNumber(),n=d(e).add(t).toNumber());break;default:e>0?(n=d(e).mul(d(1).sub(s)).toDecimalPlaces(0).toNumber(),o=d(e).mul(d(1).add(s)).toDecimalPlaces(0).toNumber()):(n=d(e).mul(d(1).add(s)).toDecimalPlaces(0).toNumber(),o=d(e).mul(d(1).sub(s)).toDecimalPlaces(0).toNumber());break}if(n=L.getInitializableTickIndex(n,t),o=L.getInitializableTickIndex(o,t),n<Gs)throw Error("Tick lower value is below the minimum allowed value.");if(o>Xs)throw Error("Tick upper value is above the maximum allowed value.");return{tick_lower:n,tick_upper:o}}static getCreateLiquidityBins(e,t){let s=[];switch(t){case 4:s=de.getCreateBidAskLiquidityBins(e);break;default:s=de.getCreateCurveLiquidityBins(e);break}return s}static getCreateBidAskLiquidityBins(e){const t=d(Math.floor(d(e.tick_upper).sub(e.tick_lower).div(e.div_width).toNumber())).abs(),s=[],i=e.ratios;let n,o;for(let a=0;a<i.length;a++){let c,u;e.tick_upper<=e.curr_tick?(u=d(e.tick_upper).sub(t.mul(a)).toNumber(),c=d(u).sub(t).toNumber()):e.tick_lower>=e.curr_tick?(c=d(e.tick_lower).add(t.mul(a)).toNumber(),u=d(e.tick_lower).add(t.mul(a+1)).toNumber()):a===4?(c=d(e.tick_lower).add(t.mul(a)).toNumber(),u=d(c).add(t.mul(2)).toNumber()):a>4?(c=d(e.tick_lower).add(t.mul(a+1)).toNumber(),u=d(c).add(t).toNumber()):(c=d(e.tick_lower).add(t.mul(a)).toNumber(),u=d(c).add(t).toNumber()),n=L.getInitializableTickIndex(c,e.tick_spacing),o=L.getInitializableTickIndex(u,e.tick_spacing),s.push({tick_lower:n,tick_upper:o,ratio:i[a],liquidity:"0"})}return s}static getCreateCurveLiquidityBins(e){const t=d(Math.floor(d(e.tick_upper).sub(e.tick_lower).div(e.div_width).toNumber())).abs(),s=[],i=e.ratios;for(let n=0;n<i.length;n++){let o,a;e.tick_upper<=e.curr_tick?(a=e.tick_upper,o=d(e.tick_upper).sub(t.mul(n+1)).toNumber()):e.tick_lower>=e.curr_tick?(o=e.tick_lower,a=d(o).add(t.mul(n+1)).toNumber()):(o=d(e.curr_tick).sub(t.mul(n+1)).toNumber(),a=d(e.curr_tick).add(t.mul(n+1)).toNumber()),s.push({tick_lower:L.getInitializableTickIndex(o,e.tick_spacing),tick_upper:L.getInitializableTickIndex(a,e.tick_spacing),ratio:i[n],liquidity:"0"})}return s}static calculateAddLiquidityInputs(e){const t=new O(L.tickIndexToSqrtPriceX64(e.curr_tick)),s=de.calculateCoinRatios(e.curr_tick,e.liquidity_bins),i=e.liquidity_bins.map((n,o)=>{const a=s[o],c=d(e.coin_amount).mul(e.fix_amount_a?a.coinRatioA:a.coinRatioB).toFixed(0).toString();try{return{...re.estLiquidityAndcoinAmountFromOneAmounts(n.tick_lower,n.tick_upper,new O(c),e.fix_amount_a,!0,e.slippage,t),...n}}catch{return{coinAmountA:new O(0),coinAmountB:new O(0),tokenMaxA:new O(0),tokenMaxB:new O(0),liquidityAmount:new O(0),fix_amount_a:!e.fix_amount_a,...n}}});return de.fixLiquidityInputs(t,e.slippage,i,!0)}static fixLiquidityInputs(e,t,s,i){const n=s.filter(a=>a.liquidityAmount.gt(Ft));if(n.length===0)return[];const o=n[0];return s.map(a=>{if(a.liquidityAmount.eq(Ft)){const c=d(o.liquidityAmount.toString()).mul(a.ratio).div(o.ratio).toFixed(0),u=L.tickIndexToSqrtPriceX64(a.tick_lower),l=L.tickIndexToSqrtPriceX64(a.tick_upper),m=re.getCoinAmountFromLiquidity(new O(c.toString()),e,u,l,!1);return{coinAmountA:m.coinA,coinAmountB:m.coinB,liquidityAmount:new O(c.toString()),fix_amount_a:a.fix_amount_a,...at(m,rt.fromDecimal(d(t).mul(100)),i)}}return a})}static calculateCoinRatios(e,t){const s=new O(L.tickIndexToSqrtPriceX64(e)),i=[];let n=d(0),o=d(0);const a=t.map(l=>{const m=d(zs(100,6).toString()).mul(l.ratio).toFixed(0).toString(),h=L.tickIndexToSqrtPriceX64(l.tick_lower),g=L.tickIndexToSqrtPriceX64(l.tick_upper),b=re.getCoinAmountFromLiquidity(new O(m),s,h,g,!0);return n=n.add(b.coinA.toString()),o=o.add(b.coinB.toString()),{...b,liquidity:m}}),c=[],u=[];return a.forEach((l,m)=>{const h={coinRatioA:n.eq(d(0))?0:d(l.coinA.toString()).div(n).toNumber(),coinRatioB:o.eq(d(0))?0:d(l.coinB.toString()).div(o).toNumber(),liquiditys:l.liquidity,tick_lower:t[m].tick_lower,tick_upper:t[m].tick_upper};i.push(h),c.push(n.eq(d(0))?0:d(l.coinA.toString()).div(n).toNumber()),u.push(o.eq(d(0))?0:d(l.coinB.toString()).div(o).toNumber())}),i}static calculateCloseMasterLiquidityInputs(e){const t=new O(L.tickIndexToSqrtPriceX64(e.curr_tick));return e.positions.map(i=>{const n=new O(i.liquidity),o=L.tickIndexToSqrtPriceX64(i.tick_lower_index),a=L.tickIndexToSqrtPriceX64(i.tick_upper_index),c=re.getCoinAmountFromLiquidity(n,t,o,a,!1),u=rt.fromDecimal(d(e.slippage).mul(100)),{tokenMaxA:l,tokenMaxB:m}=at(c,u,!1);return{coinAmountA:c.coinA,coinAmountB:c.coinB,tokenMaxA:l,tokenMaxB:m,liquidityAmount:n,fix_amount_a:!1}})}static calculateRemoveMasterLiquidityInputs(e){const t=new O(L.tickIndexToSqrtPriceX64(e.curr_tick)),{fix_token:s}=e;if(s){const n=e.positions.map((c,u)=>({tick_lower:c.tick_lower_index,tick_upper:c.tick_upper_index,ratio:e.ratios[u]})),o=de.calculateCoinRatios(e.curr_tick,n),a=e.positions.map((c,u)=>{const l=o[u],m=d(s.coin_amount).mul(s.fix_amount_a?l.coinRatioA:l.coinRatioB).toFixed(0).toString();try{const h=re.estLiquidityAndcoinAmountFromOneAmounts(c.tick_lower_index,c.tick_upper_index,new O(m),s.fix_amount_a,!1,e.slippage,t);return{...h,tick_lower:c.tick_lower_index,tick_upper:c.tick_upper_index,liquidity:h.liquidityAmount.toString(),ratio:e.ratios[u]}}catch{return{coinAmountA:new O(0),coinAmountB:new O(0),tokenMaxA:new O(0),tokenMaxB:new O(0),liquidityAmount:new O(0),fix_amount_a:!s.fix_amount_a,tick_lower:c.tick_lower_index,tick_upper:c.tick_upper_index,liquidity:"0",ratio:e.ratios[u]}}});return de.fixLiquidityInputs(t,e.slippage,a,!1)}return e.positions.map((n,o)=>{const a=e.ratios[o];let c=d(e.liquidity).mul(a).toFixed(0);d(c).greaterThan(n.liquidity)&&(c=n.liquidity);const u=L.tickIndexToSqrtPriceX64(n.tick_lower_index),l=L.tickIndexToSqrtPriceX64(n.tick_upper_index),m=re.getCoinAmountFromLiquidity(new O(c),t,u,l,!1),h=rt.fromDecimal(d(e.slippage).mul(100)),{tokenMaxA:g,tokenMaxB:b}=at(m,h,!1);return{coinAmountA:m.coinA,coinAmountB:m.coinB,tokenMaxA:g,tokenMaxB:b,liquidityAmount:new O(c),fix_amount_a:!1}})}static buildMasterPosition(e){return{coin_type_a:C(e.coin_type_a.fields.name).full_address,coin_type_b:C(e.coin_type_b.fields.name).full_address,description:e.description,id:e.id.id,index:e.index,liquidity:e.liquidity,name:e.name,pool:e.pool,tick_lower_index:Ce(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:Ce(BigInt(e.tick_upper_index.fields.bits)),url:e.url}}static buildMasterNFT(e){const t=j(e);if(t){const s={id:t.id.id,pool_id:t.pool_id,index:Number(t.index),strategy:Number(t.strategy),tick_lower_index:Ce(BigInt(t.tick_lower_index)),tick_upper_index:Ce(BigInt(t.tick_upper_index)),positions:[],...Tt(e)};return s.positions=t.positions.map(i=>de.buildMasterPosition(i.fields)),s}}},Ct=class{static get_lp_amount_by_liquidity(e,t){return e.total_supply==="0"?t:d(e.total_supply).mul(t).div(e.liquidity).toFixed(0,z.ROUND_DOWN).toString()}static get_share_liquidity_by_amount(e,t){return d(t).mul(e.liquidity).div(e.total_supply).toFixed(0,z.ROUND_DOWN).toString()}static get_protocol_fee_amount(e,t){return d(t).mul(e.protocol_fee_rate).div(lo).toFixed(0,z.ROUND_CEIL)}static buildPosition(e){return{coin_type_a:C(e.coin_type_a.fields.name).full_address,coin_type_b:C(e.coin_type_b.fields.name).full_address,description:e.description,id:e.id.id,index:e.index,liquidity:e.liquidity,name:e.name,pool:e.pool,tick_lower_index:Ce(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:Ce(BigInt(e.tick_upper_index.fields.bits)),url:e.url}}static buildPool(e){const t=j(e),s=Ke(e);if(t){const i={id:t.id.id,pool_id:t.pool,protocol_fee_rate:t.protocol_fee_rate,is_pause:t.is_pause,harvest_assets:{harvest_assets_handle:t.harvest_assets.fields.id.id,size:Number(t.harvest_assets.fields.size)},positins:[],lp_token_type:C(s).type_arguments[0],total_supply:t.lp_token_treasury.fields.total_supply.fields.value,liquidity:t.liquidity};return i.positins=t.positions.map(n=>Ct.buildPosition(n.fields)),i}}},_o=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e="all",t=!1){const{package_id:s}=this._sdk.sdkOptions.ido,i=`${s}_getPoolImmutables`,n=this.getCache(i,t),o={data:[],hasNextPage:!1},a=[];if(n!==void 0&&a.push(...n),a.length===0)try{const c=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${s}::oversubscribe_pool::CreatePoolEvent`},e);c.data.forEach(u=>{const l=u.parsedJson;if(l){const m=q.buildIdoPoolImmutables(l);a.push(m)}}),o.hasNextPage=c.hasNextPage,o.nextCursor=c.nextCursor,this.updateCache(i,a,P)}catch(c){console.log("getPoolImmutables",c)}return o.data=a,o}async getPools(e=[],t=!1){const s=[];let i=[];e.length>0?i=[...e]:(await this.getPoolImmutables("all",t)).data.forEach(a=>{i.push(a.pool_address)});const n=await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showType:!0,showContent:!0});for(const o of n){const a=q.buildIdoPool(o);await q.calculatePoolUiPrice(this._sdk,a),s.push(a);const c=`${a.pool_address}_getPoolObject`;this.updateCache(c,a,P)}return s}async getPool(e,t=!0){const s=`${e}_getPoolObject`,i=this.getCache(s,t);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),o=q.buildIdoPool(n);return await q.calculatePoolUiPrice(this._sdk,o),this.updateCache(s,o),o}async getIdoConfigs(e=!1){var u;const{package_id:t}=this._sdk.sdkOptions.ido,s=`${t}_getInitEvent`,i=this.getCache(s,e);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showPreviousTransaction:!0}}),o=es(n),a=(u=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({Transaction:o}))==null?void 0:u.data,c={pools_id:"",admin_cap_id:"",package_version_id:""};return a.length>0&&(a.forEach(l=>{console.log("item: ",l);const m=l.parsedJson;if(m)switch(C(l.type).full_address){case`${t}::config::InitConfigEvent`:c.admin_cap_id=m.admin_cap_id,c.package_version_id=m.package_version_id;break;case`${t}::factory::InitFactoryEvent`:c.pools_id=m.pools_id;break}}),this.updateCache(s,c,P)),c}async getPurchaseInfo(e,t,s=!0){const i=`${e}_${t}_getPurchaseInfo`,n=this.getCache(i,s);if(n)return n;try{const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"address",value:t}}),a=q.buildPurchaseInfo(j(o));return this.updateCache(i,a,he),a}catch{return}}async getLockNFT(e,t=!1){const s=`${e}_getLockNFT`,i=this.getCache(s,t);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(!n.error)return St(n)}async getLockNFTList(e){var n;const{clmm_pool:t}=this._sdk.ClmmSDK.sdkOptions,{ido:s}=this._sdk.sdkOptions,i=[];try{const o=(n=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{filter:{StructType:`${s.package_id}::lock::LockedNFT<${t.package_id}::position::Position>`},options:{showContent:!0}}))==null?void 0:n.data;for(const a of o){const c=j(a);if(c){const u=c.nft.fields,l={locked_at:Number(c.locked_at),lock_duration:Number(c.lock_duration),lock_nft_id:c.id.id,type:c.nft.type,...u};l.end_lock_time=l.locked_at+l.lock_duration,l.coin_type_a=C(u.coin_type_a.fields.name).full_address,l.coin_type_b=C(u.coin_type_b.fields.name).full_address,l.id=u.id.id,l.tick_lower_index=Ce(BigInt(u.tick_lower_index.fields.bits)),l.tick_upper_index=Ce(BigInt(u.tick_upper_index.fields.bits)),i.push(l)}}return i}catch(o){return console.log("getLockNFTList:",o),[]}}async creatPool(e){const{ido:t}=this.sdk.sdkOptions;Us(K(e.coin_type_sale),K(e.coin_type_raise))&&(e.price_min=d(1).div(e.price_max).toNumber(),e.price_max=d(1).div(e.price_min).toNumber());const i=G.priceRealToFix(Number(e.price),e.sale_decimals,e.raise_decimals),n=L.priceToSqrtPriceX64(d(e.price_min),e.sale_decimals,e.raise_decimals).toString(),o=L.priceToSqrtPriceX64(d(e.price_max),e.sale_decimals,e.raise_decimals).toString(),a=new v,c=d(e.total_supply).add(d(e.total_supply).mul(d(e.liquidity_injection_ratio))).toNumber(),u=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.coin_type_sale),l=H.buildCoinInputForAmount(a,u,BigInt(c),e.coin_type_sale,!1),m=[a.pure(p(t).admin_cap_id),a.pure(p(t).package_version_id),a.pure(p(t).pools_id),a.pure(K(e.owner)),a.pure(d(i).mul(tt).toString()),a.pure(e.total_supply),a.pure(e.complete_raise_limit),a.pure(e.min_purchase_amount),a.pure(e.max_purchase_amount),a.pure(e.start_time),a.pure(e.purchase_duration),a.pure(e.lock_up_duration),a.pure((e.liquidity_injection_ratio*$s).toString()),a.pure(n),a.pure(o),a.pure(e.tick_spacing.toString()),l.transactionArgument,a.pure(e.protection_hard_cap.toString()),a.pure(w)],h=[e.coin_type_sale,e.coin_type_raise];return a.moveCall({target:`${t.published_at}::${ro}::create_oversubscribe_pool`,typeArguments:h,arguments:m}),a}async creatPurchasePayload(e){const{ido:t}=this.sdk.sdkOptions,s=new v,i=await this.getPurchaseInfo(e.purchase_handle,this._sdk.ClmmSDK.senderAddress,!1),n=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.coin_type_raise),o=H.buildCoinInputForAmount(s,n,BigInt(e.raise_amount),e.coin_type_raise,!1),a=[e.coin_type_sale,e.coin_type_raise];let c,u;return i?(u="purchase",c=[s.object(p(t).package_version_id),s.object(e.pool_address),s.object(i.purchase_certificate_id),s.pure(e.raise_amount.toString()),o.transactionArgument,s.pure(w)]):(u="create_certificate_and_purchase",c=[s.object(p(t).package_version_id),s.object(e.pool_address),s.pure(e.raise_amount.toString()),o.transactionArgument,s.pure(w)]),s.moveCall({target:`${t.published_at}::${Z}::${u}`,typeArguments:a,arguments:c}),s}async redeemPayload(e){const{ido:t}=this.sdk.sdkOptions,s=await this.getPurchaseInfo(e.purchase_handle,this._sdk.ClmmSDK.senderAddress,!1);if(s===void 0)throw Error("get purchase certificate fail");const i=new v,n=[e.coin_type_sale,e.coin_type_raise],o=[i.pure(p(t).package_version_id),i.pure(e.pool_address),i.pure(s.purchase_certificate_id),i.pure(w)];return i.moveCall({target:`${t.published_at}::${Z}::redeem`,typeArguments:n,arguments:o}),i}injectLiquidityPayload(e){const{ido:t}=this.sdk.sdkOptions,{clmm_pool:s}=this.sdk.ClmmSDK.sdkOptions,i=new v,n=[e.coin_type_sale,e.coin_type_raise],o=e.is_reverse?"inject_liquidity_with_reverse_clmm_pool":"inject_liquidity_with_forward_clmm_pool",a=[i.pure(p(t).package_version_id),i.pure(e.pool_address),i.pure(p(s).global_config_id),i.pure(e.clmm_pool_address),i.pure(w)];return i.moveCall({target:`${t.published_at}::${Z}::${o}`,typeArguments:n,arguments:a}),i}unPauseInjectLiquidity(e){const{ido:t}=this.sdk.sdkOptions,{integrate:s,clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,n=new v;n.moveCall({target:`${s.published_at}::${Vs}::unpause_pool`,typeArguments:[e.coin_type_a,e.coin_type_b],arguments:[n.object(p(i).global_config_id),n.object(e.clmm_pool_address)]});const o=[e.coin_type_sale,e.coin_type_raise],a=e.is_reverse?"inject_liquidity_with_reverse_clmm_pool":"inject_liquidity_with_forward_clmm_pool",c=[n.object(p(t).package_version_id),n.object(e.pool_address),n.object(p(i).global_config_id),n.object(e.clmm_pool_address),n.object(w)];return n.moveCall({target:`${t.published_at}::${Z}::${a}`,typeArguments:o,arguments:c}),n}async findClmmPoolForLiquidity(e){let t=null,s=!1;const i=await this.sdk.ClmmSDK.Pool.getPoolImmutables();for(const n of i){if(n.coinTypeA===e.coin_type_sale&&n.coinTypeB===e.coin_type_raise&&Number(n.tickSpacing)===e.tick_spacing){t=await this._sdk.ClmmSDK.Pool.getPool(n.poolAddress);break}if(n.coinTypeA===e.coin_type_raise&&n.coinTypeB===e.coin_type_sale&&Number(n.tickSpacing)===e.tick_spacing){t=await this._sdk.ClmmSDK.Pool.getPool(n.poolAddress),s=!0;break}}return t&&(d(t.current_sqrt_price).lessThanOrEqualTo(e.current_sqrt_price_min)||d(t.current_sqrt_price).greaterThanOrEqualTo(e.current_sqrt_price_max))?(console.log("clmmPool: ",t.poolAddress),{is_reverse:s,clmmPool:null}):{is_reverse:s,clmmPool:t}}withdrawPayload(e){const{ido:t}=this.sdk.sdkOptions,s=new v,i=[e.coin_type_sale,e.coin_type_raise],n=[s.object(p(t).package_version_id),s.object(e.pool_address),s.object(w)];return s.moveCall({target:`${t.published_at}::${Z}::withdraw`,typeArguments:i,arguments:n}),s}updateWhitelistCapPayload(e){const{ido:t}=this.sdk.sdkOptions,s=new v,i=[e.coin_type_sale,e.coin_type_raise];return e.add_whites&&e.add_whites.addresses.length>0&&s.moveCall({target:`${t.published_at}::${Z}::add_white_listed_addresses`,typeArguments:i,arguments:[s.object(p(t).admin_cap_id),s.object(p(t).package_version_id),s.object(e.pool_address),s.makeMoveVec({type:"address",objects:e.add_whites.addresses.map(n=>s.pure(ie(n),"address"))}),s.pure(e.add_whites.protection_limit),s.object(w)]}),e.remove_whites&&e.remove_whites.length>0&&s.moveCall({target:`${t.published_at}::${Z}::remove_white_listed_addresses`,typeArguments:i,arguments:[s.object(p(t).admin_cap_id),s.object(p(t).package_version_id),s.object(e.pool_address),s.makeMoveVec({type:"address",objects:e.remove_whites.map(n=>s.pure(ie(n),"address"))}),s.object(w)]}),e.update_whites&&e.update_whites.forEach(n=>{s.moveCall({target:`${t.published_at}::${Z}::update_white_listed_address`,typeArguments:i,arguments:[s.object(p(t).admin_cap_id),s.object(p(t).package_version_id),s.object(e.pool_address),s.object(n.address),s.pure(n.protection_limit),s.object(w)]})}),s}creatCancelPoolPayload(e){const{ido:t}=this.sdk.sdkOptions,s=new v,i=[e.coin_type_sale,e.coin_type_raise],n=[s.pure(p(t).admin_cap_id),s.pure(p(t).package_version_id),s.pure(e.pool_address),s.pure(w)];return s.moveCall({target:`${t.published_at}::${Z}::cancel`,typeArguments:i,arguments:n}),s}updatePoolOwnerPayload(e,t){const{ido:s}=this.sdk.sdkOptions;t=t===void 0?new v:t;const i=[e.coin_type_sale,e.coin_type_raise],n=[t.object(p(s).admin_cap_id),t.object(p(s).package_version_id),t.object(e.pool_address),t.object(e.new_owner),t.object(w)];return t.moveCall({target:`${s.published_at}::${Z}::update_pool_owner`,typeArguments:i,arguments:n}),t}updatePoolDuractionPayload(e,t){const{ido:s}=this.sdk.sdkOptions;t=t===void 0?new v:t;const i=[e.coin_type_sale,e.coin_type_raise],n=[t.object(p(s).admin_cap_id),t.object(p(s).package_version_id),t.object(e.pool_address),t.pure(e.start_time),t.pure(e.purchase_duration),t.pure(e.lock_duration),t.object(w)];return t.moveCall({target:`${s.published_at}::${Z}::update_pool_duration`,typeArguments:i,arguments:n}),t}updateProtectionHardCapPayload(e,t){const{ido:s}=this.sdk.sdkOptions;t=t===void 0?new v:t;const i=[e.coin_type_sale,e.coin_type_raise],n=[t.object(p(s).admin_cap_id),t.object(p(s).package_version_id),t.object(e.pool_address),t.pure(e.protection_hard_cap),t.object(w)];return t.moveCall({target:`${s.published_at}::${Z}::update_protection_hard_cap`,typeArguments:i,arguments:n}),t}unlockNftPayload(e){const{ido:t}=this.sdk.sdkOptions,s=new v,i=[e.nft_type],n=[s.pure(e.lock_nft_id),s.pure(w)];return s.moveCall({target:`${t.published_at}::lock::unlock_nft`,typeArguments:i,arguments:n}),s}async isAdminCap(e){const{ido:t}=this._sdk.sdkOptions,s=`${t.package_id}_${e}_isAdminCap`,i=this.getCache(s);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:p(t).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(n);const o=Ke(n),a=ht(n);let c=!1;return a&&o&&C(o).source_address===`${t.package_id}::config::AdminCap`&&(c=K(a.AddressOwner)===K(e)),this.updateCache(s,c,P),c}async getWhiteProtectionLimit(e,t,s=!0){const i=`${e}_${t}_getWhiteProtectionLimit`,n=this._sdk.getCache(i,s);if(n)return n;try{const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"address",value:t}});if(o&&o.data){const a=j(o);return this._sdk.updateCache(i,a.value),a.value}return}catch{return}}async getWhiteList(e,t){var i;const s={type:"address",value:t};try{const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:s}),o=j(n);if(console.log(o),o)return(i=o==null?void 0:o.value)==null?void 0:i.fields}catch{}return{safe_limit_amount:"0",safe_purchased_amount:"0"}}async getAdminAddress(){const{ido:e}=this._sdk.sdkOptions,t=`${p(e).admin_cap_id}_getAdminAddress`,s=this.getCache(t);if(s)return s;const i=await this._sdk.ClmmSDK.fullClient.getObject({id:p(e).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(i);const n=Ke(i),o=ht(i);if(o&&n&&C(n).source_address===`${e.package_id}::config::AdminCap`){const c=K(o.AddressOwner);return this.updateCache(t,c,P),c}return""}updateCache(e,t,s=P){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}},po=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getOwnerVeNFT(e,t=!0){const{xtoken:s}=this.sdk.sdkOptions,i=`${e}_getLockUpManagerEvent`,n=this.getCache(i,t);if(n!==void 0)return n;let o;const a=`${s.package_id}::xtoken::VeNFT`;return(await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0},filter:{StructType:a}})).data.forEach(u=>{const l=C(Se(u)).source_address;if(l===a&&u.data&&u.data.content){const{fields:m}=u.data.content;o={...Tt(u),id:m.id.id,index:m.index,type:l,xtoken_balance:m.xtoken_balance},this.updateCache(i,o,P)}}),o}async getOwnerLockTokens(e){const{xtoken:t}=this.sdk.sdkOptions,s=[],i=`${t.package_id}::lock_coin::LockedCoin<${this.buileTokenCoinType()}>`,n=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0},filter:{StructType:i}});for(const o of n.data)if(C(Se(o)).source_address===i&&o.data){const c=je.buildLockToken(o.data.content),u=await this.getLockXToken(c.id);u&&(c.xtoken_amount=u.xtoken_amount),s.push(c)}return s}async getLockToken(e){var s;const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}});if((s=t.data)!=null&&s.content){const i=je.buildLockToken(t.data.content),n=await this.getLockXToken(i.id);return n&&(i.xtoken_amount=n.xtoken_amount),i}}async getOwnerTokenCoins(e){return await this._sdk.ClmmSDK.getOwnerCoinAssets(e,this.buileTokenCoinType())}mintVeNFTPayload(){const{xtoken:e}=this.sdk.sdkOptions,t=new v;return t.moveCall({target:`${e.published_at}::${Ee}::mint_venft`,typeArguments:[],arguments:[t.pure(p(e).xtoken_manager_id)]}),t}async convertPayload(e){const{xtoken:t}=this.sdk.sdkOptions,s=new v,i=this.buileTokenCoinType(),n=await H.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,s,BigInt(e.amount),i);return e.venft_id===void 0?s.moveCall({target:`${t.published_at}::${Ee}::mint_and_convert`,typeArguments:[],arguments:[s.object(p(t).lock_manager_id),s.object(p(t).xtoken_manager_id),n,s.pure(e.amount)]}):s.moveCall({target:`${t.published_at}::${Ee}::convert`,typeArguments:[],arguments:[s.object(p(t).lock_manager_id),s.object(p(t).xtoken_manager_id),n,s.pure(e.amount),s.pure(e.venft_id)]}),s}redeemLockPayload(e){const{xtoken:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${Ee}::redeem_lock`,typeArguments:[],arguments:[s.pure(p(t).lock_manager_id),s.pure(p(t).xtoken_manager_id),s.pure(e.venft_id),s.pure(e.amount),s.pure(e.lock_day),s.pure(w)]}),s}redeemPayload(e){const{xtoken:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${Ee}::redeem`,typeArguments:[],arguments:[s.pure(p(t).lock_manager_id),s.pure(p(t).xtoken_manager_id),s.pure(e.venft_id),s.pure(e.lock_id),s.pure(w)]}),s}redeemDividendPayload(e,t){const{xtoken_dividends:s}=this.sdk.sdkOptions,i=new v;return t.forEach(n=>{i.moveCall({target:`${s.published_at}::${pt}::redeem`,typeArguments:[n],arguments:[i.object(p(s).dividend_manager_id),i.object(e)]})}),i}redeemDividendV2Payload(e,t,s){const{xtoken_dividends:i}=this.sdk.sdkOptions;let n=new v;return t.filter(a=>s.includes(a)).length>0&&(n=this.redeemDividendXTokenPayload(e,n)),t.forEach(a=>{s.includes(a)||n.moveCall({target:`${i.published_at}::${pt}::redeem_v2`,typeArguments:[a],arguments:[n.object(p(i).dividend_manager_id),n.object(e),n.object(w)]})}),n}redeemDividendXTokenPayload(e,t){const{xtoken_dividends:s,xtoken:i}=this.sdk.sdkOptions,{xtoken_manager_id:n,lock_manager_id:o}=p(i),{dividend_manager_id:a}=p(s);return t=t===void 0?new v:t,t.moveCall({target:`${s.published_at}::${pt}::redeem_xtoken`,typeArguments:[],arguments:[t.object(o),t.object(n),t.object(a),t.object(e),t.object(w)]}),t}buileTokenCoinType(){return`${this.sdk.sdkOptions.token_faucet.package_id}::token::TOKEN`}buileXTokenCoinType(e=this._sdk.sdkOptions.xtoken.package_id,t="xtoken",s="XTOKEN"){return`${e}::${t}::${s}`}cancelRedeemPayload(e){const{xtoken:t}=this.sdk.sdkOptions,s=new v;return s.moveCall({target:`${t.published_at}::${Ee}::cancel_redeem_lock`,typeArguments:[],arguments:[s.pure(p(t).lock_manager_id),s.pure(p(t).xtoken_manager_id),s.pure(e.venft_id),s.pure(e.lock_id),s.pure(w)]}),s}async getInitConfigs(){var a,c;const{package_id:e}=this.sdk.sdkOptions.xtoken,t=`${e}_getInitFactoryEvent`,s=this.getCache(t);if(s!==void 0)return s;const i=(a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::xtoken::InitEvent`}))==null?void 0:a.data,n={xtoken_manager_id:"",lock_manager_id:"",lock_handle_id:""};i.length>0&&i.forEach(u=>{const l=u.parsedJson;l&&(n.xtoken_manager_id=l.xtoken_manager)});const o=(c=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::locking::InitializeEvent`}))==null?void 0:c.data;return o.length>0&&o.forEach(u=>{const l=u.parsedJson;l&&(n.lock_manager_id=l.lock_manager)}),n.lock_handle_id=(await this.getLockUpManager(n.lock_manager_id)).lock_infos.lock_handle_id,this.updateCache(t,n,P),n}async getLockUpManager(e=p(this.sdk.sdkOptions.xtoken).lock_manager_id,t=!1){const s=`${e}_getLockUpManagerEvent`,i=this.getCache(s,t);if(i!==void 0)return i;const n=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),o=je.buildLockUpManager(j(n));return this.updateCache(s,o,P),o}async getLockInfoHandle(e){const t=`${e}_getLockInfoHandle`,s=this.getCache(t);if(s!==void 0)return s;let i="";const n=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),o=j(n);return o&&(i=o.lock_infos.fields.id.id,this.updateCache(t,i,P)),i}async getDividendConfigs(){var o;const{package_id:e}=this.sdk.sdkOptions.xtoken_dividends,t=`${e}_getDividendManagerEvent`,s=this.getCache(t);if(s!==void 0)return s;const i=(o=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::dividend::InitEvent`}))==null?void 0:o.data,n={dividend_manager_id:"",dividend_admin_id:"",dividend_settle_id:""};return i.length>0&&i.forEach(a=>{const c=a.parsedJson;c&&(n.dividend_manager_id=c.manager_id,n.dividend_admin_id=c.admin_id,n.dividend_settle_id=c.settle_id,this.updateCache(t,n,P))}),n}async getDividendManager(e=!1){const{dividend_manager_id:t}=p(this.sdk.sdkOptions.xtoken_dividends),s=`${t}_getDividendManager`,i=this.getCache(s,e);if(i!==void 0)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),o=j(n),a=je.buildDividendManager(o);return this.updateCache(s,a,P),a}async getXcetusManager(e=!0){const{xtoken_manager_id:t}=p(this.sdk.sdkOptions.xtoken),s=`${t}_getXcetusManager`,i=this.getCache(s,e);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),o=j(n),a={id:o.id.id,index:Number(o.index),has_venft:{handle:o.has_venft.fields.id.id,size:o.has_venft.fields.size},nfts:{handle:o.nfts.fields.id.id,size:o.nfts.fields.size},total_locked:o.total_locked,treasury:o.treasury.fields.total_supply.fields.value};return this.updateCache(s,a),a}async getVeNFTDividendInfo(e,t){try{const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=j(s);return je.buildVeNFTDividendInfo(i)}catch{return}}async redeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const s=await this.getLockUpManager(),i=d(Q).mul(d(s.max_lock_day).sub(d(t))).mul(d(s.max_percent_numerator).sub(d(s.min_percent_numerator))).div(d(s.max_lock_day).sub(d(s.min_lock_day))),n=d(Q).mul(d(s.max_percent_numerator)).sub(i).div(d(ot)).div(Q);return{amountOut:d(n).mul(d(e)).round().toString(),percent:n.toString()}}async reverseRedeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const s=await this.getLockUpManager(),i=d(Q).mul(d(s.max_lock_day).sub(d(t))).mul(d(s.max_percent_numerator).sub(d(s.min_percent_numerator))).div(d(s.max_lock_day).sub(d(s.min_lock_day))),n=d(Q).mul(d(s.max_percent_numerator)).sub(i).div(d(ot)).div(Q);return{amountOut:d(e).div(n).toFixed(0,z.ROUND_UP),percent:n.toString()}}async getLockXToken(e){const{lock_handle_id:t}=p(this._sdk.sdkOptions.xtoken),s=`${e}_getXTokenAmount`,i=this.getCache(s);if(i)return i;try{const n=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"0x2::object::ID",value:e}}),o=j(n);if(o){const a=o.value.fields.value.fields;return this.updateCache(s,a,P),a}}catch{}}async getVeNftAmount(e,t){try{const s=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),i=j(s);if(i){const{lock_amount:n,xtoken_amount:o}=i.value.fields.value.fields;return{lock_amount:n,xtoken_amount:o}}}catch{}return{lock_amount:"0",xtoken_amount:"0"}}async getPhaseDividendInfo(e,t=!1){const i=(await this.getDividendManager()).dividends.id,n=`${i}_${e}_getPhaseDividendInfo`,o=this._sdk.getCache(n,t);if(o)return o;try{const a=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:i,name:{type:"u64",value:e}}),c=j(a),u=c.value.fields.value.fields,l=u.redeemed_num.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),m=u.bonus_types.map(b=>b.fields.name),h=u.bonus.fields.contents.map(b=>({name:b.fields.key.fields.name,value:b.fields.value})),g={id:qe(a),phase:c.name,settled_num:u.settled_num,register_time:u.register_time,redeemed_num:l,is_settled:u.is_settled,bonus_types:m,bonus:h,phase_end_time:""};return this.updateCache(n,g),g}catch{}}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}},mo=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async addMasterLiquidity(e){var N,M;const{liquidity_stratefy:t}=this._sdk.sdkOptions,{clmm_pool:s}=this._sdk.ClmmSDK.sdkOptions,i=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);let n=d(0),o=d(0);const a=[],c=[],u=[],l=[],m=[];e.liquidity_bins.forEach((D,Y)=>{const fe=e.amounts_a[Y],ae=e.amounts_b[Y],ye=e.bins_fix_amount_a[Y];n=n.add(fe),o=o.add(ae),a.push(fe),c.push(ae),u.push(ze(BigInt(D.tick_lower)).toString()),l.push(ze(BigInt(D.tick_upper)).toString()),m.push(ye)});const h=[e.coinTypeA,e.coinTypeB],g=new v,b=(N=H.buildAddLiquidityFixTokenCoinInput(g,!e.fix_amount_a,n.toString(),e.slippage,e.coinTypeA,i,!1))==null?void 0:N.transactionArgument,E=(M=H.buildAddLiquidityFixTokenCoinInput(g,e.fix_amount_a,o.toString(),e.slippage,e.coinTypeB,i,!1))==null?void 0:M.transactionArgument;return co(e)?g.moveCall({target:`${t.published_at}::router::increase_liquidity`,typeArguments:h,arguments:[g.object(p(t).master_manger_id),g.object(e.master_address),g.object(p(s).global_config_id),g.object(e.pool_address),b,E,g.makeMoveVec({type:"u64",objects:a.map(D=>g.pure(D,"u64"))}),g.makeMoveVec({type:"u64",objects:c.map(D=>g.pure(D,"u64"))}),g.makeMoveVec({type:"bool",objects:m.map(D=>g.pure(D,"bool"))}),g.object(w)]}):g.moveCall({target:`${t.published_at}::router::create_master_liquidity`,typeArguments:h,arguments:[g.object(p(t).master_manger_id),g.object(p(s).global_config_id),g.object(e.pool_address),b,E,g.makeMoveVec({type:"u32",objects:u.map(D=>g.pure(D,"u32"))}),g.makeMoveVec({type:"u32",objects:l.map(D=>g.pure(D,"u32"))}),g.makeMoveVec({type:"u64",objects:a.map(D=>g.pure(D,"u64"))}),g.makeMoveVec({type:"u64",objects:c.map(D=>g.pure(D,"u64"))}),g.makeMoveVec({type:"bool",objects:m.map(D=>g.pure(D,"bool"))}),g.pure(e.strategy),g.pure(ze(BigInt(e.tick_lower)).toString()),g.pure(ze(BigInt(e.tick_upper)).toString()),g.object(w)]}),g}buildMasterNFTType(){return`${this._sdk.sdkOptions.liquidity_stratefy.package_id}::master_liquidity::MasterLiquidity`}async getMasterNFTList(e,t=[]){const s=[],i=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0},filter:{Package:this._sdk.sdkOptions.liquidity_stratefy.package_id}}),n=t.length>0;for(const o of i.data)if(C(o.data.type).full_address===this.buildMasterNFTType()){const c=de.buildMasterNFT(o);if(c){const u=`${c.id}_masterNFT`;this.updateCache(u,c,P),n?t.includes(c.pool_id)&&s.push(c):s.push(c)}}return s}async getMasterNFT(e,t=!1){const s="$masterId}_masterNFT",i=this.getCache(s,t);if(i)return i;try{const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(C(n.data.type).full_address===this.buildMasterNFTType()){const a=de.buildMasterNFT(n);return a&&this.updateCache(s,a,P),a}}catch(n){console.log(n)}}async fetchMasterPositionInfos(e){var c;const t={},{clmm_pool:s,integrate:i,simulationAccount:n}=this.sdk.ClmmSDK.sdkOptions,o=new v;return e.forEach(u=>{u.position_ids.forEach(l=>{const m=[u.coinTypeA,u.coinTypeB],h=[o.object(p(s).global_config_id),o.object(u.pool_id),o.object(l)];o.moveCall({target:`${i.published_at}::${Ne}::fetch_position_fees`,arguments:h,typeArguments:m}),o.moveCall({target:`${i.published_at}::${Ne}::fetch_position_rewards`,arguments:[...h,o.object(w)],typeArguments:m})})}),(c=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:o,sender:n.address})).events)==null||c.forEach(u=>{const{parsedJson:l}=u,{position_id:m}=l;let h=t[m];switch(h===void 0&&(h={position_id:m,feeOwedA:"0",feeOwedB:"0",rewarders:[]},t[m]=h),C(u.type).name){case"FetchPositionFeesEvent":h.feeOwedA=l.fee_owned_a,h.feeOwedB=l.fee_owned_b;break;case"FetchPositionRewardsEvent":h.rewarders=l.data;break}}),t}async getLiquidityStrategyConfigs(e=!1){const{package_id:t}=this._sdk.sdkOptions.liquidity_stratefy,s=`${t}_getLiquidityStrategyConfigst`,i=this.getCache(s,e);if(i!==void 0)return i;const n=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::master_liquidity::MasterLiquidityManagerCreatedEvent`})).data,o={master_manger_id:"",master_liquidity_handle:""};if(n.length>0){for(const a of n){const c=a.parsedJson;o.master_manger_id=c.id;const u=await this._sdk.ClmmSDK.fullClient.getObject({id:c.id,options:{showContent:!0}}),l=j(u);o.master_liquidity_handle=l.position_maps.fields.id.id;break}this.updateCache(s,o,P)}return o}removeMasterLiquidity(e){const{clmm_pool:t}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:s}=this.sdk.sdkOptions,i=new v,n=[e.coinTypeA,e.coinTypeB];this.collectReward({coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collect_fee:!1,rewarder_coin_types:e.rewarder_coin_types,master_address:e.master_address,pool_address:e.pool_address},i);const o=[i.object(p(s).master_manger_id),i.object(e.pool_address),i.object(e.master_address),i.object(p(t).global_config_id),i.makeMoveVec({type:"u128",objects:e.delta_liquidities.map(a=>i.pure(a,"u128"))}),i.makeMoveVec({type:"u64",objects:e.min_amounts_a.map(a=>i.pure(a,"u64"))}),i.makeMoveVec({type:"u64",objects:e.min_amounts_b.map(a=>i.pure(a,"u64"))}),i.object(w)];return i.moveCall({target:`${s.published_at}::${Ze}::remove_liquidity`,typeArguments:n,arguments:o}),i}closeMasterLiquidity(e){const{clmm_pool:t}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:s}=this.sdk.sdkOptions,i=new v,n=[e.coinTypeA,e.coinTypeB];return this.collectReward({coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collect_fee:!1,rewarder_coin_types:e.rewarder_coin_types,master_address:e.master_address,pool_address:e.pool_address},i),i.moveCall({target:`${s.published_at}::${Ze}::close_master_liquidity`,typeArguments:n,arguments:[i.object(p(s).master_manger_id),i.object(e.master_address),i.object(p(t).global_config_id),i.object(e.pool_address),i.makeMoveVec({type:"u64",objects:e.min_amounts_a.map(o=>i.pure(o,"u64"))}),i.makeMoveVec({type:"u64",objects:e.min_amounts_b.map(o=>i.pure(o,"u64"))}),i.object(w)]}),i}collectFee(e,t){const{clmm_pool:s}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:i}=this.sdk.sdkOptions;t=t===void 0?new v:t;const n=[e.coinTypeA,e.coinTypeB],o=[t.object(p(i).master_manger_id),t.object(e.master_address),t.object(p(s).global_config_id),t.object(e.pool_address)];return t.moveCall({target:`${i.published_at}::${Ze}::collect_fee`,typeArguments:n,arguments:o}),t}collectReward(e,t){const{clmm_pool:s}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:i}=this.sdk.sdkOptions;return t=t===void 0?new v:t,e.collect_fee&&this.collectFee({...e},t),e.rewarder_coin_types.forEach(n=>{const o=[e.coinTypeA,e.coinTypeB,n];if(t){const a=[t.object(p(i).master_manger_id),t.object(e.master_address),t.object(p(s).global_config_id),t.object(e.pool_address),t.object(p(s).global_vault_id),t.object(w)];t.moveCall({target:`${i.published_at}::${Ze}::collect_reward`,typeArguments:o,arguments:a})}}),t}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e],i=s==null?void 0:s.isValid();if(!t&&i)return s.value;i||delete this._cache[e]}},ho=class{constructor(e){$(this,"_sdk");$(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}buildCoinInput(e,t,s,i,n){const{selectedCoins:o,remainingCoins:a}=Me.selectCoinAssetGreaterThanOrEqual(t,BigInt(i)),c=Me.calculateTotalBalance(o);if(c<BigInt(i))throw new Error(`The amount(${c}) is Insufficient balance for ${s} , expect ${i} `);const u=c-BigInt(i);let l;if(Me.isSuiCoin(s))l=e.splitCoins(e.gas,[e.pure(i)]);else{const[m,...h]=o.map(g=>g.coinObjectId);l=e.object(m),h.length>0?n?e.mergeCoins(l,[...h.map(g=>e.object(g)),n]):e.mergeCoins(l,[...h.map(g=>e.object(g))]):n&&e.mergeCoins(l,[n])}return{selectedUsedAmount:u,coinInput:l,remainingCoins:a}}async deposit(e){var l,m;console.log({params:e});const{vaults:t}=this._sdk.sdkOptions,{clmm_pool:s,integrate:i}=this._sdk.ClmmSDK.sdkOptions,n=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress),o=new v;let a,c;if(e.swapParams){const{swap_amount:h,a2b:g}=e.swapParams,b=g?e.coinTypeA:e.coinTypeB,E=Me.getCoinAssets(b,n),{coinInput:N,remainingCoins:M,selectedUsedAmount:D}=this.buildCoinInput(o,E,b,BigInt(h)),Y=H.moveCallCoinZero(o,g?e.coinTypeB:e.coinTypeA),fe=Kt.getDefaultSqrtPriceLimit(g).toString(),ae=o.moveCall({target:`${i.published_at}::${qt}::swap`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[o.object(p(s).global_config_id),o.object(e.clmm_pool),g?N:Y,g?Y:N,o.pure(g),o.pure(!0),o.pure(h),o.pure(fe),o.pure(!1),o.object(w)]}),ye=g?ae[0]:ae[1],Lt=g?ae[1]:ae[0];if(console.log({selectedUsedAmount:D}),g){c=Lt;const Xe=BigInt(e.amount_a)-D;d(Xe.toString()).greaterThan(0)?a=this.buildCoinInput(o,M,b,Xe,ye).coinInput:a=ye}else{a=Lt;const Xe=BigInt(e.amount_b)-D;d(Xe.toString()).greaterThan(0)?c=this.buildCoinInput(o,M,b,BigInt(e.amount_b)-D,ye).coinInput:c=ye}}else a=(l=H.buildAddLiquidityFixTokenCoinInput(o,!e.fix_amount_a,e.amount_a,e.slippage,e.coinTypeA,n,!1))==null?void 0:l.transactionArgument,c=(m=H.buildAddLiquidityFixTokenCoinInput(o,e.fix_amount_a,e.amount_b,e.slippage,e.coinTypeB,n,!1))==null?void 0:m.transactionArgument;const u=e.rewarder_coin_types?e.rewarder_coin_types.length:0;if(u>0){const h=["deposit_with_one","deposit_with_two","deposit_with_three"];o.moveCall({target:`${t.published_at}::${mt}::${h[u-1]}`,typeArguments:[e.coinTypeA,e.coinTypeB,...e.rewarder_coin_types,e.lp_token_type],arguments:[o.object(p(t).vaults_manager_id),o.object(e.vault_id),o.object(p(s).global_config_id),o.object(e.clmm_pool),o.object(p(s).global_vault_id),a,c,o.pure(e.amount_a),o.pure(e.amount_b),o.pure(e.fix_amount_a),o.object(w)]})}else o.moveCall({target:`${t.published_at}::${mt}::deposit`,typeArguments:[e.coinTypeA,e.coinTypeB,e.lp_token_type],arguments:[o.object(p(t).vaults_manager_id),o.object(e.vault_id),o.object(p(s).global_config_id),o.object(e.clmm_pool),a,c,o.pure(e.amount_a),o.pure(e.amount_b),o.pure(e.fix_amount_a),o.object(w)]});return o}async remove(e){var l;console.log({params:e});const{vaults:t}=this.sdk.sdkOptions,{clmm_pool:s,integrate:i}=this._sdk.ClmmSDK.sdkOptions,n=new v,o=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.lp_token_type),a=(l=H.buildCoinInputForAmount(n,o,BigInt(e.lp_token_amount),e.lp_token_type,!1))==null?void 0:l.transactionArgument,c=[e.coinTypeA,e.coinTypeB,e.lp_token_type],u=e.rewarder_coin_types.length;if(u>0){const m=["remove_with_one","remove_with_two","remove_with_three"];n.moveCall({target:`${t.published_at}::${mt}::${m[u-1]}`,typeArguments:[e.coinTypeA,e.coinTypeB,...e.rewarder_coin_types,e.lp_token_type],arguments:[n.object(p(t).vaults_manager_id),n.object(e.vault_id),n.object(p(s).global_config_id),n.object(e.clmm_pool),n.object(p(s).global_vault_id),a,n.pure(e.lp_token_amount),n.pure(e.min_amount_a),n.pure(e.min_amount_b),n.object(w)]})}else{const m=n.moveCall({target:`${t.published_at}::${uo}::remove`,typeArguments:c,arguments:[n.object(p(t).vaults_manager_id),n.object(e.vault_id),n.object(p(s).global_config_id),n.object(e.clmm_pool),a,n.pure(e.lp_token_amount),n.pure(e.min_amount_a),n.pure(e.min_amount_b),n.object(w)]}),h=m[0],g=m[1];if(e.swapParams){const{a2b:b,swap_amount:E}=e.swapParams,N=Kt.getDefaultSqrtPriceLimit(b).toString(),M=n.moveCall({target:`${i.published_at}::${qt}::swap`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[n.object(p(s).global_config_id),n.object(e.clmm_pool),h,g,n.pure(b),n.pure(!0),n.pure(E),n.pure(N),n.pure(!0),n.object(w)]});n.transferObjects([M[0],M[1]],n.object(this._sdk.ClmmSDK.senderAddress))}else n.transferObjects([h,g],n.object(this._sdk.ClmmSDK.senderAddress))}return n}async getVaultList(e="all"){const{vaults:t}=this._sdk.sdkOptions,s=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t.package_id}::vaults::CreateEvent`},e),i=s.data.map(a=>a.parsedJson.id),n=await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}),o=[];return n.forEach(a=>{const c=Ct.buildPool(a);c&&(this.savePoolToCache(c),o.push(c))}),s.data=o,s}savePoolToCache(e){const t=`${e.id}_mirrorPool`;this.updateCache(t,e,P)}readPoolFromCache(e,t=!1){const s=`${e}_mirrorPool`;return this.getCache(s,t)}async calculateMaxAvailable(e){var N;const{integrate:t,simulationAccount:s}=this.sdk.ClmmSDK.sdkOptions,i=new v,n=L.tickIndexToSqrtPriceX64(e.lowerTick),o=L.tickIndexToSqrtPriceX64(e.upperTick),a=new O(e.curSqrtPrice),c=re.getCoinAmountFromLiquidity(new O(e.input_amount),a,n,o,!1),u=[e.coinTypeA,e.coinTypeB];i.moveCall({target:`${t.published_at}::${Ne}::calculate_swap_result`,arguments:[i.object(e.clmm_pool),i.pure(!0),i.pure(!0),i.pure(c.coinA.toString())],typeArguments:u}),i.moveCall({target:`${t.published_at}::${Ne}::calculate_swap_result`,arguments:[i.object(e.clmm_pool),i.pure(!1),i.pure(!0),i.pure(c.coinB.toString())],typeArguments:u});const m=(N=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:i,sender:s.address})).events)==null?void 0:N.filter(M=>C(M.type).name==="CalculatedSwapResultEvent");if(m.length===0)return null;const h=m[0].parsedJson.data,g=m[1].parsedJson.data,b=d(c.coinB.toString()).add(h.amount_out),E=d(c.coinA.toString()).add(g.amount_out);return{maxAmountB:b,maxAmountA:E}}async calculateRemoveSwapAmount(e){var Y;const{ratioA:t,ratioB:s}=re.calculateDepositRatioFixTokenA(e.lowerTick,e.upperTick,new O(e.curSqrtPrice)),i=d(e.receive_amount).mul(e.fix_amount_a?t:s),n=d(e.receive_amount).sub(i);console.log({receiveAmount:i,otherReceiveAmount:n});const o=re.estLiquidityAndcoinAmountFromOneAmounts(e.lowerTick,e.upperTick,new O(i.toFixed(0)),e.fix_amount_a,!1,.2,new O(e.curSqrtPrice)),a=e.fix_amount_a?o.coinAmountB.toString():o.coinAmountA.toString();console.log({otherSideAmount:a});const{integrate:c,simulationAccount:u}=this.sdk.ClmmSDK.sdkOptions,l=new v,m=!e.fix_amount_a,h=[l.pure(e.clmm_pool),l.pure(m),l.pure(!0),l.pure(a)],g=[e.coinTypeA,e.coinTypeB];l.moveCall({target:`${c.published_at}::${Ne}::calculate_swap_result`,arguments:h,typeArguments:g});const E=(Y=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:l,sender:u.address})).events)==null?void 0:Y.filter(fe=>C(fe.type).name==="CalculatedSwapResultEvent");if(E.length===0)return null;const{data:N}=E[0].parsedJson,M=N.amount_in&&N.fee_amount?new O(N.amount_in).add(new O(N.fee_amount)).toString():"0",D=N.amount_out;return{swapInAmount:M,swapOutAmount:D,liquidity:o.liquidityAmount.toString()}}async calculateDepositSwapAmount(e){var ae;const{ratioA:t,ratioB:s}=re.calculateDepositRatioFixTokenA(e.lowerTick,e.upperTick,new O(e.curSqrtPrice)),i=d(e.input_amount).mul(e.fix_amount_a?t:s),n=d(e.input_amount).sub(i),o=e.fix_amount_a?i:n,a=e.fix_amount_a?n:i,c=e.fix_amount_a,u=e.fix_amount_a?a:o;if(console.log({token_a_amount:o,token_b_amount:a,amount:u}),u.toFixed(0)==="0")return null;const{integrate:l,simulationAccount:m}=this.sdk.ClmmSDK.sdkOptions,h=new v,g=[e.coinTypeA,e.coinTypeB],b=[h.pure(e.clmm_pool),h.pure(c),h.pure(!0),h.pure(u.toFixed(0))];h.moveCall({target:`${l.published_at}::${Ne}::calculate_swap_result`,arguments:b,typeArguments:g});const N=(ae=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:h,sender:m.address})).events)==null?void 0:ae.filter(ye=>C(ye.type).name==="CalculatedSwapResultEvent");if(N.length===0)return null;const{data:M}=N[0].parsedJson,D=M.amount_in&&M.fee_amount?new O(M.amount_in).add(new O(M.fee_amount)).toString():"0",Y=M.amount_out,fe=M.after_sqrt_price;return{swapInAmount:D,swapOutAmount:Y,afterSqrtPrice:fe}}async getVault(e,t=!1){const s=this.readPoolFromCache(e,t);if(s)return s;try{const i=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}}),n=Ct.buildPool(i);if(n)return this.savePoolToCache(n),n}catch(i){console.log(i)}}async getVaultsConfigs(e=!1){const{package_id:t}=this._sdk.sdkOptions.vaults,s=`${t}_getMirrorPoolConfigs`,i=this.getCache(s,e);if(i!==void 0)return i;const n=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::vaults::InitEvent`})).data,o={admin_cap_id:"",vaults_manager_id:"",vaults_pool_handle:""};if(n.length>0){for(const a of n){const c=a.parsedJson;o.admin_cap_id=c.admin_cap_id,o.vaults_manager_id=c.manager_id;const u=await this._sdk.ClmmSDK.fullClient.getObject({id:o.vaults_manager_id,options:{showContent:!0}}),l=j(u);o.vaults_pool_handle=l.vault_to_pool_maps.fields.id.id;break}this.updateCache(s,o,P)}return o}updateCache(e,t,s=he){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e],i=s==null?void 0:s.isValid();if(!t&&i)return s.value;i||delete this._cache[e]}},vo=class{constructor(e,t){$(this,"_cache",{});$(this,"_sdkOptions");$(this,"_launchpad");$(this,"_ido");$(this,"_xcetusModule");$(this,"_xtokenModule");$(this,"_boosterModule");$(this,"_makerModule");$(this,"_clmmSDK");$(this,"_liquidityStrategy");$(this,"_vaults");this._sdkOptions=e,this._clmmSDK=t,this._launchpad=new no(this),this._ido=new _o(this),this._xcetusModule=new ao(this),this._xtokenModule=new po(this),this._boosterModule=new io(this),this._makerModule=new oo(this),this._vaults=new ho(this),this._liquidityStrategy=new mo(this),Ks(this._sdkOptions)}get ClmmSDK(){return this._clmmSDK}get sdkOptions(){return this._sdkOptions}get Launchpad(){return this._launchpad}get Ido(){return this._ido}get XToken(){return this._xtokenModule}get XCetusModule(){return this._xcetusModule}get BoosterModule(){return this._boosterModule}get MakerModule(){return this._makerModule}get LiquidityStrategy(){return this._liquidityStrategy}get Vaults(){return this._vaults}updateCache(e,t,s=P){let i=this._cache[e];i?(i.overdueTime=F(s),i.value=t):i=new ge(t,F(s)),this._cache[e]=i}getCache(e,t=!1){const s=this._cache[e];if(!t&&(s!=null&&s.isValid()))return s.value;delete this._cache[e]}};export{vo as C,q as I,Ct as V,Pe as X,bo as a};
