var Cn=Object.defineProperty;var vn=(e,t,i)=>t in e?Cn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var F=(e,t,i)=>(vn(e,typeof t!="symbol"?t+"":t,i),i);import{Q as U,R as Sn,S as Tn,U as Pt,V as An,b as g}from"./pool.236a9f78.js";import{s as u,f as K,o as f,g as N,l as O,h as dt,i as fe,j as X,k as E,m as k,p as De,q as lt,t as Ii,v as A,w as oe,x as he,y as Ee,z as Pn,A as Vt,B as jn,C as In}from"./sha256.d032a5e8.js";import{D as $}from"./decimal.0bdeb344.js";const Oi=32;function Di(e){return On(e)&&Dn(e)===Oi}function Y(e,t=!1){let i=e.toLowerCase();return!t&&i.startsWith("0x")&&(i=i.slice(2)),`0x${i.padStart(Oi*2,"0")}`}function ue(e,t=!1){return Y(e,t)}function On(e){return/^(0x|0X)?[a-fA-F0-9]+$/.test(e)&&e.length%2===0}function Dn(e){return/^(0x|0X)/.test(e)?(e.length-2)/2:e.length/2}BigInt(1e9);ue("0x6");ue("0x5");u();u();u();u();u();u();const ze=K([f({AddressOwner:u()}),f({ObjectOwner:u()}),f({Shared:f({initial_shared_version:N(u())})}),O("Immutable")]),Bn=dt("SuiJsonValue",()=>!0),En=K([f({u32:u()}),f({u64:u()}),f({f64:u()})]);f({attributes:fe(u(),N(En)),featureFlags:fe(u(),X()),maxSupportedProtocolVersion:u(),minSupportedProtocolVersion:u(),protocolVersion:u()});K([u(),O("package")]);const be=f({digest:u(),objectId:u(),version:K([E(),u()])}),Nn=f({payment:k(be),owner:u(),price:u(),budget:u()}),Mn=De(be,f({type:u(),owner:ze,previousTransaction:u()})),xn=fe(u(),lt()),Rn=fe(u(),Ii()),Fn=f({type:u(),fields:xn,hasPublicTransfer:X()}),Gt=f({disassembled:Rn}),qn=K([De(Fn,f({dataType:O("moveObject")})),De(Gt,f({dataType:O("package")}))]),$n=f({type:u(),hasPublicTransfer:X(),version:u(),bcsBytes:u()}),Ln=f({id:u(),moduleMap:fe(u(),u())}),Kn=K([De($n,f({dataType:O("moveObject")})),De(Ln,f({dataType:O("package")}))]);BigInt(1e9);u();const Bi=f({code:u(),error:A(u()),object_id:A(u()),parent_object_id:A(u()),version:A(u()),digest:A(u())}),Un=f({data:N(A(fe(u(),u()))),error:N(A(Bi))}),Vn=K([Un,A(fe(u(),u()))]),Ei=f({objectId:u(),version:u(),digest:u(),type:N(A(u())),content:N(A(qn)),bcs:N(A(Kn)),owner:N(A(ze)),previousTransaction:N(A(u())),storageRebate:N(A(u())),display:N(A(Vn))});f({showType:N(A(X())),showContent:N(A(X())),showBcs:N(A(X())),showOwner:N(A(X())),showPreviousTransaction:N(A(X())),showStorageRebate:N(A(X())),showDisplay:N(A(X()))});K([O("Exists"),O("notExists"),O("Deleted")]);k(Mn);const Gn=f({data:N(A(Ei)),error:N(A(Bi))});function Xn(e){return e.data}function zn(e){if(e.error&&"object_id"in e.error&&"version"in e.error&&"digest"in e.error){const t=e.error;return{objectId:t.object_id,version:t.version,digest:t.digest}}}function Wn(e){if("reference"in e)return e.reference;const t=Xn(e);return t?{objectId:t.objectId,version:t.version,digest:t.digest}:zn(e)}f({objectId:u(),atCheckpoint:A(E())});f({data:k(Gn),nextCursor:A(N(u())),hasNextPage:X()});K([f({details:Ei,status:O("VersionFound")}),f({details:u(),status:O("ObjectNotExists")}),f({details:be,status:O("ObjectDeleted")}),f({details:oe([u(),E()]),status:O("VersionNotFound")}),f({details:f({asked_version:E(),latest_version:E(),object_id:u()}),status:O("VersionTooHigh")})]);const Ni=f({txDigest:u(),eventSeq:u()}),Mi=f({id:Ni,packageId:u(),transactionModule:u(),sender:u(),type:u(),parsedJson:A(fe(u(),lt())),bcs:A(u()),timestampMs:A(u())});f({data:k(Mi),nextCursor:N(Ni),hasNextPage:X()});u();const Jn=f({epoch:u(),storage_charge:u(),computation_charge:u(),storage_rebate:u(),epoch_start_timestamp_ms:A(u())}),Hn=f({epoch:u(),round:u(),commit_timestamp_ms:u()}),Zn=f({objects:k(u())}),ye=K([O("GasCoin"),f({Input:E()}),f({Result:E()}),f({NestedResult:oe([E(),E()])})]),Yn=f({arguments:A(k(ye)),type_arguments:A(k(u())),package:u(),module:u(),function:u()}),Qn=K([f({MoveCall:Yn}),f({TransferObjects:oe([k(ye),ye])}),f({SplitCoins:oe([ye,k(ye)])}),f({MergeCoins:oe([ye,k(ye)])}),f({Publish:K([oe([Gt,k(u())]),k(u())])}),f({Upgrade:K([oe([Gt,k(u()),u(),ye]),oe([k(u()),u(),ye])])}),f({MakeMoveVec:oe([N(u()),k(ye)])})]),eo=K([f({type:O("pure"),valueType:N(u()),value:Bn}),f({type:O("object"),objectType:O("immOrOwnedObject"),objectId:u(),version:u(),digest:u()}),f({type:O("object"),objectType:O("sharedObject"),objectId:u(),initialSharedVersion:u(),mutable:X()})]),to=f({transactions:k(Qn),inputs:k(eo)}),io=K([De(Jn,f({kind:O("ChangeEpoch")})),De(Hn,f({kind:O("ConsensusCommitPrologue")})),De(Zn,f({kind:O("Genesis")})),De(to,f({kind:O("ProgrammableTransaction")}))]),xi=f({messageVersion:O("v1"),transaction:io,sender:u(),gasData:Nn});u();const no=K([u(),k(u())]);f({epoch:u(),signature:no,signers_map:k(E())});const oo=f({computationCost:u(),storageCost:u(),storageRebate:u(),nonRefundableStorageFee:u()}),so=K([O("success"),O("failure")]),ro=f({status:so,error:A(u())}),ht=f({owner:ze,reference:be}),ao=f({objectId:u(),sequenceNumber:u()}),ei=f({messageVersion:O("v1"),status:ro,executedEpoch:u(),modifiedAtVersions:A(k(ao)),gasUsed:oo,sharedObjects:A(k(be)),transactionDigest:u(),created:A(k(ht)),mutated:A(k(ht)),unwrapped:A(k(ht)),deleted:A(k(be)),unwrappedThenDeleted:A(k(be)),wrapped:A(k(be)),gasObject:ht,eventsDigest:N(A(u())),dependencies:A(k(u()))}),ti=k(Mi),co=oe([k(E()),u()]),uo=oe([ye,k(E()),u()]),lo=f({mutableReferenceOutputs:A(k(uo)),returnValues:A(k(co))});f({effects:ei,events:ti,results:A(k(lo)),error:A(u())});u();const _o=f({data:xi,txSignatures:k(u())}),po=f({type:O("published"),packageId:u(),version:u(),digest:u(),modules:k(u())}),mo=f({type:O("transferred"),sender:u(),recipient:ze,objectType:u(),objectId:u(),version:u(),digest:u()}),ho=f({type:O("mutated"),sender:u(),owner:ze,objectType:u(),objectId:u(),version:u(),previousVersion:u(),digest:u()}),go=f({type:O("deleted"),sender:u(),objectType:u(),objectId:u(),version:u()}),fo=f({type:O("wrapped"),sender:u(),objectType:u(),objectId:u(),version:u()}),yo=f({type:O("created"),sender:u(),owner:ze,objectType:u(),objectId:u(),version:u(),digest:u()}),Ri=K([po,mo,ho,go,fo,yo]),Fi=f({owner:ze,coinType:u(),amount:u()}),bo=f({digest:u(),transaction:A(_o),effects:A(ei),events:A(ti),timestampMs:A(u()),checkpoint:A(u()),confirmedLocalExecution:A(X()),objectChanges:A(k(Ri)),balanceChanges:A(k(Fi)),errors:A(k(u()))});f({showInput:A(X()),showEffects:A(X()),showEvents:A(X()),showObjectChanges:A(X()),showBalanceChanges:A(X())});f({data:k(bo),nextCursor:N(u()),hasNextPage:X()});f({effects:ei,events:ti,objectChanges:k(Ri),balanceChanges:k(Fi),input:A(xi)});const wo=K([u(),f({Object:u()})]);k(wo);const ko=f({address:u(),name:u()}),Co=K([O("Private"),O("Public"),O("Friend")]),ii=f({abilities:k(u())}),vo=f({constraints:ii,isPhantom:X()}),So=f({TypeParameter:E()}),Mt=oe([f({module:u(),package:u(),function:u()}),u()]);f({rank3Days:k(Mt),rank7Days:k(Mt),rank30Days:k(Mt)});function qi(e){if(!e)return!1;if(typeof e=="string"||he(e,So)||$i(e))return!0;if(typeof e!="object")return!1;const t=e;return!!(he(t.Reference,Qe)||he(t.MutableReference,Qe)||he(t.Vector,Qe))}const Qe=dt("SuiMoveNormalizedType",qi);function $i(e){if(!e||typeof e!="object")return!1;const t=e;if(!t.Struct||typeof t.Struct!="object")return!1;const i=t.Struct;return!(typeof i.address!="string"||typeof i.module!="string"||typeof i.name!="string"||!Array.isArray(i.typeArguments)||!i.typeArguments.every(n=>qi(n)))}dt("SuiMoveNormalizedStructType",$i);const To=f({visibility:Co,isEntry:X(),typeParameters:k(ii),parameters:k(Qe),return:k(Qe)}),Ao=f({name:u(),type:Qe}),Po=f({abilities:ii,typeParameters:k(vo),fields:k(Ao)}),jo=f({fileFormatVersion:E(),address:u(),name:u(),friends:k(ko),structs:fe(u(),Po),exposedFunctions:fe(u(),To)});fe(u(),jo);function Li(e){return typeof e=="object"&&"MutableReference"in e?e.MutableReference:void 0}function Io(e){return typeof e=="object"&&"Reference"in e?e.Reference:void 0}function Ki(e){if(typeof e=="object"&&"Struct"in e)return e;const t=Io(e),i=Li(e);if(typeof t=="object"&&"Struct"in t)return t;if(typeof i=="object"&&"Struct"in i)return i}const Oo=f({apy:E(),address:u()});f({epoch:u(),apys:k(Oo)});f({value:E()});const Do=f({stakedSuiId:u(),stakeRequestEpoch:u(),stakeActiveEpoch:u(),principal:u(),status:K([O("Active"),O("Pending"),O("Unstaked")]),estimatedReward:A(u())});f({validatorAddress:u(),stakingPool:u(),stakes:k(Do)});const Bo=f({balance:f({value:E()}),distribution_counter:E(),current_distribution_amount:E(),stake_subsidy_period_length:E(),stake_subsidy_decrease_rate:E()});f({type:u(),fields:Bo});f({value:E()});const Eo=f({id:u(),size:E(),head:f({vec:k()}),tail:f({vec:k()})});f({id:u(),size:E()});f({type:u(),fields:Eo});const No=f({exchangeRates:f({id:u(),size:E()}),id:u(),pendingStake:E(),pendingPoolTokenWithdraw:E(),pendingTotalSuiWithdraw:E(),poolTokenBalance:E(),rewardsPool:f({value:E()}),activationEpoch:f({vec:k()}),deactivationEpoch:f({vec:k()}),suiBalance:E()});f({type:u(),fields:No});const Mo=k(oe([u(),u()]));f({epoch:u(),validators:Mo});const Ui=f({suiAddress:u(),protocolPubkeyBytes:u(),networkPubkeyBytes:u(),workerPubkeyBytes:u(),proofOfPossessionBytes:u(),operationCapId:u(),name:u(),description:u(),imageUrl:u(),projectUrl:u(),p2pAddress:u(),netAddress:u(),primaryAddress:u(),workerAddress:u(),nextEpochProtocolPubkeyBytes:N(u()),nextEpochProofOfPossession:N(u()),nextEpochNetworkPubkeyBytes:N(u()),nextEpochWorkerPubkeyBytes:N(u()),nextEpochNetAddress:N(u()),nextEpochP2pAddress:N(u()),nextEpochPrimaryAddress:N(u()),nextEpochWorkerAddress:N(u()),votingPower:u(),gasPrice:u(),commissionRate:u(),nextEpochStake:u(),nextEpochGasPrice:u(),nextEpochCommissionRate:u(),stakingPoolId:u(),stakingPoolActivationEpoch:N(u()),stakingPoolDeactivationEpoch:N(u()),stakingPoolSuiBalance:u(),rewardsPool:u(),poolTokenBalance:u(),pendingStake:u(),pendingPoolTokenWithdraw:u(),pendingTotalSuiWithdraw:u(),exchangeRatesId:u(),exchangeRatesSize:u()});f({epoch:u(),protocolVersion:u(),systemStateVersion:u(),storageFundTotalObjectStorageRebates:u(),storageFundNonRefundableBalance:u(),referenceGasPrice:u(),safeMode:X(),safeModeStorageRewards:u(),safeModeComputationRewards:u(),safeModeStorageRebates:u(),safeModeNonRefundableStorageFee:u(),epochStartTimestampMs:u(),epochDurationMs:u(),stakeSubsidyStartEpoch:u(),maxValidatorCount:u(),minValidatorJoiningStake:u(),validatorLowStakeThreshold:u(),validatorVeryLowStakeThreshold:u(),validatorLowStakeGracePeriod:u(),stakeSubsidyBalance:u(),stakeSubsidyDistributionCounter:u(),stakeSubsidyCurrentDistributionAmount:u(),stakeSubsidyPeriodLength:u(),stakeSubsidyDecreaseRate:E(),totalStake:u(),activeValidators:k(Ui),pendingActiveValidatorsId:u(),pendingActiveValidatorsSize:u(),pendingRemovals:k(u()),stakingPoolMappingsId:u(),stakingPoolMappingsSize:u(),inactivePoolsId:u(),inactivePoolsSize:u(),validatorCandidatesId:u(),validatorCandidatesSize:u(),atRiskValidators:k(oe([u(),u()])),validatorReportRecords:k(oe([u(),k(u())]))});const xo=f({coinType:u(),coinObjectId:u(),version:u(),digest:u(),balance:u(),previousTransaction:u()});f({data:k(xo),nextCursor:N(u()),hasNextPage:X()});f({coinType:u(),coinObjectCount:E(),totalBalance:u(),lockedBalance:f({epochId:A(E()),number:A(E())})});f({value:u()});const Ro=f({lastCheckpointId:u(),epochEndTimestamp:u(),protocolVersion:u(),referenceGasPrice:u(),totalStake:u(),storageFundReinvestment:u(),storageCharge:u(),storageRebate:u(),storageFundBalance:u(),stakeSubsidyAmount:u(),totalGasFees:u(),totalStakeRewardsDistributed:u(),leftoverStorageFundInflow:u()}),Fo=f({epoch:u(),validators:k(Ui),epochTotalTransactions:u(),firstCheckpointId:u(),epochStartTimestamp:u(),endOfEpochInfo:N(Ro),referenceGasPrice:N(E())});f({data:k(Fo),nextCursor:N(u()),hasNextPage:X()});f({data:k(u()),hasNextPage:X(),nextCursor:N(u())});const qo=K([O("DynamicField"),O("DynamicObject")]),$o=f({type:u(),value:lt()}),Lo=f({name:$o,bcsName:u(),type:qo,objectType:u(),objectId:u(),version:E(),digest:u()});f({data:k(Lo),nextCursor:N(u()),hasNextPage:X()});const Ko=f({computationCost:u(),storageCost:u(),storageRebate:u(),nonRefundableStorageFee:u()});u();u();f({digest:k(E())});const Vi=lt();u();const Uo=f({nextEpochCommittee:k(oe([u(),u()])),nextEpochProtocolVersion:u(),epochCommitments:k(Vi)});f({transaction:u(),effects:u()});const Vo=f({epoch:u(),sequenceNumber:u(),digest:u(),networkTotalTransactions:u(),previousDigest:A(u()),epochRollingGasCostSummary:Ko,timestampMs:u(),endOfEpochData:A(Uo),validatorSignature:u(),transactions:k(u()),checkpointCommitments:k(Vi)});f({data:k(Vo),nextCursor:N(u()),hasNextPage:X()});f({currentTps:E(),tps30Days:E(),currentCheckpoint:u(),currentEpoch:u(),totalAddresses:u(),totalObjects:u(),totalPackages:u()});const Go=f({checkpoint:E(),epoch:E(),timestampMs:E(),cumulativeAddresses:E(),cumulativeActiveAddresses:E(),dailyActiveAddresses:E()});k(Go);const Gi="0x2",ni="0x1",Xo="object",zo="ID",Wo=`${Gi}::sui::SUI`;ue("0x6");f({decimals:E(),name:u(),symbol:u(),description:u(),iconUrl:N(u()),id:N(u())});const Jo="ascii",Ho="String",Zo="string",Yo="String",Qo="option",es="Option",ts={address:Gi,module:Xo,name:zo},is={address:ni,module:Jo,name:Ho},ns={address:ni,module:Zo,name:Yo},os={address:ni,module:Qo,name:es},gt=(e,t)=>e.address===t.address&&e.module===t.module&&e.name===t.name;function ss(e){var i;const t=(i=Ki(e))==null?void 0:i.Struct;return(t==null?void 0:t.address)==="0x2"&&(t==null?void 0:t.module)==="tx_context"&&(t==null?void 0:t.name)==="TxContext"}function xt(e,t){if(!(typeof t>"u")&&typeof t!==e)throw new Error(`Expect ${t} to be ${e}, received ${typeof t}`)}const rs=["Address","Bool","U8","U16","U32","U64","U128","U256"];function Xt(e,t){if(typeof e=="string"&&rs.includes(e)){if(e in["U8","U16","U32","U64","U128","U256"])xt("number",t);else if(e==="Bool")xt("boolean",t);else if(e==="Address"&&(xt("string",t),t&&!Di(t)))throw new Error("Invalid Sui Address");return e.toLowerCase()}else if(typeof e=="string")throw new Error(`Unknown pure normalized type ${JSON.stringify(e,null,2)}`);if("Vector"in e){if((t===void 0||typeof t=="string")&&e.Vector==="U8")return"string";if(t!==void 0&&!Array.isArray(t))throw new Error(`Expect ${t} to be a array, received ${typeof t}`);const i=Xt(e.Vector,t?t[0]:void 0);return i===void 0?void 0:`vector<${i}>`}if("Struct"in e){if(gt(e.Struct,is))return"string";if(gt(e.Struct,ns))return"utf8string";if(gt(e.Struct,ts))return"address";if(gt(e.Struct,os)){const i={Vector:e.Struct.typeArguments[0]};return Xt(i,t)}}}const We="vector",as={kind:"TransactionKind",sender:U.ADDRESS,gasData:"GasData",expiration:"TransactionExpiration"},cs={enums:{"Option<T>":{None:null,Some:"T"},ObjectArg:{ImmOrOwned:"SuiObjectRef",Shared:"SharedObjectRef"},CallArg:{Pure:[We,U.U8],Object:"ObjectArg",ObjVec:[We,"ObjectArg"]},TypeTag:{bool:null,u8:null,u64:null,u128:null,address:null,signer:null,vector:"TypeTag",struct:"StructTag",u16:null,u32:null,u256:null},TransactionKind:{ProgrammableTransaction:"ProgrammableTransaction",ChangeEpoch:null,Genesis:null,ConsensusCommitPrologue:null},TransactionExpiration:{None:null,Epoch:"unsafe_u64"},TransactionData:{V1:"TransactionDataV1"}},structs:{SuiObjectRef:{objectId:U.ADDRESS,version:U.U64,digest:"ObjectDigest"},SharedObjectRef:{objectId:U.ADDRESS,initialSharedVersion:U.U64,mutable:U.BOOL},StructTag:{address:U.ADDRESS,module:U.STRING,name:U.STRING,typeParams:[We,"TypeTag"]},GasData:{payment:[We,"SuiObjectRef"],owner:U.ADDRESS,price:U.U64,budget:U.U64},SenderSignedData:{data:"TransactionData",txSignatures:[We,[We,U.U8]]},TransactionDataV1:as},aliases:{ObjectDigest:U.BASE58}},oi=new U({...Sn(),types:cs});oi.registerType("utf8string",(e,t)=>{const i=Array.from(new TextEncoder().encode(t));return e.writeVec(i,(n,o)=>n.write8(o))},e=>{let t=e.readVec(i=>i.read8());return new TextDecoder().decode(new Uint8Array(t))});oi.registerType("unsafe_u64",(e,t)=>e.write64(t),e=>Number.parseInt(e.read64(),10));const us=/^vector<(.+)>$/,ds=/^([^:]+)::([^:]+)::([^<]+)(<(.+)>)?/;class Ie{static parseFromStr(t,i=!1){if(t==="address")return{address:null};if(t==="bool")return{bool:null};if(t==="u8")return{u8:null};if(t==="u16")return{u16:null};if(t==="u32")return{u32:null};if(t==="u64")return{u64:null};if(t==="u128")return{u128:null};if(t==="u256")return{u256:null};if(t==="signer")return{signer:null};const n=t.match(us);if(n)return{vector:Ie.parseFromStr(n[1],i)};const o=t.match(ds);if(o)return{struct:{address:i?Y(o[1]):o[1],module:o[2],name:o[3],typeParams:o[5]===void 0?[]:Ie.parseStructTypeArgs(o[5],i)}};throw new Error(`Encountered unexpected token when parsing type args for ${t}`)}static parseStructTypeArgs(t,i=!1){return Tn(t).map(n=>Ie.parseFromStr(n,i))}static tagToString(t){if("bool"in t)return"bool";if("u8"in t)return"u8";if("u16"in t)return"u16";if("u32"in t)return"u32";if("u64"in t)return"u64";if("u128"in t)return"u128";if("u256"in t)return"u256";if("address"in t)return"address";if("signer"in t)return"signer";if("vector"in t)return`vector<${Ie.tagToString(t.vector)}>`;if("struct"in t){const i=t.struct,n=i.typeParams.map(Ie.tagToString).join(", ");return`${i.address}::${i.module}::${i.name}${n?`<${n}>`:""}`}throw new Error("Invalid TypeTag")}}const Xi="Argument",ne="vector",ls="Option",_s="CallArg",mi="TypeTag",ps="ProgrammableTransaction",zt="ProgrammableMoveCall",zi="Transaction",hi="CompressedSignature",gi="PublicKey",fi="MultiSigPublicKey",yi="MultiSigPkMap",ms="MultiSig",si="EnumKind",hs=[si,zi],Te=[si,Xi],Wi="SimpleProgrammableMoveCall",ge=new U(oi);ri(ge,"FixedArray[64]",64);ri(ge,"FixedArray[33]",33);ri(ge,"FixedArray[32]",32);ge.registerStructType(ps,{inputs:[ne,_s],transactions:[ne,hs]}).registerEnumType(Xi,{GasCoin:null,Input:{index:U.U16},Result:{index:U.U16},NestedResult:{index:U.U16,resultIndex:U.U16}}).registerStructType(zt,{package:U.ADDRESS,module:U.STRING,function:U.STRING,type_arguments:[ne,mi],arguments:[ne,Te]}).registerEnumType(zi,{MoveCall:Wi,TransferObjects:{objects:[ne,Te],address:Te},SplitCoins:{coin:Te,amounts:[ne,Te]},MergeCoins:{destination:Te,sources:[ne,Te]},Publish:{modules:[ne,[ne,U.U8]],dependencies:[ne,U.ADDRESS]},MakeMoveVec:{type:[ls,mi],objects:[ne,Te]},Upgrade:{modules:[ne,[ne,U.U8]],dependencies:[ne,U.ADDRESS],packageId:U.ADDRESS,ticket:Te}}).registerEnumType(hi,{ED25519:["FixedArray[64]","u8"],Secp256k1:["FixedArray[64]","u8"],Secp256r1:["FixedArray[64]","u8"]}).registerEnumType(gi,{ED25519:["FixedArray[32]","u8"],Secp256k1:["FixedArray[33]","u8"],Secp256r1:["FixedArray[33]","u8"]}).registerStructType(yi,{pubKey:gi,weight:U.U8}).registerStructType(fi,{pk_map:[ne,yi],threshold:U.U16}).registerStructType(ms,{sigs:[ne,hi],bitmap:U.U16,multisig_pk:fi});ge.registerType([si,"T"],function(t,i,n,o){const r={[i.kind]:i},[a]=n;return this.getTypeInterface(a)._encodeRaw.call(this,t,r,n,o)},function(t,i,n){const[o]=i,s=this.getTypeInterface(o)._decodeRaw.call(this,t,i,n),r=Object.keys(s)[0];return{kind:r,...s[r]}},e=>{if(typeof e!="object"&&!("kind"in e))throw new Error(`EnumKind: Missing property "kind" in the input ${JSON.stringify(e)}`);return!0});ge.registerType(Wi,function(t,i,n,o){const[s,r,a]=i.target.split("::"),c=i.typeArguments.map(d=>Ie.parseFromStr(d,!0));return this.getTypeInterface(zt)._encodeRaw.call(this,t,{package:Y(s),module:r,function:a,type_arguments:c,arguments:i.arguments},n,o)},function(t,i,n){let o=ge.getTypeInterface(zt)._decodeRaw.call(this,t,i,n);return{target:[o.package,o.module,o.function].join("::"),arguments:o.arguments,typeArguments:o.type_arguments.map(Ie.tagToString)}},e=>e.target.split("::").length===3);function ri(e,t,i){e.registerType(t,function(o,s,r,a){if(s.length!==i)throw new Error(`Expected fixed array of length ${i}, got ${s.length}`);if(r.length!==1)throw new Error(`Expected one type parameter in a fixed array, got ${r.length}`);let[c]=typeof r[0]=="string"?[r[0],[]]:r[0];for(let d of s)this.getTypeInterface(c)._encodeRaw.call(this,o,d,r,a);return o},function(o,s,r){if(s.length!==1)throw new Error(`Expected one type parameter in a fixed array, got ${s.length}`);let a=[],[c]=typeof s[0]=="string"?[s[0],[]]:s[0];for(let d=0;d<i;d++)a.push(this.getTypeInterface(c)._decodeRaw.call(this,o,s,r));return a})}const gs=K([f({ImmOrOwned:be}),f({Shared:f({objectId:u(),initialSharedVersion:K([Ee(),u()]),mutable:X()})})]),jt=f({Pure:k(Ee())}),fs=f({Object:gs}),tt=K([jt,fs]),Oe={Pure(e,t){return{Pure:Array.from(e instanceof Uint8Array?e:ge.ser(t,e,{maxSize:1/0}).toBytes())}},ObjectRef({objectId:e,digest:t,version:i}){return{Object:{ImmOrOwned:{digest:t,version:i,objectId:Y(e)}}}},SharedObjectRef({objectId:e,mutable:t,initialSharedVersion:i}){return{Object:{Shared:{mutable:t,initialSharedVersion:i,objectId:Y(e)}}}}};function bi(e){return typeof e=="string"?Y(e):"ImmOrOwned"in e.Object?Y(e.Object.ImmOrOwned.objectId):Y(e.Object.Shared.objectId)}function ys(e){return typeof e=="object"&&"Object"in e&&"Shared"in e.Object?e.Object.Shared:void 0}function bs(e){var t;return((t=ys(e))==null?void 0:t.mutable)??!1}function le(e,t){return Pn(e,t)}const It=Symbol("transaction-argument-type"),ws=e=>K([f({None:K([O(!0),O(null)])}),f({Some:e})]),at=f({kind:O("Input"),index:Ee(),value:A(lt()),type:A(K([O("pure"),O("object")]))}),ai=[at,f({kind:O("GasCoin")}),f({kind:O("Result"),index:Ee()}),f({kind:O("NestedResult"),index:Ee(),resultIndex:Ee()})],ks=K([...ai]),Ge=K([...ai]);Ge[It]={kind:"object"};const Ji=e=>{const t=K([...ai]);return t[It]={kind:"pure",type:e},t},Hi=f({kind:O("MoveCall"),target:dt("target",u().validator),typeArguments:k(u()),arguments:k(ks)}),Zi=f({kind:O("TransferObjects"),objects:k(Ge),address:Ji(U.ADDRESS)}),Yi=f({kind:O("SplitCoins"),coin:Ge,amounts:k(Ji("u64"))}),Qi=f({kind:O("MergeCoins"),destination:Ge,sources:k(Ge)}),en=f({kind:O("MakeMoveVec"),type:A(ws(fe(u(),Ii()))),objects:k(Ge)}),tn=f({kind:O("Publish"),modules:k(k(Ee())),dependencies:k(u())}),nn=f({kind:O("Upgrade"),modules:k(k(Ee())),dependencies:k(u()),packageId:u(),ticket:Ge}),on=[Hi,Zi,Yi,Qi,tn,nn,en],sn=K([...on]);function Cs(e){return Vt(e,sn),on.find(t=>he(e,t))}const xe={MoveCall(e){return le({kind:"MoveCall",target:e.target,arguments:e.arguments??[],typeArguments:e.typeArguments??[]},Hi)},TransferObjects(e,t){return le({kind:"TransferObjects",objects:e,address:t},Zi)},SplitCoins(e,t){return le({kind:"SplitCoins",coin:e,amounts:t},Yi)},MergeCoins(e,t){return le({kind:"MergeCoins",destination:e,sources:t},Qi)},Publish({modules:e,dependencies:t}){return le({kind:"Publish",modules:e.map(i=>typeof i=="string"?Array.from(Pt(i)):i),dependencies:t.map(i=>ue(i))},tn)},Upgrade({modules:e,dependencies:t,packageId:i,ticket:n}){return le({kind:"Upgrade",modules:e.map(o=>typeof o=="string"?Array.from(Pt(o)):o),dependencies:t.map(o=>ue(o)),packageId:i,ticket:n},nn)},MakeMoveVec({type:e,objects:t}){return le({kind:"MakeMoveVec",type:e?{Some:Ie.parseFromStr(e)}:{None:null},objects:t},en)}};function vs(e,t){const i=Array.from(`${e}::`).map(o=>o.charCodeAt(0)),n=new Uint8Array(i.length+t.length);return n.set(i),n.set(t,i.length),jn(n,{dkLen:32})}const Ss=A(N(K([f({Epoch:Ee()}),f({None:K([O(!0),O(null)])})]))),wi=dt("StringEncodedBigint",e=>{if(!["string","number","bigint"].includes(typeof e))return!1;try{return BigInt(e),!0}catch{return!1}}),Ts=f({budget:A(wi),price:A(wi),payment:A(k(be)),owner:A(u())}),ft=f({version:O(1),sender:A(u()),expiration:Ss,gasConfig:Ts,inputs:k(at),transactions:k(sn)});function ki(e){return Y(e).replace("0x","")}class Be{constructor(t){this.version=1,this.sender=t==null?void 0:t.sender,this.expiration=t==null?void 0:t.expiration,this.gasConfig=(t==null?void 0:t.gasConfig)??{},this.inputs=(t==null?void 0:t.inputs)??[],this.transactions=(t==null?void 0:t.transactions)??[]}static fromKindBytes(t){const i=ge.de("TransactionKind",t),n=i==null?void 0:i.ProgrammableTransaction;if(!n)throw new Error("Unable to deserialize from bytes.");const o=le({version:1,gasConfig:{},inputs:n.inputs.map((s,r)=>le({kind:"Input",value:s,index:r,type:he(s,jt)?"pure":"object"},at)),transactions:n.transactions},ft);return Be.restore(o)}static fromBytes(t){var r;const i=ge.de("TransactionData",t),n=i==null?void 0:i.V1,o=(r=n==null?void 0:n.kind)==null?void 0:r.ProgrammableTransaction;if(!n||!o)throw new Error("Unable to deserialize from bytes.");const s=le({version:1,sender:n.sender,expiration:n.expiration,gasConfig:n.gasData,inputs:o.inputs.map((a,c)=>le({kind:"Input",value:a,index:c,type:he(a,jt)?"pure":"object"},at)),transactions:o.transactions},ft);return Be.restore(s)}static restore(t){Vt(t,ft);const i=new Be;return Object.assign(i,t),i}static getDigestFromBytes(t){const i=vs("TransactionData",t);return An(i)}build({maxSizeBytes:t=1/0,overrides:i,onlyTransactionKind:n}={}){const o=this.inputs.map(_=>(Vt(_.value,tt),_.value)),s={ProgrammableTransaction:{inputs:o,transactions:this.transactions}};if(n)return ge.ser("TransactionKind",s,{maxSize:t}).toBytes();const r=(i==null?void 0:i.expiration)??this.expiration,a=(i==null?void 0:i.sender)??this.sender,c={...this.gasConfig,...i==null?void 0:i.gasConfig};if(!a)throw new Error("Missing transaction sender");if(!c.budget)throw new Error("Missing gas budget");if(!c.payment)throw new Error("Missing gas payment");if(!c.price)throw new Error("Missing gas price");const d={sender:ki(a),expiration:r||{None:!0},gasData:{payment:c.payment,owner:ki(this.gasConfig.owner??a),price:BigInt(c.price),budget:BigInt(c.budget)},kind:{ProgrammableTransaction:{inputs:o,transactions:this.transactions}}};return ge.ser("TransactionData",{V1:d},{maxSize:t}).toBytes()}getDigest(){const t=this.build({onlyTransactionKind:!1});return Be.getDigestFromBytes(t)}snapshot(){return le(this,ft)}}var ci=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},z=(e,t,i)=>(ci(e,t,"read from private field"),i?i.call(e):t.get(e)),Re=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},yt=(e,t,i,n)=>(ci(e,t,"write to private field"),n?n.call(e,i):t.set(e,i),i),ae=(e,t,i)=>(ci(e,t,"access private method"),i),L,St,Wt,Le,Xe,ui,rn,di,an,li,cn,_i,un,Tt,Jt;const As={maxPureArgumentSize:16*1024,maxTxGas:5e10,maxGasObjects:256,maxTxSizeBytes:128*1024};function Ps(e){const t={kind:"Result",index:e},i=[],n=o=>i[o]??(i[o]={kind:"NestedResult",index:e,resultIndex:o});return new Proxy(t,{set(){throw new Error("The transaction result is a proxy, and does not support setting properties directly")},get(o,s){if(s in o)return Reflect.get(o,s);if(s===Symbol.iterator)return function*(){let a=0;for(;;)yield n(a),a++};if(typeof s=="symbol")return;const r=parseInt(s,10);if(!(Number.isNaN(r)||r<0))return n(r)}})}function ct(e){if(!e.client&&!e.provider)throw new Error("No provider passed to Transaction#build, but transaction data was not sufficient to build offline.");return e.client??e.provider}const Ci=Symbol.for("@mysten/transaction"),Rt={maxTxGas:"max_tx_gas",maxGasObjects:"max_gas_payment_objects",maxTxSizeBytes:"max_tx_size_bytes",maxPureArgumentSize:"max_pure_argument_size"},js=1000n,Is=50,Os=(e,t)=>Array.from({length:Math.ceil(e.length/t)},(i,n)=>e.slice(n*t,n*t+t)),Ds=class Ht{constructor(t){Re(this,St),Re(this,Le),Re(this,ui),Re(this,di),Re(this,li),Re(this,_i),Re(this,Tt),Re(this,L,void 0),yt(this,L,new Be(t?t.blockData:void 0))}static is(t){return!!t&&typeof t=="object"&&t[Ci]===!0}static fromKind(t){const i=new Ht;return yt(i,L,Be.fromKindBytes(typeof t=="string"?Pt(t):t)),i}static from(t){const i=new Ht;return typeof t!="string"||!t.startsWith("{")?yt(i,L,Be.fromBytes(typeof t=="string"?Pt(t):t)):yt(i,L,Be.restore(JSON.parse(t))),i}static get Transactions(){return xe}static get Inputs(){return Oe}setSender(t){z(this,L).sender=t}setSenderIfNotSet(t){z(this,L).sender||(z(this,L).sender=t)}setExpiration(t){z(this,L).expiration=t}setGasPrice(t){z(this,L).gasConfig.price=String(t)}setGasBudget(t){z(this,L).gasConfig.budget=String(t)}setGasOwner(t){z(this,L).gasConfig.owner=t}setGasPayment(t){z(this,L).gasConfig.payment=t.map(i=>In(i,be))}get blockData(){return z(this,L).snapshot()}get[Ci](){return!0}get gas(){return{kind:"GasCoin"}}object(t){const i=bi(t);return z(this,L).inputs.find(o=>o.type==="object"&&i===bi(o.value))??ae(this,St,Wt).call(this,"object",t)}objectRef(...t){return this.object(Oe.ObjectRef(...t))}sharedObjectRef(...t){return this.object(Oe.SharedObjectRef(...t))}pure(t,i){return ae(this,St,Wt).call(this,"pure",t instanceof Uint8Array?Oe.Pure(t):i?Oe.Pure(t,i):t)}add(t){const i=z(this,L).transactions.push(t);return Ps(i-1)}splitCoins(...t){return this.add(xe.SplitCoins(...t))}mergeCoins(...t){return this.add(xe.MergeCoins(...t))}publish(...t){return this.add(xe.Publish(...t))}upgrade(...t){return this.add(xe.Upgrade(...t))}moveCall(...t){return this.add(xe.MoveCall(...t))}transferObjects(...t){return this.add(xe.TransferObjects(...t))}makeMoveVec(...t){return this.add(xe.MakeMoveVec(...t))}serialize(){return JSON.stringify(z(this,L).snapshot())}async sign(t){const{signer:i,...n}=t,o=await this.build(n);return i.signTransactionBlock(o)}async build(t={}){return await ae(this,Tt,Jt).call(this,t),z(this,L).build({maxSizeBytes:ae(this,Le,Xe).call(this,"maxTxSizeBytes",t),onlyTransactionKind:t.onlyTransactionKind})}async getDigest(t={}){return await ae(this,Tt,Jt).call(this,t),z(this,L).getDigest()}};L=new WeakMap;St=new WeakSet;Wt=function(e,t){const i=z(this,L).inputs.length,n=le({kind:"Input",value:typeof t=="bigint"?String(t):t,index:i,type:e},at);return z(this,L).inputs.push(n),n};Le=new WeakSet;Xe=function(e,{protocolConfig:t,limits:i}){if(i&&typeof i[e]=="number")return i[e];if(!t)return As[e];const n=t==null?void 0:t.attributes[Rt[e]];if(!n)throw new Error(`Missing expected protocol config: "${Rt[e]}"`);const o="u64"in n?n.u64:"u32"in n?n.u32:n.f64;if(!o)throw new Error(`Unexpected protocol config value found for: "${Rt[e]}"`);return Number(o)};ui=new WeakSet;rn=function(e){const t=ae(this,Le,Xe).call(this,"maxPureArgumentSize",e);z(this,L).inputs.forEach((i,n)=>{if(he(i.value,jt)&&i.value.Pure.length>t)throw new Error(`Input at index ${n} is too large, max pure input size is ${t} bytes, got ${i.value.Pure.length} bytes`)})};di=new WeakSet;an=async function(e){if(z(this,L).gasConfig.payment){const o=ae(this,Le,Xe).call(this,"maxGasObjects",e);if(z(this,L).gasConfig.payment.length>o)throw new Error(`Payment objects exceed maximum amount: ${o}`)}if(e.onlyTransactionKind||z(this,L).gasConfig.payment)return;const t=z(this,L).gasConfig.owner??z(this,L).sender,n=(await ct(e).getCoins({owner:t,coinType:Wo})).data.filter(o=>!z(this,L).inputs.find(r=>he(r.value,tt)&&"Object"in r.value&&"ImmOrOwned"in r.value.Object?o.coinObjectId===r.value.Object.ImmOrOwned.objectId:!1)).slice(0,ae(this,Le,Xe).call(this,"maxGasObjects",e)-1).map(o=>({objectId:o.coinObjectId,digest:o.digest,version:o.version}));if(!n.length)throw new Error("No valid gas coins found for the transaction.");this.setGasPayment(n)};li=new WeakSet;cn=async function(e){e.onlyTransactionKind||z(this,L).gasConfig.price||this.setGasPrice(await ct(e).getReferenceGasPrice())};_i=new WeakSet;un=async function(e){const{inputs:t,transactions:i}=z(this,L),n=[],o=[];if(i.forEach(s=>{if(s.kind==="MoveCall"){s.arguments.some(c=>c.kind==="Input"&&!he(t[c.index].value,tt))&&n.push(s);return}const r=Cs(s);r.schema&&Object.entries(s).forEach(([a,c])=>{if(a==="kind")return;const d=r.schema[a],_=d.type==="array",p=_?d.schema[It]:d[It];if(!p)return;const m=y=>{const S=t[y];if(!S)throw new Error(`Missing input ${c.index}`);if(!he(S.value,tt))if(p.kind==="object"&&typeof S.value=="string")o.push({id:S.value,input:S});else if(p.kind==="pure")S.value=Oe.Pure(S.value,p.type);else throw new Error("Unexpected input format.")};if(_)c.forEach(y=>{y.kind==="Input"&&m(y.index)});else{if(c.kind!=="Input")return;m(c.index)}})}),n.length&&await Promise.all(n.map(async s=>{const[r,a,c]=s.target.split("::"),d=await ct(e).getNormalizedMoveFunction({package:ue(r),module:a,function:c}),p=d.parameters.length>0&&ss(d.parameters.at(-1))?d.parameters.slice(0,d.parameters.length-1):d.parameters;if(p.length!==s.arguments.length)throw new Error("Incorrect number of arguments.");p.forEach((m,y)=>{const S=s.arguments[y];if(S.kind!=="Input")return;const C=t[S.index];if(he(C.value,tt))return;const w=C.value,b=Xt(m,w);if(b){C.value=Oe.Pure(w,b);return}if(Ki(m)!=null||typeof m=="object"&&"TypeParameter"in m){if(typeof w!="string")throw new Error(`Expect the argument to be an object id string, got ${JSON.stringify(w,null,2)}`);o.push({id:w,input:C,normalizedType:m});return}throw new Error(`Unknown call arg type ${JSON.stringify(m,null,2)} for value ${JSON.stringify(w,null,2)}`)})})),o.length){const s=[...new Set(o.map(({id:_})=>_))],r=Os(s,Is),a=(await Promise.all(r.map(_=>ct(e).multiGetObjects({ids:_,options:{showOwner:!0}})))).flat();let c=new Map(s.map((_,p)=>[_,a[p]]));const d=Array.from(c).filter(([_,p])=>p.error).map(([_,p])=>_);if(d.length)throw new Error(`The following input objects are invalid: ${d.join(", ")}`);o.forEach(({id:_,input:p,normalizedType:m})=>{var w;const y=c.get(_),S=(w=y.data)==null?void 0:w.owner,C=S&&typeof S=="object"&&"Shared"in S?S.Shared.initial_shared_version:void 0;if(C){const b=bs(p.value)||m!=null&&Li(m)!=null;p.value=Oe.SharedObjectRef({objectId:_,initialSharedVersion:C,mutable:b})}else p.value=Oe.ObjectRef(Wn(y))})}};Tt=new WeakSet;Jt=async function(e){if(!e.onlyTransactionKind&&!z(this,L).sender)throw new Error("Missing transaction sender");const t=e.client||e.provider;if(!e.protocolConfig&&!e.limits&&t&&(e.protocolConfig=await t.getProtocolConfig()),await Promise.all([ae(this,li,cn).call(this,e),ae(this,_i,un).call(this,e)]),!e.onlyTransactionKind&&(await ae(this,di,an).call(this,e),!z(this,L).gasConfig.budget)){const i=await ct(e).dryRunTransactionBlock({transactionBlock:z(this,L).build({maxSizeBytes:ae(this,Le,Xe).call(this,"maxTxSizeBytes",e),overrides:{gasConfig:{budget:String(ae(this,Le,Xe).call(this,"maxTxGas",e)),payment:[]}}})});if(i.effects.status.status!=="success")throw new Error(`Dry run failed, could not automatically determine a budget: ${i.effects.status.error}`,{cause:i});const n=js*BigInt(this.blockData.gasConfig.price||1n),o=BigInt(i.effects.gasUsed.computationCost)+n,s=o+BigInt(i.effects.gasUsed.storageCost)-BigInt(i.effects.gasUsed.storageRebate);this.setGasBudget(s>o?s:o)}ae(this,ui,rn).call(this,e)};let T=Ds;var Bs=Object.defineProperty,Es=(e,t,i)=>t in e?Bs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ns=(e,t,i)=>(Es(e,typeof t!="symbol"?t+"":t,i),i),Ne=5*60*1e3,x=24*60*60*1e3;function J(e){return Date.parse(new Date().toString())+e}var we=class{constructor(e,t=0){F(this,"overdueTime");F(this,"value");this.overdueTime=t,this.value=e}isValid(){return this.value===null?!1:this.overdueTime===0?!0:!(Date.parse(new Date().toString())>this.overdueTime)}};$.config({precision:64,rounding:$.ROUND_DOWN,toExpNeg:-64,toExpPos:64});var te=$,de=class extends Error{constructor(t,i){super(t);F(this,"message");F(this,"errorCode");this.message=t,this.errorCode=i}static isClmmpoolsErrorCode(t,i){return t instanceof de&&t.errorCode===i}},H=new g(0),it=new g(1),Et=new g(2);Et.pow(new g(128));var Zt=Et.pow(new g(64)).sub(it),Ms=Et.pow(new g(128)).sub(it),Pe=class{static toX64_BN(e){return e.mul(new g(2).pow(new g(64)))}static toX64_Decimal(e){return e.mul(te.pow(2,64))}static toX64(e){return new g(e.mul(te.pow(2,64)).floor().toFixed())}static fromX64(e){return new te(e.toString()).mul(te.pow(2,-64))}static fromX64_Decimal(e){return e.mul(te.pow(2,-64))}static fromX64_BN(e){return e.div(new g(2).pow(new g(64)))}static shiftRightRoundUp(e){let t=e.shrn(64);return e.mod(Zt).gt(H)&&(t=t.add(it)),t}static divRoundUp(e,t){return e.mod(t).eq(H)?e.div(t):e.div(t).add(new g(1))}static subUnderflowU128(e,t){return e.lt(t)?e.sub(t).add(Ms):e.sub(t)}static checkUnsignedSub(e,t){const i=e.sub(t);if(i.isNeg())throw new de("Unsigned integer sub overflow","UnsignedIntegerOverflow");return i}static checkMul(e,t,i){const n=e.mul(t);if(this.isOverflow(n,i))throw new de("Multiplication overflow","MultiplicationOverflow");return n}static checkMulDivFloor(e,t,i,n){if(i.eq(H))throw new de("Devide by zero","DivideByZero");const o=e.mul(t).div(i);if(this.isOverflow(o,n))throw new de("Multiplication div overflow","MulDivOverflow");return o}static checkMulDivCeil(e,t,i,n){if(i.eq(H))throw new de("Devide by zero","DivideByZero");const o=e.mul(t).add(i.sub(it)).div(i);if(this.isOverflow(o,n))throw new de("Multiplication div overflow","MulDivOverflow");return o}static checkMulDivRound(e,t,i,n){if(i.eq(H))throw new de("Devide by zero","DivideByZero");const o=e.mul(t.add(i.shrn(1))).div(i);if(this.isOverflow(o,n))throw new de("Multiplication div overflow","MulDivOverflow");return o}static checkMulShiftRight(e,t,i,n){const o=e.mul(t).div(new g(2).pow(new g(i)));if(this.isOverflow(o,n))throw new de("Multiplication shift right overflow","MulShiftRightOverflow");return o}static checkMulShiftRight64RoundUpIf(e,t,i,n){const o=e.mul(t),r=n&&o.and(Zt).gt(H)?o.shrn(64).add(it):o.shrn(64);if(this.isOverflow(r,i))throw new de("Multiplication shift right overflow","MulShiftRightOverflow");return r}static checkMulShiftLeft(e,t,i,n){const o=e.mul(t).shln(i);if(this.isOverflow(o,n))throw new de("Multiplication shift left overflow","MulShiftLeftOverflow");return o}static checkDivRoundUpIf(e,t,i){if(t.eq(H))throw new de("Devide by zero","DivideByZero");return i?this.divRoundUp(e,t):e.div(t)}static isOverflow(e,t){return e.gte(Et.pow(new g(t)))}},xs=443636,Rs=-443636,dn="79226673515401279992447579055",ln="4295048016",vi=new g(1e6),v="0x0000000000000000000000000000000000000000000000000000000000000006",Fs="pool_script",Yt="pool_script_v2",nt="router",Si="router_with_partner",ot="fetcher_script",qs="utils",Ft="custodian_v2",$s="clob_v2",Ls="endpoints_v2",_n=(e=>(e.Deleted="Deleted",e.Exists="Exists",e.NotExists="NotExists",e))(_n||{});function h(e){if(e.config===void 0)throw Error(`package: ${e.package_id}  not config in sdk SdkOptions`);return e.config}var Ks=14,Us="59543866431248",Vs="184467440737095516",Gs="15793534762490258745";function Xs(e,t,i){const n=e.toTwos(i).shln(t);return n.imaskn(i+1),n.fromTwos(i)}function q(e,t,i){const n=e.toTwos(i).shrn(t);return n.imaskn(i-t+1),n.fromTwos(i-t)}function zs(e){let t;return e&1?t=new g("79232123823359799118286999567"):t=new g("79228162514264337593543950336"),e&2&&(t=q(t.mul(new g("79236085330515764027303304731")),96,256)),e&4&&(t=q(t.mul(new g("79244008939048815603706035061")),96,256)),e&8&&(t=q(t.mul(new g("79259858533276714757314932305")),96,256)),e&16&&(t=q(t.mul(new g("79291567232598584799939703904")),96,256)),e&32&&(t=q(t.mul(new g("79355022692464371645785046466")),96,256)),e&64&&(t=q(t.mul(new g("79482085999252804386437311141")),96,256)),e&128&&(t=q(t.mul(new g("79736823300114093921829183326")),96,256)),e&256&&(t=q(t.mul(new g("80248749790819932309965073892")),96,256)),e&512&&(t=q(t.mul(new g("81282483887344747381513967011")),96,256)),e&1024&&(t=q(t.mul(new g("83390072131320151908154831281")),96,256)),e&2048&&(t=q(t.mul(new g("87770609709833776024991924138")),96,256)),e&4096&&(t=q(t.mul(new g("97234110755111693312479820773")),96,256)),e&8192&&(t=q(t.mul(new g("119332217159966728226237229890")),96,256)),e&16384&&(t=q(t.mul(new g("179736315981702064433883588727")),96,256)),e&32768&&(t=q(t.mul(new g("407748233172238350107850275304")),96,256)),e&65536&&(t=q(t.mul(new g("2098478828474011932436660412517")),96,256)),e&131072&&(t=q(t.mul(new g("55581415166113811149459800483533")),96,256)),e&262144&&(t=q(t.mul(new g("38992368544603139932233054999993551")),96,256)),q(t,32,256)}function Ws(e){const t=Math.abs(e);let i;return t&1?i=new g("18445821805675392311"):i=new g("18446744073709551616"),t&2&&(i=q(i.mul(new g("18444899583751176498")),64,256)),t&4&&(i=q(i.mul(new g("18443055278223354162")),64,256)),t&8&&(i=q(i.mul(new g("18439367220385604838")),64,256)),t&16&&(i=q(i.mul(new g("18431993317065449817")),64,256)),t&32&&(i=q(i.mul(new g("18417254355718160513")),64,256)),t&64&&(i=q(i.mul(new g("18387811781193591352")),64,256)),t&128&&(i=q(i.mul(new g("18329067761203520168")),64,256)),t&256&&(i=q(i.mul(new g("18212142134806087854")),64,256)),t&512&&(i=q(i.mul(new g("17980523815641551639")),64,256)),t&1024&&(i=q(i.mul(new g("17526086738831147013")),64,256)),t&2048&&(i=q(i.mul(new g("16651378430235024244")),64,256)),t&4096&&(i=q(i.mul(new g("15030750278693429944")),64,256)),t&8192&&(i=q(i.mul(new g("12247334978882834399")),64,256)),t&16384&&(i=q(i.mul(new g("8131365268884726200")),64,256)),t&32768&&(i=q(i.mul(new g("3584323654723342297")),64,256)),t&65536&&(i=q(i.mul(new g("696457651847595233")),64,256)),t&131072&&(i=q(i.mul(new g("26294789957452057")),64,256)),t&262144&&(i=q(i.mul(new g("37481735321082")),64,256)),i}var B=class{static priceToSqrtPriceX64(e,t,i){return Pe.toX64(e.mul(te.pow(10,i-t)).sqrt())}static sqrtPriceX64ToPrice(e,t,i){return Pe.fromX64(e).pow(2).mul(te.pow(10,t-i))}static tickIndexToSqrtPriceX64(e){return e>0?new g(zs(e)):new g(Ws(e))}static sqrtPriceX64ToTickIndex(e){if(e.gt(new g(dn))||e.lt(new g(ln)))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");const t=e.bitLength()-1,i=new g(t-64),n=Xs(i,32,128);let o=new g("8000000000000000","hex"),s=0,r=new g(0),a=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new g(0))&&s<Ks;){a=a.mul(a);const S=a.shrn(127);a=a.shrn(63+S.toNumber()),r=r.add(o.mul(S)),o=o.shrn(1),s+=1}const c=r.shrn(32),_=n.add(c).mul(new g(Us)),p=q(_.sub(new g(Vs)),64,128).toNumber(),m=q(_.add(new g(Gs)),64,128).toNumber();return p===m?p:B.tickIndexToSqrtPriceX64(m).lte(e)?m:p}static tickIndexToPrice(e,t,i){return B.sqrtPriceX64ToPrice(B.tickIndexToSqrtPriceX64(e),t,i)}static priceToTickIndex(e,t,i){return B.sqrtPriceX64ToTickIndex(B.priceToSqrtPriceX64(e,t,i))}static priceToInitializableTickIndex(e,t,i,n){return B.getInitializableTickIndex(B.priceToTickIndex(e,t,i),n)}static getInitializableTickIndex(e,t){return e-e%t}static getNextInitializableTickIndex(e,t){return B.getInitializableTickIndex(e,t)+t}static getPrevInitializableTickIndex(e,t){return B.getInitializableTickIndex(e,t)-t}};new g(365);new g(24);new g(3600);new g(.5);var Ke=class{static getDefaultSqrtPriceLimit(e){return new g(e?ln:dn)}static getDefaultOtherAmountThreshold(e){return e?H:Zt}};function bt(e,t,i){const n=g.min(e,t),o=g.max(e,t),s=Pe.fromX64_BN(i.mul(o).mul(n)),r=o.sub(n);return s.div(r)}function wt(e,t,i){const n=g.min(e,t),s=g.max(e,t).sub(n);return i.shln(64).div(s)}var ie=class{static updateFeeRate(e,t,i,n,o){const s=Pe.checkMulDivCeil(t,new g(n),vi,64),r=i===0?H:Pe.checkMulDivFloor(t,new g(i),vi,64),a=t.mul(s).mul(r);if(o?e.feeProtocolCoinA=e.feeProtocolCoinA.add(s):e.feeProtocolCoinB=e.feeProtocolCoinB.add(s),a.eq(H)||e.liquidity.eq(H))return{refFee:r,clmm:e};const c=a.shln(64).div(e.liquidity);return o?e.feeGrowthGlobalA=e.feeGrowthGlobalA.add(c):e.feeGrowthGlobalB=e.feeGrowthGlobalB.add(c),{refFee:r,clmm:e}}static getCoinAmountFromLiquidity(e,t,i,n,o){const s=new te(e.toString()),r=new te(t.toString()),a=new te(i.toString()),c=new te(n.toString());let d,_;return t.lt(i)?(d=Pe.toX64_Decimal(s).mul(c.sub(a)).div(a.mul(c)),_=new te(0)):t.lt(n)?(d=Pe.toX64_Decimal(s).mul(c.sub(r)).div(r.mul(c)),_=Pe.fromX64_Decimal(s.mul(r.sub(a)))):(d=new te(0),_=Pe.fromX64_Decimal(s.mul(c.sub(a)))),o?{coinA:new g(d.ceil().toString()),coinB:new g(_.ceil().toString())}:{coinA:new g(d.floor().toString()),coinB:new g(_.floor().toString())}}static estLiquidityAndcoinAmountFromOneAmounts(e,t,i,n,o,s,r){const a=B.sqrtPriceX64ToTickIndex(r),c=B.tickIndexToSqrtPriceX64(e),d=B.tickIndexToSqrtPriceX64(t);let _;if(a<e){if(!n)throw new Error("lower tick cannot calculate liquidity by coinB");_=bt(c,d,i)}else if(a>t){if(n)throw new Error("upper tick cannot calculate liquidity by coinA");_=wt(d,c,i)}else n?_=bt(r,d,i):_=wt(r,c,i);const p=ie.getCoinAmountFromLiquidity(_,r,c,d,o),m=o?l(p.coinA.toString()).mul(1+s).toString():l(p.coinA.toString()).mul(1-s).toString(),y=o?l(p.coinB.toString()).mul(1+s).toString():l(p.coinB.toString()).mul(1-s).toString();return{coinAmountA:p.coinA,coinAmountB:p.coinB,tokenMaxA:o?new g(te.ceil(m).toString()):new g(te.floor(m).toString()),tokenMaxB:o?new g(te.ceil(y).toString()):new g(te.floor(y).toString()),liquidityAmount:_,fix_amount_a:n}}static estimateLiquidityFromcoinAmounts(e,t,i,n){if(t>i)throw new Error("lower tick cannot be greater than lower tick");const o=B.sqrtPriceX64ToTickIndex(e),s=B.tickIndexToSqrtPriceX64(t),r=B.tickIndexToSqrtPriceX64(i);if(o<t)return bt(s,r,n.coinA);if(o>=i)return wt(r,s,n.coinB);const a=bt(e,r,n.coinA),c=wt(e,s,n.coinB);return g.min(a,c)}static estCoinAmountsFromTotalAmount(e,t,i,n,o,s){const{ratioA:r,ratioB:a}=ie.calculateDepositRatioFixTokenA(e,t,i);console.log({ratioA:r,ratioB:a});const c=l(n).mul(r).div(o),d=l(n).mul(a).div(s);return{amountA:c,amountB:d}}static calculateDepositRatioFixTokenA(e,t,i){const n=new g(1e8),{coinAmountB:o}=ie.estLiquidityAndcoinAmountFromOneAmounts(e,t,n,!0,!0,0,i),s=B.sqrtPriceX64ToPrice(i,0,0),r=l(n.toString()).mul(s),a=r.add(o.toString()),c=r.div(a),d=l(o.toString()).div(a);return{ratioA:c,ratioB:d}}};function Js(e){return e.startsWith("0x")?`${e.slice(2)}`:e}var Hs=0,pn=1,Zs=2;function Ti(e,t){return e===t?Hs:e<t?pn:Zs}function Ys(e,t){let i=0;const n=e.length<=t.length?e.length:t.length,o=Ti(e.length,t.length);for(;i<n;){const s=Ti(e.charCodeAt(i),t.charCodeAt(i));if(i+=1,s!==0)return s}return o}function Qs(e,t){return Ys(e,t)===pn}function Ot(e,...t){const i=Array.isArray(t[t.length-1])?t.pop():[];let o=[e,...t].filter(Boolean).join("::");return i&&i.length&&(o+=`<${i.join(", ")}>`),o}function P(e){var t;try{let i=e.replace(/\s/g,"");const n=i.match(/(<.+>)$/),o=(t=n==null?void 0:n[0])==null?void 0:t.match(/(\w+::\w+::\w+)(?:<.*?>(?!>))?/g);if(o){i=i.slice(0,i.indexOf("<"));const d={...P(i),type_arguments:o.map(_=>P(_).source_address)};return d.type_arguments=d.type_arguments.map(_=>G.isSuiCoin(_)?_:P(_).source_address),d.source_address=Ot(d.full_address,d.type_arguments),d}const s=i.split("::"),a={full_address:i,address:i===hn||i===nr?"0x2":ue(s[0]),module:s[1],name:s[2],type_arguments:[],source_address:""};return a.full_address=`${a.address}::${a.module}::${a.name}`,a.source_address=Ot(a.full_address,a.type_arguments),a}catch{return{full_address:e,address:"",module:"",name:"",type_arguments:[],source_address:e}}}function Ce(e){return P(e).source_address}function er(e){return e.toLowerCase().startsWith("0x")?ue(e):e}function mn(e){for(const t in e){const i=typeof e[t];if(i==="object")mn(e[t]);else if(i==="string"){const n=e[t];e[t]=er(n)}}}var tr="0x2::coin::Coin",ir=/^0x2::coin::Coin<(.+)>$/,hn="0x2::sui::SUI",nr="0x0000000000000000000000000000000000000000000000000000000000000002::sui::SUI",G=class{static getCoinTypeArg(e){const t=e.type.match(ir);return t?t[1]:null}static isSUI(e){const t=G.getCoinTypeArg(e);return t?G.getCoinSymbol(t)==="SUI":!1}static getCoinSymbol(e){return e.substring(e.lastIndexOf(":")+1)}static getBalance(e){return BigInt(e.fields.balance)}static totalBalance(e,t){let i=BigInt(0);return e.forEach(n=>{t===n.coinAddress&&(i+=BigInt(n.balance))}),i}static getID(e){return e.fields.id.id}static getCoinTypeFromArg(e){return`${tr}<${e}>`}static getFaucetCoins(e){const{events:t}=e,i=[];return t==null||t.forEach(n=>{const{type:o}=n;if(P(o).name==="InitEvent"){const s=n.parsedJson;i.push({transactionModule:n.transactionModule,suplyID:s.suplyID,decimals:s.decimals})}}),i}static getCoinAssets(e,t){const i=[];return t.forEach(n=>{Ce(n.coinAddress)===Ce(e)&&i.push(n)}),i}static isSuiCoin(e){return P(e).full_address===hn}static selectCoinObjectIdGreaterThanOrEqual(e,t,i=[]){const n=G.selectCoinAssetGreaterThanOrEqual(e,t,i),o=n.selectedCoins.map(a=>a.coinObjectId),s=n.remainingCoins,r=n.selectedCoins.map(a=>a.balance.toString());return{objectArray:o,remainCoins:s,amountArray:r}}static selectCoinAssetGreaterThanOrEqual(e,t,i=[]){const n=G.sortByBalance(e.filter(c=>!i.includes(c.coinObjectId))),o=G.calculateTotalBalance(n);if(o<t)return{selectedCoins:[],remainingCoins:n};if(o===t)return{selectedCoins:n,remainingCoins:[]};let s=BigInt(0);const r=[],a=[...n];for(;s<o;){const c=t-s,d=a.findIndex(p=>p.balance>=c);if(d!==-1){r.push(a[d]),a.splice(d,1);break}const _=a.pop();_.balance>0&&(r.push(_),s+=_.balance)}return{selectedCoins:G.sortByBalance(r),remainingCoins:G.sortByBalance(a)}}static sortByBalance(e){return e.sort((t,i)=>t.balance<i.balance?-1:t.balance>i.balance?1:0)}static sortByBalanceDes(e){return e.sort((t,i)=>t.balance>i.balance?-1:t.balance<i.balance?0:1)}static calculateTotalBalance(e){return e.reduce((t,i)=>t+i.balance,BigInt(0))}},st=class{constructor(e,t){F(this,"numerator");F(this,"denominator");this.toString=()=>`${this.numerator.toString()}/${this.denominator.toString()}`,this.numerator=e,this.denominator=t}static fromDecimal(e){return st.fromFraction(e.toDecimalPlaces(1).mul(10).toNumber(),1e3)}static fromFraction(e,t){const i=typeof e=="number"?new g(e.toString()):e,n=typeof t=="number"?new g(t.toString()):t;return new st(i,n)}};function Qt(e,{numerator:t,denominator:i},n){return n?e.mul(i.add(t)).div(i):e.mul(i).div(i.add(t))}function qt(e,t,i){return{tokenMaxA:Qt(e.coinA,t,i),tokenMaxB:Qt(e.coinB,t,i)}}function l(e){return $.isDecimal(e)?e:new $(e===void 0?0:e)}function or(e){return l(10).pow(l(e).abs())}function _t(e){return e.data}function gn(e){if(e.error&&"object_id"in e.error&&"version"in e.error&&"digest"in e.error){const{error:t}=e;return{objectId:t.object_id,version:t.version,digest:t.digest}}}function fn(e){if(e.error&&"object_id"in e.error&&!("version"in e.error)&&!("digest"in e.error))return e.error.object_id}function sr(e){if("reference"in e)return e.reference;const t=_t(e);return t?{objectId:t.objectId,version:t.version,digest:t.digest}:gn(e)}function ut(e){var t;return"objectId"in e?e.objectId:((t=sr(e))==null?void 0:t.objectId)??fn(e)}function rr(e){return e.data!==void 0}function ar(e){return e.content!==void 0}function yn(e){const t="data"in e?_t(e):e;if(!(!t||!ar(t)||t.content.dataType!=="moveObject"))return t.content}function ve(e){var t;return(t=yn(e))==null?void 0:t.type}function et(e){var i;const t=rr(e)?e.data:e;return!(t!=null&&t.type)&&"data"in e?((i=t==null?void 0:t.content)==null?void 0:i.dataType)==="package"?"package":ve(e):t==null?void 0:t.type}function bn(e){var t;return(t=_t(e))==null?void 0:t.previousTransaction}function Dt(e){var t;return(t=_t(e))==null?void 0:t.owner}function cr(e){var i;const t=(i=_t(e))==null?void 0:i.display;return t||{data:null,error:null}}function R(e){var i;const t=(i=yn(e))==null?void 0:i.fields;if(t)return"fields"in t?t.fields:t}function ur(e,t){const i=or(l(t));return Number(l(e).mul(i))}function $e(e,t=32){return BigInt.asUintN(t,BigInt(e)).toString()}function ce(e,t=32){return Number(BigInt.asIntN(t,BigInt(e)))}function Nt(e){const t=cr(e).data,i={creator:"",description:"",image_url:"",link:"",name:"",project_url:""};return t&&(i.creator=t.creator,i.description=t.description,i.image_url=t.image_url,i.link=t.link,i.name=t.name,i.project_url=t.project_url),i}function pi(e){let t={creator:"",description:"",image_url:"",link:"",name:"",project_url:""},i={...t,pos_object_id:"",owner:"",type:"",coin_type_a:"",coin_type_b:"",liquidity:"",tick_lower_index:0,tick_upper_index:0,index:0,pool:"",reward_amount_owed_0:"0",reward_amount_owed_1:"0",reward_amount_owed_2:"0",reward_growth_inside_0:"0",reward_growth_inside_1:"0",reward_growth_inside_2:"0",fee_growth_inside_a:"0",fee_owed_a:"0",fee_growth_inside_b:"0",fee_owed_b:"0",position_status:"Exists"},n=R(e);if(n){const r=ve(e),a=Dt(e);"nft"in n?(n=n.nft.fields,t.description=n.description,t.name=n.name,t.link=n.url):t=Nt(e),i={...t,pos_object_id:n.id.id,owner:a.AddressOwner,type:r,coin_type_a:n.coin_type_a.fields.name,coin_type_b:n.coin_type_b.fields.name,liquidity:n.liquidity,tick_lower_index:ce(BigInt(n.tick_lower_index.fields.bits)),tick_upper_index:ce(BigInt(n.tick_upper_index.fields.bits)),index:n.index,pool:n.pool,reward_amount_owed_0:"0",reward_amount_owed_1:"0",reward_amount_owed_2:"0",reward_growth_inside_0:"0",reward_growth_inside_1:"0",reward_growth_inside_2:"0",fee_growth_inside_a:"0",fee_owed_a:"0",fee_growth_inside_b:"0",fee_owed_b:"0",position_status:"Exists"}}const o=gn(e);o&&(i.pos_object_id=o.objectId,i.position_status="Deleted");const s=fn(e);return s&&(i.pos_object_id=s,i.position_status="NotExists"),i}function dr(e){const t=G.isSuiCoin(e.coinTypeA),i=G.isSuiCoin(e.coinTypeB);return{isAdjustCoinA:t,isAdjustCoinB:i}}function lr(e,t){return $.ceil(l(e).div(1+t)).toString()}var M=class{static createCollectRewarderAndFeeParams(e,t,i,n,o,s){o===void 0&&(o=[...n]),s===void 0&&(s=[...n]);const r=Ce(i.coinTypeA),a=Ce(i.coinTypeB);if(i.collect_fee){const d=M.buildCoinForAmount(t,o,BigInt(0),r,!1);o=d.remainCoins;const _=M.buildCoinForAmount(t,s,BigInt(0),a,!1);s=_.remainCoins,t=e.Position.createCollectFeePaylod({pool_id:i.pool_id,pos_id:i.pos_id,coinTypeA:i.coinTypeA,coinTypeB:i.coinTypeB},t,d.targetCoin,_.targetCoin)}const c=[];return i.rewarder_coin_types.forEach(d=>{switch(Ce(d)){case r:c.push(M.buildCoinForAmount(t,o,BigInt(0),d,!1).targetCoin);break;case a:c.push(M.buildCoinForAmount(t,s,BigInt(0),d,!1).targetCoin);break;default:c.push(M.buildCoinForAmount(t,n,BigInt(0),d,!1).targetCoin);break}}),t=e.Rewarder.createCollectRewarderPaylod(i,t,c),t}static async adjustTransactionForGas(e,t,i,n){n.setSender(e.senderAddress);const o=G.selectCoinAssetGreaterThanOrEqual(t,i).selectedCoins;if(o.length===0)throw new Error("Insufficient balance");const s=G.calculateTotalBalance(t);if(s-i>1e9)return{fixAmount:i};const r=await e.fullClient.calculationTxGas(n);if(G.selectCoinAssetGreaterThanOrEqual(t,BigInt(r),o.map(c=>c.coinObjectId)).selectedCoins.length===0){const c=BigInt(r)+BigInt(500);if(s-i<c){if(i-=c,i<0)throw new Error("gas Insufficient balance");const d=new T;return{fixAmount:i,newTx:d}}}return{fixAmount:i}}static async buildAddLiquidityFixTokenForGas(e,t,i,n){let o=await M.buildAddLiquidityFixToken(e,t,i);const{isAdjustCoinA:s}=dr(i),r=s?i.amount_a:i.amount_b,a=await M.adjustTransactionForGas(e,G.getCoinAssets(s?i.coinTypeA:i.coinTypeB,t),BigInt(r),o),{fixAmount:c}=a,{newTx:d}=a;if(d!==void 0){let _,p;if(s)i.amount_a=Number(c),_=M.buildAddLiquidityFixTokenCoinInput(d,!i.fix_amount_a,c.toString(),i.slippage,i.coinTypeA,t,!1),p=M.buildAddLiquidityFixTokenCoinInput(d,i.fix_amount_a,i.amount_b,i.slippage,i.coinTypeB,t,!1);else return i.amount_b=Number(c),_=M.buildAddLiquidityFixTokenCoinInput(d,!i.fix_amount_a,i.amount_a,i.slippage,i.coinTypeA,t,!1),p=M.buildAddLiquidityFixTokenCoinInput(d,i.fix_amount_a,c.toString(),i.slippage,i.coinTypeB,t,!1),i=M.fixAddLiquidityFixTokenParams(i,n.slippage,n.curSqrtPrice),o=await M.buildAddLiquidityFixTokenArgs(d,e,t,i,_,p),o}return o}static async buildAddLiquidityFixToken(e,t,i){if(e.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");let n=new T;const o=M.buildAddLiquidityFixTokenCoinInput(n,!i.fix_amount_a,i.amount_a,i.slippage,i.coinTypeA,t,!1),s=M.buildAddLiquidityFixTokenCoinInput(n,i.fix_amount_a,i.amount_b,i.slippage,i.coinTypeB,t,!1);return n=M.buildAddLiquidityFixTokenArgs(n,e,t,i,o,s),n}static buildAddLiquidityFixTokenCoinInput(e,t,i,n,o,s,r=!0){return t?M.buildCoinForAmountInterval(e,s,{amountSecond:BigInt(lr(i,n)),amountFirst:BigInt(i)},o,r):M.buildCoinForAmount(e,s,BigInt(i),o,r)}static fixAddLiquidityFixTokenParams(e,t,i){const n=e.fix_amount_a?e.amount_a:e.amount_b,o=ie.estLiquidityAndcoinAmountFromOneAmounts(Number(e.tick_lower),Number(e.tick_upper),new g(n),e.fix_amount_a,!0,t,i);return e.amount_a=e.fix_amount_a?e.amount_a:o.tokenMaxA.toNumber(),e.amount_b=e.fix_amount_a?o.tokenMaxB.toNumber():e.amount_b,e}static buildAddLiquidityFixTokenArgs(e,t,i,n,o,s){const r=[n.coinTypeA,n.coinTypeB],a=n.is_open?"open_position_with_liquidity_by_fix_coin":"add_liquidity_by_fix_coin",{clmm_pool:c,integrate:d}=t.sdkOptions;n.is_open||(e=M.createCollectRewarderAndFeeParams(t,e,n,i,o.remainCoins,s.remainCoins));const _=h(c),p=n.is_open?[e.object(_.global_config_id),e.object(n.pool_id),e.pure($e(BigInt(n.tick_lower)).toString()),e.pure($e(BigInt(n.tick_upper)).toString()),o.targetCoin,s.targetCoin,e.pure(n.amount_a),e.pure(n.amount_b),e.pure(n.fix_amount_a),e.object(v)]:[e.object(_.global_config_id),e.object(n.pool_id),e.object(n.pos_id),o.targetCoin,s.targetCoin,e.pure(n.amount_a),e.pure(n.amount_b),e.pure(n.fix_amount_a),e.object(v)];return e.moveCall({target:`${d.published_at}::${Yt}::${a}`,typeArguments:r,arguments:p}),e}static async buildSwapTransactionForGas(e,t,i,n){let o=M.buildSwapTransaction(e,t,i);o.setSender(e.senderAddress);const s=await M.adjustTransactionForGas(e,G.getCoinAssets(t.a2b?t.coinTypeA:t.coinTypeB,i),BigInt(t.by_amount_in?t.amount:t.amount_limit),o),{fixAmount:r,newTx:a}=s;if(a!==void 0){a.setSender(e.senderAddress),t.by_amount_in?t.amount=r.toString():t.amount_limit=r.toString(),t=await M.fixSwapParams(e,t,n);const c=M.buildCoinForAmount(o,i,t.a2b?BigInt(t.by_amount_in?t.amount:t.amount_limit):BigInt(0),t.coinTypeA),d=M.buildCoinForAmount(o,i,t.a2b?BigInt(0):BigInt(t.by_amount_in?t.amount:t.amount_limit),t.coinTypeB);o=M.buildSwapTransactionArgs(a,t,e.sdkOptions,c,d)}return o}static buildSwapTransaction(e,t,i){let n=new T;n.setSender(e.senderAddress);const o=M.buildCoinForAmount(n,i,t.a2b?BigInt(t.by_amount_in?t.amount:t.amount_limit):BigInt(0),t.coinTypeA,!1),s=M.buildCoinForAmount(n,i,t.a2b?BigInt(0):BigInt(t.by_amount_in?t.amount:t.amount_limit),t.coinTypeB,!1);return n=M.buildSwapTransactionArgs(n,t,e.sdkOptions,o,s),n}static buildSwapTransactionArgs(e,t,i,n,o){const{clmm_pool:s,integrate:r}=i,a=Ke.getDefaultSqrtPriceLimit(t.a2b),c=[t.coinTypeA,t.coinTypeB],{global_config_id:d}=h(s);if(d===void 0)throw Error("clmm.config.global_config_id is undefined");const _=t.swap_partner!==void 0,p=_?t.a2b?"swap_a2b_with_partner":"swap_b2a_with_partner":t.a2b?"swap_a2b":"swap_b2a",m=_?[e.pure(d),e.pure(t.pool_id),e.pure(t.swap_partner),n.targetCoin,o.targetCoin,e.pure(t.by_amount_in),e.pure(t.amount),e.pure(t.amount_limit),e.pure(a.toString()),e.pure(v)]:[e.pure(d),e.pure(t.pool_id),n.targetCoin,o.targetCoin,e.pure(t.by_amount_in),e.pure(t.amount),e.pure(t.amount_limit),e.pure(a.toString()),e.pure(v)];return e.moveCall({target:`${r.published_at}::${Yt}::${p}`,typeArguments:c,arguments:m}),e}static async fixSwapParams(e,t,i){const{currentPool:n}=i;try{const o=await e.Swap.preswap({decimalsA:i.decimalsA,decimalsB:i.decimalsB,a2b:t.a2b,byAmountIn:t.by_amount_in,amount:t.amount,pool:n,currentSqrtPrice:n.current_sqrt_price,coinTypeA:n.coinTypeA,coinTypeB:n.coinTypeB}),s=i.byAmountIn?o.estimatedAmountOut:o.estimatedAmountIn,r=Qt(s,i.slippage,!i.byAmountIn);t.amount_limit=r.toString()}catch(o){console.log("fixSwapParams",o)}return t}static async syncBuildCoinInputForAmount(e,t,i,n,o=!0){if(e.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const s=await e.getOwnerCoinAssets(e.senderAddress,n);return M.buildCoinForAmount(t,s,i,n,o).targetCoin}static buildCoinForAmount(e,t,i,n,o=!0,s=!1){const r=G.getCoinAssets(n,t);if(i===BigInt(0)&&r.length===0)return M.buildZeroValueCoin(t,e,n,o);const a=G.calculateTotalBalance(r);if(a<i)throw new Error(`The amount(${a}) is Insufficient balance for ${n} , expect ${i} `);return M.buildCoin(e,t,r,i,n,o,s)}static buildCoin(e,t,i,n,o,s=!0,r=!1){if(G.isSuiCoin(o)){if(s){const j=e.splitCoins(e.gas,[e.pure(n.toString())]);return{targetCoin:e.makeMoveVec({objects:[j]}),remainCoins:t,tragetCoinAmount:n.toString(),isMintZeroCoin:!1,originalSplitedCoin:e.gas}}if(n===0n&&i.length>1){const j=G.selectCoinObjectIdGreaterThanOrEqual(i,n);return{targetCoin:e.object(j.objectArray[0]),remainCoins:j.remainCoins,tragetCoinAmount:j.amountArray[0],isMintZeroCoin:!1}}const w=G.selectCoinObjectIdGreaterThanOrEqual(i,n);return{targetCoin:e.splitCoins(e.gas,[e.pure(n.toString())]),remainCoins:w.remainCoins,tragetCoinAmount:n.toString(),isMintZeroCoin:!1,originalSplitedCoin:e.gas}}const a=G.selectCoinObjectIdGreaterThanOrEqual(i,n),c=a.amountArray.reduce((w,b)=>Number(w)+Number(b),0).toString(),d=a.objectArray;if(s)return{targetCoin:e.makeMoveVec({objects:d.map(w=>e.object(w))}),remainCoins:a.remainCoins,tragetCoinAmount:a.amountArray.reduce((w,b)=>Number(w)+Number(b),0).toString(),isMintZeroCoin:!1};const[_,...p]=d,m=e.object(_);let y=m,S=a.amountArray.reduce((w,b)=>Number(w)+Number(b),0).toString(),C;return p.length>0&&e.mergeCoins(m,p.map(w=>e.object(w))),r&&Number(c)>Number(n)&&(y=e.splitCoins(m,[e.pure(n.toString())]),S=n.toString(),C=m),{targetCoin:y,remainCoins:a.remainCoins,originalSplitedCoin:C,tragetCoinAmount:S,isMintZeroCoin:!1}}static buildZeroValueCoin(e,t,i,n=!0){const o=M.callMintZeroValueCoin(t,i);let s;return n?s=t.makeMoveVec({objects:[o]}):s=o,{targetCoin:s,remainCoins:e,isMintZeroCoin:!0,tragetCoinAmount:"0"}}static buildCoinForAmountInterval(e,t,i,n,o=!0){const s=G.getCoinAssets(n,t);if(i.amountFirst===BigInt(0))return s.length>0?M.buildCoin(e,[...t],[...s],i.amountFirst,n,o):M.buildZeroValueCoin(t,e,n,o);const r=G.calculateTotalBalance(s);if(r>=i.amountFirst)return M.buildCoin(e,[...t],[...s],i.amountFirst,n,o);if(r<i.amountSecond)throw new Error(`The amount(${r}) is Insufficient balance for ${n} , expect ${i.amountSecond} `);return M.buildCoin(e,[...t],[...s],i.amountSecond,n,o)}static async buildRouterSwapTransaction(e,t,i,n){let o=new T;return t.paths.length>1&&(t.partner=""),o=await this.buildRouterBasePathTx(e,t,i,n,o),o}static async buildRouterBasePathTx(e,t,i,n,o){const s=t.paths.filter(j=>j&&j.poolAddress),r=Number(s.reduce((j,I)=>j.add(I.amountIn),H).toString()),a=Number(s.reduce((j,I)=>j.add(I.amountOut),H).toString()),c=Math.round(i?Number(a.toString())*(1-t.priceSlippagePoint):Number(r.toString())*(1+t.priceSlippagePoint)),d=t.paths[0].coinType[0],_=t.paths[0].coinType[t.paths[0].coinType.length-1],p=M.buildCoinForAmount(o,n,BigInt(i?r:c),d,!1,!0),m=p.originalSplitedCoin!==void 0,y=M.buildCoinForAmount(o,n,0n,_,!1),S=await this.buildRouterBasePathReturnCoins(e,t,i,p,y,o),C=[],{toCoin:w,fromCoin:b}=S;if(o=S.tx,y.isMintZeroCoin?C.push(w):y.originalSplitedCoin!==void 0?o.mergeCoins(y.originalSplitedCoin,[w]):o.mergeCoins(y.targetCoin,[w]),m){const j=p==null?void 0:p.originalSplitedCoin;o.mergeCoins(j,[b])}else C.push(b);return C.length>0&&o.transferObjects(C,o.pure(e.senderAddress)),o}static async buildRouterBasePathReturnCoins(e,t,i,n,o,s){const{clmm_pool:r,integrate:a}=e.sdkOptions,c=h(r).global_config_id,d=t.paths.filter(I=>I&&I.poolAddress),_=Number(d.reduce((I,D)=>I.add(D.amountIn),H).toString()),p=Number(d.reduce((I,D)=>I.add(D.amountOut),H).toString()),m=Math.round(i?Number(p.toString())*(1-t.priceSlippagePoint):Number(_.toString())*(1+t.priceSlippagePoint)),y=t.paths[0].coinType[0],S=t.paths[0].coinType[t.paths[0].coinType.length-1];let C=n.targetCoin,w;o.isMintZeroCoin||o.originalSplitedCoin!==void 0?w=o.targetCoin:w=M.callMintZeroValueCoin(s,S);const b=t.partner==="",j=b?nt:Si;for(const I of d)if(I.poolAddress.length===1){const D=I.a2b[0],Z={amount:Number(I.amountIn.toString()),amountLimit:m,poolCoinA:I.a2b[0]?y:S,poolCoinB:I.a2b[0]?S:y},W=b?"swap":"swap_with_partner",ee=D?C:w,_e=D?w:C,Se=i?I.amountIn.toString():I.amountOut.toString(),ke=Ke.getDefaultSqrtPriceLimit(D).toString(),Me=b?[s.object(c),s.object(I.poolAddress[0]),ee,_e,s.pure(D),s.pure(i),s.pure(Se),s.pure(ke),s.pure(!1),s.object(v)]:[s.object(c),s.object(I.poolAddress[0]),s.pure(t.partner),ee,_e,s.pure(D),s.pure(i),s.pure(Se),s.pure(ke),s.pure(!1),s.object(v)],pt=[Z.poolCoinA,Z.poolCoinB],mt=s.moveCall({target:`${e.sdkOptions.integrate.published_at}::${j}::${W}`,typeArguments:pt,arguments:Me});C=D?mt[0]:mt[1],w=D?mt[1]:mt[0]}else{const D=i?I.amountIn:I.rawAmountLimit[0],Z=i?0:I.amountOut;let W="";I.a2b[0]?I.a2b[1]?W="swap_ab_bc":W="swap_ab_cb":I.a2b[1]?W="swap_ba_bc":W="swap_ba_cb",b||(W=`${W}_with_partner`);const ee=Ke.getDefaultSqrtPriceLimit(I.a2b[0]),_e=Ke.getDefaultSqrtPriceLimit(I.a2b[1]),Se=b?[s.object(c),s.object(I.poolAddress[0]),s.object(I.poolAddress[1]),C,w,s.pure(i),s.pure(D.toString()),s.pure(Z.toString()),s.pure(ee.toString()),s.pure(_e.toString()),s.object(v)]:[s.object(c),s.object(I.poolAddress[0]),s.object(I.poolAddress[1]),s.pure(t.partner),C,w,s.pure(i),s.pure(D.toString()),s.pure(Z.toString()),s.pure(ee.toString()),s.pure(_e.toString()),s.object(v)],ke=[I.coinType[0],I.coinType[1],I.coinType[2]],Me=s.moveCall({target:`${a.published_at}::${j}::${W}`,typeArguments:ke,arguments:Se});C=Me[0],w=Me[1]}return this.checkCoinThreshold(e,i,s,w,m,S),{fromCoin:C,toCoin:w,tx:s}}static async buildAggregatorSwapReturnCoins(e,t,i,n,o,s,r){t.splitPaths.length>1&&(o="");let a,c;const d=t.splitPaths.some(_=>_.basePaths.some(p=>p.label==="Deepbook"));if((!t.byAmountIn||t.splitPaths.length===1)&&!d){const _=[];for(const y of t.splitPaths){const S=[],C=[],w=[],b=[];for(let I=0;I<y.basePaths.length;I+=1){const D=y.basePaths[I];S.push(D.direction),C.push(D.poolAddress),w.push(new g(D.inputAmount.toString())),I===0?b.push(D.fromCoin,D.toCoin):b.push(D.toCoin)}const j={amountIn:new g(y.inputAmount.toString()),amountOut:new g(y.outputAmount.toString()),poolAddress:C,a2b:S,rawAmountLimit:w,isExceed:!1,coinType:b};_.push(j)}const p={paths:_,partner:o,priceSlippagePoint:s},m=await this.buildRouterBasePathReturnCoins(e,p,t.byAmountIn,i,n,r);a=m.fromCoin,c=m.toCoin,r=m.tx}else{const _=Math.round(t.outputAmount*(1-s));a=i.targetCoin,n.isMintZeroCoin||n.originalSplitedCoin!==void 0?c=n.targetCoin:c=M.callMintZeroValueCoin(r,t.toCoin);let p=!1,m;if(d){const[y,S]=Ai.createAccountCap(e.senderAddress,e.sdkOptions,r);r=S,m=y,p=!0}for(let y=0;y<t.splitPaths.length;y+=1){const S=t.splitPaths[y];let C;for(let w=0;w<S.basePaths.length;w+=1){const b=S.basePaths[w];if(b.label==="Deepbook")if(w===0)if(S.basePaths.length===1){const j=this.buildDeepbookBasePathTx(e,b,r,m,a,c,!1);a=j.from,c=j.to}else{C=M.callMintZeroValueCoin(r,b.toCoin);const j=this.buildDeepbookBasePathTx(e,b,r,m,a,C,!1);a=j.from,C=j.to}else{const j=this.buildDeepbookBasePathTx(e,b,r,m,C,c,!0);C=j.from,c=j.to}if(b.label==="Cetus")if(w===0)if(S.basePaths.length===1){const j=this.buildClmmBasePathTx(e,b,r,t.byAmountIn,a,c,!1,o);a=j.from,c=j.to}else{C=M.callMintZeroValueCoin(r,b.toCoin);const j=this.buildClmmBasePathTx(e,b,r,t.byAmountIn,a,C,!1,o);a=j.from,C=j.to}else{const j=this.buildClmmBasePathTx(e,b,r,t.byAmountIn,C,c,!0,o);C=j.from,c=j.to,r.moveCall({target:`${e.sdkOptions.integrate.published_at}::${qs}::send_coin`,typeArguments:[b.fromCoin],arguments:[C,r.pure(e.senderAddress)]})}}}this.checkCoinThreshold(e,t.byAmountIn,r,c,_,t.toCoin),p&&(r=Ai.deleteAccountCapByObject(m,e.sdkOptions,r))}return{fromCoin:a,toCoin:c,tx:r}}static async buildAggregatorSwapTransaction(e,t,i,n,o){let s=new T;const r=t.byAmountIn?Math.round(t.outputAmount*(1-o)):Math.round(t.inputAmount*(1+o)),a=M.buildCoinForAmount(s,i,t.byAmountIn?BigInt(t.inputAmount):BigInt(r),t.fromCoin,!1,!0),c=a.originalSplitedCoin!==void 0,d=M.buildCoinForAmount(s,i,0n,t.toCoin,!1),_=await this.buildAggregatorSwapReturnCoins(e,t,a,d,n,o,s),{fromCoin:p,toCoin:m}=_;s=_.tx;const y=[];if(d.isMintZeroCoin?y.push(m):d.originalSplitedCoin!==void 0?s.mergeCoins(d.originalSplitedCoin,[m]):s.mergeCoins(d.targetCoin,[m]),c){const S=a.originalSplitedCoin;s.mergeCoins(S,[p])}else y.push(p);return y.length>0&&s.transferObjects(y,s.pure(e.senderAddress)),s}static checkCoinThreshold(e,t,i,n,o,s){t&&i.moveCall({target:`${e.sdkOptions.integrate.published_at}::${nt}::check_coin_threshold`,typeArguments:[s],arguments:[n,i.pure(o)]})}static buildDeepbookBasePathTx(e,t,i,n,o,s,r){const a=t.direction?o:s,c=t.direction?s:o,d=[i.object(t.poolAddress),n,i.pure(t.inputAmount),i.pure(0),i.pure(t.direction),a,c,i.pure(r),i.object(v)],_=t.direction?[t.fromCoin,t.toCoin]:[t.toCoin,t.fromCoin],p=i.moveCall({target:`${e.sdkOptions.deepbook_endpoint_v2.published_at}::endpoints_v2::swap`,typeArguments:_,arguments:d});return o=t.direction?p[0]:p[1],s=t.direction?p[1]:p[0],{from:o,to:s,tx:i}}static buildClmmBasePathTx(e,t,i,n,o,s,r,a){const{clmm_pool:c,integrate:d}=e.sdkOptions,_=h(c).global_config_id;let p=t.direction?o:s,m=t.direction?s:o;const y=a==="",S=y?nt:Si,C=y?"swap":"swap_with_partner",w=n?t.inputAmount.toString():t.outputAmount.toString(),b=Ke.getDefaultSqrtPriceLimit(t.direction),j=y?[i.object(_),i.object(t.poolAddress),p,m,i.pure(t.direction),i.pure(n),i.pure(w),i.pure(b.toString()),i.pure(r),i.object(v)]:[i.object(_),i.object(t.poolAddress),i.pure(a),p,m,i.pure(t.direction),i.pure(n),i.pure(w),i.pure(b.toString()),i.pure(r),i.object(v)],I=t.direction?[t.fromCoin,t.toCoin]:[t.toCoin,t.fromCoin],D=i.moveCall({target:`${d.published_at}::${S}::${C}`,typeArguments:I,arguments:j});return p=D[0],m=D[1],o=t.direction?p:m,s=t.direction?m:p,{from:o,to:s,tx:i}}static buildCoinTypePair(e,t){const i=[];if(e.length===2){const n=[];n.push(e[0],e[1]),i.push(n)}else{const n=[];n.push(e[0],e[e.length-1]),i.push(n);for(let o=1;o<e.length-1;o+=1){if(t[o-1]===0)continue;const s=[];s.push(e[0],e[o],e[e.length-1]),i.push(s)}}return i}},V=M;Ns(V,"callMintZeroValueCoin",(e,t)=>e.moveCall({target:"0x2::coin::zero",typeArguments:[t]}));var Je=new g(1e9),Ai=class{static createAccountCap(e,t,i,n=!1){const{deepbook:o}=t,[s]=i.moveCall({target:`${o.published_at}::${$s}::create_account`,typeArguments:[],arguments:[]});return n&&i.transferObjects([s],i.pure(e)),[s,i]}static deleteAccountCap(e,t,i){const{deepbook:n}=t,o=[i.pure(e)];return i.moveCall({target:`${n.published_at}::${Ft}::delete_account_cap`,typeArguments:[],arguments:o}),i}static deleteAccountCapByObject(e,t,i){const{deepbook:n}=t,o=[e];return i.moveCall({target:`${n.published_at}::${Ft}::delete_account_cap`,typeArguments:[],arguments:o}),i}static async getAccountCap(e){const t=await e.fullClient.getOwnedObjectsByPage(e.senderAddress,{options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0},filter:{MoveModule:{package:e.sdkOptions.deepbook.package_id,module:Ft}}});return t.data.length===0?"":t.data[0].data.objectId}static async getPools(e){const t=e.sdkOptions.deepbook.package_id,i=[];try{(await e.fullClient.queryEventsByPage({MoveEventType:`${t}::clob_v2::PoolCreated`})).data.forEach(o=>{const s=o.parsedJson;s&&i.push({poolID:s.pool_id,tickSize:Number(s.tick_size),lotSize:Number(s.lot_size),takerFeeRate:Number(s.taker_fee_rate),makerRebateRate:Number(s.maker_rebate_rate),baseAsset:s.base_asset.name,quoteAsset:s.quote_asset.name})})}catch(n){console.log("getPoolImmutables",n)}return i}static async getPoolAsks(e,t,i,n){var m;const{simulationAccount:o}=e.sdkOptions,{deepbook_endpoint_v2:s}=e.sdkOptions,r=new T,a=[],c=[i,n],d=[r.pure(t),r.pure("0"),r.pure("999999999999"),r.pure(v)];r.moveCall({target:`${s.published_at}::endpoints_v2::get_level2_book_status_ask_side`,arguments:d,typeArguments:c});const p=(m=(await e.fullClient.devInspectTransactionBlock({transactionBlock:r,sender:o.address})).events)==null?void 0:m.filter(y=>P(y.type).name==="BookStatus");if(p.length===0)return a;for(let y=0;y<p[0].parsedJson.depths.length;y++){const S=p[0].parsedJson.price[y],C=p[0].parsedJson.depths[y],w={price:parseInt(S,10),quantity:parseInt(C,10)};a.push(w)}return a}static async getPoolBids(e,t,i,n){var m;const{simulationAccount:o}=e.sdkOptions,{deepbook_endpoint_v2:s}=e.sdkOptions,r=new T,a=[],c=[i,n],d=[r.pure(t),r.pure("0"),r.pure("999999999999"),r.pure(v)];r.moveCall({target:`${s.published_at}::endpoints_v2::get_level2_book_status_bid_side`,arguments:d,typeArguments:c});const p=(m=(await e.fullClient.devInspectTransactionBlock({transactionBlock:r,sender:o.address})).events)==null?void 0:m.filter(y=>P(y.type).name==="BookStatus");if(p.length===0)return a;for(let y=0;y<p[0].parsedJson.depths.length;y++){const S=p[0].parsedJson.price[y],C=p[0].parsedJson.depths[y],w={price:parseInt(S,10),quantity:parseInt(C,10)};a.push(w)}return a}static async preSwap(e,t,i,n){let o=!1,s=H,r=new g(n),a=H;const c=new g(n);if(i){let d=await this.getPoolBids(e,t.poolID,t.baseAsset,t.quoteAsset);d===null&&(o=!0),d=d.sort((_,p)=>p.price-_.price);for(let _=0;_<d.length;_+=1){const p=new g(d[_].quantity),m=new g(d[_].price),y=p.mul(new g(m)).mul(new g(t.takerFeeRate)).div(Je).div(Je);if(r.gt(p))r=r.sub(p),s=s.add(p.mul(m).div(Je).sub(y)),a=a.add(y);else{const S=r.mul(new g(d[_].price)).div(Je),C=S.mul(new g(t.takerFeeRate)).div(Je);s=s.add(S.sub(C)),r=r.sub(r),a=a.add(C)}if(r.eq(H))break}}else{const d=await this.getPoolAsks(e,t.poolID,t.baseAsset,t.quoteAsset);d===null&&(o=!0);for(let _=0;_<d.length;_+=1){const p=new g(d[_].price).mul(new g(d[_].quantity)).div(new g(1e9)),m=p.mul(new g(t.takerFeeRate)).div(Je),y=p.add(m);if(r.gt(p))s=s.add(new g(d[_].quantity)),r=r.sub(y),a=a.add(m);else{const S=new g(d[_].quantity).div(new g(t.lotSize)),C=y.div(S),w=r.div(C);s=s.add(w.muln(t.lotSize)),r=r.sub(w.mul(C)),a=a.add(w.div(S).mul(m))}if(r.eq(H))break}}return{poolAddress:t.poolID,estimatedAmountIn:c.sub(r).toNumber(),estimatedAmountOut:s.toNumber(),estimatedFeeAmount:a,isExceed:o,amount:Number(n),aToB:i,byAmountIn:!0}}static async simulateSwap(e,t,i,n,o,s){var Z;const{deepbook_endpoint_v2:r}=e.sdkOptions;let a=new T;const c=await this.getAccountCap(e);let d;if(c===""){const W=this.createAccountCap(e.senderAddress,e.sdkOptions,a),ee=W[0];a=W[1],d=ee}else d=a.pure(c);const _=await e.getOwnerCoinAssets(e.senderAddress),p=V.buildCoinForAmount(a,_,BigInt(s),i,!1),m=p==null?void 0:p.targetCoin,y=V.buildCoinForAmount(a,_,BigInt(s),n,!1),S=y==null?void 0:y.targetCoin,C=[i,n],w=[a.pure(t),d,a.pure(s),a.pure(0),a.pure(o),m,S,a.pure(v)];a.moveCall({target:`${r.published_at}::${Ls}::swap`,arguments:w,typeArguments:C});const{simulationAccount:b}=e.sdkOptions,I=(Z=(await e.fullClient.devInspectTransactionBlock({transactionBlock:a,sender:b.address})).events)==null?void 0:Z.filter(W=>P(W.type).name==="DeepbookSwapEvent");if(I.length===0)return null;const D=I[0].parsedJson;return{poolAddress:D.pool,estimatedAmountIn:D.amount_in,estimatedAmountOut:D.amount_out,aToB:D.atob}}},$t="router",Ye=1e4,Fe=class{static buildPoolImmutables(e){const{fields:t}=e.value.fields.value;return{clmm_pool_id:P(t.clmm_pool_id).address,booster_type:P(t.booster_type.fields.name).source_address,pool_id:P(t.pool_id).address,coinTypeA:P(t.coin_type_a.fields.name).source_address,coinTypeB:P(t.coin_type_b.fields.name).source_address}}static buildPoolState(e){const t=R(e),i=[];return t.config.fields.contents.forEach(o=>{i.push({lock_day:Number(o.fields.key),multiplier:Number(l(o.fields.value).div(Ye))})}),{basic_percent:Number(l(t.basic_percent).div(Ye)),balances:{balances_handle:t.balances.fields.id.id,size:t.balances.fields.size},config:i,lock_positions:{lock_positions_handle:t.lock_positions.fields.id.id,size:t.lock_positions.fields.size},is_open:t.is_open,index:Number(t.index),pool_id:ut(e)}}static buildLockNFT(e){const t=P(ut(e)).address;return{lock_clmm_position:pi(e),locked_nft_id:t}}static buildLockPositionInfo(e){const t=R(e),{value:i}=t.value.fields;return{type:i.type,position_id:i.fields.position_id,start_time:Number(i.fields.start_time),lock_period:Number(i.fields.lock_period),end_time:Number(i.fields.end_time),growth_rewarder:i.fields.growth_rewarder,rewarder_owned:i.fields.rewarder_owned,is_settled:i.fields.is_settled}}static isLocked(e){return e.end_time>Date.parse(new Date().toString())/1e3}},_r=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=!1){var s;const{booster:t}=this._sdk.sdkOptions,i=`${t.package_id}_getPoolImmutables`,n=this.getCache(i,e),o=[];if(n!==void 0)o.push(...n);else{const r=[];(s=(await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(h(t).booster_pool_handle)).data)==null||s.forEach(d=>{r.push(d.objectId)});const c=await this._sdk.ClmmSDK.fullClient.batchGetObjects(r,{showContent:!0});for(const d of c){const _=R(d);if(_){const p=Fe.buildPoolImmutables(_);this.updateCache(`${p.pool_id}_getPoolImmutable`,p,x),o.push(p)}}}return this.updateCache(i,o,x),o}async getPoolImmutable(e){const{booster:t}=this._sdk.sdkOptions,i=`${e}_getPoolImmutable`,n=this.getCache(i);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:h(t).booster_pool_handle,name:{type:"0x2::object::ID",value:e}}),s=R(o),r=Fe.buildPoolImmutables(s);return this.updateCache(i,r,x),r}async getPools(){const e=[],i=(await this.getPoolImmutables()).map(o=>o.pool_id),n=await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showType:!0,showContent:!0});for(const o of n){const s=Fe.buildPoolState(o);if(s){const r={...await this.getPoolImmutable(s.pool_id),...s};e.push(r);const a=`${r.pool_id}_getPoolObject`;this.updateCache(a,r,x)}}return e}async getPool(e,t=!0){const i=`${e}_getPoolObject`,n=this.getCache(i,t),o=await this.getPoolImmutable(e);if(n!==void 0)return{...o,...n};const s=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),r=Fe.buildPoolState(s),a={...o,...r};return this.updateCache(i,a,x),a}async getPoolHandleId(e){const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),i=R(t);return i?i.list.fields.id.id:""}async getBoosterInitConfigs(){var n;const{package_id:e}=this.sdk.sdkOptions.booster,t=(n=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitEvent`}))==null?void 0:n.data,i={booster_config_id:"",booster_pool_handle:""};return t.length>0&&t.forEach(o=>{const s=o.parsedJson;s&&(i.booster_config_id=s.config_id)}),i.booster_pool_handle=await this.getPoolHandleId(i.booster_config_id),i}async getOwnerBoosterPositions(e,t,i){const{booster:n}=this.sdk.sdkOptions,o=[],s=[],r=`${n.package_id}::lock_nft::LockNFT<${this._sdk.ClmmSDK.Position.buildPositionType()}>`,a=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showOwner:!0},filter:{StructType:r}});for(const d of a.data)if(P(ve(d)).source_address===r&&d.data){const p=Fe.buildLockNFT(d);this.updateCache(`${p.locked_nft_id}_getBoosterPositionById`,p,x),p&&(t===void 0||t===p.lock_clmm_position.pool)&&o.push(p)}const c=await this.getLockPositionInfos(i,o.map(d=>d.locked_nft_id));for(const d of o)for(const _ of c)if(d.lock_clmm_position.pos_object_id===_.position_id){s.push({...d,..._});break}return s}async getBoosterPosition(e,t){const i=`${t}_getBoosterPositionById`,n=this.getCache(i);let o;if(n!==void 0)o=n;else{const r=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0,showOwner:!0}});o=Fe.buildLockNFT(r),this.updateCache(i,o,x)}const s=await this.getLockPositionInfo(e,t);return{...o,...s}}async getLockPositionInfos(e,t=[]){var s;const i=await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(e),n=[],o=[];return(s=i.data)==null||s.forEach(r=>{t.length>0?t.includes(r.name.value)&&n.push(r.objectId):n.push(r.objectId)}),n.length>0&&(await this._sdk.ClmmSDK.fullClient.batchGetObjects(n,{showContent:!0})).forEach(a=>{const c=Fe.buildLockPositionInfo(a);c&&o.push(c)}),o}async getLockPositionInfo(e,t){const i=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}});return Fe.buildLockPositionInfo(i)}calculateXCetusRewarder(e,t,i){let n=t.basic_percent,o="0";e.forEach(a=>{a.coin_address===t.booster_type&&(console.log("find ",t.booster_type),o=a.amount_owed.toString())}),i.is_settled||t.config.forEach(a=>{a.lock_day===i.lock_period&&(n=a.multiplier)});const s=l(o).sub(i.growth_rewarder).mul(n);return l(i.rewarder_owned).add(s).toString()}lockPositionPayload(e){const{booster:t}=this.sdk.sdkOptions,{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${$t}::lock_position`,typeArguments:[e.booster_type,e.coinTypeA,e.coinTypeB],arguments:[n.pure(h(t).booster_config_id),n.pure(h(i).global_config_id),n.pure(e.booster_pool_id),n.pure(e.clmm_pool_id),n.pure(e.clmm_position_id),n.pure(e.lock_day),n.pure(v)]}),n}canceLockPositionPayload(e){const{booster:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${$t}::cancel_lock`,typeArguments:[e.booster_type],arguments:[i.pure(h(t).booster_config_id),i.pure(e.booster_pool_id),i.pure(e.lock_nft_id),i.pure(v)]}),i}redeemPayload(e){const{booster:t,xcetus:i}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions,o=new T,s=h(i);return o.moveCall({target:`${t.published_at}::${$t}::redeem`,typeArguments:[e.booster_type,e.coinTypeA,e.coinTypeB],arguments:[o.pure(h(t).booster_config_id),o.pure(h(n).global_config_id),o.pure(e.booster_pool_id),o.pure(e.lock_nft_id),o.pure(e.clmm_pool_id),o.pure(s.lock_manager_id),o.pure(s.xcetus_manager_id),o.pure(e.ve_nft_id),o.pure(v)]}),o}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},re="router",wn=1e9,se=class{static priceRealToFix(e,t,i){const n=l(t-i).toNumber();return Number(l(e).div(l(10).pow(l(n))).toString())}static priceFixToReal(e,t,i){const n=l(t-i).toNumber();return Number(l(e).mul(l(10).pow(l(n))).toString())}static raiseTotalAmount(e,t,i){const n=l(t-i).abs().toNumber();return t>i?Number(l(e.total_supply).mul(e.current_price).div(l(10).pow(l(n))).toString()):Number(l(e.total_supply).mul(e.current_price).mul(l(10).pow(l(n))).toString())}static buildLaunchPadPool(e){const t=ve(e),i=P(t),n=R(e),o={coin_type_sale:i.type_arguments[0],coin_type_raise:i.type_arguments[1],pool_address:ue(ut(e)),is_settle:n.is_settle,current_price:l(n.initialize_price).div(l(wn)).toString(),price:n.initialize_price,min_price:"0",max_price:"0",sale_coin_amount:n.sale_coin,raise_coin_amount:n.raise_coin,total_purchase_amount:n.reality_raise_total,total_supply:n.sale_total,min_purchase:n.min_purchase,max_purchase:n.max_purchase,complete_raise_limit:n.least_raise_amount,softcap:n.softcap,max_raise_amount:n.hardcap,sale_decimals:0,raise_decimals:0,liquidity_injection_ratio:Number(n.liquidity_rate)/1e4,is_cancel:n.is_cancel,duration_summary:{start_time:Number(n.duration_manager.fields.start_time),end_time:0,settle_end_time:0,purchase_duration:Number(n.duration_manager.fields.activity_duration),settle_duration:Number(n.duration_manager.fields.settle_duration),lock_up_duration:Number(n.duration_manager.fields.locked_duration)},white_summary:{white_handle:n.white_list.fields.users.fields.id.id,protection_hard_cap:n.white_list.fields.hard_cap_total,protection_limit_used:n.white_list.fields.purchase_total,size:Number(n.white_list.fields.users.fields.size)},unused_sale:n.unused_sale,harvest_raise:n.harvest_raise,tick_spacing:Number(n.tick_spacing),owner:n.recipient,purchase_summary:{purchase_handle:n.purchase_list.fields.id.id,size:Number(n.purchase_list.fields.size)},pool_status:"Failed"};return se.updatePoolStatus(o),o}static updatePoolStatus(e){const t=Number(l(Date.now()/1e3).toFixed(0)),{duration_summary:i}=e,n=i.start_time+i.purchase_duration,o=n+i.settle_duration;if(i.end_time=n,i.settle_end_time=o,e.is_settle)e.pool_status="Ended";else if(e.is_cancel)e.pool_status="Canceled";else if(t<i.start_time)e.pool_status="Upcoming";else if(t>i.start_time&&t<n)e.pool_status="Live";else if(t>n&&t<o){const s=e.raise_coin_amount;Number(s)<Number(e.complete_raise_limit)?e.pool_status="Failed":e.pool_status="Settle"}return e}static async calculatePoolPrice(e,t){const i=await e.ClmmSDK.CetusConfig.getTokenListByCoinTypes([t.coin_type_sale,t.coin_type_raise]),n=i[t.coin_type_sale].decimals,o=i[t.coin_type_raise].decimals;t.min_price=this.priceFixToReal(Number(l(t.softcap).div(l(t.total_supply))),n,o).toString(),t.max_price=this.priceFixToReal(Number(l(t.max_raise_amount).div(l(t.total_supply))),n,o).toString(),t.current_price=this.priceFixToReal(Number(t.current_price),n,o).toString(),t.sale_decimals=n,t.raise_decimals=o}static async getWithdrawRaise(e){return e.pool_status==="Ended"?e.harvest_raise:"0"}static async getWithdrawSale(e){return e.pool_status==="Ended"?e.unused_sale:e.sale_coin_amount}static async getHistoryWithdrawRaise(e,t){if(t.pool_status==="Ended"){if(l(t.harvest_raise).equals(l(0))){const n=await e.Launchpad.getSettleEvent(t.pool_address);n&&(t.harvest_raise=n.unused_raise)}const i=g.min(new g(t.total_purchase_amount),new g(t.max_raise_amount));return l(i.toString()).mul(1-t.liquidity_injection_ratio).toString()}return"0"}static async getHistoryWithdrawSale(e,t){if(t.pool_status==="Ended"){const i=await e.Launchpad.getSettleEvent(t.pool_address);return i&&(t.unused_sale=i.unused_sale),t.unused_sale}return"0"}static async getOverrecruitReverseAmount(e,t){const i=await e.Launchpad.getPurchaseMarks(e.ClmmSDK.senderAddress,[t.pool_address],!1);if(i.length>0){const n=i[0].purchased_raise_amount,o=(await e.Launchpad.getPurchaseAmount(t.white_summary.white_handle,e.ClmmSDK.senderAddress)).safe_purchased_amount,{protection_limit_used:s}=t.white_summary;return l(n).sub(o).div(l(t.total_purchase_amount).sub(s)).mul(l(t.total_purchase_amount).sub(t.max_raise_amount)).toString()}return"0"}static async getCanPurchaseAmount(e,t){const i=await se.getOverrecruitReverseAmount(e,t),n=await e.Launchpad.getPurchaseMarks(e.ClmmSDK.senderAddress,[t.pool_address],!1);if(n){const o=n[0].purchased_raise_amount;l(o).sub(i).div(t.current_price)}return"0"}},pr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=[],t=0,i=100,n=!1){var _;const{package_id:o}=this._sdk.sdkOptions.launchpad;if(o===void 0)throw Error("sdk.sdkOptions.launchpad is undefined");const s=`${o}_getPoolImmutables`,r=this.getCache(s,n),a=[],c=[];if(r!==void 0&&a.push(...r),a.length===0)try{((_=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${o}::factory::CreatePoolEvent`}))==null?void 0:_.data).forEach(m=>{const y=m.parsedJson;y&&a.push({pool_address:y.pool_id,coin_type_sale:P(y.sale_coin.name).full_address,coin_type_raise:P(y.raise_coin.name).full_address})}),this.updateCache(s,a,x)}catch(p){console.log("getPoolImmutables",p)}const d=e.length>0;for(let p=0;p<a.length;p+=1){const m=a[p];if(!(d&&!e.includes(m.pool_address))){if(!d){const y=p;if(y<t||y>=t+i)continue}c.push(m)}}return c}async getPoolImmutablesWithPage(e="all",t=!1){const{package_id:i}=this._sdk.sdkOptions.launchpad,n=`${i}_getPoolImmutables`,o=[],s={data:[],hasNextPage:!1},r=e==="all";if(r){const a=this.getCache(n,t);a&&o.push(...a)}if(o.length===0)try{const a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${i}::factory::CreatePoolEvent`},e);s.hasNextPage=a.hasNextPage,s.nextCursor=a.nextCursor,a.data.forEach(c=>{const d=c.parsedJson;d&&o.push({pool_address:d.pool_id,coin_type_sale:P(d.sale_coin.name).full_address,coin_type_raise:P(d.raise_coin.name).full_address})})}catch(a){console.log("getPoolImmutables",a)}return s.data=o,r&&this.updateCache(n,o,x),s}async getPools(e=[],t=0,i=100){const n=[];let o=[];e.length>0?o=[...e]:(await this.getPoolImmutables([],t,i,!1)).forEach(a=>{o.push(a.pool_address)});const s=await this._sdk.ClmmSDK.fullClient.batchGetObjects(o,{showType:!0,showContent:!0});for(const r of s){const a=se.buildLaunchPadPool(r);await se.calculatePoolPrice(this._sdk,a),n.push(a);const c=`${a.pool_address}_getPoolObject`;this.updateCache(c,a,x)}return n}async getPool(e,t=!0){const i=`${e}_getPoolObject`,n=this.getCache(i,t);if(n!==void 0){const r=n;return se.updatePoolStatus(r),r}const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),s=se.buildLaunchPadPool(o);return await se.calculatePoolPrice(this._sdk,s),this.updateCache(i,s),s}async getInitConfig(e=!1){var c;const t=this._sdk.sdkOptions.launchpad.package_id,i=`${t}_getInitEvent`,n=this.getCache(i,e);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showPreviousTransaction:!0}}),s=bn(o),r=(c=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({Transaction:s}))==null?void 0:c.data,a={pools_id:"",admin_cap_id:"",config_cap_id:""};return r.length>0&&(r.forEach(d=>{const _=d.parsedJson;if(_)switch(P(d.type).full_address){case`${t}::config::InitConfigEvent`:a.admin_cap_id=_.admin_cap_id,a.config_cap_id=_.config_cap_id;break;case`${t}::factory::InitFactoryEvent`:a.pools_id=_.pools_id;break}}),this.updateCache(i,a,x)),a}async getLockNFT(e,t=!1){const i=`${e}_getLockNFT`,n=this.getCache(i,t);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(!o.error)return pi(o)}async getLockNFTList(e){var o;const{package_id:t}=this._sdk.ClmmSDK.sdkOptions.clmm_pool,{sdkOptions:i}=this._sdk,n=[];try{const s=(o=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${i.launchpad.package_id}::lock::LockNFTEvent`}))==null?void 0:o.data;for(const r of s){const a=r.parsedJson;if(a){const c={locked_time:Number(a.locked_time),end_lock_time:Number(a.end_lock_time),nft_type:a.nft_type_name.name,lock_nft_id:a.lock_nft_id,recipient:a.recipient};if(e===c.recipient&&`${t}`===P(c.nft_type).address){const d=await this.getLockNFT(c.lock_nft_id);if(d){const _=P(d.coin_type_a).full_address,p=P(d.coin_type_b).full_address;n.push({...d,coin_type_a:_,coin_type_b:p,...c})}}}}return n}catch(s){return console.log("getLockNFTList:",s),[]}}async creatPoolTransactionPayload(e){const{launchpad:t}=this.sdk.sdkOptions,i=h(t);if(this.assertLuanchpadConfig(),this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const n=se.priceRealToFix(Number(e.initialize_price),e.sale_decimals,e.raise_decimals),o=new T,s=l(e.total_supply).add(l(e.total_supply).mul(l(e.liquidity_rate))).toNumber(),r=await V.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,o,BigInt(s),e.coin_type_sale),a=[o.pure(i.admin_cap_id),o.pure(i.config_cap_id),o.pure(i.pools_id),o.pure(Y(e.recipient)),o.pure((n*wn).toString()),r,o.pure(e.total_supply.toString()),o.pure(e.min_purchase.toString()),o.pure(e.max_purchase.toString()),o.pure(e.least_raise_amount.toString()),o.pure(e.hardcap.toString()),o.pure((e.liquidity_rate*1e3).toString()),o.pure(e.start_time.toString()),o.pure(e.activity_duration.toString()),o.pure(e.settle_duration.toString()),o.pure(e.locked_duration.toString()),o.pure(e.tick_spacing.toString()),o.pure(v)],c=[e.coin_type_sale,e.coin_type_raise];return o.moveCall({target:`${t.published_at}::${re}::create_launch_pool`,typeArguments:c,arguments:a}),o}async creatPurchasePayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const i=new T,n=await V.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,i,BigInt(e.purchase_amount),e.coin_type_raise),o=(await this.getPurchaseMarks(this._sdk.ClmmSDK.senderAddress,[e.pool_address],!1))[0],s=[e.coin_type_sale,e.coin_type_raise];let r;return o?r=[i.pure(e.pool_address),i.pure(h(t).config_cap_id),i.pure(o.id),n,i.pure(e.purchase_amount.toString()),i.pure(v)]:r=[i.pure(e.pool_address),i.pure(h(t).config_cap_id),n,i.pure(e.purchase_amount.toString()),i.pure(v)],i.moveCall({target:`${t.published_at}::${re}::${o===void 0?"create_and_purchase":"purchase"}`,typeArguments:s,arguments:r}),i}async creatClaimPayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");const i=(await this.getPurchaseMarks(this._sdk.ClmmSDK.senderAddress,[e.pool_address],!1))[0],n=new T,o=[e.coin_type_sale,e.coin_type_raise],s=[n.pure(e.pool_address),n.pure(h(t).config_cap_id),n.pure(i==null?void 0:i.id),n.pure(v)];return n.moveCall({target:`${t.published_at}::${re}::claim`,typeArguments:o,arguments:s}),n}async creatSettlePayload(e){const{launchpad:t}=this.sdk.sdkOptions,{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions;if(this._sdk.ClmmSDK.senderAddress.length===0)throw Error("this config sdk senderAddress is empty");this.assertLuanchpadConfig();const n=h(i),{clmm_args:o}=e,s=new T;s.setSender(this.sdk.ClmmSDK.senderAddress);const r=[e.coin_type_sale,e.coin_type_raise];if(o){const a=o.opposite?B.priceToSqrtPriceX64(l(1).div(o.current_price),o.raise_decimals,o.sale_decimals).toString():B.priceToSqrtPriceX64(l(o.current_price),o.sale_decimals,o.raise_decimals).toString(),c=BigInt(a)<BigInt(o.clmm_sqrt_price),d=o.opposite?c?e.coin_type_raise:e.coin_type_sale:c?e.coin_type_sale:e.coin_type_raise,_=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,d);let p=G.calculateTotalBalance(_);G.isSuiCoin(d)&&(p-=BigInt(2e8));const y=V.buildCoinForAmount(s,_,p,d).targetCoin,S=o.opposite?c?"settle_with_reverse_clmm_only_with_a":"settle_with_reverse_clmm_only_with_b":c?"settle_only_with_a":"settle_only_with_b",C=[s.pure(e.pool_address),s.pure(h(t).config_cap_id),s.pure(o.clmm_pool_address),s.pure(n.global_config_id),s.pure(a),y,s.pure(v)];s.moveCall({target:`${t.published_at}::${re}::${S}`,typeArguments:r,arguments:C})}else s.moveCall({target:`${t.published_at}::${re}::settle`,typeArguments:r,arguments:[s.pure(e.pool_address),s.pure(h(t).config_cap_id),s.pure(v)]});return s}creatWithdrawPayload(e){const{launchpad:t}=this.sdk.sdkOptions,i=new T,n=[e.coin_type_sale,e.coin_type_raise],o=[i.object(e.pool_address),i.object(h(t).config_cap_id),i.object(v)];return e.sale_amount>BigInt(0)&&i.moveCall({target:`${t.published_at}::${re}::withdraw_sale`,typeArguments:n,arguments:o}),e.raise_amount>BigInt(0)&&i.moveCall({target:`${t.published_at}::${re}::withdraw_raise`,typeArguments:n,arguments:o}),i}addUserToWhitelisPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const i=new T,n=[e.coin_type_sale,e.coin_type_raise];return e.user_addrs.forEach(o=>{const s=[i.object(h(t).admin_cap_id),i.object(h(t).config_cap_id),i.object(e.pool_address),i.object(o),i.pure(e.safe_limit_amount),i.object(v)];i.moveCall({target:`${t.published_at}::${re}::add_user_to_whitelist`,typeArguments:n,arguments:s})}),i}updateWhitelistCapPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const i=new T,n=[e.coin_type_sale,e.coin_type_raise];return e.safe_limit_amount>0&&i.moveCall({target:`${t.published_at}::${re}::update_whitelist_member_safe_limit_amount`,typeArguments:n,arguments:[i.object(h(t).admin_cap_id),i.object(h(t).config_cap_id),i.object(e.pool_address),i.pure(e.white_list_member),i.pure(e.safe_limit_amount),i.object(v)]}),e.hard_cap_total>0&&i.moveCall({target:`${t.published_at}::${re}::update_whitelist_hard_cap_total`,typeArguments:n,arguments:[i.object(h(t).admin_cap_id),i.object(h(t).config_cap_id),i.object(e.pool_address),i.pure(e.hard_cap_total),i.object(v)]}),i}creatRemoveWhitelistPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const i=new T,n=[e.coin_type_sale,e.coin_type_raise];return e.user_addrs.forEach(o=>{const s=[i.object(h(t).admin_cap_id),i.object(h(t).config_cap_id),i.object(e.pool_address),i.object(o),i.object(v)];i.moveCall({target:`${t.published_at}::${re}::remove_user_from_whitelist`,typeArguments:n,arguments:s})}),i}creatCancelPoolPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const i=new T,n=[e.coin_type_sale,e.coin_type_raise],o=[i.pure(h(t).admin_cap_id),i.pure(h(t).config_cap_id),i.pure(e.pool_address),i.pure(v)];return i.moveCall({target:`${t.published_at}::${re}::cancel`,typeArguments:n,arguments:o}),i}updateRecipientPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const i=new T,n=[e.coin_type_sale,e.coin_type_raise],o=[i.pure(h(t).admin_cap_id),i.pure(h(t).config_cap_id),i.pure(e.pool_address),i.pure(e.new_recipient),i.pure(v)];return i.moveCall({target:`${t.published_at}::${re}::update_recipient_address`,typeArguments:n,arguments:o}),i}updatePoolDuractionPayload(e){const{launchpad:t}=this.sdk.sdkOptions;this.assertLuanchpadConfig();const i=new T,n=[e.coin_type_sale,e.coin_type_raise],o=[i.pure(h(t).admin_cap_id),i.pure(h(t).config_cap_id),i.pure(e.pool_address),i.pure(e.activity_duration),i.pure(e.settle_duration),i.pure(e.lock_duration),i.pure(v)];return i.moveCall({target:`${t.published_at}::${re}::update_pool_duration`,typeArguments:n,arguments:o}),i}creatUnlockNftPayload(e){const{launchpad:t}=this.sdk.sdkOptions;if(h(t)===void 0)throw Error("getPackagerConfigs(launchpad)  is null");const i=new T,n=[e.nft_type],o=[i.pure(e.lock_nft),i.pure(v)];return i.moveCall({target:`${t.published_at}::lock::unlock_nft`,typeArguments:n,arguments:o}),i}async isAdminCap(e){const{launchpad:t}=this._sdk.sdkOptions;if(h(t)===void 0)throw Error("launchpad config is empty");const i=`${e}_isAdminCap`,n=this.getCache(i);if(n)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:h(t).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(o);const s=et(o),r=Dt(o);let a=!1;return r&&s&&P(s).source_address===`${t.package_id}::config::AdminCap`&&(a=Y(r.AddressOwner)===Y(e)),this.updateCache(i,a,x),a}async isWhiteListUser(e,t){const i={type:"address",value:t};try{const n=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:i});return!!(n&&n.data)}catch{return!1}}async getPurchaseAmount(e,t){var n;const i={type:"address",value:t};try{const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:i}),s=R(o);if(console.log(s),s)return(n=s==null?void 0:s.value)==null?void 0:n.fields}catch{}return{safe_limit_amount:"0",safe_purchased_amount:"0"}}async getPurchaseMarks(e,t=[],i=!0){const{launchpad:n}=this._sdk.sdkOptions,o=`${t}_getPurchaseMark`,s=this.getCache(o,i);if(!i&&s!==void 0)return s;let r=null;const a=[];for(;;){const c=await this._sdk.ClmmSDK.fullClient.getOwnedObjects({owner:e,options:{showType:!0,showContent:!0,showDisplay:!0},cursor:r});for(const d of c.data){const{fields:_}=d.data.content;if(P(ve(d)).source_address===`${n.package_id}::pool::PurchaseMark`){console.log("fields: ",_);const m={id:_.id.id,pool_id:P(_.pool_id).address,purchased_raise_amount:_.purchase_total,obtain_sale_amount:_.obtain_sale_amount,used_raise_amount:_.used_raise_amount};t.length>0?t.includes(m.pool_id)&&a.push(m):a.push(m)}}if(c.hasNextPage)r=c.nextCursor;else break}return this.updateCache(o,a,x),a}async getSettleEvent(e){const{launchpad:t}=this._sdk.sdkOptions,i=`${e}_getPurchaseMark`,n=this.getCache(i);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t.package_id}::pool::SettleEvent`});for(const s of o.data){const r=s.parsedJson;if(e===ue(r.pool_id)){const a={pool_id:r.pool_id,settle_price:r.settle_price,unused_sale:r.unused_sale,unused_raise:r.unused_raise,white_purchase_total:r.white_purchase_total};return this.updateCache(i,a,x),a}}}buildLaunchpadCoinType(e,t){return Ot(this._sdk.sdkOptions.launchpad.package_id,"pool","PoolLiquidityCoin",[e,t])}assertLuanchpadConfig(){const{launchpad:e}=this.sdk.sdkOptions;if(h(e)===void 0)throw Error("sdk getPackagerConfigs(launchpad) is null")}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},qe=class{static buildPoolImmutables(e){const{fields:t}=e.value.fields.value;return{clmm_pool_id:P(t.clmm_pool_id).address,bonus_type:P(t.bonus_type.fields.name).source_address,pool_id:P(t.pool_id).address,coinTypeA:P(t.coin_type_a.fields.name).source_address,coinTypeB:P(t.coin_type_b.fields.name).source_address}}static buildPoolState(e){const t=R(e),i=[];return t.config.fields.contents.forEach(o=>{i.push({rate:Number(l(o.fields.key).div(Ye)),multiplier:Number(l(o.fields.value).div(Ye))})}),{balance:t.balance,config:i,is_open:t.is_open,index:Number(t.index),start_time:Number(t.start_time),interval_day:Number(t.interval_day),minimum_percent_to_reward:Number(l(t.minimum_percent_to_reward).div(Ye)),rewarders:{rewarder_handle:t.rewarders.fields.id.id,size:Number(t.rewarders.fields.size)},whale_nfts:{whale_nfts_handle:t.whale_nfts.fields.id.id,size:Number(t.whale_nfts.fields.size)},points:{point_handle:t.points.fields.id.id,size:Number(t.points.fields.size)}}}static buildMarkerPositions(e){const{contents:t}=e.value.fields.value.fields,i=[],n=e.id.id;return t.forEach(o=>{const{key:s,value:r}=o.fields,a={id:s,period_id:n,bonus_num:r.fields.bonus_num,point:r.fields.point,is_burn:r.fields.is_burn,point_after_multiplier:r.fields.point_after_multiplier,percent:Number(l(r.fields.percent).div(Ye)),fee_share_rate:0,is_redeemed:r.fields.is_redeemed};i.push(a)}),i}static buildPoolBonusInfo(e){const{fields:t,type:i}=e.value.fields.value;return{type:i,time:Number(t.time),settle_time:Number(t.settle_time),settled_num:t.settled_num,is_settled:t.is_settled,basis_bonus:t.basis_bonus,total_bonus:t.total_bonus,is_vacant:t.is_vacant,redeemed_num:t.redeemed_num}}static getBonusPercent(e,t){let i=0;for(const n of e)t>=n.rate&&n.rate>i&&(i=n.multiplier);return i}},Pi="router",mr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e=!1){var s;const{maker_bonus:t}=this._sdk.sdkOptions,i=`${t.package_id}_getPoolImmutables`,n=this.getCache(i,e),o=[];if(n!==void 0)o.push(...n);else{const r=[];(s=(await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(h(t).maker_pool_handle)).data)==null||s.forEach(d=>{r.push(d.objectId)});const c=await this._sdk.ClmmSDK.fullClient.batchGetObjects(r,{showContent:!0});for(const d of c){const _=R(d);_&&o.push(qe.buildPoolImmutables(_))}}return o}async getPoolImmutable(e){const{maker_bonus:t}=this._sdk.sdkOptions,i=`${t.package_id}_getPoolImmutables`,n=this.getCache(i);if(n!==void 0){const r=n.filter(a=>e===a.pool_id);if(r.length>0)return r[0]}const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:h(t).maker_pool_handle,name:{type:"0x2::object::ID",value:e}}),s=R(o);return qe.buildPoolImmutables(s)}async getPools(){const e=[],t=await this.getPoolImmutables(),i=t.map(s=>s.pool_id),n=await this._sdk.ClmmSDK.fullClient.batchGetObjects(i,{showType:!0,showContent:!0});let o=0;for(const s of n){const r=qe.buildPoolState(s);if(r){const a={...t[o],...r};e.push(a);const c=`${a.pool_id}_getPoolObject`;this.updateCache(c,a,x)}o+=1}return e}async getPool(e,t=!0){const i=`${e}_getPoolObject`,n=this.getCache(i,t),o=await this.getPoolImmutable(e);if(n!==void 0)return n;const s=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),r=qe.buildPoolState(s),a={...o,...r};return this.updateCache(i,a,x),a}async getPoolHandleId(e){const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),i=R(t);return i?i.list.fields.id.id:""}async getMakerPoolPeriods(e,t=!1){const i=[],n=`${e.pool_id}_getMakerPoolPeriods`,o=this.getCache(n,t);return o!==void 0?o:((await this._sdk.ClmmSDK.fullClient.getDynamicFieldsByPage(e.whale_nfts.whale_nfts_handle)).data.forEach(r=>{const a={id:r.objectId,start_time:0,end_time:0,period:Number(r.name.value)};a.start_time=Number(l(e.start_time).add(l(e.interval_day).mul(24*3600).mul(a.period)).toFixed(0,$.ROUND_DOWN)),a.end_time=Number(l(a.start_time).add(l(e.interval_day).mul(24*3600)).toFixed(0,$.ROUND_DOWN)),i.push(a)}),this.updateCache(n,i,x),i)}async getMakerBonusInitConfigs(){var n;const{package_id:e}=this.sdk.sdkOptions.maker_bonus,t=(n=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitEvent`}))==null?void 0:n.data,i={maker_config_id:"",maker_pool_handle:""};return t.length>0&&t.forEach(o=>{const s=o.parsedJson;s&&(i.maker_config_id=s.config_id)}),i.maker_pool_handle=await this.getPoolHandleId(i.maker_config_id),i}async getPoolMarkerPositionList(e,t,i=!1){const n={},o=[];i||t.forEach(s=>{const r=`${e}_${s.period}_getPoolMarkerPositionList`,a=this.getCache(r);a!==void 0?n[s.period]=a:(n[s.period]=[],o.push(s))});try{o.length>0&&(await this._sdk.ClmmSDK.fullClient.batchGetObjects(o.map(a=>a.id),{showContent:!0})).forEach(a=>{const c=R(a),d=qe.buildMarkerPositions(c);if(d.length>0){const{period_id:_}=d[0],p=t.filter(m=>m.id===_)[0];n[p.period]=d}});const s=[];for(const r in n)n[r].forEach(c=>{s.push(c)});if(s.length>0){const r=await this._sdk.ClmmSDK.Position.getSipmlePositionList(s.map(a=>a.id));for(const a of s)for(const c of r)if(a.id===c.pos_object_id){a.clmm_position=c;break}}}catch(s){console.log(s)}for(const s in n){const r=`${e}_${s}_getPoolMarkerPositionList`;this.updateCache(r,n[s],x)}return n}async updateXCetusRewarderAndFee(e,t,i){const n=await this.calculateTotalPointsAfterMultiper(e,i);for(const o of t)await this.calculateXCetusRewarder(e,o,i.period,n);return t}async calculateXCetusRewarder(e,t,i,n){const o=await this.getPoolBonusInfo(e.rewarders.rewarder_handle,i),{fee_share_rate:s}=this.calculateFeeShareRate(e,t,n),r=l(s).mul(o.total_bonus);return t.is_redeemed?t.bonus_num="0":t.bonus_num=r.toString(),t.bonus_num}calculateFeeShareRate(e,t,i){const n=qe.getBonusPercent(e.config,t.percent),o=l(t.point).mul(n),s=l(o).div(i);return t.point_after_multiplier=o.toString(),t.fee_share_rate=Number(s),{fee_share_rate:Number(s),points_after_multiper:o.toString()}}async calculateTotalPointsAfterMultiper(e,t){const i=await this.getPoolMarkerPositionList(e.whale_nfts.whale_nfts_handle,[t]);let n=l(0);const o=i[t.period];for(const s of o){const r=qe.getBonusPercent(e.config,s.percent),a=l(s.point).mul(r);n=n.add(a)}return n.toString()}async calculateAllXCetusRewarder(e){const t=this._sdk.ClmmSDK.senderAddress;let i=l(0);const n=[];for(const o of e){const s=await this._sdk.MakerModule.getMakerPoolPeriods(o),r=await this._sdk.MakerModule.getPoolMarkerPositionList(o.whale_nfts.whale_nfts_handle,s),a=[];for(const c of s){const d=r[c.period].filter(_=>{var p;return t.length===0?!1:((p=_.clmm_position)==null?void 0:p.owner)===t});d.length>0&&(await this._sdk.MakerModule.updateXCetusRewarderAndFee(o,d,c),d.forEach(_=>{var p;((p=_.clmm_position)==null?void 0:p.position_status)===_n.Exists&&l(_.bonus_num).greaterThan(0)&&(i=i.add(_.bonus_num),a.includes(_.clmm_position.pos_object_id)||a.push(_.clmm_position.pos_object_id))}))}n.push({bonus_type:o.bonus_type,pool_id:o.pool_id,nft_ids:a})}return{claimtotal:i,claimRecord:n}}async getPoolBonusInfo(e,t,i=!1){const n=`${e}_${t}_getPoolBonusInfo`,o=this.getCache(n,i);if(o!==void 0)return o;const s=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"u64",value:t.toString()}}),r=R(s),a=qe.buildPoolBonusInfo(r);return this.updateCache(n,a,Ne),a}claimPayload(e){const{maker_bonus:t,xcetus:i}=this.sdk.sdkOptions,n=new T;return n.moveCall({target:`${t.published_at}::${Pi}::claim`,typeArguments:[e.bonus_type],arguments:[n.pure(h(t).maker_config_id),n.pure(e.market_pool_id),n.pure(e.position_nft_id),n.pure(e.phase),n.pure(h(i).lock_manager_id),n.pure(h(i).xcetus_manager_id),n.pure(e.ve_nft_id)]}),n}claimAllPayload(e){const{maker_bonus:t,xcetus:i}=this.sdk.sdkOptions,n=new T;return e.whale_nfts.forEach(o=>{o.nft_ids.forEach(s=>{n.moveCall({target:`${t.published_at}::${Pi}::claim_all`,typeArguments:[o.bonus_type],arguments:[n.object(h(t).maker_config_id),n.object(o.pool_id),n.object(s),n.object(h(i).lock_manager_id),n.object(h(i).xcetus_manager_id),n.object(e.ve_nft_id)]})})}),n}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},He="router",Lt="router",rt=24*3600,Bt=1e3,me=1e11,Ue=class{static buildVeNFTDividendInfo(e){const t={id:e.id.id,ve_nft_id:e.name,rewards:[]};return e.value.fields.value.fields.dividends.fields.contents.forEach(i=>{const n=[];i.fields.value.fields.contents.forEach(o=>{n.push({coin_type:P(o.fields.key.fields.name).source_address,amount:o.fields.value})}),t.rewards.push({period:Number(i.fields.key),rewards:n})}),t}static buildDividendManager(e){const t={id:e.id.id,dividends:{id:e.dividends.fields.id.id,size:e.dividends.fields.size},venft_dividends:{id:e.venft_dividends.fields.id.id,size:e.venft_dividends.fields.size},bonus_types:[],start_time:Number(e.start_time),interval_day:Number(e.interval_day),balances:{id:e.balances.fields.id.id,size:e.balances.fields.size},is_open:e.is_open};return e.bonus_types.forEach(i=>{t.bonus_types.push(P(i.fields.name).source_address)}),t}static buildLockUpManager(e){return{id:e.id.id,balance:e.balance,treasury_manager:e.treasury_manager,extra_treasury:e.extra_treasury,lock_infos:{lock_handle_id:e.lock_infos.fields.id.id,size:Number(e.lock_infos.fields.size)},type_name:Ce(e.type_name.fields.name),min_lock_day:Number(e.min_lock_day),max_lock_day:Number(e.max_lock_day),package_version:Number(e.package_version),max_percent_numerator:Number(e.max_percent_numerator),min_percent_numerator:Number(e.min_percent_numerator)}}static buildLockCetus(e){const t=e.fields,i={id:t.id.id,type:P(e.type).source_address,locked_start_time:Number(t.locked_start_time),locked_until_time:Number(t.locked_until_time),cetus_amount:t.balance,xcetus_amount:"0",lock_day:0};return i.lock_day=(i.locked_until_time-i.locked_start_time)/rt,i}static getAvailableXCetus(e,t){let i=l(0);return t.forEach(n=>{i=i.add(n.xcetus_amount)}),l(e.xcetus_balance).sub(i).toString()}static getWaitUnLockCetuss(e){return e.filter(t=>!Ue.isLocked(t))}static getLockingCetuss(e){return e.filter(t=>Ue.isLocked(t))}static isLocked(e){return e.locked_until_time>Date.parse(new Date().toString())/1e3}static buildDividendRewardTypeList(e){const t=new Set;return e.forEach(i=>{i.rewards.forEach(n=>{t.add(n.coin_type)})}),Array.from(t)}static getNextStartTime(e){const t=Date.now()/1e3,{start_time:i,interval_day:n}=e,o=Math.ceil((t-i)/(n*rt));return i+o*n*rt}},hr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getOwnerVeNFT(e,t=!0){const{xcetus:i}=this.sdk.sdkOptions,n=`${e}_getLockUpManagerEvent`,o=this.getCache(n,t);if(o!==void 0)return o;let s;const r=`${i.package_id}::xcetus::VeNFT`;return(await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0},filter:{StructType:r}})).data.forEach(c=>{const d=P(ve(c)).source_address;if(d===r&&c.data&&c.data.content){const{fields:_}=c.data.content;s={...Nt(c),id:_.id.id,index:_.index,type:d,xcetus_balance:_.xcetus_balance},this.updateCache(n,s,x)}}),s}async getOwnerLockCetuss(e){const{xcetus:t}=this.sdk.sdkOptions,i=[],n=`${t.package_id}::lock_coin::LockedCoin<${this.buileCetusCoinType()}>`,o=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0},filter:{StructType:n}});for(const s of o.data)if(P(ve(s)).source_address===n&&s.data){const a=Ue.buildLockCetus(s.data.content);a.xcetus_amount=await this.getXCetusAmount(a.id),i.push(a)}return i}async getLockCetus(e){var i;const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}});if((i=t.data)!=null&&i.content){const n=Ue.buildLockCetus(t.data.content);return n.xcetus_amount=await this.getXCetusAmount(n.id),n}}async getOwnerCetusCoins(e){return await this._sdk.ClmmSDK.getOwnerCoinAssets(e,this.buileCetusCoinType())}mintVeNFTPayload(){const{xcetus:e}=this.sdk.sdkOptions,t=new T;return t.moveCall({target:`${e.published_at}::${He}::mint_venft`,typeArguments:[],arguments:[t.pure(h(e).xcetus_manager_id)]}),t}async convertPayload(e){const{xcetus:t}=this.sdk.sdkOptions,i=new T,n=this.buileCetusCoinType(),o=await V.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,i,BigInt(e.amount),n);return e.venft_id===void 0?i.moveCall({target:`${t.published_at}::${He}::mint_and_convert`,typeArguments:[],arguments:[i.object(h(t).lock_manager_id),i.object(h(t).xcetus_manager_id),o,i.pure(e.amount)]}):i.moveCall({target:`${t.published_at}::${He}::convert`,typeArguments:[],arguments:[i.object(h(t).lock_manager_id),i.object(h(t).xcetus_manager_id),o,i.pure(e.amount),i.pure(e.venft_id)]}),i}redeemLockPayload(e){const{xcetus:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${He}::redeem_lock`,typeArguments:[],arguments:[i.pure(h(t).lock_manager_id),i.pure(h(t).xcetus_manager_id),i.pure(e.venft_id),i.pure(e.amount),i.pure(e.lock_day),i.pure(v)]}),i}redeemPayload(e){const{xcetus:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${He}::redeem`,typeArguments:[],arguments:[i.pure(h(t).lock_manager_id),i.pure(h(t).xcetus_manager_id),i.pure(e.venft_id),i.pure(e.lock_id),i.pure(v)]}),i}redeemDividendPayload(e,t){const{xcetus:i,xcetus_dividends:n}=this.sdk.sdkOptions,o=new T;return t.forEach(s=>{o.moveCall({target:`${i.published_at}::${Lt}::redeem`,typeArguments:[s],arguments:[o.object(h(n).dividend_manager_id),o.object(e)]})}),o}redeemDividendV2Payload(e,t,i){const{xcetus_dividends:n}=this.sdk.sdkOptions;let o=new T;return t.filter(r=>i.includes(r)).length>0&&(o=this.redeemDividendXTokenPayload(e,o)),t.forEach(r=>{i.includes(r)||o.moveCall({target:`${n.published_at}::${Lt}::redeem_v2`,typeArguments:[r],arguments:[o.object(h(n).dividend_manager_id),o.object(e),o.object(v)]})}),o}redeemDividendXTokenPayload(e,t){const{xcetus_dividends:i,xcetus:n}=this.sdk.sdkOptions,{xcetus_manager_id:o,lock_manager_id:s}=h(n),{dividend_manager_id:r}=h(i);return t=t===void 0?new T:t,t.moveCall({target:`${i.published_at}::${Lt}::redeem_xtoken`,typeArguments:[],arguments:[t.object(s),t.object(o),t.object(r),t.object(e),t.object(v)]}),t}buileCetusCoinType(){return`${this.sdk.sdkOptions.cetus_faucet.package_id}::cetus::CETUS`}buileXTokenCoinType(e=this._sdk.sdkOptions.xcetus.package_id,t="xcetus",i="XCETUS"){return`${e}::${t}::${i}`}cancelRedeemPayload(e){const{xcetus:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${He}::cancel_redeem_lock`,typeArguments:[],arguments:[i.pure(h(t).lock_manager_id),i.pure(h(t).xcetus_manager_id),i.pure(e.venft_id),i.pure(e.lock_id),i.pure(v)]}),i}async getInitConfigs(){var r,a;const{package_id:e}=this.sdk.sdkOptions.xcetus,t=`${e}_getInitFactoryEvent`,i=this.getCache(t);if(i!==void 0)return i;const n=(r=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::xcetus::InitEvent`}))==null?void 0:r.data,o={xcetus_manager_id:"",lock_manager_id:"",lock_handle_id:""};n.length>0&&n.forEach(c=>{const d=c.parsedJson;d&&(o.xcetus_manager_id=d.xcetus_manager)});const s=(a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::locking::InitializeEvent`}))==null?void 0:a.data;return s.length>0&&s.forEach(c=>{const d=c.parsedJson;d&&(o.lock_manager_id=d.lock_manager)}),o.lock_manager_id.length>0&&(o.lock_handle_id=(await this.getLockUpManager(o.lock_manager_id)).lock_infos.lock_handle_id),this.updateCache(t,o,x),o}async getLockUpManager(e=h(this.sdk.sdkOptions.xcetus).lock_manager_id,t=!1){const i=`${e}_getLockUpManager`,n=this.getCache(i,t);if(n!==void 0)return n;const o=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=Ue.buildLockUpManager(R(o));return this.updateCache(i,s,x),s}async getDividendConfigs(){var s;const{package_id:e}=this.sdk.sdkOptions.xcetus_dividends,t=`${e}_getDividendManagerEvent`,i=this.getCache(t);if(i!==void 0)return i;const n=(s=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::dividend::InitEvent`}))==null?void 0:s.data,o={dividend_manager_id:"",dividend_admin_id:"",dividend_settle_id:""};return n.length>0&&n.forEach(r=>{const a=r.parsedJson;a&&(o.dividend_manager_id=a.manager_id,o.dividend_admin_id=a.admin_id,o.dividend_settle_id=a.settle_id,this.updateCache(t,o,x))}),o}async getDividendManager(e=!1){const{dividend_manager_id:t}=h(this._sdk.sdkOptions.xcetus_dividends),i=`${t}_getDividendManager`,n=this.getCache(i,e);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=R(o),r=Ue.buildDividendManager(s);return this.updateCache(i,r,x),r}async getXcetusManager(e=!0){const{xcetus_manager_id:t}=h(this._sdk.sdkOptions.xcetus),i=`${t}_getXcetusManager`,n=this.getCache(i,e);if(n)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=R(o),r={id:s.id.id,index:Number(s.index),has_venft:{handle:s.has_venft.fields.id.id,size:s.has_venft.fields.size},nfts:{handle:s.nfts.fields.id.id,size:s.nfts.fields.size},total_locked:s.total_locked,treasury:s.treasury.fields.total_supply.fields.value};return this.updateCache(i,r),r}async getVeNFTDividendInfo(e,t){try{const i=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),n=R(i);return Ue.buildVeNFTDividendInfo(n)}catch{return}}async redeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const i=await this.getLockUpManager(h(this._sdk.sdkOptions.xcetus).lock_manager_id),n=l(me).mul(l(i.max_lock_day).sub(l(t))).mul(l(i.max_percent_numerator).sub(l(i.min_percent_numerator))).div(l(i.max_lock_day).sub(l(i.min_lock_day))),o=l(me).mul(l(i.max_percent_numerator)).sub(n).div(l(Bt)).div(me);return{amountOut:l(o).mul(l(e)).round().toString(),percent:o.toString()}}async reverseRedeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const i=await this.getLockUpManager(h(this._sdk.sdkOptions.xcetus).lock_manager_id),n=l(me).mul(l(i.max_lock_day).sub(l(t))).mul(l(i.max_percent_numerator).sub(l(i.min_percent_numerator))).div(l(i.max_lock_day).sub(l(i.min_lock_day))),o=l(me).mul(l(i.max_percent_numerator)).sub(n).div(l(Bt)).div(me);return{amountOut:l(e).div(o).toFixed(0,$.ROUND_UP),percent:o.toString()}}async getXCetusAmount(e){const{lock_handle_id:t}=h(this._sdk.sdkOptions.xcetus),i=`${e}_getXCetusAmount`,n=this.getCache(i);if(n!==void 0)return n;try{const o=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"0x2::object::ID",value:e}}),s=R(o);if(s){const{xcetus_amount:r}=s.value.fields.value.fields;return this.updateCache(i,r,x),r}}catch{}return"0"}async getVeNftAmount(e,t){try{const i=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),n=R(i);if(n){const{lock_amount:o,xcetus_amount:s}=n.value.fields.value.fields;return{lock_amount:o,xcetus_amount:s}}}catch{}return{lock_amount:"0",xcetus_amount:"0"}}async getPhaseDividendInfo(e,t=!1){const n=(await this.getDividendManager()).dividends.id,o=`${n}_${e}_getPhaseDividendInfo`,s=this._sdk.getCache(o,t);if(s)return s;try{const r=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:n,name:{type:"u64",value:e}}),a=R(r),c=a.value.fields.value.fields,d=c.redeemed_num.fields.contents.map(y=>({name:y.fields.key.fields.name,value:y.fields.value})),_=c.bonus_types.map(y=>y.fields.name),p=c.bonus.fields.contents.map(y=>({name:y.fields.key.fields.name,value:y.fields.value})),m={id:ut(r),phase:a.name,settled_num:c.settled_num,register_time:c.register_time,redeemed_num:d,is_settled:c.is_settled,bonus_types:_,bonus:p,phase_end_time:""};return this.updateCache(o,m),m}catch{}}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},gr="factory",pe="oversubscribe_pool",kn=1e6,At=1e18,Ze="router",Kt="router",kt="router",ji={curve:{strategy:3,both_side:{div_width:10,ratios:[.333333,.266666,.2,.133333,.066666]},one_side:{div_width:5,ratios:[.333333,.266666,.2,.133333,.066666]}},bidAsk:{strategy:4,both_side:{div_width:10,ratios:[.172413793,.137931034,.103448276,.068965517,.034482759,.068965517,.103448276,.137931034,.172413793]},one_side:{div_width:5,ratios:[.066666667,.13333333,.2,.266666667,.333333333]}}};function fr(e){return"master_address"in e}var Ut="router",yr="vaults",br=1e4,Q=class{static buildIdoPoolImmutables(e){return{pool_address:ue(e.pool_id),coin_type_sale:P(e.sale_coin_type.name).full_address,coin_type_raise:P(e.raise_coin_type.name).full_address,tick_spacing:Number(e.tick_spacing),total_supply:e.total_supply,min_purchase:e.min_purchase_amount,max_purchase:e.max_purchase_amount}}static buildIdoPool(e){const t=ve(e),i=P(t),n=R(e),o={pool_address:ue(n.id.id),coin_type_sale:i.type_arguments[0],coin_type_raise:i.type_arguments[1],tick_spacing:Number(n.tick_spacing),total_supply:n.total_supply,min_purchase:n.min_purchase_amount,max_purchase:n.max_purchase_amount},s={start_time:Number(n.duration_manager.fields.start_time),lock_up_duration:Number(n.duration_manager.fields.lock_up_duration),purchase_duration:Number(n.duration_manager.fields.purchase_duration),end_time:0};s.end_time=s.start_time+s.purchase_duration;const r={complete_raise_limit:n.complete_raise_limit,liquidity_injection_ratio:l(n.liquidity_injection_ratio).div(kn).toNumber(),current_sqrt_price_min:n.current_sqrt_price_min,current_sqrt_price_max:n.current_sqrt_price_max,owner:n.owner,sale_coin_amount:n.sale_coin,raise_coin_amount:n.raise_coin,price:n.price,current_price:n.price,duration_summary:s,is_cancelled:n.is_cancelled,is_liquidity_injected:n.is_liquidity_injected,liquidity_used_raise_amount:n.liquidity_used_raise_amount,liquidity_used_sale_amount:n.liquidity_used_sale_amount,purchase_summary:{size:Number(n.purchase_manager.fields.purchases.fields.size),purchase_handle:n.purchase_manager.fields.purchases.fields.id.id},total_purchase_amount:n.total_purchase_amount,white_summary:{white_list_id:n.white_list.fields.id.id,protection_limit_used:n.white_list.fields.protection_limit_used,protection_hard_cap:n.white_list.fields.protection_hard_cap,white_handle:n.white_list.fields.addresses.fields.id.id,size:Number(n.white_list.fields.addresses.fields.size)},pool_status:"Upcoming",max_raise_amount:"",sale_decimals:0,raise_decimals:0,is_withdrawn:n.is_withdrawn};return Q.updatePoolStatus(r),{...o,...r}}static is_init_period(e){return Number(l(Date.now()/1e3).toFixed(0))<e.start_time}static is_purchase_period(e){const t=Number(l(Date.now()/1e3).toFixed(0));return t>=e.start_time&&t<=e.start_time+e.purchase_duration}static is_claim_period(e){const t=Number(l(Date.now()/1e3).toFixed(0)),i=e.start_time+e.purchase_duration;return t>i}static is_can_inject_liquidity(e){return!e.is_cancelled&&e.liquidity_injection_ratio!==0&&Q.is_claim_period(e.duration_summary)&&!e.is_liquidity_injected}static is_can_withdraw(e){return e.is_withdrawn?!1:Q.is_sale_failed(e)?!0:(e.liquidity_injection_ratio===0||e.is_liquidity_injected)&&Q.is_claim_period(e.duration_summary)}static is_sale_failed(e){return!!(e.is_cancelled||Q.is_claim_period(e.duration_summary)&&l(e.total_purchase_amount).lessThan(e.complete_raise_limit))}static buildPurchaseInfo(e){return{...e.value.fields.value.fields,owner:e.name}}static calculateRedeemAmount(e,t){let i,n;if(Q.is_sale_failed(e))i="0",n="0";else if(t.is_redeemed)i=t.obtained_sale_amount,n=t.used_raise_amount;else if(l(e.total_purchase_amount).lessThanOrEqualTo(e.max_raise_amount))i=l(t.purchased_raise_amount).mul(At).div(e.price).toString(),n=t.purchased_raise_amount;else{const s=Q.redeemForSaleOversubcribe(e,t);i=s.user_obtained_sale_amount,n=s.user_used_raise_amount_ceil}i=$.floor(i);const o=$.floor(l(t.purchased_raise_amount).sub(n).toString());return{obtained_sale_amount:i,refunded_raise_amount:o}}static calculateWithdrawAmount(e){let t,i;const n=l(e.total_supply).mul(e.liquidity_injection_ratio);if(Q.is_sale_failed(e))t="0",i=l(n).add(e.total_supply);else{const{max_raise_amount:o}=e;l(e.total_purchase_amount).greaterThanOrEqualTo(o)?(t=l(o).sub(e.liquidity_used_raise_amount).toString(),i="0"):(t=l(e.total_purchase_amount).sub(e.liquidity_used_raise_amount),i=l(e.total_supply).add(n).sub(e.liquidity_used_sale_amount).sub(Q.get_sold_amount(e)))}return{obtained_raise_amount:$.floor(t).toString(),refunded_sale_amount:$.ceil(i).toString()}}static get_sold_amount(e){return l(e.total_purchase_amount).greaterThanOrEqualTo(e.max_raise_amount)?e.total_supply:l(e.total_purchase_amount).mul(At).div(e.price)}static redeemForSaleOversubcribe(e,t){const i=t.protection_raise_amount,n=l(t.purchased_raise_amount).sub(i),o=e.max_raise_amount,{protection_limit_used:s}=e.white_summary,r=l(o).sub(s),a=l(e.total_purchase_amount).sub(s),c=$.ceil(n.mul(r).div(a).add(i)),d=$.floor(n.mul(r).div(a).add(i));return{user_obtained_sale_amount:$.floor(l(e.total_supply).mul(d).div(o)),user_used_raise_amount_ceil:c}}static raiseTotalAmount(e){const t=l(e.sale_decimals-e.raise_decimals).abs().toNumber();return e.sale_decimals>e.raise_decimals?l(e.total_supply).mul(e.current_price).div(l(10).pow(l(t))).toString():l(e.total_supply).mul(e.current_price).mul(l(10).pow(l(t))).toString()}static updatePoolStatus(e){const t=Number(l(Date.now()/1e3).toFixed(0)),i=e.duration_summary,n=i.start_time+i.purchase_duration;e.is_cancelled?e.pool_status="Canceled":t<i.start_time?e.pool_status="Upcoming":t>i.start_time&&t<n?e.pool_status="Live":l(e.total_purchase_amount).lessThan(e.complete_raise_limit)?e.pool_status="Failed":e.pool_status="Ended"}static async calculatePoolUiPrice(e,t){const i=await e.ClmmSDK.CetusConfig.getTokenListByCoinTypes([t.coin_type_sale,t.coin_type_raise]),n=i[t.coin_type_sale].decimals,o=i[t.coin_type_raise].decimals;t.current_price=se.priceFixToReal(Number(l(t.price).div(l(At)).toString()),n,o).toString(),t.sale_decimals=n,t.raise_decimals=o,t.max_raise_amount=this.raiseTotalAmount(t)}},Or=class{constructor(e){F(this,"_sdk");this._sdk=e}async getPools(e=[],t=!1){const i=[];if(e.length>0){if(e.filter(o=>{const s=`${o}_getPool`,r=this._sdk.getCache(s,t);return r?(i.push(r),!1):!0}).length>0){const o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(e,{showType:!0,showContent:!0});for(const s of o){const r=await this.buildIdoWarpPool(s);r&&i.push(r)}}}else{const n=await this._sdk.Launchpad.getPools(),o=await this._sdk.Ido.getPools();n.forEach(s=>{i.push({...s,version:"1"})}),o.forEach(s=>{i.push({...s,version:"2"})})}return i.forEach(n=>{const o=`${n.pool_address}_getPool`;this._sdk.updateCache(o,n)}),i}async getPool(e,t=!0){const i=`${e}_getPool`,n=this._sdk.getCache(i,t);if(n)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),s=await this.buildIdoWarpPool(o);return this._sdk.updateCache(i,s),s}async getJoinPools(e,t){const i=[],n=t.filter(s=>s.version==="1"),o=t.filter(s=>s.version==="2");if(n.length>0){const s=await this._sdk.Launchpad.getPurchaseMarks(e,n.map(r=>r.pool_address),!1);n.forEach(r=>{for(const a of s)if(a.pool_id===r.pool_address){i.push(r);break}})}for(const s of o)await this._sdk.Ido.getPurchaseInfo(s.purchase_summary.purchase_handle,e,!1)&&i.push(s);return i}async getOwnerPools(e,t){return t.filter(i=>i.owner===Y(e))}async creatPurchasePayload(e,t){return e.version==="1"?await this._sdk.Launchpad.creatPurchasePayload({pool_address:e.pool_address,purchase_amount:t,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise}):await this._sdk.Ido.creatPurchasePayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,purchase_handle:e.purchase_summary.purchase_handle,raise_amount:t.toString()})}async creatRedeemPayload(e){return e.version==="1"?await this._sdk.Launchpad.creatClaimPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise}):await this._sdk.Ido.redeemPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,purchase_handle:e.purchase_summary.purchase_handle})}async creatWithdrawPayload(e){if(e.version==="1"){const i=await se.getWithdrawSale(e),n=await se.getWithdrawRaise(e);return this._sdk.Launchpad.creatWithdrawPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise,sale_amount:BigInt(i),raise_amount:BigInt(n)})}return this._sdk.Ido.withdrawPayload({pool_address:e.pool_address,coin_type_sale:e.coin_type_sale,coin_type_raise:e.coin_type_raise})}unlockNftPayload(e,t){return e.version==="1"?this._sdk.Launchpad.creatUnlockNftPayload(t):this._sdk.Ido.unlockNftPayload({lock_nft_id:t.lock_nft,nft_type:t.nft_type})}async getLockNFTList(e){let t=[];return e.version==="1"&&(t=await this._sdk.Launchpad.getLockNFTList(e.owner)),t=await this._sdk.Ido.getLockNFTList(e.owner),t.filter(n=>n.coin_type_a===e.coin_type_sale&&n.coin_type_b===e.coin_type_raise||n.coin_type_a===e.coin_type_raise&&n.coin_type_b===e.coin_type_sale)}async isWhiteListUser(e,t){return t.version==="1"?await this._sdk.Launchpad.isWhiteListUser(t.white_summary.white_handle,e):!!await this._sdk.Ido.getWhiteProtectionLimit(t.white_summary.white_handle,e)}async getPurchaseInfo(e,t){if(t.version==="1"){const n=await this._sdk.Launchpad.getPurchaseMarks(e,[t.pool_address]);return n.length>0?n[0]:void 0}return await this._sdk.Ido.getPurchaseInfo(t.purchase_summary.purchase_handle,e)}async getwhiteProtectionInfo(e,t,i=!1){if(t.version==="1")return await this._sdk.Launchpad.getPurchaseAmount(t.white_summary.white_handle,e);const n=await this._sdk.Ido.getPurchaseInfo(t.purchase_summary.purchase_handle,e,i);if(n)return{safe_limit_amount:n.protection_raise_limit,safe_purchased_amount:n.protection_raise_amount};const o=await this._sdk.Ido.getWhiteProtectionLimit(t.white_summary.white_handle,e,!1);return o?{safe_limit_amount:o,safe_purchased_amount:"0"}:{safe_limit_amount:"0",safe_purchased_amount:"0"}}async calculateWithdrawAmount(e){if(e.version==="1"){const t=await se.getHistoryWithdrawRaise(this._sdk,e),i=await se.getHistoryWithdrawSale(this._sdk,e);return{obtained_raise_amount:t,refunded_sale_amount:i}}return Q.calculateWithdrawAmount(e)}async buildIdoWarpPool(e){const t=et(e);if(P(t).address===this._sdk.sdkOptions.ido.package_id){const i=Q.buildIdoPool(e);return await Q.calculatePoolUiPrice(this._sdk,i),{...i,version:"2"}}if(P(t).address===this._sdk.sdkOptions.launchpad.package_id){const i=se.buildLaunchPadPool(e);return await se.calculatePoolPrice(this._sdk,i),{...i,version:"1"}}}},Ve=class{static buildVeNFTDividendInfo(e){const t={id:e.id.id,ve_nft_id:e.name,rewards:[]};return e.value.fields.value.fields.dividends.fields.contents.forEach(i=>{const n=[];i.fields.value.fields.contents.forEach(o=>{n.push({coin_type:P(o.fields.key.fields.name).source_address,amount:o.fields.value})}),t.rewards.push({period:Number(i.fields.key),rewards:n})}),t}static buildDividendManager(e){const t={id:e.id.id,dividends:{id:e.dividends.fields.id.id,size:e.dividends.fields.size},venft_dividends:{id:e.venft_dividends.fields.id.id,size:e.venft_dividends.fields.size},bonus_types:[],start_time:Number(e.start_time),interval_day:Number(e.interval_day),balances:{id:e.balances.fields.id.id,size:e.balances.fields.size},is_open:e.is_open};return e.bonus_types.forEach(i=>{t.bonus_types.push(P(i.fields.name).source_address)}),t}static buildLockUpManager(e){return{id:e.id.id,balance:e.balance,treasury_manager:e.treasury_manager,extra_treasury:e.extra_treasury,lock_infos:{lock_handle_id:e.lock_infos.fields.id.id,size:Number(e.lock_infos.fields.size)},type_name:Ce(e.type_name.fields.name),min_lock_day:Number(e.min_lock_day),max_lock_day:Number(e.max_lock_day),package_version:Number(e.package_version),max_percent_numerator:Number(e.max_percent_numerator),min_percent_numerator:Number(e.min_percent_numerator)}}static buildLockToken(e){const t=e.fields,i={id:t.id.id,type:P(e.type).source_address,locked_start_time:Number(t.locked_start_time),locked_until_time:Number(t.locked_until_time),token_amount:t.balance,xtoken_amount:"0",lock_day:0};return i.lock_day=(i.locked_until_time-i.locked_start_time)/rt,i}static getAvailableXToken(e,t){let i=l(0);return t.forEach(n=>{i=i.add(n.xtoken_amount)}),l(e.xtoken_balance).sub(i).toString()}static getWaitUnLockTokens(e){return e.filter(t=>!Ve.isLocked(t))}static getLockingTokens(e){return e.filter(t=>Ve.isLocked(t))}static buildDividendRewardTypeList(e){const t=new Set;return e.forEach(i=>{i.rewards.forEach(n=>{t.add(n.coin_type)})}),Array.from(t)}static isLocked(e){return e.locked_until_time>Date.parse(new Date().toString())/1e3}static getNextStartTime(e,t=rt){const i=Date.now()/1e3,{start_time:n,interval_day:o}=e,s=Math.ceil((i-n)/(o*t));return n+s*o*t}},Ae=class{static getDefaultStrategyConfig(e){let t;switch(e){case 4:t=ji.bidAsk;break;default:t=ji.curve;break}return t}static geTickIndexRange(e,t,i,n){let o,s;switch(e=B.getInitializableTickIndex(e,t),n){case"left":e>0?(s=l(e).sub(t).toNumber(),o=l(e).mul(l(1).add(i)).toDecimalPlaces(0).toNumber()):(s=l(e).sub(t).toNumber(),o=l(e).mul(l(1).sub(i)).toDecimalPlaces(0).toNumber());break;case"right":e>0?(s=l(e).mul(l(1).add(i)).toDecimalPlaces(0).toNumber(),o=l(e).add(t).toNumber()):(s=l(e).mul(l(1).sub(i)).toDecimalPlaces(0).toNumber(),o=l(e).add(t).toNumber());break;default:e>0?(o=l(e).mul(l(1).sub(i)).toDecimalPlaces(0).toNumber(),s=l(e).mul(l(1).add(i)).toDecimalPlaces(0).toNumber()):(o=l(e).mul(l(1).add(i)).toDecimalPlaces(0).toNumber(),s=l(e).mul(l(1).sub(i)).toDecimalPlaces(0).toNumber());break}if(o=B.getInitializableTickIndex(o,t),s=B.getInitializableTickIndex(s,t),o<Rs)throw Error("Tick lower value is below the minimum allowed value.");if(s>xs)throw Error("Tick upper value is above the maximum allowed value.");return{tick_lower:o,tick_upper:s}}static getCreateLiquidityBins(e,t){let i=[];switch(t){case 4:i=Ae.getCreateBidAskLiquidityBins(e);break;default:i=Ae.getCreateCurveLiquidityBins(e);break}return i}static getCreateBidAskLiquidityBins(e){const t=l(Math.floor(l(e.tick_upper).sub(e.tick_lower).div(e.div_width).toNumber())).abs(),i=[],n=e.ratios;let o,s;for(let r=0;r<n.length;r++){let a,c;e.tick_upper<=e.curr_tick?(c=l(e.tick_upper).sub(t.mul(r)).toNumber(),a=l(c).sub(t).toNumber()):e.tick_lower>=e.curr_tick?(a=l(e.tick_lower).add(t.mul(r)).toNumber(),c=l(e.tick_lower).add(t.mul(r+1)).toNumber()):r===4?(a=l(e.tick_lower).add(t.mul(r)).toNumber(),c=l(a).add(t.mul(2)).toNumber()):r>4?(a=l(e.tick_lower).add(t.mul(r+1)).toNumber(),c=l(a).add(t).toNumber()):(a=l(e.tick_lower).add(t.mul(r)).toNumber(),c=l(a).add(t).toNumber()),o=B.getInitializableTickIndex(a,e.tick_spacing),s=B.getInitializableTickIndex(c,e.tick_spacing),i.push({tick_lower:o,tick_upper:s,ratio:n[r],liquidity:"0"})}return i}static getCreateCurveLiquidityBins(e){const t=l(Math.floor(l(e.tick_upper).sub(e.tick_lower).div(e.div_width).toNumber())).abs(),i=[],n=e.ratios;for(let o=0;o<n.length;o++){let s,r;e.tick_upper<=e.curr_tick?(r=e.tick_upper,s=l(e.tick_upper).sub(t.mul(o+1)).toNumber()):e.tick_lower>=e.curr_tick?(s=e.tick_lower,r=l(s).add(t.mul(o+1)).toNumber()):(s=l(e.curr_tick).sub(t.mul(o+1)).toNumber(),r=l(e.curr_tick).add(t.mul(o+1)).toNumber()),i.push({tick_lower:B.getInitializableTickIndex(s,e.tick_spacing),tick_upper:B.getInitializableTickIndex(r,e.tick_spacing),ratio:n[o],liquidity:"0"})}return i}static calculateAddLiquidityInputs(e){const t=new g(B.tickIndexToSqrtPriceX64(e.curr_tick)),i=Ae.calculateCoinRatios(e.curr_tick,e.liquidity_bins),n=e.liquidity_bins.map((o,s)=>{const r=i[s],a=l(e.coin_amount).mul(e.fix_amount_a?r.coinRatioA:r.coinRatioB).toFixed(0).toString();try{return{...ie.estLiquidityAndcoinAmountFromOneAmounts(o.tick_lower,o.tick_upper,new g(a),e.fix_amount_a,!0,e.slippage,t),...o}}catch{return{coinAmountA:new g(0),coinAmountB:new g(0),tokenMaxA:new g(0),tokenMaxB:new g(0),liquidityAmount:new g(0),fix_amount_a:!e.fix_amount_a,...o}}});return Ae.fixLiquidityInputs(t,e.slippage,n,!0)}static fixLiquidityInputs(e,t,i,n){const o=i.filter(r=>r.liquidityAmount.gt(H));if(o.length===0)return[];const s=o[0];return i.map(r=>{if(r.liquidityAmount.eq(H)){const a=l(s.liquidityAmount.toString()).mul(r.ratio).div(s.ratio).toFixed(0),c=B.tickIndexToSqrtPriceX64(r.tick_lower),d=B.tickIndexToSqrtPriceX64(r.tick_upper),_=ie.getCoinAmountFromLiquidity(new g(a.toString()),e,c,d,!1);return{coinAmountA:_.coinA,coinAmountB:_.coinB,liquidityAmount:new g(a.toString()),fix_amount_a:r.fix_amount_a,...qt(_,st.fromDecimal(l(t).mul(100)),n)}}return r})}static calculateCoinRatios(e,t){const i=new g(B.tickIndexToSqrtPriceX64(e)),n=[];let o=l(0),s=l(0);const r=t.map(d=>{const _=l(ur(100,6).toString()).mul(d.ratio).toFixed(0).toString(),p=B.tickIndexToSqrtPriceX64(d.tick_lower),m=B.tickIndexToSqrtPriceX64(d.tick_upper),y=ie.getCoinAmountFromLiquidity(new g(_),i,p,m,!0);return o=o.add(y.coinA.toString()),s=s.add(y.coinB.toString()),{...y,liquidity:_}}),a=[],c=[];return r.forEach((d,_)=>{const p={coinRatioA:o.eq(l(0))?0:l(d.coinA.toString()).div(o).toNumber(),coinRatioB:s.eq(l(0))?0:l(d.coinB.toString()).div(s).toNumber(),liquiditys:d.liquidity,tick_lower:t[_].tick_lower,tick_upper:t[_].tick_upper};n.push(p),a.push(o.eq(l(0))?0:l(d.coinA.toString()).div(o).toNumber()),c.push(s.eq(l(0))?0:l(d.coinB.toString()).div(s).toNumber())}),n}static calculateCloseMasterLiquidityInputs(e){const t=new g(B.tickIndexToSqrtPriceX64(e.curr_tick));return e.positions.map(n=>{const o=new g(n.liquidity),s=B.tickIndexToSqrtPriceX64(n.tick_lower_index),r=B.tickIndexToSqrtPriceX64(n.tick_upper_index),a=ie.getCoinAmountFromLiquidity(o,t,s,r,!1),c=st.fromDecimal(l(e.slippage).mul(100)),{tokenMaxA:d,tokenMaxB:_}=qt(a,c,!1);return{coinAmountA:a.coinA,coinAmountB:a.coinB,tokenMaxA:d,tokenMaxB:_,liquidityAmount:o,fix_amount_a:!1}})}static calculateRemoveMasterLiquidityInputs(e){const t=new g(B.tickIndexToSqrtPriceX64(e.curr_tick)),{fix_token:i}=e;if(i){const o=e.positions.map((a,c)=>({tick_lower:a.tick_lower_index,tick_upper:a.tick_upper_index,ratio:e.ratios[c]})),s=Ae.calculateCoinRatios(e.curr_tick,o),r=e.positions.map((a,c)=>{const d=s[c],_=l(i.coin_amount).mul(i.fix_amount_a?d.coinRatioA:d.coinRatioB).toFixed(0).toString();try{const p=ie.estLiquidityAndcoinAmountFromOneAmounts(a.tick_lower_index,a.tick_upper_index,new g(_),i.fix_amount_a,!1,e.slippage,t);return{...p,tick_lower:a.tick_lower_index,tick_upper:a.tick_upper_index,liquidity:p.liquidityAmount.toString(),ratio:e.ratios[c]}}catch{return{coinAmountA:new g(0),coinAmountB:new g(0),tokenMaxA:new g(0),tokenMaxB:new g(0),liquidityAmount:new g(0),fix_amount_a:!i.fix_amount_a,tick_lower:a.tick_lower_index,tick_upper:a.tick_upper_index,liquidity:"0",ratio:e.ratios[c]}}});return Ae.fixLiquidityInputs(t,e.slippage,r,!1)}return e.positions.map((o,s)=>{const r=e.ratios[s];let a=l(e.liquidity).mul(r).toFixed(0);l(a).greaterThan(o.liquidity)&&(a=o.liquidity);const c=B.tickIndexToSqrtPriceX64(o.tick_lower_index),d=B.tickIndexToSqrtPriceX64(o.tick_upper_index),_=ie.getCoinAmountFromLiquidity(new g(a),t,c,d,!1),p=st.fromDecimal(l(e.slippage).mul(100)),{tokenMaxA:m,tokenMaxB:y}=qt(_,p,!1);return{coinAmountA:_.coinA,coinAmountB:_.coinB,tokenMaxA:m,tokenMaxB:y,liquidityAmount:new g(a),fix_amount_a:!1}})}static buildMasterPosition(e){return{coin_type_a:P(e.coin_type_a.fields.name).full_address,coin_type_b:P(e.coin_type_b.fields.name).full_address,description:e.description,id:e.id.id,index:e.index,liquidity:e.liquidity,name:e.name,pool:e.pool,tick_lower_index:ce(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:ce(BigInt(e.tick_upper_index.fields.bits)),url:e.url}}static buildMasterNFT(e){const t=R(e);if(t){const i={id:t.id.id,pool_id:t.pool_id,index:Number(t.index),strategy:Number(t.strategy),tick_lower_index:ce(BigInt(t.tick_lower_index)),tick_upper_index:ce(BigInt(t.tick_upper_index)),positions:[],...Nt(e)};return i.positions=t.positions.map(n=>Ae.buildMasterPosition(n.fields)),i}}},je=class{static generateNextTickRange(e,t,i){const n=e-t/2,o=e+t/2;return{new_tick_lower:je.getValidTickIndex(n,i),new_tick_upper:je.getValidTickIndex(o,i)}}static calculateDepositRatio(e,t,i){const n=B.sqrtPriceX64ToTickIndex(i);if(n<e)return{ratioA:new $(1),ratioB:new $(0)};if(n>t)return{ratioA:new $(0),ratioB:new $(1)};const o=new g(1e8),{coinAmountB:s}=ie.estLiquidityAndcoinAmountFromOneAmounts(e,t,o,!0,!0,0,i),r=B.sqrtPriceX64ToPrice(i,0,0),a=l(o.toString()).mul(r),c=a.add(s.toString()),d=a.div(c),_=l(s.toString()).div(c);return{ratioA:d,ratioB:_}}static getValidTickIndex(e,t){if(e%t===0)return e;let i;if(e>0?i=e-e%t+t:e<0?i=e+Math.abs(e)%t-t:i=e,i%t!==0)throw new Error("Assertion failed: res % tickSpacing == 0");if(Math.abs(i)<Math.abs(e))throw new Error("Assertion failed: res.abs() >= tickIndex");return i}static get_lp_amount_by_liquidity(e,t){return e.total_supply==="0"?t:l(e.total_supply).mul(t).div(e.liquidity).toFixed(0,$.ROUND_DOWN).toString()}static get_share_liquidity_by_amount(e,t){return l(t).mul(e.liquidity).div(e.total_supply).toFixed(0,$.ROUND_DOWN).toString()}static get_protocol_fee_amount(e,t){return l(t).mul(e.protocol_fee_rate).div(br).toFixed(0,$.ROUND_CEIL)}static buildPosition(e){return{coin_type_a:P(e.coin_type_a.fields.name).full_address,coin_type_b:P(e.coin_type_b.fields.name).full_address,description:e.description,id:e.id.id,index:e.index,liquidity:e.liquidity,name:e.name,pool:e.pool,tick_lower_index:ce(BigInt(e.tick_lower_index.fields.bits)),tick_upper_index:ce(BigInt(e.tick_upper_index.fields.bits)),url:e.url}}static buildPool(e){const t=R(e),i=et(e);if(t){const n={id:t.id.id,pool_id:t.pool,protocol_fee_rate:t.protocol_fee_rate,is_pause:t.is_pause,harvest_assets:{harvest_assets_handle:t.harvest_assets.fields.id.id,size:Number(t.harvest_assets.fields.size)},positins:[],lp_token_type:P(i).type_arguments[0],total_supply:t.lp_token_treasury.fields.total_supply.fields.value,liquidity:t.liquidity,max_quota:t.max_quota,status:t.status===1?"STATUS_RUNNING":"STATUS_REBALANCING",quota_based_type:t.quota_based_type.fields.name};return n.positins=t.positions.map(o=>je.buildPosition(o.fields)),n}}},Ct=class{static calculatePositionShare(e,t,i,n,o,s,r){if(t<=o||e>=s)return"0";let a=0;e<o?a=o:a=e;let c=0;t<s?c=t:c=s;const d=B.tickIndexToSqrtPriceX64(a),_=B.tickIndexToSqrtPriceX64(c),{coinA:p,coinB:m}=ie.getCoinAmountFromLiquidity(new g(i),new g(r),d,_,!0);return l(p.toString()).mul(n).div(1e12).add(m.toString()).toString()}static buildFramsPool(e){const t=R(e);if(t)try{const i=[];return t.rewarders.forEach(o=>{i.push({reward_coin:P(o.fields.name).full_address,last_reward_time:"",emission_per_second:"",total_allocate_point:"",allocate_point:""})}),{id:t.id.id,clmm_pool_id:t.clmm_pool_id,effective_tick_lower:ce(BigInt(t.effective_tick_lower.fields.bits)),effective_tick_upper:ce(BigInt(t.effective_tick_upper.fields.bits)),total_wrapped_amount:t.total_wrapped_amount,rewarders:i,last_reward_time:Number(t.last_reward_time),price:t.price,positions:{positions_handle:t.positions.fields.id.id,size:t.positions.fields.size}}}catch(i){console.log(i)}}static buildFramsPositionNFT(e){const t=R(e);if(t){const i=t.position.fields;return{id:t.id.id,url:i.url,pool_id:t.pool_id,coinTypeA:P(i.coin_type_a.fields.name).full_address,coinTypeB:P(i.coin_type_b.fields.name).full_address,description:i.description,name:i.name,liquidity:i.liquidity,clmm_position_id:i.id.id,clmm_pool_id:i.pool,tick_lower_index:ce(BigInt(i.tick_lower_index.fields.bits)),tick_upper_index:ce(BigInt(i.tick_upper_index.fields.bits)),rewards:[]}}}},wr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getPoolImmutables(e="all",t=!1){const{package_id:i}=this._sdk.sdkOptions.ido,n=`${i}_getPoolImmutables`,o=this.getCache(n,t),s={data:[],hasNextPage:!1},r=[];if(o!==void 0&&r.push(...o),r.length===0)try{const a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${i}::oversubscribe_pool::CreatePoolEvent`},e);a.data.forEach(c=>{const d=c.parsedJson;if(d){const _=Q.buildIdoPoolImmutables(d);r.push(_)}}),s.hasNextPage=a.hasNextPage,s.nextCursor=a.nextCursor,this.updateCache(n,r,x)}catch(a){console.log("getPoolImmutables",a)}return s.data=r,s}async getPools(e=[],t=!1){const i=[];let n=[];e.length>0?n=[...e]:(await this.getPoolImmutables("all",t)).data.forEach(r=>{n.push(r.pool_address)});const o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(n,{showType:!0,showContent:!0});for(const s of o){const r=Q.buildIdoPool(s);await Q.calculatePoolUiPrice(this._sdk,r),i.push(r);const a=`${r.pool_address}_getPoolObject`;this.updateCache(a,r,x)}return i}async getPool(e,t=!0){const i=`${e}_getPoolObject`,n=this.getCache(i,t);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),s=Q.buildIdoPool(o);return await Q.calculatePoolUiPrice(this._sdk,s),this.updateCache(i,s),s}async getIdoConfigs(e=!1){var c;const{package_id:t}=this._sdk.sdkOptions.ido,i=`${t}_getInitEvent`,n=this.getCache(i,e);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showPreviousTransaction:!0}}),s=bn(o),r=(c=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({Transaction:s}))==null?void 0:c.data,a={pools_id:"",admin_cap_id:"",package_version_id:""};return r.length>0&&(r.forEach(d=>{console.log("item: ",d);const _=d.parsedJson;if(_)switch(P(d.type).full_address){case`${t}::config::InitConfigEvent`:a.admin_cap_id=_.admin_cap_id,a.package_version_id=_.package_version_id;break;case`${t}::factory::InitFactoryEvent`:a.pools_id=_.pools_id;break}}),this.updateCache(i,a,x)),a}async getPurchaseInfo(e,t,i=!0){const n=`${e}_${t}_getPurchaseInfo`,o=this.getCache(n,i);if(o)return o;try{const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"address",value:t}}),r=Q.buildPurchaseInfo(R(s));return this.updateCache(n,r,Ne),r}catch{return}}async getLockNFT(e,t=!1){const i=`${e}_getLockNFT`,n=this.getCache(i,t);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(!o.error)return pi(o)}async getLockNFTList(e){var o;const{clmm_pool:t}=this._sdk.ClmmSDK.sdkOptions,{ido:i}=this._sdk.sdkOptions,n=[];try{const s=(o=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{filter:{StructType:`${i.package_id}::lock::LockedNFT<${t.package_id}::position::Position>`},options:{showContent:!0}}))==null?void 0:o.data;for(const r of s){const a=R(r);if(a){const c=a.nft.fields,d={locked_at:Number(a.locked_at),lock_duration:Number(a.lock_duration),lock_nft_id:a.id.id,type:a.nft.type,...c};d.end_lock_time=d.locked_at+d.lock_duration,d.coin_type_a=P(c.coin_type_a.fields.name).full_address,d.coin_type_b=P(c.coin_type_b.fields.name).full_address,d.id=c.id.id,d.tick_lower_index=ce(BigInt(c.tick_lower_index.fields.bits)),d.tick_upper_index=ce(BigInt(c.tick_upper_index.fields.bits)),n.push(d)}}return n}catch(s){return console.log("getLockNFTList:",s),[]}}async creatPool(e){const{ido:t}=this.sdk.sdkOptions;Qs(Y(e.coin_type_sale),Y(e.coin_type_raise))&&(e.price_min=l(1).div(e.price_max).toNumber(),e.price_max=l(1).div(e.price_min).toNumber());const n=se.priceRealToFix(Number(e.price),e.sale_decimals,e.raise_decimals),o=B.priceToSqrtPriceX64(l(e.price_min),e.sale_decimals,e.raise_decimals).toString(),s=B.priceToSqrtPriceX64(l(e.price_max),e.sale_decimals,e.raise_decimals).toString(),r=new T,a=l(e.total_supply).add(l(e.total_supply).mul(l(e.liquidity_injection_ratio))).toNumber(),c=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.coin_type_sale),d=V.buildCoinForAmount(r,c,BigInt(a),e.coin_type_sale,!1),_=[r.pure(h(t).admin_cap_id),r.pure(h(t).package_version_id),r.pure(h(t).pools_id),r.pure(Y(e.owner)),r.pure(l(n).mul(At).toString()),r.pure(e.total_supply),r.pure(e.complete_raise_limit),r.pure(e.min_purchase_amount),r.pure(e.max_purchase_amount),r.pure(e.start_time),r.pure(e.purchase_duration),r.pure(e.lock_up_duration),r.pure((e.liquidity_injection_ratio*kn).toString()),r.pure(o),r.pure(s),r.pure(e.tick_spacing.toString()),d.targetCoin,r.pure(e.protection_hard_cap.toString()),r.pure(v)],p=[e.coin_type_sale,e.coin_type_raise];return r.moveCall({target:`${t.published_at}::${gr}::create_oversubscribe_pool`,typeArguments:p,arguments:_}),r}async creatPurchasePayload(e){const{ido:t}=this.sdk.sdkOptions,i=new T,n=await this.getPurchaseInfo(e.purchase_handle,this._sdk.ClmmSDK.senderAddress,!1),o=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.coin_type_raise),s=V.buildCoinForAmount(i,o,BigInt(e.raise_amount),e.coin_type_raise,!1),r=[e.coin_type_sale,e.coin_type_raise];let a,c;return n?(c="purchase",a=[i.object(h(t).package_version_id),i.object(e.pool_address),i.object(n.purchase_certificate_id),i.pure(e.raise_amount.toString()),s.targetCoin,i.pure(v)]):(c="create_certificate_and_purchase",a=[i.object(h(t).package_version_id),i.object(e.pool_address),i.pure(e.raise_amount.toString()),s.targetCoin,i.pure(v)]),i.moveCall({target:`${t.published_at}::${pe}::${c}`,typeArguments:r,arguments:a}),i}async redeemPayload(e){const{ido:t}=this.sdk.sdkOptions,i=await this.getPurchaseInfo(e.purchase_handle,this._sdk.ClmmSDK.senderAddress,!1);if(i===void 0)throw Error("get purchase certificate fail");const n=new T,o=[e.coin_type_sale,e.coin_type_raise],s=[n.pure(h(t).package_version_id),n.pure(e.pool_address),n.pure(i.purchase_certificate_id),n.pure(v)];return n.moveCall({target:`${t.published_at}::${pe}::redeem`,typeArguments:o,arguments:s}),n}injectLiquidityPayload(e){const{ido:t}=this.sdk.sdkOptions,{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,n=new T,o=[e.coin_type_sale,e.coin_type_raise],s=e.is_reverse?"inject_liquidity_with_reverse_clmm_pool":"inject_liquidity_with_forward_clmm_pool",r=[n.pure(h(t).package_version_id),n.pure(e.pool_address),n.pure(h(i).global_config_id),n.pure(e.clmm_pool_address),n.pure(v)];return n.moveCall({target:`${t.published_at}::${pe}::${s}`,typeArguments:o,arguments:r}),n}unPauseInjectLiquidity(e){const{ido:t}=this.sdk.sdkOptions,{integrate:i,clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions,o=new T;o.moveCall({target:`${i.published_at}::${Fs}::unpause_pool`,typeArguments:[e.coin_type_a,e.coin_type_b],arguments:[o.object(h(n).global_config_id),o.object(e.clmm_pool_address)]});const s=[e.coin_type_sale,e.coin_type_raise],r=e.is_reverse?"inject_liquidity_with_reverse_clmm_pool":"inject_liquidity_with_forward_clmm_pool",a=[o.object(h(t).package_version_id),o.object(e.pool_address),o.object(h(n).global_config_id),o.object(e.clmm_pool_address),o.object(v)];return o.moveCall({target:`${t.published_at}::${pe}::${r}`,typeArguments:s,arguments:a}),o}async findClmmPoolForLiquidity(e){let t=null,i=!1;const n=await this.sdk.ClmmSDK.Pool.getPoolImmutables();for(const o of n){if(o.coinTypeA===e.coin_type_sale&&o.coinTypeB===e.coin_type_raise&&Number(o.tickSpacing)===e.tick_spacing){t=await this._sdk.ClmmSDK.Pool.getPool(o.poolAddress);break}if(o.coinTypeA===e.coin_type_raise&&o.coinTypeB===e.coin_type_sale&&Number(o.tickSpacing)===e.tick_spacing){t=await this._sdk.ClmmSDK.Pool.getPool(o.poolAddress),i=!0;break}}return t&&(l(t.current_sqrt_price).lessThanOrEqualTo(e.current_sqrt_price_min)||l(t.current_sqrt_price).greaterThanOrEqualTo(e.current_sqrt_price_max))?(console.log("clmmPool: ",t.poolAddress),{is_reverse:i,clmmPool:null}):{is_reverse:i,clmmPool:t}}withdrawPayload(e){const{ido:t}=this.sdk.sdkOptions,i=new T,n=[e.coin_type_sale,e.coin_type_raise],o=[i.object(h(t).package_version_id),i.object(e.pool_address),i.object(v)];return i.moveCall({target:`${t.published_at}::${pe}::withdraw`,typeArguments:n,arguments:o}),i}updateWhitelistCapPayload(e){const{ido:t}=this.sdk.sdkOptions,i=new T,n=[e.coin_type_sale,e.coin_type_raise];return e.add_whites&&e.add_whites.addresses.length>0&&i.moveCall({target:`${t.published_at}::${pe}::add_white_listed_addresses`,typeArguments:n,arguments:[i.object(h(t).admin_cap_id),i.object(h(t).package_version_id),i.object(e.pool_address),i.makeMoveVec({type:"address",objects:e.add_whites.addresses.map(o=>i.pure(ue(o),"address"))}),i.pure(e.add_whites.protection_limit),i.object(v)]}),e.remove_whites&&e.remove_whites.length>0&&i.moveCall({target:`${t.published_at}::${pe}::remove_white_listed_addresses`,typeArguments:n,arguments:[i.object(h(t).admin_cap_id),i.object(h(t).package_version_id),i.object(e.pool_address),i.makeMoveVec({type:"address",objects:e.remove_whites.map(o=>i.pure(ue(o),"address"))}),i.object(v)]}),e.update_whites&&e.update_whites.forEach(o=>{i.moveCall({target:`${t.published_at}::${pe}::update_white_listed_address`,typeArguments:n,arguments:[i.object(h(t).admin_cap_id),i.object(h(t).package_version_id),i.object(e.pool_address),i.object(o.address),i.pure(o.protection_limit),i.object(v)]})}),i}creatCancelPoolPayload(e){const{ido:t}=this.sdk.sdkOptions,i=new T,n=[e.coin_type_sale,e.coin_type_raise],o=[i.pure(h(t).admin_cap_id),i.pure(h(t).package_version_id),i.pure(e.pool_address),i.pure(v)];return i.moveCall({target:`${t.published_at}::${pe}::cancel`,typeArguments:n,arguments:o}),i}updatePoolOwnerPayload(e,t){const{ido:i}=this.sdk.sdkOptions;t=t===void 0?new T:t;const n=[e.coin_type_sale,e.coin_type_raise],o=[t.object(h(i).admin_cap_id),t.object(h(i).package_version_id),t.object(e.pool_address),t.object(e.new_owner),t.object(v)];return t.moveCall({target:`${i.published_at}::${pe}::update_pool_owner`,typeArguments:n,arguments:o}),t}updatePoolDuractionPayload(e,t){const{ido:i}=this.sdk.sdkOptions;t=t===void 0?new T:t;const n=[e.coin_type_sale,e.coin_type_raise],o=[t.object(h(i).admin_cap_id),t.object(h(i).package_version_id),t.object(e.pool_address),t.pure(e.start_time),t.pure(e.purchase_duration),t.pure(e.lock_duration),t.object(v)];return t.moveCall({target:`${i.published_at}::${pe}::update_pool_duration`,typeArguments:n,arguments:o}),t}updateProtectionHardCapPayload(e,t){const{ido:i}=this.sdk.sdkOptions;t=t===void 0?new T:t;const n=[e.coin_type_sale,e.coin_type_raise],o=[t.object(h(i).admin_cap_id),t.object(h(i).package_version_id),t.object(e.pool_address),t.pure(e.protection_hard_cap),t.object(v)];return t.moveCall({target:`${i.published_at}::${pe}::update_protection_hard_cap`,typeArguments:n,arguments:o}),t}unlockNftPayload(e){const{ido:t}=this.sdk.sdkOptions,i=new T,n=[e.nft_type],o=[i.pure(e.lock_nft_id),i.pure(v)];return i.moveCall({target:`${t.published_at}::lock::unlock_nft`,typeArguments:n,arguments:o}),i}async isAdminCap(e){const{ido:t}=this._sdk.sdkOptions,i=`${t.package_id}_${e}_isAdminCap`,n=this.getCache(i);if(n)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:h(t).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(o);const s=et(o),r=Dt(o);let a=!1;return r&&s&&P(s).source_address===`${t.package_id}::config::AdminCap`&&(a=Y(r.AddressOwner)===Y(e)),this.updateCache(i,a,x),a}async getWhiteProtectionLimit(e,t,i=!0){const n=`${e}_${t}_getWhiteProtectionLimit`,o=this._sdk.getCache(n,i);if(o)return o;try{const s=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"address",value:t}});if(s&&s.data){const r=R(s);return this._sdk.updateCache(n,r.value),r.value}return}catch{return}}async getWhiteList(e,t){var n;const i={type:"address",value:t};try{const o=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:i}),s=R(o);if(console.log(s),s)return(n=s==null?void 0:s.value)==null?void 0:n.fields}catch{}return{safe_limit_amount:"0",safe_purchased_amount:"0"}}async getAdminAddress(){const{ido:e}=this._sdk.sdkOptions,t=`${h(e).admin_cap_id}_getAdminAddress`,i=this.getCache(t);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:h(e).admin_cap_id,options:{showType:!0,showOwner:!0}});console.log(n);const o=et(n),s=Dt(n);if(s&&o&&P(o).source_address===`${e.package_id}::config::AdminCap`){const a=Y(s.AddressOwner);return this.updateCache(t,a,x),a}return""}updateCache(e,t,i=x){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},kr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getOwnerVeNFT(e,t=!0){const{xtoken:i}=this.sdk.sdkOptions,n=`${e}_getLockUpManagerEvent`,o=this.getCache(n,t);if(o!==void 0)return o;let s;const r=`${i.package_id}::xtoken::VeNFT`;return(await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0},filter:{StructType:r}})).data.forEach(c=>{const d=P(ve(c)).source_address;if(d===r&&c.data&&c.data.content){const{fields:_}=c.data.content;s={...Nt(c),id:_.id.id,index:_.index,type:d,xtoken_balance:_.xtoken_balance},this.updateCache(n,s,x)}}),s}async getOwnerLockTokens(e){const{xtoken:t}=this.sdk.sdkOptions,i=[],n=`${t.package_id}::lock_coin::LockedCoin<${this.buileTokenCoinType()}>`,o=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0},filter:{StructType:n}});for(const s of o.data)if(P(ve(s)).source_address===n&&s.data){const a=Ve.buildLockToken(s.data.content),c=await this.getLockXToken(a.id);c&&(a.xtoken_amount=c.xtoken_amount),i.push(a)}return i}async getLockToken(e){var i;const t=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}});if((i=t.data)!=null&&i.content){const n=Ve.buildLockToken(t.data.content),o=await this.getLockXToken(n.id);return o&&(n.xtoken_amount=o.xtoken_amount),n}}async getOwnerTokenCoins(e){return await this._sdk.ClmmSDK.getOwnerCoinAssets(e,this.buileTokenCoinType())}mintVeNFTPayload(){const{xtoken:e}=this.sdk.sdkOptions,t=new T;return t.moveCall({target:`${e.published_at}::${Ze}::mint_venft`,typeArguments:[],arguments:[t.pure(h(e).xtoken_manager_id)]}),t}async convertPayload(e){const{xtoken:t}=this.sdk.sdkOptions,i=new T,n=this.buileTokenCoinType(),o=await V.syncBuildCoinInputForAmount(this._sdk.ClmmSDK,i,BigInt(e.amount),n);return e.venft_id===void 0?i.moveCall({target:`${t.published_at}::${Ze}::mint_and_convert`,typeArguments:[],arguments:[i.object(h(t).lock_manager_id),i.object(h(t).xtoken_manager_id),o,i.pure(e.amount)]}):i.moveCall({target:`${t.published_at}::${Ze}::convert`,typeArguments:[],arguments:[i.object(h(t).lock_manager_id),i.object(h(t).xtoken_manager_id),o,i.pure(e.amount),i.pure(e.venft_id)]}),i}redeemLockPayload(e){const{xtoken:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${Ze}::redeem_lock`,typeArguments:[],arguments:[i.pure(h(t).lock_manager_id),i.pure(h(t).xtoken_manager_id),i.pure(e.venft_id),i.pure(e.amount),i.pure(e.lock_day),i.pure(v)]}),i}redeemPayload(e){const{xtoken:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${Ze}::redeem`,typeArguments:[],arguments:[i.pure(h(t).lock_manager_id),i.pure(h(t).xtoken_manager_id),i.pure(e.venft_id),i.pure(e.lock_id),i.pure(v)]}),i}redeemDividendPayload(e,t){const{xtoken_dividends:i}=this.sdk.sdkOptions,n=new T;return t.forEach(o=>{n.moveCall({target:`${i.published_at}::${Kt}::redeem`,typeArguments:[o],arguments:[n.object(h(i).dividend_manager_id),n.object(e)]})}),n}redeemDividendV2Payload(e,t,i){const{xtoken_dividends:n}=this.sdk.sdkOptions;let o=new T;return t.filter(r=>i.includes(r)).length>0&&(o=this.redeemDividendXTokenPayload(e,o)),t.forEach(r=>{i.includes(r)||o.moveCall({target:`${n.published_at}::${Kt}::redeem_v2`,typeArguments:[r],arguments:[o.object(h(n).dividend_manager_id),o.object(e),o.object(v)]})}),o}redeemDividendXTokenPayload(e,t){const{xtoken_dividends:i,xtoken:n}=this.sdk.sdkOptions,{xtoken_manager_id:o,lock_manager_id:s}=h(n),{dividend_manager_id:r}=h(i);return t=t===void 0?new T:t,t.moveCall({target:`${i.published_at}::${Kt}::redeem_xtoken`,typeArguments:[],arguments:[t.object(s),t.object(o),t.object(r),t.object(e),t.object(v)]}),t}buileTokenCoinType(){return`${this.sdk.sdkOptions.token_faucet.package_id}::token::TOKEN`}buileXTokenCoinType(e=this._sdk.sdkOptions.xtoken.package_id,t="xtoken",i="XTOKEN"){return`${e}::${t}::${i}`}cancelRedeemPayload(e){const{xtoken:t}=this.sdk.sdkOptions,i=new T;return i.moveCall({target:`${t.published_at}::${Ze}::cancel_redeem_lock`,typeArguments:[],arguments:[i.pure(h(t).lock_manager_id),i.pure(h(t).xtoken_manager_id),i.pure(e.venft_id),i.pure(e.lock_id),i.pure(v)]}),i}async getInitConfigs(){var r,a;const{package_id:e}=this.sdk.sdkOptions.xtoken,t=`${e}_getInitFactoryEvent`,i=this.getCache(t);if(i!==void 0)return i;const n=(r=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::xtoken::InitEvent`}))==null?void 0:r.data,o={xtoken_manager_id:"",lock_manager_id:"",lock_handle_id:""};n.length>0&&n.forEach(c=>{const d=c.parsedJson;d&&(o.xtoken_manager_id=d.xtoken_manager)});const s=(a=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::locking::InitializeEvent`}))==null?void 0:a.data;return s.length>0&&s.forEach(c=>{const d=c.parsedJson;d&&(o.lock_manager_id=d.lock_manager)}),o.lock_handle_id=(await this.getLockUpManager(o.lock_manager_id)).lock_infos.lock_handle_id,this.updateCache(t,o,x),o}async getLockUpManager(e=h(this.sdk.sdkOptions.xtoken).lock_manager_id,t=!1){const i=`${e}_getLockUpManagerEvent`,n=this.getCache(i,t);if(n!==void 0)return n;const o=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=Ve.buildLockUpManager(R(o));return this.updateCache(i,s,x),s}async getLockInfoHandle(e){const t=`${e}_getLockInfoHandle`,i=this.getCache(t);if(i!==void 0)return i;let n="";const o=await this.sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0}}),s=R(o);return s&&(n=s.lock_infos.fields.id.id,this.updateCache(t,n,x)),n}async getDividendConfigs(){var s;const{package_id:e}=this.sdk.sdkOptions.xtoken_dividends,t=`${e}_getDividendManagerEvent`,i=this.getCache(t);if(i!==void 0)return i;const n=(s=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::dividend::InitEvent`}))==null?void 0:s.data,o={dividend_manager_id:"",dividend_admin_id:"",dividend_settle_id:""};return n.length>0&&n.forEach(r=>{const a=r.parsedJson;a&&(o.dividend_manager_id=a.manager_id,o.dividend_admin_id=a.admin_id,o.dividend_settle_id=a.settle_id,this.updateCache(t,o,x))}),o}async getDividendManager(e=!1){const{dividend_manager_id:t}=h(this.sdk.sdkOptions.xtoken_dividends),i=`${t}_getDividendManager`,n=this.getCache(i,e);if(n!==void 0)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=R(o),r=Ve.buildDividendManager(s);return this.updateCache(i,r,x),r}async getXcetusManager(e=!0){const{xtoken_manager_id:t}=h(this.sdk.sdkOptions.xtoken),i=`${t}_getXcetusManager`,n=this.getCache(i,e);if(n)return n;const o=await this._sdk.ClmmSDK.fullClient.getObject({id:t,options:{showContent:!0}}),s=R(o),r={id:s.id.id,index:Number(s.index),has_venft:{handle:s.has_venft.fields.id.id,size:s.has_venft.fields.size},nfts:{handle:s.nfts.fields.id.id,size:s.nfts.fields.size},total_locked:s.total_locked,treasury:s.treasury.fields.total_supply.fields.value};return this.updateCache(i,r),r}async getVeNFTDividendInfo(e,t){try{const i=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),n=R(i);return Ve.buildVeNFTDividendInfo(n)}catch{return}}async redeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const i=await this.getLockUpManager(),n=l(me).mul(l(i.max_lock_day).sub(l(t))).mul(l(i.max_percent_numerator).sub(l(i.min_percent_numerator))).div(l(i.max_lock_day).sub(l(i.min_lock_day))),o=l(me).mul(l(i.max_percent_numerator)).sub(n).div(l(Bt)).div(me);return{amountOut:l(o).mul(l(e)).round().toString(),percent:o.toString()}}async reverseRedeemNum(e,t){if(BigInt(e)===BigInt(0))return{amountOut:"0",percent:"0"};const i=await this.getLockUpManager(),n=l(me).mul(l(i.max_lock_day).sub(l(t))).mul(l(i.max_percent_numerator).sub(l(i.min_percent_numerator))).div(l(i.max_lock_day).sub(l(i.min_lock_day))),o=l(me).mul(l(i.max_percent_numerator)).sub(n).div(l(Bt)).div(me);return{amountOut:l(e).div(o).toFixed(0,$.ROUND_UP),percent:o.toString()}}async getLockXToken(e){const{lock_handle_id:t}=h(this._sdk.sdkOptions.xtoken),i=`${e}_getXTokenAmount`,n=this.getCache(i);if(n)return n;try{const o=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:t,name:{type:"0x2::object::ID",value:e}}),s=R(o);if(s){const r=s.value.fields.value.fields;return this.updateCache(i,r,x),r}}catch{}}async getVeNftAmount(e,t){try{const i=await this.sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:e,name:{type:"0x2::object::ID",value:t}}),n=R(i);if(n){const{lock_amount:o,xtoken_amount:s}=n.value.fields.value.fields;return{lock_amount:o,xtoken_amount:s}}}catch{}return{lock_amount:"0",xtoken_amount:"0"}}async getPhaseDividendInfo(e,t=!1){const n=(await this.getDividendManager()).dividends.id,o=`${n}_${e}_getPhaseDividendInfo`,s=this._sdk.getCache(o,t);if(s)return s;try{const r=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:n,name:{type:"u64",value:e}}),a=R(r),c=a.value.fields.value.fields,d=c.redeemed_num.fields.contents.map(y=>({name:y.fields.key.fields.name,value:y.fields.value})),_=c.bonus_types.map(y=>y.fields.name),p=c.bonus.fields.contents.map(y=>({name:y.fields.key.fields.name,value:y.fields.value})),m={id:ut(r),phase:a.name,settled_num:c.settled_num,register_time:c.register_time,redeemed_num:d,is_settled:c.is_settled,bonus_types:_,bonus:p,phase_end_time:""};return this.updateCache(o,m),m}catch{}}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},Cr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async addMasterLiquidity(e){var C,w;const{liquidity_stratefy:t}=this._sdk.sdkOptions,{clmm_pool:i}=this._sdk.ClmmSDK.sdkOptions,n=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);let o=l(0),s=l(0);const r=[],a=[],c=[],d=[],_=[];e.liquidity_bins.forEach((b,j)=>{const I=e.amounts_a[j],D=e.amounts_b[j],Z=e.bins_fix_amount_a[j];o=o.add(I),s=s.add(D),r.push(I),a.push(D),c.push($e(BigInt(b.tick_lower)).toString()),d.push($e(BigInt(b.tick_upper)).toString()),_.push(Z)});const p=[e.coinTypeA,e.coinTypeB],m=new T,y=(C=V.buildAddLiquidityFixTokenCoinInput(m,!e.fix_amount_a,o.toString(),e.slippage,e.coinTypeA,n,!1))==null?void 0:C.targetCoin,S=(w=V.buildAddLiquidityFixTokenCoinInput(m,e.fix_amount_a,s.toString(),e.slippage,e.coinTypeB,n,!1))==null?void 0:w.targetCoin;return fr(e)?m.moveCall({target:`${t.published_at}::router::increase_liquidity`,typeArguments:p,arguments:[m.object(h(t).master_manger_id),m.object(e.master_address),m.object(h(i).global_config_id),m.object(e.pool_address),y,S,m.makeMoveVec({type:"u64",objects:r.map(b=>m.pure(b,"u64"))}),m.makeMoveVec({type:"u64",objects:a.map(b=>m.pure(b,"u64"))}),m.makeMoveVec({type:"bool",objects:_.map(b=>m.pure(b,"bool"))}),m.object(v)]}):m.moveCall({target:`${t.published_at}::router::create_master_liquidity`,typeArguments:p,arguments:[m.object(h(t).master_manger_id),m.object(h(i).global_config_id),m.object(e.pool_address),y,S,m.makeMoveVec({type:"u32",objects:c.map(b=>m.pure(b,"u32"))}),m.makeMoveVec({type:"u32",objects:d.map(b=>m.pure(b,"u32"))}),m.makeMoveVec({type:"u64",objects:r.map(b=>m.pure(b,"u64"))}),m.makeMoveVec({type:"u64",objects:a.map(b=>m.pure(b,"u64"))}),m.makeMoveVec({type:"bool",objects:_.map(b=>m.pure(b,"bool"))}),m.pure(e.strategy),m.pure($e(BigInt(e.tick_lower)).toString()),m.pure($e(BigInt(e.tick_upper)).toString()),m.object(v)]}),m}buildMasterNFTType(){return`${this._sdk.sdkOptions.liquidity_stratefy.package_id}::master_liquidity::MasterLiquidity`}async getMasterNFTList(e,t=[]){const i=[],n=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0},filter:{Package:this._sdk.sdkOptions.liquidity_stratefy.package_id}}),o=t.length>0;for(const s of n.data)if(P(s.data.type).full_address===this.buildMasterNFTType()){const a=Ae.buildMasterNFT(s);if(a){const c=`${a.id}_masterNFT`;this.updateCache(c,a,x),o?t.includes(a.pool_id)&&i.push(a):i.push(a)}}return i}async getMasterNFT(e,t=!1){const i="$masterId}_masterNFT",n=this.getCache(i,t);if(n)return n;try{const o=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}});if(P(o.data.type).full_address===this.buildMasterNFTType()){const r=Ae.buildMasterNFT(o);return r&&this.updateCache(i,r,x),r}}catch(o){console.log(o)}}async fetchMasterPositionInfos(e){var a;const t={},{clmm_pool:i,integrate:n,simulationAccount:o}=this.sdk.ClmmSDK.sdkOptions,s=new T;return e.forEach(c=>{c.position_ids.forEach(d=>{const _=[c.coinTypeA,c.coinTypeB],p=[s.object(h(i).global_config_id),s.object(c.pool_id),s.object(d)];s.moveCall({target:`${n.published_at}::${ot}::fetch_position_fees`,arguments:p,typeArguments:_}),s.moveCall({target:`${n.published_at}::${ot}::fetch_position_rewards`,arguments:[...p,s.object(v)],typeArguments:_})})}),(a=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:s,sender:o.address})).events)==null||a.forEach(c=>{const{parsedJson:d}=c,{position_id:_}=d;let p=t[_];switch(p===void 0&&(p={position_id:_,feeOwedA:"0",feeOwedB:"0",rewarders:[]},t[_]=p),P(c.type).name){case"FetchPositionFeesEvent":p.feeOwedA=d.fee_owned_a,p.feeOwedB=d.fee_owned_b;break;case"FetchPositionRewardsEvent":p.rewarders=d.data;break}}),t}async getLiquidityStrategyConfigs(e=!1){const{package_id:t}=this._sdk.sdkOptions.liquidity_stratefy,i=`${t}_getLiquidityStrategyConfigst`,n=this.getCache(i,e);if(n!==void 0)return n;const o=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::master_liquidity::MasterLiquidityManagerCreatedEvent`})).data,s={master_manger_id:"",master_liquidity_handle:""};if(o.length>0){for(const r of o){const a=r.parsedJson;s.master_manger_id=a.id;const c=await this._sdk.ClmmSDK.fullClient.getObject({id:a.id,options:{showContent:!0}}),d=R(c);s.master_liquidity_handle=d.position_maps.fields.id.id;break}this.updateCache(i,s,x)}return s}removeMasterLiquidity(e){const{clmm_pool:t}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:i}=this.sdk.sdkOptions,n=new T,o=[e.coinTypeA,e.coinTypeB];this.collectReward({coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collect_fee:!1,rewarder_coin_types:e.rewarder_coin_types,master_address:e.master_address,pool_address:e.pool_address},n);const s=[n.object(h(i).master_manger_id),n.object(e.pool_address),n.object(e.master_address),n.object(h(t).global_config_id),n.makeMoveVec({type:"u128",objects:e.delta_liquidities.map(r=>n.pure(r,"u128"))}),n.makeMoveVec({type:"u64",objects:e.min_amounts_a.map(r=>n.pure(r,"u64"))}),n.makeMoveVec({type:"u64",objects:e.min_amounts_b.map(r=>n.pure(r,"u64"))}),n.object(v)];return n.moveCall({target:`${i.published_at}::${kt}::remove_liquidity`,typeArguments:o,arguments:s}),n}closeMasterLiquidity(e){const{clmm_pool:t}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:i}=this.sdk.sdkOptions,n=new T,o=[e.coinTypeA,e.coinTypeB];return this.collectReward({coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collect_fee:!1,rewarder_coin_types:e.rewarder_coin_types,master_address:e.master_address,pool_address:e.pool_address},n),n.moveCall({target:`${i.published_at}::${kt}::close_master_liquidity`,typeArguments:o,arguments:[n.object(h(i).master_manger_id),n.object(e.master_address),n.object(h(t).global_config_id),n.object(e.pool_address),n.makeMoveVec({type:"u64",objects:e.min_amounts_a.map(s=>n.pure(s,"u64"))}),n.makeMoveVec({type:"u64",objects:e.min_amounts_b.map(s=>n.pure(s,"u64"))}),n.object(v)]}),n}collectFee(e,t){const{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:n}=this.sdk.sdkOptions;t=t===void 0?new T:t;const o=[e.coinTypeA,e.coinTypeB],s=[t.object(h(n).master_manger_id),t.object(e.master_address),t.object(h(i).global_config_id),t.object(e.pool_address)];return t.moveCall({target:`${n.published_at}::${kt}::collect_fee`,typeArguments:o,arguments:s}),t}collectReward(e,t){const{clmm_pool:i}=this.sdk.ClmmSDK.sdkOptions,{liquidity_stratefy:n}=this.sdk.sdkOptions;return t=t===void 0?new T:t,e.collect_fee&&this.collectFee({...e},t),e.rewarder_coin_types.forEach(o=>{const s=[e.coinTypeA,e.coinTypeB,o];if(t){const r=[t.object(h(n).master_manger_id),t.object(e.master_address),t.object(h(i).global_config_id),t.object(e.pool_address),t.object(h(i).global_vault_id),t.object(v)];t.moveCall({target:`${n.published_at}::${kt}::collect_reward`,typeArguments:s,arguments:r})}}),t}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e],n=i==null?void 0:i.isValid();if(!t&&n)return i.value;n||delete this._cache[e]}},vr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}buildCoinInput(e,t,i,n,o){const{selectedCoins:s,remainingCoins:r}=G.selectCoinAssetGreaterThanOrEqual(t,BigInt(n)),a=G.calculateTotalBalance(s);if(a<BigInt(n))throw new Error(`The amount(${a}) is Insufficient balance for ${i} , expect ${n} `);const c=a-BigInt(n);let d;if(G.isSuiCoin(i))d=e.splitCoins(e.gas,[e.pure(n)]);else{const[_,...p]=s.map(m=>m.coinObjectId);d=e.object(_),p.length>0?o?e.mergeCoins(d,[...p.map(m=>e.object(m)),o]):e.mergeCoins(d,[...p.map(m=>e.object(m))]):o&&e.mergeCoins(d,[o])}return{selectedUnusedAmount:c,coinInput:d,remainingCoins:r}}async deposit(e){var c,d;console.log("1110 deposit 参数: ",{params:e});const{vaults:t}=this._sdk.sdkOptions,{clmm_pool:i}=this._sdk.ClmmSDK.sdkOptions,n=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.getVerifySenderAddress()),o=new T;let s,r;if(e.swapParams){const _=await this.handleDepositSwap(e,o,n);s=_.primaryCoinAInputs,r=_.primaryCoinBInputs}else s=(c=V.buildAddLiquidityFixTokenCoinInput(o,!e.fix_amount_a,e.amount_a,e.slippage,e.coinTypeA,n,!1))==null?void 0:c.targetCoin,r=(d=V.buildAddLiquidityFixTokenCoinInput(o,e.fix_amount_a,e.amount_b,e.slippage,e.coinTypeB,n,!1))==null?void 0:d.targetCoin;const a=e.rewarder_coin_types?e.rewarder_coin_types.length:0;if(a>0){const _=["deposit_with_one","deposit_with_two","deposit_with_three"];o.moveCall({target:`${t.published_at}::${Ut}::${_[a-1]}`,typeArguments:[e.coinTypeA,e.coinTypeB,...e.rewarder_coin_types,e.lp_token_type],arguments:[o.object(h(t).vaults_manager_id),o.object(e.vault_id),o.object(h(i).global_config_id),o.object(e.clmm_pool),o.object(h(i).global_vault_id),s,r,o.pure(e.amount_a),o.pure(e.amount_b),o.pure(e.fix_amount_a),o.object(v)]})}else o.moveCall({target:`${t.published_at}::${Ut}::deposit`,typeArguments:[e.coinTypeA,e.coinTypeB,e.lp_token_type],arguments:[o.object(h(t).vaults_manager_id),o.object(e.vault_id),o.object(h(i).global_config_id),o.object(e.clmm_pool),s,r,o.pure(e.amount_a),o.pure(e.amount_b),o.pure(e.fix_amount_a),o.object(v)]});return o}async handleDepositSwap(e,t,i){const{clmm_pool:n,integrate:o}=this._sdk.ClmmSDK.sdkOptions,{swap_amount:s,a2b:r,route_obj:a}=e.swapParams,c=r?e.coinTypeA:e.coinTypeB,d=V.buildCoinForAmount(t,i,BigInt(s),c,!1),_=BigInt(d.tragetCoinAmount)-BigInt(s),p=V.buildCoinForAmount(t,i,0n,r?e.coinTypeB:e.coinTypeA,!1);let m=[];if(a){const b=await V.buildAggregatorSwapReturnCoins(this._sdk.ClmmSDK,a,d,p,"",e.slippage,t);m=r?[b.fromCoin,b.toCoin]:[b.toCoin,b.fromCoin],p.isMintZeroCoin||t.transferObjects([p.targetCoin],t.pure(this._sdk.getVerifySenderAddress()))}else{const b=Ke.getDefaultSqrtPriceLimit(r).toString();m=t.moveCall({target:`${o.published_at}::${nt}::swap`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(h(n).global_config_id),t.object(e.clmm_pool),r?d.targetCoin:p.targetCoin,r?p.targetCoin:d.targetCoin,t.pure(r),t.pure(!0),t.pure(s),t.pure(b),t.pure(!1),t.object(v)]})}let y,S;const C=m[0],w=m[1];if(r){const b=BigInt(e.amount_a)-_;G.isSuiCoin(c)?(t.transferObjects([C],t.pure(this._sdk.getVerifySenderAddress())),y=t.splitCoins(t.gas,[t.pure(e.amount_a)])):b>0n?y=this.buildCoinInput(t,d.remainCoins,c,b,C).coinInput:y=C,S=w}else{y=C;const b=BigInt(e.amount_b)-_;G.isSuiCoin(c)?(t.transferObjects([w],t.pure(this._sdk.getVerifySenderAddress())),S=t.splitCoins(t.gas,[t.pure(e.amount_b)])):b>0n?S=this.buildCoinInput(t,d.remainCoins,c,b,w).coinInput:S=w}return{primaryCoinAInputs:y,primaryCoinBInputs:S}}async remove(e){console.log({params:e});const{vaults:t}=this.sdk.sdkOptions,{clmm_pool:i,integrate:n}=this._sdk.ClmmSDK.sdkOptions,o=new T,s=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.getVerifySenderAddress(),e.lp_token_type),r=V.buildCoinForAmount(o,s,BigInt(e.lp_token_amount),e.lp_token_type,!1).targetCoin,a=[e.coinTypeA,e.coinTypeB,e.lp_token_type],c=e.rewarder_coin_types.length;if(c>0){const d=["remove_with_one","remove_with_two","remove_with_three"];o.moveCall({target:`${t.published_at}::${Ut}::${d[c-1]}`,typeArguments:[e.coinTypeA,e.coinTypeB,...e.rewarder_coin_types,e.lp_token_type],arguments:[o.object(h(t).vaults_manager_id),o.object(e.vault_id),o.object(h(i).global_config_id),o.object(e.clmm_pool),o.object(h(i).global_vault_id),r,o.pure(e.lp_token_amount),o.pure(e.min_amount_a),o.pure(e.min_amount_b),o.object(v)]})}else{const d=o.moveCall({target:`${t.published_at}::${yr}::remove`,typeArguments:a,arguments:[o.object(h(t).vaults_manager_id),o.object(e.vault_id),o.object(h(i).global_config_id),o.object(e.clmm_pool),r,o.pure(e.lp_token_amount),o.pure(e.min_amount_a),o.pure(e.min_amount_b),o.object(v)]}),_=d[0],p=d[1];if(e.swapParams){const{a2b:m,swap_amount:y,route_obj:S}=e.swapParams;if(S){const C={targetCoin:m?_:p,remainCoins:[],isMintZeroCoin:!1,tragetCoinAmount:""},w={targetCoin:m?p:_,remainCoins:[],isMintZeroCoin:!1,tragetCoinAmount:""},b=await V.buildAggregatorSwapReturnCoins(this._sdk.ClmmSDK,S,C,w,"",e.slippage,o),j=m?[b.fromCoin,b.toCoin]:[b.toCoin,b.fromCoin];o.moveCall({target:"0x2::coin::destroy_zero",arguments:[b.fromCoin],typeArguments:[m?e.coinTypeA:e.coinTypeB]}),m?(o.mergeCoins(j[1],[p]),o.transferObjects([j[1]],o.pure(this._sdk.getVerifySenderAddress()))):(o.mergeCoins(j[0],[_]),o.transferObjects([j[0]],o.pure(this._sdk.getVerifySenderAddress())))}else{const C=Ke.getDefaultSqrtPriceLimit(m).toString(),w=o.moveCall({target:`${n.published_at}::${nt}::swap`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[o.object(h(i).global_config_id),o.object(e.clmm_pool),_,p,o.pure(m),o.pure(!0),o.pure(y),o.pure(C),o.pure(!0),o.object(v)]});o.transferObjects([w[0],w[1]],o.pure(this._sdk.getVerifySenderAddress()))}}else o.transferObjects([_,p],o.pure(this._sdk.getVerifySenderAddress()))}return o}async getVaultList(e="all"){const{vaults:t}=this._sdk.sdkOptions,i=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t.package_id}::vaults::CreateEvent`},e),n=i.data.map(r=>r.parsedJson.id),o=await this._sdk.ClmmSDK.fullClient.batchGetObjects(n,{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}),s=[];return o.forEach(r=>{const a=je.buildPool(r);a&&(this.savePoolToCache(a),s.push(a))}),i.data=s,i}savePoolToCache(e){const t=`${e.id}_mirrorPool`;this.updateCache(t,e,x)}readPoolFromCache(e,t=!1){const i=`${e}_mirrorPool`;return this.getCache(i,t)}async calculateMaxAvailable(e){var C;const{integrate:t,simulationAccount:i}=this.sdk.ClmmSDK.sdkOptions,n=new T,o=B.tickIndexToSqrtPriceX64(e.lowerTick),s=B.tickIndexToSqrtPriceX64(e.upperTick),r=new g(e.curSqrtPrice),a=ie.getCoinAmountFromLiquidity(new g(e.input_amount),r,o,s,!1),c=[e.coinTypeA,e.coinTypeB];n.moveCall({target:`${t.published_at}::${ot}::calculate_swap_result`,arguments:[n.object(e.clmm_pool),n.pure(!0),n.pure(!0),n.pure(a.coinA.toString())],typeArguments:c}),n.moveCall({target:`${t.published_at}::${ot}::calculate_swap_result`,arguments:[n.object(e.clmm_pool),n.pure(!1),n.pure(!0),n.pure(a.coinB.toString())],typeArguments:c});const _=(C=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:n,sender:i.address})).events)==null?void 0:C.filter(w=>P(w.type).name==="CalculatedSwapResultEvent");if(_.length===0)return null;const p=_[0].parsedJson.data,m=_[1].parsedJson.data,y=l(a.coinB.toString()).add(p.amount_out),S=l(a.coinA.toString()).add(m.amount_out);return{maxAmountB:y,maxAmountA:S}}async calculateRemoveSwapAmount(e,t){const i=je.calculateDepositRatio(e.lowerTick,e.upperTick,new g(e.curSqrtPrice)),n=e.fix_amount_a?i.ratioA:i.ratioB;console.log({fixRatio:n});let o=l(e.receive_amount).mul(n),s,r;if(e.removeLiquidity){const C=B.tickIndexToSqrtPriceX64(e.lowerTick),w=B.tickIndexToSqrtPriceX64(e.upperTick),b=ie.getCoinAmountFromLiquidity(new g(e.removeLiquidity),new g(e.curSqrtPrice),C,w,!1);r=e.removeLiquidity,s=e.fix_amount_a?b.coinB.toString():b.coinA.toString(),o=e.fix_amount_a?l(b.coinA.toString()):l(b.coinB.toString())}else{const C=ie.estLiquidityAndcoinAmountFromOneAmounts(e.lowerTick,e.upperTick,new g(o.toFixed(0)),e.fix_amount_a,!1,.2,new g(e.curSqrtPrice));r=C.liquidityAmount.toString(),s=e.fix_amount_a?C.coinAmountB.toString():C.coinAmountA.toString()}console.log({fixAmount:o,otherSideAmount:s});const a=!e.fix_amount_a,c=await this.clmmPreSwap(e.clmm_pool,e.curSqrtPrice,a,l(s),e.coinTypeA,e.coinTypeB,!0,e.priceSplitPoint,e.use_route,[{pool_id:e.clmm_pool,tick_lower:e.lowerTick,tick_upper:e.upperTick,delta_liquidity:Number(r),is_increase:!1}]);console.log({data:c,range:t});const d=o.add(c.amount_out),_=l(e.receive_amount),p=_.sub(d);if(console.log(`实际得到: ${d.toString()} , 期望得到: ${e.receive_amount}, 剩余: ${p.toString()} `),(!e.removeLiquidity||e.removeLiquidity&&t)&&p.abs().greaterThan(_.mul(.01))){const C=d.lessThan(_);let w,b;t?C?(w=l(r),b=t.right):(w=t.left,b=l(r)):(w=l(C?r:0),b=l(C?e.maxLiquidity:r));const j=l(w).add(b).div(2).toFixed(0);if(console.log({left:w.toString(),right:b.toString(),midLiquidity:j.toString()}),!t||t&&t.count<15&&w<b)return await this.calculateRemoveSwapAmount({...e,removeLiquidity:j},{left:w,right:b,count:t?t.count+1:0})}const m=c.amount_in&&c.fee_amount?new g(c.amount_in).add(new g(c.fee_amount)).toString():c.amount_in,y=c.amount_out,{is_exceed:S}=c;return{swapInAmount:m,swapOutAmount:y,liquidity:r,is_exceed:S,routeObj:c.route_obj,request_id:e.request_id}}async calculateDepositSwapAmount(e,t=!1){const i=B.sqrtPriceX64ToTickIndex(new g(e.curSqrtPrice));console.log("1110 calculateDepositSwapAmount params: ",{...e,currentTick:i,adjustBestAmount:t});const{ratioA:n,ratioB:o}=je.calculateDepositRatio(e.lowerTick,e.upperTick,new g(e.curSqrtPrice)),s=l(e.input_amount).mul(e.fix_amount_a?n:o);let r=l(e.input_amount).sub(s);console.log("1110 ",{fixAmount:s.toString(),swapAmount:r.toString()});const a=e.fix_amount_a;if(r.toFixed(0)==="0")return null;const c=i<e.lowerTick||i>e.upperTick,d={clmm_pool:e.clmm_pool,curSqrtPrice:e.curSqrtPrice,a2b:a,amount_a:a?new $(e.input_amount):new $(0),amount_b:a?new $(0):new $(e.input_amount),amount_left:a?new $(r.toFixed(0)):new $(0),amount_right:a?new $(e.input_amount):new $(r.toFixed(0)),lowerTick:e.lowerTick,upperTick:e.upperTick,tick_spacing:2,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,useRoute:e.use_route,remainRate:e.remainRate?e.remainRate:.01,priceSplitPoint:e.priceSplitPoint},_=t&&i<=e.upperTick;let p=_?await this.calculateRebalance(d):await this.clmmPreSwap(e.clmm_pool,e.curSqrtPrice,a,r,e.coinTypeA,e.coinTypeB,!0,e.priceSplitPoint,e.use_route),m=p.after_sqrt_price;const y=B.sqrtPriceX64ToTickIndex(new g(m));console.log("1110 首次计算 结果: ",{...p,currentTick:y},null,2);const S=y<e.lowerTick||y>e.upperTick;if(c!==S&&!_&&y<=e.upperTick){console.log("1110 区间发生变化, 再次进行swap: ");const{ratioA:W,ratioB:ee}=je.calculateDepositRatio(e.lowerTick,e.upperTick,new g(m));console.log("1110 ",{newAfterRatioA:W,newAfterRatioB:ee}),r=l(e.input_amount).sub(l(e.input_amount).mul(e.fix_amount_a?W:ee)),d.amount_left=a?new $(r.toFixed(0)):new $(0),d.amount_right=a?new $(e.input_amount):new $(r.toFixed(0)),p=await this.calculateRebalance(d),m=p.after_sqrt_price;const _e=B.sqrtPriceX64ToTickIndex(new g(m));console.log("1110 再次计算变化后: ",{lowerTick:e.lowerTick,upperTick:e.upperTick,currentTick:_e,afterSqrtPrice:m})}const{ratioA:C,ratioB:w}=je.calculateDepositRatio(e.lowerTick,e.upperTick,new g(m));console.log("1110 1",{afterRatioA:C,afterRatioB:w,data:p});let b=w.div(C).sub(o.div(n)).greaterThan("0");const j=p.amount_in&&p.fee_amount?new g(p.amount_in).add(new g(p.fee_amount)).toString():p.amount_in,I=p.amount_out,{is_exceed:D}=p;if(y<e.lowerTick)b=!0;else if(y>e.upperTick)b=!1;else{const W=b===a?new g(l(e.input_amount).sub(j).toString()):new g(I),ee=ie.estLiquidityAndcoinAmountFromOneAmounts(e.lowerTick,e.upperTick,W,b,!0,0,new g(m)),_e=ee.coinAmountA,Se=ee.coinAmountB,ke=l(e.fix_amount_a?_e.toString():Se.toString()).add(j);console.log("1110 实际消耗:",{preAmountTotal:ke.toString(),fixAmountA:b}),ke.greaterThanOrEqualTo(e.input_amount)&&(b=!b)}const Z={swapInAmount:j,swapOutAmount:I,afterSqrtPrice:m,is_exceed:D,fixAmountA:b,routeObj:p.route_obj,request_id:e.request_id};return console.log(Z),Z}async calculateRebalance(e){const{clmm_pool:t,a2b:i,curSqrtPrice:n,amount_a:o,amount_b:s,lowerTick:r,upperTick:a,amount_left:c,amount_right:d,coinTypeA:_,coinTypeB:p,useRoute:m,priceSplitPoint:y,remainRate:S}=e,C=async(w,b,j)=>{const I=w.plus(b).div(2),D=await this.clmmPreSwap(t,n,i,I,_,p,!0,y,m);if(D.amount_out==="0")return D;if(D.after_sqrt_price||(D.after_sqrt_price=e.curSqrtPrice),D.is_exceed)return b=I,C(w,b,j+1);const Z=i?o.sub(D.amount_in):o.add(D.amount_out),W=i?s.add(D.amount_out):s.sub(D.amount_in),ee=B.sqrtPriceX64ToTickIndex(new g(D.after_sqrt_price)),_e=ie.estLiquidityAndcoinAmountFromOneAmounts(r,a,new g(Z.toString()),!0,!0,1,new g(D.after_sqrt_price)),Se=new $(_e.coinAmountA.toString()),ke=new $(_e.coinAmountB.toString());if(console.log("1110 swap递归计算 ",{preRes:D,left:w.toString(),right:b.toString(),mid:I.toString(),afterPoolTickIndex:ee,afterA:Z.toString(),afterB:W.toString(),usedA:Se.toString(),usedB:toString(),count:j}),Se.toString()!==Z.toString())throw new Error("usedA does not match afterA");if(W.lessThan(ke))i?w=I:b=I;else{i?b=I:w=I;const Me=W.sub(ke),pt=W.mul(S);if(console.log("1110 剩余未使用amount ",{remainingB:Me.toString(),maxRemainingB:pt.toString(),remainRate:S,count:j}),pt.sub(Me).greaterThanOrEqualTo(0))return console.log("break"),{...D,remainingB:Me}}return w.greaterThan(b)||b.sub(w).lessThan(10)?D:C(w,b,j+1)};return c.greaterThanOrEqualTo(d)?C(new $(0),c,0):C(c,d,0)}async clmmPreSwap(e,t,i,n,o,s,r,a,c,d){var b;if(c)try{const j=await this._sdk.ClmmSDK.RouterV2.getBestRouter(i?o:s,i?s:o,Number(n.toFixed(0)),r,a,"",void 0,void 0,!0,!1,d);if(!j.result)throw new Error("route unavailable");const{result:I}=j;let D=t;return I.splitPaths.forEach(Z=>{const W=Z.basePaths.find(ee=>ee.poolAddress.toLowerCase()===e.toLowerCase());W&&(D=W.afterSqrtPrice.toString())}),{amount_in:I.inputAmount.toString(),amount_out:I.outputAmount.toString(),after_sqrt_price:D,is_exceed:I.isExceed,route_obj:I}}catch{throw new Error("route unavailable")}const{integrate:_,simulationAccount:p}=this.sdk.ClmmSDK.sdkOptions,m=new T,y=[o,s],S=[m.pure(e),m.pure(i),m.pure(r),m.pure(n.toFixed(0))];m.moveCall({target:`${_.published_at}::${ot}::calculate_swap_result`,arguments:S,typeArguments:y});const w=(b=(await this.sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:m,sender:p.address})).events)==null?void 0:b.filter(j=>P(j.type).name==="CalculatedSwapResultEvent");return w.length===0?null:w[0].parsedJson.data}async getVault(e,t=!1){const i=this.readPoolFromCache(e,t);if(i)return i;try{const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0,showDisplay:!0,showOwner:!0}}),o=je.buildPool(n);if(o)return this.savePoolToCache(o),o}catch(n){console.log(n)}}async getVaultsConfigs(e=!1){const{package_id:t}=this._sdk.sdkOptions.vaults,i=`${t}_getMirrorPoolConfigs`,n=this.getCache(i,e);if(n!==void 0)return n;const o=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::vaults::InitEvent`})).data,s={admin_cap_id:"",vaults_manager_id:"",vaults_pool_handle:""};if(o.length>0){for(const r of o){const a=r.parsedJson;s.admin_cap_id=a.admin_cap_id,s.vaults_manager_id=a.manager_id;const c=await this._sdk.ClmmSDK.fullClient.getObject({id:s.vaults_manager_id,options:{showContent:!0}}),d=R(c);s.vaults_pool_handle=d.vault_to_pool_maps.fields.id.id;break}this.updateCache(i,s,x)}return s}updateCache(e,t,i=Ne){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e],n=i==null?void 0:i.isValid();if(!t&&n)return i.value;n||delete this._cache[e]}},vt=class{static buildOrderLimitEvent(e){const{events:t}=e,i=[];return t&&t.forEach(n=>{const o=P(n.type).name;if(o==="OrderPlacedEvent"||o==="OrderCanceledEvent"||o==="FlashLoanEvent"){const s={digest:e.digest,type:o,timestampMs:e.timestampMs,parsedJson:n.parsedJson};i.push(s)}}),i}static buildLimitOrderInfo(e){const t=R(e),i=et(e);if(t&&i)try{const n=P(i),o={pay_coin_type:n.type_arguments[0],target_coin_type:n.type_arguments[1],balance:t.balance,canceled_ts:t.canceled_ts==="18446744073709551615"?0:Number(t.canceled_ts),id:t.id.id,obtained_amount:t.obtained_amount,owner:t.owner,rate:t.rate,expire_ts:Number(t.expire_ts),total_pay_amount:t.total_pay_amount,status:"Running",created_ts:Number(t.created_ts)};if(o.canceled_ts===0)o.status="Running";else if(Number(o.obtained_amount)===0)o.status="Cancelled";else{const s=l(o.total_pay_amount).mul(1e20).div(o.rate).toFixed(0);o.obtained_amount===s?o.status="Completed":o.status="Cancelled"}return o}catch(n){console.log(n)}}static calculateFormatRate(e,t,i){const n=20+t-i;return l(e).mul(l(10).pow(n)).toString()}static calculateRate(e,t,i){const n=20+t-i;return Number(e)/10**n}},Sr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getLimitOrderTokenList(){const{limit_order:e}=this._sdk.sdkOptions,{token_list_handle:t}=h(e),{fullClient:i}=this._sdk.ClmmSDK,o=(await i.getDynamicFieldsByPage(t)).data.map(r=>r.objectId);return(await i.batchGetObjects(o,{showContent:!0})).map(r=>{const{fields:a}=r.data.content;return{coin_type:P(a.name.fields.name).full_address,min_trade_amount:Number(a.value)}})}async getLimitOrderPoolList(){const{limit_order:e}=this._sdk.sdkOptions,{rate_orders_indexer_handle:t}=h(e),{fullClient:i}=this._sdk.ClmmSDK,o=(await i.getDynamicFieldsByPage(t)).data.map(r=>r.objectId);return(await i.batchGetObjects(o,{showContent:!0})).map(r=>{const{fields:a}=r.data.content.fields.value,c={pay_coin_type:P(a.pay_coin.fields.name).full_address,target_coin_type:P(a.target_coin.fields.name).full_address,indexer_id:a.indexer_id};return this._sdk.updateCache(`${c.pay_coin_type}_${c.target_coin_type}`,c.indexer_id),c})}async getPoolIndexerId(e,t){const i=this._sdk.getCache(`${e}_${t}`);try{if(i===void 0){const o=(await this.getLimitOrderPoolList()).filter(s=>s.pay_coin_type===e&&s.target_coin_type===t);if(o.length>0)return o[0].indexer_id}}catch{}return i}async getOwnerLimitOrderList(e,t){const{fullClient:i}=this._sdk.ClmmSDK,n={data:[],hasNextPage:!1};try{const o=await this.getUserIndexerHandle(e);if(!o)return n;const s=await i.getDynamicFieldsByPage(o,t);n.hasNextPage=s.hasNextPage,n.nextCursor=s.nextCursor;const r=s.data.map(d=>d.name.value),c=(await i.batchGetObjects(r,{showContent:!0})).map(d=>vt.buildLimitOrderInfo(d)).filter(d=>d!==void 0);n.data=c}catch(o){console.error("Error in getOwnerLimitOrderList:",o)}return n}async getLimitOrderConfigs(){const{package_id:e}=this._sdk.sdkOptions.limit_order,t={rate_orders_indexer_id:"",rate_orders_indexer_handle:"",global_config_id:"",token_list_handle:"",user_orders_indexer_id:"",user_orders_indexer_handle:""},i=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::limit_order::InitEvent`})).data;if(i.length>0){const o=i[0].parsedJson;t.rate_orders_indexer_id=o.rate_orders_indexer_id,t.user_orders_indexer_id=o.user_orders_indexer_id;const s=await this._sdk.ClmmSDK.fullClient.getObject({id:t.rate_orders_indexer_id,options:{showContent:!0}});t.rate_orders_indexer_handle=R(s).list.fields.id.id;const r=await this._sdk.ClmmSDK.fullClient.getObject({id:t.user_orders_indexer_id,options:{showContent:!0}});t.user_orders_indexer_handle=R(r).indexer.fields.id.id}const n=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitFactoryEvent`})).data;if(n.length>0){const o=n[0].parsedJson;t.global_config_id=o.global_config_id;const s=await this._sdk.ClmmSDK.fullClient.getObject({id:t.global_config_id,options:{showContent:!0}}),r=R(s);t.token_list_handle=r.token_white_list.fields.id.id}return t}async getLimitOrder(e){const{fullClient:t}=this._sdk.ClmmSDK;try{const i=await t.getObject({id:e,options:{showContent:!0}});return vt.buildLimitOrderInfo(i)}catch(i){console.error("Error in getLimitOrder:",i);return}}async getLimitOrderLogs(e){const{fullClient:t}=this._sdk.ClmmSDK;try{const i=await t.queryTransactionBlocks({filter:{ChangedObject:e},options:{showEvents:!0}}),n=[];return i.data.forEach(o=>{n.push(...vt.buildOrderLimitEvent(o))}),n}catch(i){return console.error("Error in getLimitOrderLogs:",i),[]}}buildRateOrdersIndexerType(e){const{limit_order:t}=this._sdk.sdkOptions;return Ot(`${t.package_id}::limit_order::RateOrdersIndexer`,[e.pay_coin_type,e.target_coin_type])}async placeLimitOrder(e){const{limit_order:t}=this._sdk.sdkOptions,{user_orders_indexer_id:i,global_config_id:n,rate_orders_indexer_id:o}=h(t),s=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress,e.pay_coin_type),r=new T,a=await this.getPoolIndexerId(e.pay_coin_type,e.target_coin_type),c=V.buildCoinForAmount(r,s,BigInt(e.pay_coin_amount),e.pay_coin_type,!1,!0);return r.moveCall({target:`${t.published_at}::limit_order::${a===void 0?"create_indexer_and_place_limit_order":"place_limit_order"}`,typeArguments:[e.pay_coin_type,e.target_coin_type],arguments:[r.object(n),a===void 0?r.object(o):r.object(a),r.object(i),c.targetCoin,r.pure(vt.calculateFormatRate(e.rate,e.pay_decimal,e.target_decimal)),r.pure(e.expired_ts),r.object(v)]}),r}async cancelOrdersByOwner(e){const{limit_order:t}=this._sdk.sdkOptions,{global_config_id:i}=h(t),n=new T,o=await this.getPoolIndexerId(e.pay_coin_type,e.target_coin_type);if(o===void 0)throw Error("not found indexerId");return e.order_ids.forEach(s=>{n.moveCall({target:`${t.published_at}::limit_order::cancel_order_by_owner`,typeArguments:[e.pay_coin_type,e.target_coin_type],arguments:[n.object(i),n.object(o),n.object(s),n.object(v)]})}),n}async getUserIndexerHandle(e){const{fullClient:t}=this._sdk.ClmmSDK,{limit_order:i}=this._sdk.sdkOptions;let n=this.getUserIndexerHandleByCache(e);if(n===void 0){const o=new T;o.moveCall({target:`${i.published_at}::limit_order::get_orders_indexer_by_owner`,typeArguments:[],arguments:[o.pure(e),o.object(h(i).user_orders_indexer_id)]}),n=(await t.devInspectTransactionBlock({transactionBlock:o,sender:this._sdk.ClmmSDK.sdkOptions.simulationAccount.address})).events[0].parsedJson.orders_table_id,n&&this.saveUserIndexerHandleByCache(e,n)}return n}getUserIndexerHandleByCache(e){const t=`getUserIndexerHandleByCache_${e}`;return this.getCache(t)}saveUserIndexerHandleByCache(e,t){const i=`getUserIndexerHandleByCache_${e}`;return this.updateCache(i,t)}updateCache(e,t,i=x){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e],n=i==null?void 0:i.isValid();if(!t&&n)return i.value;n||delete this._cache[e]}},Tr=class{constructor(e){F(this,"_sdk");F(this,"_cache",{});this._sdk=e}get sdk(){return this._sdk}async getFramsPoolList(e="all"){const{package_id:t}=this._sdk.sdkOptions.frams,i={data:[],hasNextPage:!1};try{const n=await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${t}::pool::CreatePoolEvent`},e),o=n.data.map(s=>s.parsedJson.id);if(i.hasNextPage=n.hasNextPage,i.nextCursor=n.nextCursor,o.length>0){const s=await this._sdk.ClmmSDK.fullClient.batchGetObjects(o,{showType:!0,showContent:!0});for(const r of s){const a=Ct.buildFramsPool(r);a&&(a.rewarders=await this.getFramsRewarderConfig(a.clmm_pool_id,a.rewarders.map(c=>c.reward_coin)),i.data.push(a),this.updateCache(a.id,a))}}}catch(n){console.log("getFramsPoolList error ",n)}return i}async getFramsPool(e,t=!1){const i=this.getCache(e,t);if(i)return i;const n=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showType:!0,showContent:!0}}),o=Ct.buildFramsPool(n.data);return o&&(o.rewarders=await this.getFramsRewarderConfig(o.clmm_pool_id,o.rewarders.map(s=>s.reward_coin)),this.updateCache(o.id,o)),o}async getFramsRewarderConfig(e,t,i=!1){const{frams:n}=this._sdk.sdkOptions,o=[];for(const s of t){const r=`getFramsRewarderConfig_${s}_${e}`,a=this.getCache(r,i);if(a)o.push(a);else try{const c=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:h(n).rewarder_manager_handle,name:{type:"0x1::type_name::TypeName",value:Js(s)}}),{fields:d}=c.data.content.fields.value.fields.value,_={reward_coin:s,last_reward_time:d.last_reward_time,emission_per_second:d.emission_per_second,total_allocate_point:d.total_allocate_point,allocate_point:""},p=d.pools.fields.id.id,m=await this._sdk.ClmmSDK.fullClient.getDynamicFieldObject({parentId:p,name:{type:"0x2::object::ID",value:e}}),{allocate_point:y}=m.data.content.fields.value.fields.value.fields;_.allocate_point=y,this.updateCache(r,_),o.push(_)}catch(c){console.log(c)}}return o}async getOwnedFramsPositionNFTList(e,t=!1,i="all"){const{package_id:n}=this._sdk.sdkOptions.frams,o={data:[],hasNextPage:!1},s=await this._sdk.ClmmSDK.fullClient.getOwnedObjectsByPage(e,{filter:{StructType:`${n}::pool::WrappedPositionNFT`},options:{showContent:!0}},i);o.hasNextPage=s.hasNextPage,o.nextCursor=s.nextCursor;for(const r of s.data){const a=Ct.buildFramsPositionNFT(r);a&&o.data.push(a)}if(t&&o.data.length>0){const r=await this.calculateFarmingRewards(o.data.map(a=>({pool_id:a.pool_id,position_nft_id:a.id,clmm_pool_id:a.clmm_pool_id})));o.data.forEach(a=>{r[a.id]&&(a.rewards=r[a.id])})}return o}async getFramsPositionNFT(e,t=!0){const i=await this._sdk.ClmmSDK.fullClient.getObject({id:e,options:{showContent:!0,showType:!0}}),n=Ct.buildFramsPositionNFT(i);if(t&&n){const o=await this.calculateFarmingRewards([{pool_id:n.pool_id,position_nft_id:n.id}]);o[n.id]&&(n.rewards=o[n.id])}return n}async calculateFarmingRewards(e){var s;const{frams:t}=this._sdk.sdkOptions,i=new T,{rewarder_manager_id:n}=h(t);e.forEach(r=>{i.moveCall({target:`${t.published_at}::fetcher::fetch_latest_rewarders`,typeArguments:[],arguments:[i.object(n),i.object(r.pool_id),i.object(r.position_nft_id),i.object(v)]})});const o={};try{const a=(s=(await this._sdk.ClmmSDK.fullClient.devInspectTransactionBlock({transactionBlock:i,sender:this._sdk.ClmmSDK.senderAddress})).events)==null?void 0:s.filter(c=>P(c.type).name==="PositionRewardersEvent");if(a&&a.length>0)for(let c=0;c<a.length;c+=1){const{parsedJson:d}=a[c],_=[];d.amounts_map.contents.forEach(p=>{_.push({rewarder_type:P(p.key.name).full_address,rewarder_amount:p.value})}),o[d.wrapped_position_id]=_}}catch(r){console.log(r)}return o}depositPayload(e,t){const{frams:i}=this.sdk.sdkOptions;t=t||new T;const{global_config_id:n,rewarder_manager_id:o}=h(i);return t.moveCall({target:`${i.published_at}::router::deposit`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(n),t.object(o),t.object(e.pool_id),t.object(e.clmm_pool_id),t.object(e.clmm_position_id),t.object(v)]}),t}async withdrawPayload(e,t){const{frams:i}=this.sdk.sdkOptions,{global_config_id:n,rewarder_manager_id:o}=h(i);return t=t||new T,t=await this.harvestPayload({pool_id:e.pool_id,position_nft_id:e.position_nft_id},t),t.moveCall({target:`${i.published_at}::router::withdraw`,typeArguments:[],arguments:[t.object(n),t.object(o),t.object(e.pool_id),t.object(e.position_nft_id),t.object(v)]}),t}async batchHarvestPayload(e,t){t=t||new T;for(const i of e)await this.harvestPayload(i,t);return t}async harvestPayload(e,t){const{frams:i}=this.sdk.sdkOptions;t=t||new T;const n=await this.getFramsPool(e.pool_id,!1);if(n===void 0)throw Error(`not found ${e.pool_id}`);const{global_config_id:o,rewarder_manager_id:s}=h(i);if("collect_fee"in e&&(e.collect_fee||e.clmm_rewarder_types.length>0)){const a=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);t=await this.buildCollectRewarderAndFeeParams({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collectFee:e.collect_fee,clmm_rewarder_types:e.clmm_rewarder_types},t,a)}return n.rewarders.forEach(a=>{t&&t.moveCall({target:`${i.published_at}::router::harvest`,typeArguments:[a.reward_coin],arguments:[t.object(o),t.object(s),t.object(e.pool_id),t.object(e.position_nft_id),t.object(v)]})}),t}async claimFeeAndClmmReward(e){const t=new T,i=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);return await this.buildCollectRewarderAndFeeParams({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collectFee:e.collect_fee,clmm_rewarder_types:e.clmm_rewarder_types},t,i),t}async openPositionAddLiquidityStakePaylod(e){const t=new T,{clmm_pool:i,integrate:n}=this._sdk.ClmmSDK.sdkOptions,o=h(i),s=t.moveCall({target:`${i.published_at}::pool::open_position`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(e.clmm_pool_id),t.pure($e(BigInt(e.tick_lower)).toString()),t.pure($e(BigInt(e.tick_upper)).toString())]}),r=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress),a=V.buildCoinForAmount(t,r,BigInt(e.amount_a),e.coinTypeA,!1),c=V.buildCoinForAmount(t,r,BigInt(e.amount_b),e.coinTypeB,!1);t.moveCall({target:`${n.published_at}::${Yt}::add_liquidity_by_fix_coin`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(e.clmm_pool_id),s,a.targetCoin,c.targetCoin,t.pure(e.amount_a.toString()),t.pure(e.amount_b.toString()),t.pure(e.fix_amount_a),t.object(v)]});const{frams:d}=this.sdk.sdkOptions,{global_config_id:_,rewarder_manager_id:p}=h(d);return t.moveCall({target:`${d.published_at}::router::deposit`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(_),t.object(p),t.object(e.pool_id),t.object(e.clmm_pool_id),s,t.object(v)]}),t}async addLiquidityPayload(e,t){const{frams:i}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions;t=t||new T;const o=h(i),s=h(n),r=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress),a=V.buildCoinForAmount(t,r,BigInt(e.amount_limit_a),e.coinTypeA,!1),c=V.buildCoinForAmount(t,r,BigInt(e.amount_limit_b),e.coinTypeB,!1);if(e.collect_rewarder&&(t=await this.harvestPayload({pool_id:e.pool_id,position_nft_id:e.position_nft_id,clmm_pool_id:e.clmm_pool_id},t)),e.collect_fee||e.clmm_rewarder_types.length>0){const d=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);t=await this.buildCollectRewarderAndFeeParams({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collectFee:e.collect_fee,clmm_rewarder_types:e.clmm_rewarder_types},t,d)}return t.moveCall({target:`${i.published_at}::router::add_liquidity`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(s.global_config_id),t.object(o.rewarder_manager_id),t.object(e.pool_id),t.object(e.clmm_pool_id),t.object(e.position_nft_id),a.targetCoin,c.targetCoin,t.pure(e.amount_limit_a),t.pure(e.amount_limit_b),t.pure(e.delta_liquidity),t.object(v)]}),t}async addLiquidityFixCoinPayload(e,t){const{frams:i}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions;t=t||new T;const o=h(i),s=h(n),r=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress),a=V.buildCoinForAmount(t,r,BigInt(e.amount_a),e.coinTypeA,!1),c=V.buildCoinForAmount(t,r,BigInt(e.amount_b),e.coinTypeB,!1);if(e.collect_rewarder&&(t=await this.harvestPayload({pool_id:e.pool_id,position_nft_id:e.position_nft_id,clmm_pool_id:e.clmm_pool_id},t)),e.collect_fee||e.clmm_rewarder_types.length>0){const d=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);t=await this.buildCollectRewarderAndFeeParams({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collectFee:e.collect_fee,clmm_rewarder_types:e.clmm_rewarder_types},t,d)}return t.moveCall({target:`${i.published_at}::router::add_liquidity_fix_coin`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(s.global_config_id),t.object(o.rewarder_manager_id),t.object(e.pool_id),t.object(e.clmm_pool_id),t.object(e.position_nft_id),a.targetCoin,c.targetCoin,t.pure(e.amount_a.toString()),t.pure(e.amount_b.toString()),t.pure(e.fix_amount_a),t.object(v)]}),t}async removeLiquidityPayload(e,t){const{frams:i}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions;t=t||new T;const o=h(i),s=h(n);if(e.collect_rewarder&&(!e.unstake||e.close_position)&&(t=await this.harvestPayload({pool_id:e.pool_id,position_nft_id:e.position_nft_id,clmm_pool_id:e.clmm_pool_id},t)),e.clmm_rewarder_types.length>0){const r=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);t=await this.buildCollectRewarderAndFeeParams({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,collectFee:!1,clmm_rewarder_types:e.clmm_rewarder_types},t,r)}if(e.close_position){if(e.clmm_position_id===void 0)throw Error("close_position need clmm_position_id");t.moveCall({target:`${i.published_at}::router::close_position`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(o.rewarder_manager_id),t.object(e.pool_id),t.object(s.global_config_id),t.object(e.clmm_pool_id),t.object(e.position_nft_id),t.pure(e.min_amount_a),t.pure(e.min_amount_b),t.object(v)]})}else t.moveCall({target:`${i.published_at}::router::remove_liquidity`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(s.global_config_id),t.object(o.rewarder_manager_id),t.object(e.pool_id),t.object(e.clmm_pool_id),t.object(e.position_nft_id),t.pure(e.delta_liquidity),t.pure(e.min_amount_a),t.pure(e.min_amount_b),t.object(v)]}),e.unstake&&this.withdrawPayload({pool_id:e.pool_id,position_nft_id:e.position_nft_id});return t}async buildCollectRewarderAndFeeParams(e,t,i,n,o){n===void 0&&(n=[...i]),o===void 0&&(o=[...i]);const s=Ce(e.coinTypeA),r=Ce(e.coinTypeB);if(e.collectFee){const c=V.buildCoinForAmount(t,n,BigInt(0),s,!1);n=c.remainCoins;const d=V.buildCoinForAmount(t,o,BigInt(0),r,!1);o=d.remainCoins,this.collectFeePayload({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,coin_a:c.targetCoin,coin_b:d.targetCoin,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB},t)}const a=[];return e.clmm_rewarder_types.forEach(c=>{switch(Ce(c)){case s:a.push(V.buildCoinForAmount(t,n,BigInt(0),c,!1).targetCoin);break;case r:a.push(V.buildCoinForAmount(t,o,BigInt(0),c,!1).targetCoin);break;default:a.push(V.buildCoinForAmount(t,i,BigInt(0),c,!1).targetCoin);break}}),this.collectClmmRewardPayload({clmm_pool_id:e.clmm_pool_id,position_nft_id:e.position_nft_id,clmm_rewarder_types:e.clmm_rewarder_types,coinTypeA:e.coinTypeA,coinTypeB:e.coinTypeB,reward_coins:a},t),t}collectFeePayload(e,t){const{frams:i}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions;t=t||new T;const o=h(i),s=h(n);return t.moveCall({target:`${i.published_at}::router::collect_fee`,typeArguments:[e.coinTypeA,e.coinTypeB],arguments:[t.object(o.global_config_id),t.object(s.global_config_id),t.object(e.clmm_pool_id),t.object(e.position_nft_id),e.coin_a,e.coin_b]}),t}async collectClmmRewardPayload(e,t){var a;const{frams:i}=this.sdk.sdkOptions,{clmm_pool:n}=this.sdk.ClmmSDK.sdkOptions;t=t||new T;let o=e.reward_coins;if(e.clmm_rewarder_types.length>0&&o===void 0){o=[];const c=await this._sdk.ClmmSDK.getOwnerCoinAssets(this._sdk.ClmmSDK.senderAddress);e.clmm_rewarder_types.forEach(d=>{o.push(V.buildCoinForAmount(t,c,BigInt(0),d,!1).targetCoin)})}const s=h(i),r=h(n);return(a=e.clmm_rewarder_types)==null||a.forEach((c,d)=>{t&&t.moveCall({target:`${i.published_at}::router::collect_clmm_reward`,typeArguments:[c,e.coinTypeA,e.coinTypeB],arguments:[t.object(s.global_config_id),t.object(r.global_config_id),t.object(e.clmm_pool_id),t.object(e.position_nft_id),t.object(r.global_vault_id),o[d],t.object(v)]})}),t}async getFrarmsConfigs(){const{package_id:e}=this._sdk.sdkOptions.frams,t={global_config_id:"",rewarder_manager_id:"",rewarder_manager_handle:""},i=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::config::InitConfigEvent`})).data;if(i.length>0){const o=i[0].parsedJson;t.global_config_id=o.global_config_id,t.admin_cap_id=o.admin_cap_id}const n=(await this._sdk.ClmmSDK.fullClient.queryEventsByPage({MoveEventType:`${e}::rewarder::InitRewarderManagerEvent`})).data;if(n.length>0){const o=n[0].parsedJson;t.rewarder_manager_id=o.id;const s=await this._sdk.ClmmSDK.fullClient.getObject({id:t.rewarder_manager_id,options:{showContent:!0}});t.rewarder_manager_handle=s.data.content.fields.rewarders.fields.id.id}return t}updateCache(e,t,i=x){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}},Dr=class{constructor(e,t){F(this,"_cache",{});F(this,"_sdkOptions");F(this,"_launchpad");F(this,"_ido");F(this,"_xcetusModule");F(this,"_xtokenModule");F(this,"_boosterModule");F(this,"_makerModule");F(this,"_clmmSDK");F(this,"_liquidityStrategy");F(this,"_vaults");F(this,"_limitOrder");F(this,"_farmsModule");this._sdkOptions=e,this._clmmSDK=t,this._launchpad=new pr(this),this._ido=new wr(this),this._xcetusModule=new hr(this),this._xtokenModule=new kr(this),this._boosterModule=new _r(this),this._makerModule=new mr(this),this._vaults=new vr(this),this._limitOrder=new Sr(this),this._farmsModule=new Tr(this),this._liquidityStrategy=new Cr(this),mn(this._sdkOptions)}get ClmmSDK(){return this._clmmSDK}get sdkOptions(){return this._sdkOptions}get Launchpad(){return this._launchpad}get Ido(){return this._ido}get XToken(){return this._xtokenModule}get XCetusModule(){return this._xcetusModule}get BoosterModule(){return this._boosterModule}get MakerModule(){return this._makerModule}get LiquidityStrategy(){return this._liquidityStrategy}get Vaults(){return this._vaults}get LimitOrder(){return this._limitOrder}get Farms(){return this._farmsModule}getVerifySenderAddress(){const{senderAddress:e}=this.ClmmSDK;if(e.length===0||!Di(e))throw Error("this clmm config sdk senderAddess is illegal");return e}updateCache(e,t,i=x){let n=this._cache[e];n?(n.overdueTime=J(i),n.value=t):n=new we(t,J(i)),this._cache[e]=n}getCache(e,t=!1){const i=this._cache[e];if(!t&&(i!=null&&i.isValid()))return i.value;delete this._cache[e]}};export{Dr as C,Q as I,je as V,Ue as X,Or as a};
