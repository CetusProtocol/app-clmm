import{j as Dt,n as vt,d as de,e as kt,u as It,a as Se,c as Ie,s as ft,T as Ve,E as Zt,b as Fe,l as Ct,p as _t}from"./pool.7e07c235.js";import{a as it,r as B,l as A,H as Lt,q as qe,e as nt,o as R,f as Z,t as Nt,N as Gt,h as o,O as pt,v as le,u as ce,x as te,c as Je,p as At,k as qt,S as Mt,y as $t,m as wt,K as Bt,s as Kt,F as gt,E as Tt,i as Oe,A as ct,w as bt,j as Rt,P as Jt,b as Qt,B as Yt}from"./entry.69df4926.js";/* empty css              */import{s as st,m as Vt,l as ei,b as ti,a as ii}from"./transform.c672907f.js";import{D as r}from"./decimal.0bdeb344.js";import{u as yt,a as ni}from"./sha256.97c0006b.js";import{d as Ft,_ as Ot,c as Ut,a as zt,b as ai}from"./new-liquidity-title.b1c3448b.js";import{i as ht}from"./import-icon.de3e6c66.js";/* empty css              */import"./decimal.6f03adc8.js";import{positionError as Qe,fromCoin as k,toCoin as p,tickList as et,currentPrice as tt,currentPriceReverse as lt,direction as Ue,currentPriceTab as U,defaultMinPrice as dt,defaultMaxPrice as mt,minPrice as O,maxPrice as I,toggle as jt,isInputTotalAmount as Xe,priceConfigObj as Ke,fromCoinAmount as y,toCoinAmount as C,fixedFromCoin as ke,resetTickList as Pt,resetData as ri}from"./data.3ddf9134.js";import{_ as oi}from"./coin-lock.929c2184.js";import{_ as si}from"./coin-select.32cc863b.js";import{_ as li}from"./viewDetail.6564cc1c.js";import{a as ui}from"./new-add-or-create.0e57a76d.js";import{u as ci}from"./notifi.6e4e6260.js";import{_ as di,a as mi}from"./icon-Add-Liquidity_2x.0acb06cb.js";import"./img-lock_2x.a28135f4.js";import"./lock.a662a38d.js";/* empty css              *//* empty css              */import"./token-warning.58443b74.js";import"./swap-setting.db88595f.js";/* empty css              */import"./icon-error_2x.15f45743.js";import"./img-lock_2x.4a7596b9.js";import"./img-no-Positions_2x.1d3d4e4b.js";import"./status-block.8e1164c2.js";import"./icon-arrow_2x.948aedb2.js";import"./icon-arrow_2x.4ffddb8e.js";import"./useWhale.915bcd76.js";import"./index.676b17e1.js";function St(e,v,be){const ue=new r(10).pow(v-be);return new r(1.0001).pow(e).mul(ue)}const vi=it({props:{poolInfo:{type:Object,default:()=>({chartLoading:!1,token_a:{decimal:6},token_b:{decimal:6},currentLiquity:"50000000"})},minPrice:{type:String,default:""},maxPrice:{type:String,default:""},direction:{type:Boolean,default:!0},tickList:{type:Array,default:()=>[]},currentTick:{type:Number,default:0},chartLoading:{type:Boolean,default:!1},currentPriceTab:{type:String,default:""},before7dContractPriceLowest:{type:String,default:""},before7dContractPriceHighest:{type:String,default:""},zoom:{type:Number,default:1}},setup(e,v){const be=B(""),ue=B(""),q=A(()=>{var n,l,d,X,F,Y;return(n=e.poolInfo)!=null&&n.current_sqrt_price&&((l=e.poolInfo)!=null&&l.coinA.decimals)&&((d=e.poolInfo)!=null&&d.coinB.decimals)?a.sqrtPriceX64ToPrice((X=e.poolInfo)==null?void 0:X.current_sqrt_price,(F=e.poolInfo)==null?void 0:F.coinA.decimals,(Y=e.poolInfo)==null?void 0:Y.coinB.decimals).toString():"0"}),Ce=A(()=>{let n=0;return e.direction?n=(Number(e.minPrice)/Number(q.value)-1)*100:n=(Number(e.minPrice)/Number(1/Number(q.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),H=A(()=>{let n=0;return e.direction?n=(Number(e.maxPrice)/Number(q.value)-1)*100:n=(Number(e.maxPrice)/Number(1/Number(q.value))-1)*100,n=n>0&&n<.1?.1:n,n=n<0&&n>-.1?-.1:n,n}),z=yt(),T=A(()=>z),G=A(()=>T.value.chainName?kt(T.value.chainName):{}),{TickMath:a,getNearestTickByTick:S}=G.value,Q=(n=[])=>{let l=6;const d=Math.abs(Number(n[0])-Number(n[n.length-1]));return d>=6?l=0:d>=1?l=1:d>=.1?l=2:d>=.01?l=3:d>=.001?l=4:d>=1e-4?l=5:d>=1e-5?l=6:d>=1e-6?l=7:d>=1e-7&&(l=8),l},Le=(n,l=1)=>{if(n&&n.token_a&&!e.chartLoading&&e.minPrice&&e.maxPrice){const d=Number(e.poolInfo.current_tick_index);let X=d+100*l,F=d-100*l,Y,ie;if(e.maxPrice==="∞")ie=G.value.TickUtil.getMaxIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?ie=a.priceToTickIndex(new r(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):ie=a.priceToTickIndex(new r(1).div(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{ie=443636}if(e.minPrice==="0")Y=G.value.TickUtil.getMinIndex(Number(e.poolInfo.tickSpacing));else try{e.direction?Y=a.priceToTickIndex(new r(e.minPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):Y=a.priceToTickIndex(new r(1).div(e.maxPrice),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)}catch{Y=-443636}let he=0;if(e.currentPriceTab!=="full range"){if(d>=Y&&d<=ie){const _=d-Y,V=ie-d;he=Math.max(Math.abs(_),Math.abs(V))}else d<Y?he=Math.abs(ie-d):he=Math.abs(d-Y);X=d+he+100*l,F=d-he-100*l}else{const _=(Math.abs(d)>5e3,2e4);X=d+_*l,F=d-_*l}F<-443636&&(F=-443636),X>443636&&(X=443636);const g=new r(n.liquidity).div(Math.pow(10,8)).toString(),P=e.tickList,N=[],me=[];let b={};for(let _=0;_<P.length;_++){if(b=P[_],b.index<=d&&b.index>=F){if(N.length<1&&_!==0){const V=P[_-1];N.unshift({...V,index:F,source:"left"})}N.unshift(b)}else if(b.index>d&&b.index<=X&&(me.push(b),N.length<1&&_!==0)){const V=P[_-1];N.push({...V,index:F,source:"left"})}if(b.index>X){const V=P[_];if(me.push({...V,index:X,source:"right"}),N.length<1&&_!==0){const Ge=P[_-1];N.push({...Ge,index:F,source:"left"})}break}}let L="0";for(let _=N.length-1;_>=0;_--)L=new r(L).plus(new r(N[_].liquidityNet.toString()).div(Math.pow(10,8))).toString(),N[_].liquityAmount=L;let E=g;for(let _=0;_<me.length;_++)E=new r(E).plus(new r(me[_].liquidityNet.toString()).div(Math.pow(10,8))).toString(),me[_].liquityAmount=E;let K=[];const M=P&&P.length>0?{index:d,liquityAmount:Number(g)}:{index:d,liquityAmount:0};(N.length>0||me.length>0)&&(K=[...N.reverse(),M,...me],e.direction||(K=K.reverse()));const ze=[];P.forEach(_=>{ze.push({..._,liquidityGross:_.liquidityGross.toString(),liquidityNet:_.liquidityNet.toString()})}),x(K,F,X,Y,ie,d)}};let we=B(!1);const w=B(!1);Lt(()=>{const n=document.body.clientWidth;w.value=!0,n<750?we.value=!1:we.value=!0,window.onresize=()=>{document.body.clientWidth<750?we.value=!1:we.value=!0,Le(e.poolInfo,e.zoom)}});const x=(n,l,d,X,F,Y)=>{let ie,he;e.direction?(ie=e.before7dContractPriceLowest?a.priceToTickIndex(new r(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",he=e.before7dContractPriceHighest?a.priceToTickIndex(new r(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):""):(ie=e.before7dContractPriceLowest?a.priceToTickIndex(new r(1).div(e.before7dContractPriceLowest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"",he=e.before7dContractPriceHighest?a.priceToTickIndex(new r(1).div(e.before7dContractPriceHighest),e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals):"");const g={top:30,right:35,bottom:20,left:80};let P,N;we.value?(P=460-g.left-g.right,N=205-g.top-g.bottom):(P=340-g.left-g.right,N=205-g.top-g.bottom);const me=d-l,b=parseInt(String(me/4));let L=[l+b/4,l+b,l+2*b,d-b,d-b/4];const E=l,K=d,M=P/(K-E);e.currentPriceTab==="full range"&&(L=[l,l+2*b,d]);const ze=L.map(s=>e.direction?St(s,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString():new r(1).div(St(s,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals)).toString()),_=Q(ze);st("#chart").selectAll("*").remove();const V=st("#chart").attr("width",P+g.left+g.right).attr("height",N+g.top+g.bottom).append("g").attr("transform",`translate(${g.left},${g.right})`),Ge=Vt(n,function(s){return Number(Math.abs(s.liquityAmount))})||0,Ne=ei().range([0,N]).domain([Ge,0]);ti().rangeRound([0,P]).padding(.1);const Ye=V.append("g").attr("id","barsBox").selectAll("rect").data(n).enter().append("rect");T.value.theme=="default"?Ye.attr("x",function(s,u){return u===0?0:e.direction?Math.abs(s.index-E)*M:Math.abs(K-s.index)*M}).attr("y",function(s,u){return e.direction?u===n.length-1?0:Ne(s.liquityAmount):u===n.length-1?0:Ne(n[u+1].liquityAmount)}).attr("width",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?P:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-s.index)*M:0)}).attr("height",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?N:e.direction?u===n.length-1?0:N-Ne(s.liquityAmount):u===n.length-1?0:N-Ne(n[u+1].liquityAmount)}).attr("fill","#279477").attr("class","bars").attr("stroke-width",1).attr("stroke","#279477"):Ye.attr("x",function(s,u){return u===0?0:e.direction?Math.abs(s.index-E)*M:Math.abs(K-s.index)*M}).attr("y",function(s,u){return e.direction?u===n.length-1?0:Ne(Math.abs(s.liquityAmount)):u===n.length-1?0:Ne(Math.abs(n[u+1].liquityAmount))}).attr("width",function(s,u){return u===0&&n.length===1&&s.liquityAmount>0?P:(e.direction,u!==n.length-1?Math.abs(n[u+1].index-s.index)*M:0)}).attr("height",function(s,u){if(u===0&&n.length===1&&s.liquityAmount>0)return N;if(e.direction)return u===n.length-1?0:Number(s.liquityAmount)?N-Ne(Math.abs(s.liquityAmount)):0;{if(u===n.length-1)return 0;const He=N-Ne(Math.abs(n[u+1].liquityAmount));return Number(n[u+1].liquityAmount)?He:0}}).attr("fill",function(s,u){return"#417494"}).attr("class","bars").attr("stroke-width",1).attr("stroke",function(s,u){return"#417494"});const t=V.append("g");t.append("line").attr("x1",0).attr("y1",155).attr("x2",P).attr("y2",155).attr("stroke-width",1).attr("stroke","#50535D");const m=t.append("g");let f=0;if(e.direction){for(let s=0;s<L.length;s++){const u=de(ze[s],_)||"0";ze.push(u);const He=Math.abs(L[s]-E)*M;let ve=0;for(let fe=0;fe<u.length;fe++)u[fe]==="1"?ve+=4.02:u[fe]==="."?ve+=2.64:u[fe]==="7"?ve+=5.48:ve+=6;m.append("text").text(u).attr("x",He-ve/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}f=Math.abs(Y-E)*M}else{for(let s=L.length-1;s>=0;s--){const u=de(ze[s],_)||0;ze.push(u);const He=Math.abs(L[s]-K)*M;let ve=0;for(let fe=0;fe<u.length;fe++)u[fe]==="1"?ve+=4.02:u[fe]==="."?ve+=2.64:u[fe]==="7"?ve+=5.48:ve+=6;m.append("text").text(u).attr("x",He-ve/2).attr("y",168).attr("fill","rgba(255, 255, 255, 0.5").style("font-size","10")}f=Math.abs(Y-K)*M}(T.value.theme=="default"?V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#68FFD8"):V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",2).attr("stroke","#76C8FF")).attr("transform","translate("+f+", 0)");let J,W,ye,je;e.direction?(J=X<E?-100:parseInt(String(Math.abs(X-E)*M)),W=F<E?-100:parseInt(String(Math.abs(F-E)*M)),ye=ie<E?-100:Math.abs(ie-E)*M,je=he<E?-100:Math.abs(he-E)*M):(W=X<E?-100:Math.abs(K-X)*M,J=F<E?-100:Math.abs(K-F)*M,je=ie>K?-100:Math.abs(K-ie)*M,ye=he>K?-100:Math.abs(K-he)*M),e.minPrice==="0"&&(J=0),e.maxPrice==="∞"&&(W=P),we.value,be.value=P-J+87+"px",ue.value=W+98+"px",ie&&ye<P&&V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+ye+", 0)"),he&&je<P&&V.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-width",1).attr("stroke-dasharray","5, 5").attr("stroke","rgba(255, 255, 255, 0.5)").attr("transform","translate("+je+", 0)");const _e=V.append("g").attr("id","left-handle"),Te=V.append("g").attr("id","right-handle");T.value.theme=="default"?(_e.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),_e.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 20) rotate(180)"),_e.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",6).attr("fill","#68FFD8"),_e.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",4.5).attr("fill","#68FFD8"),Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#68FFD8"),Te.append("path").attr("d","M0 0 L12 0 L12 20 L0 20 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",6).attr("fill","#68FFD8"),Te.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",4.5).attr("fill","#68FFD8")):(_e.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),_e.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(-1, 24) rotate(180)"),_e.append("rect").attr("width",1).attr("height",7).attr("x",-9).attr("y",8).attr("fill","#76C8FF"),_e.append("rect").attr("width",1).attr("height",10).attr("x",-7).attr("y",6.5).attr("fill","#76C8FF"),Te.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",155).attr("stroke-dasharray","5, 5").attr("stroke-width",2).attr("stroke","#76C8FF"),Te.append("path").attr("d","M0 0 L12 0 L12 24 L0 24 Z").attr("fill","#333").attr("stroke","#333").attr("transform","translate(1, 0)"),Te.append("rect").attr("width",1).attr("height",7).attr("x",7).attr("y",8).attr("fill","#76C8FF"),Te.append("rect").attr("width",1).attr("height",10).attr("x",5).attr("y",6.5).attr("fill","#76C8FF")),_e.attr("transform","translate("+J+", 0)"),Te.attr("transform","translate("+W+", 0)");const xe=ii().extent([[0,0],[P,N]]).handleSize(30).on("end",De);V.append("g").attr("class","brush").call(xe).call(xe.move,[J,W]);function De(s){if(!s.sourceEvent||!s.selection)return;_e.attr("transform","translate("+s.selection[0]+", 0)"),Te.attr("transform","translate("+s.selection[1]+", 0)"),we.value,be.value=P-s.selection[0]+87+"px",ue.value=s.selection[1]+74+"px";let u,He,ve=0,fe=0;e.direction?(ve=S(parseInt(String(s.selection[0]/M+E)),Number(e.poolInfo.tickSpacing)),u=a.tickIndexToPrice(ve,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),fe=S(parseInt(String(s.selection[1]/M+E)),Number(e.poolInfo.tickSpacing)),He=a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()):(fe=S(K-s.selection[0]/M,Number(e.poolInfo.tickSpacing)),u=1/a.tickIndexToPrice(fe,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString(),ve=S(K-s.selection[1]/M,Number(e.poolInfo.tickSpacing)),He=1/a.tickIndexToPrice(ve,e.poolInfo.token_a.decimals,e.poolInfo.token_b.decimals).toString()),v.emit("onChangeMinPrice",String(de(String(u),6))),v.emit("onChangeMaxPrice",String(de(String(He),6)))}T.value.theme=="default"?st(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#15322C"):st(".selection").attr("stroke","rgba(255, 255, 255, 0)").attr("fill","#152632")};return B(""),qe(()=>[e.poolInfo,e.minPrice,e.maxPrice,e.currentPriceTab,e.zoom,e.tickList],([n,l,d,X,F,Y])=>{n&&l&&d&&(n!=null&&n.liquidity)&&Le(n,F)},{immediate:!0}),{store:T,loading:w,rangeSizeLower:Ce,rangeSizeUpper:H,rangeSizeLowerPosition:be,rangeSizeUpperPosition:ue,decimalFormat:Dt,numberformat:vt}}});const fi=e=>(At("data-v-60bd7ae2"),e=e(),qt(),e),pi={class:"chart-box"},gi={class:"chart"},bi=fi(()=>o("svg",{id:"chart"},null,-1));function hi(e,v,be,ue,q,Ce){const H=Mt;return R(),Z("div",pi,[Nt(o("div",gi,[e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),Z("div",{key:0,class:"range-size range-size-lower",style:pt({right:e.rangeSizeLowerPosition})},le(("numberformat"in e?e.numberformat:ce(vt))(e.rangeSizeLower.toFixed(1),1))+"% ",5)):te("",!0),e.currentPriceTab!=="full range"&&e.minPrice!=="0"&&e.maxPrice!=="∞"?(R(),Z("div",{key:1,class:"range-size range-size-upper",style:pt({left:e.rangeSizeUpperPosition})},le(("numberformat"in e?e.numberformat:ce(vt))(e.rangeSizeUpper.toFixed(1),1))+"% ",5)):te("",!0),bi],512),[[Gt,!e.chartLoading]]),e.chartLoading?(R(),Je(H,{key:0})):te("",!0)])}const Ht=nt(vi,[["render",hi],["__scopeId","data-v-60bd7ae2"]]),ki=it({props:{lever:{type:String,default:""}},setup(){return{}}});const wi=e=>(At("data-v-619778e2"),e=e(),qt(),e),yi={class:"lever"},Ci=wi(()=>o("div",{class:"lever-title"},"Leverage",-1)),_i={class:"lever-text"};function Ti(e,v,be,ue,q,Ce){return R(),Z("div",yi,[Ci,o("div",_i,le(e.lever),1)])}const Pi=nt(ki,[["render",Ti],["__scopeId","data-v-619778e2"]]),Si=it({components:{NewLiquidityD3Chart:Ht,NewLiquidityPrice:Ft},setup(){const{t:e,locale:v}=$t(),be=B("liquidity"),ue=yt(),q=A(()=>ue),Ce=A(()=>q.value.chainName),H=It(),z=A(()=>H),T=A(()=>q.value.chainName?kt(q.value.chainName):{});Lt(()=>{Qe.value=!1});const G=wt(),a=A(()=>{let t=null;for(let m=0;m<z.value.poolConfigList.length;m++){const f=z.value.poolConfigList[m];f.address==G.query.poolAddress&&(t=f)}return t}),S=A(()=>{let t=null;for(const m in z.value.poolsObj){const f=z.value.poolsObj[m];f.address==G.query.poolAddress&&(t=f)}return t}),Q=B(),Le=B(!0),we=async(t,m)=>{if(Le.value=!0,m){et.value=[],x.value=[];const f=t.token_a.decimals,$=t.token_b.decimals;Ve.tickIndexToPrice(t.current_tick_index,f,$),tt.value=Ve.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,f,$).toString(),lt.value=new r(1).div(Ve.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,f,$)).toString(),k.value=t.needReverse?t.token_b:t.token_a,p.value=t.needReverse?t.token_a:t.token_b,Q.value=t.needReverse,t.token_a.address.toLowerCase()===k.value.address.toLowerCase()&&t.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Ue.value=!0:Ue.value=!1;let J={poolAddress:t.address,coinTypeA:t.coin_a_address,coinTypeB:t.coin_b_address};const W=await T.value.getTicks(J);et.value=W?T.value.getTickDataFromUrlData(W):[],Le.value=!1,l(t)}},w=t=>{const m=t.token_a.decimals,f=t.token_b.decimals;tt.value=Ve.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,m,f).toString(),lt.value=new r(1).div(Ve.sqrtPriceX64ToPrice(t==null?void 0:t.current_sqrt_price,m,f)).toString()},x=B([]),n=B(),l=t=>{const m=t.token_a.decimals,f=t.token_b.decimals;let $=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].recommend_ranges||{};const J=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[t.address]&&z.value.poolPriceConfigObj[t.address].type||"";let W,ye;const je=Zt(t.current_tick_index,t.tickSpacing);n.value=t.current_tick_index,W=je-Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3),ye=je+Number(t.type=="unstable"?Number(t.tickSpacing)*2:Number(t.tickSpacing)*3);const _e=T.value.TickMath.tickIndexToPrice(W,m,f).toString(),Te=T.value.TickMath.tickIndexToPrice(ye,m,f).toString();$["full range"]={lower:T.value.TickUtil.getMinIndex(Number(S.value.tickSpacing)),upper:T.value.TickUtil.getMaxIndex(Number(S.value.tickSpacing))},$.custom={lower:W,upper:ye,minPrice:_e,maxPrice:Te};const xe=[];for(let De in $)$[De]&&xe.push({...$[De],key:De});J&&xe&&xe.length>2?t.isSelfBuilt?U.value="custom":J=="stable"?U.value="suggested":U.value="passive":U.value="custom",x.value=xe,Ke.value=$,F({key:U.value,...$[U.value]})},d=B(""),X=B(""),F=t=>{U.value=t.key.toLowerCase();const m=S.value.token_a.decimals,f=S.value.token_b.decimals,{lower:$,upper:J}=t;Xe.value=!1;const W=T.value.TickMath.tickIndexToPrice($,m,f).toString(),ye=T.value.TickMath.tickIndexToPrice(J,m,f).toString();if(t.key=="full range"){d.value=$,X.value=J,Y();return}Ue.value?(dt.value=String(W),O.value=String(W),mt.value=String(ye),I.value=String(ye),d.value=$,X.value=J):(dt.value=String(1/Number(ye)),O.value=String(1/Number(ye)),mt.value=String(1/Number(W)),I.value=String(1/Number(W)),d.value=T.value.TickMath.priceToTickIndex(new r(1/Number(ye)),m,f),X.value=T.value.TickMath.priceToTickIndex(new r(1/Number(W)),m,f))},Y=t=>{O.value="0",I.value="∞"};qe(()=>S.value,(t,m)=>{(!m&&t&&!Ie(t)||m&&t&&m.address!==t.address)&&we(t,!m||t.address!==m.address),t&&!Ie(t)&&w(t)},{immediate:!0}),Bt(()=>{k.value=B(),p.value=B(),et.value=[]}),qe(()=>[a.value,S.value,z.value.recommendRangesObj],(t,m)=>{var f,$;(!m||t[0]&&t[1]&&t[2]&&!Ie(t[0])&&!Ie(t[1]&&!Ie(t[2]))||((f=t[0])==null?void 0:f.address)!==(($=m[0])==null?void 0:$.address))&&t[0]&&t[2]&&!Ie(t[0])&&!Ie(t[2])&&H.setSinglePool(t[0],t[2],Ce.value)},{immediate:!0,deep:!0});const ie=t=>{if(Ce.value=="Sui")switch(t){case"passive":return"/sui-image/icon_ conservative@2x.png";case"active":return"/sui-image/icon_active@2x.png";case"full range":return"/sui-image/icon_fullrange@2x.png";case"custom":return"/sui-image/icon_costom@2x.png";case"suggested":return"/sui-image/icon_stabel@2x.png"}else switch(t){case"passive":return"/image/icon_ conservative@2x.png";case"active":return"/image/icon_active@2x.png";case"full range":return"/image/icon_fullrange@2x.png";case"custom":return"/image/icon_costom@2x.png";case"suggested":return"/image/icon_stabel@2x.png"}},he=t=>{switch(t){case"suggested":return e("newAdd.suggested");case"active":return e("newAdd.active");case"passive":return e("newAdd.conservative");case"full range":return e("newAdd.fullRange");case"custom":return e("newAdd.custom")}},g=t=>{var f,$;const m=z.value.poolPriceConfigObj&&z.value.poolPriceConfigObj[(f=S.value)==null?void 0:f.address]&&z.value.poolPriceConfigObj[($=S.value)==null?void 0:$.address].type||"";if(x.value.length>2)if(m=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"suggested":return{top:"23%"};case"full range":return{top:"48%"};case"custom":return{top:"73%"}}else if(m=="unstable")switch(t){case"active":return{top:"35%"};case"passive":return{top:"10%"};case"full range":return{top:"60%"};case"custom":return{top:"85%"}}else switch(t){case"full range":return{top:"35%"};case"custom":return{top:"60%"}}},P=B(1),N=()=>{const t=P.value/2;P.value=t},me=()=>{const t=P.value*2;P.value=t},b=A(()=>{var t,m,f;return!S.value||Ie(q.value.addressHistTokens)||!q.value.addressHistTokens[(t=S.value)==null?void 0:t.poolAddress]?null:Object.fromEntries((f=q.value.addressHistTokens[(m=S.value)==null?void 0:m.poolAddress])==null?void 0:f.data.map($=>[$.key,$.value]))}),L=B(30),E=B("30D"),K=A(()=>Ue.value?b.value&&de(L.value==7?b.value.before_7_d_contract_price_lowest:L.value==24?b.value.before_24_h_contract_price_lowest:b.value.before_30_d_contract_price_lowest,6)||0:b.value&&de(new r(1).div(L.value==7?b.value.before_7_d_contract_price_highest:L.value==24?b.value.before_24_h_contract_price_highest:b.value.before_30_d_contract_price_highest).toString(),6)||0),M=A(()=>Ue.value?b.value&&de(L.value==7?b.value.before_7_d_contract_price_highest:L.value==24?b.value.before_24_h_contract_price_highest:b.value.before_30_d_contract_price_highest,6)||0:(b.value&&de(1/Number(L.value==7?b.value.before_7_d_contract_price_lowest:L.value==24?b.value.before_24_h_contract_price_lowest:b.value.before_30_d_contract_price_lowest),6))==1/0?0:b.value&&de(1/Number(L.value==7?b.value.before_7_d_contract_price_lowest:L.value==24?b.value.before_24_h_contract_price_lowest:b.value.before_30_d_contract_price_lowest),6)||0),ze=A(()=>{const t=Number(O.value),m=Number(I.value);if(O.value=="0"&&I.value=="∞"||U.value=="full range")return"1x";if(O.value==I.value||U.value=="full range")return"--";if(O.value&&I.value&&O.value!=="0"&&I.value!=="∞"){const f=ft(1/(1-Number((t/m)**.25)),2);return Number(f)>0?f+"x":"--"}else return 1}),_=A(()=>{var t,m,f,$,J,W;return((t=k.value)==null?void 0:t.isSelfBuilt)||((m=p.value)==null?void 0:m.isSelfBuilt)||(($=z.value.tokensObj[(f=k.value)==null?void 0:f.address])==null?void 0:$.isSelfBuilt)||((W=z.value.tokensObj[(J=p.value)==null?void 0:J.address])==null?void 0:W.isSelfBuilt)}),V=(t,m)=>{t!==O.value&&U.value=="full range"?F({key:"custom",...x.value.custom}):U.value!=="full range"&&U.value!=="custom"?(U.value="custom",O.value=t):O.value=t},Ge=(t,m)=>{t!==I.value&&U.value=="full range"?F({key:"custom",...x.value.custom}):U.value!=="full range"&&U.value!=="custom"?(U.value="custom",t=="0"?I.value="∞":I.value=t):t=="0"?I.value="∞":I.value=t};return qe(()=>[O.value,I.value],([t,m])=>{},{deep:!0,immediate:!0}),{positionError:Qe,getCoinIcon:t=>{var m;return(t==null?void 0:t.logoURI)||(t==null?void 0:t.logo_url)||((m=z.value.tokensObj[t==null?void 0:t.address])==null?void 0:m.logo_url)||(q.value.theme==="default"?ht("/image/coins/unknown.png"):ht("/image/coins/sui-unknown.png"))},chainName:Ce,store:q,currentTab:be,currentPrice:tt,currentPriceReverse:lt,fromCoin:k,toCoin:p,direction:Ue,needReverse:Q,addCommom:Se,decimalUi:de,priceTablList:x,currentPriceTab:U,sliderStyle:g,poolInfo:S,tickList:et,getPriceTabImage:ie,getPriceTabText:he,defaultMinPrice:dt,defaultMaxPrice:mt,minPrice:O,maxPrice:I,currentTick:n,chartLoading:Le,zoomOut:N,zoomIn:me,zoom:P,priceTab:F,before7dContractPriceLowest:K,before7dContractPriceHighest:M,aprRewardsTime:E,lever:ze,aprRewardsParameter:L,isSelfBuilt:_,priceRangeChangeMin:V,priceRangeChangeMax:Ge,toggle:jt,getPirceTabTips:t=>{switch(t){case"active":return e("newAdd.activeTips");case"passive":return e("newAdd.passiveTips");case"full range":return e("newAdd.fullRangTips");case"suggested":return e("newAdd.suggestedTips");case"custom":return e("newAdd.customTips")}},timeList:[{label:"24H",value:24},{label:"7D",value:7},{label:"30D",value:30}]}}});const Ii={class:"new-liquidity-left"},Li=o("span",{class:"selectRange"},"Select Range",-1),Ni={class:"price-info"},Ai={class:"left"},qi={class:"base-coin"},Mi={class:"base-coin-title"},$i=o("span",null,"Base coin",-1),Bi=o("svg",{class:"icon icon-up","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_up1"})],-1),Ri=o("svg",{class:"icon icon-down","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-exchange_down1"})],-1),Fi=[Bi,Ri],Oi={class:"base-coin-bottom"},Ui={alt:""},zi={class:"current-price"},ji=o("div",{class:"current-price-title"},"Current Price",-1),Hi={key:0,class:"from-pre-to"},Xi={class:"right"},xi={class:"price-range"},Ei={class:"left"},Wi={class:"price-slider"},Di={class:"slider"},Zi=o("div",{class:"slider-ratio-content"},null,-1),Gi=[Zi],Ki={class:"price-tab-list"},Ji=["onClick"],Qi=["src"],Yi={class:"right"},Vi={class:"price-zoom"},en={class:"current-price"},tn=o("div",{class:"current-price-title"},"Current Price",-1),nn={key:0,class:"from-pre-to"},an={class:"price-zoom-right"},rn={class:"leverage"},on=o("div",{class:"left"},null,-1),sn={class:"right"},ln={class:"right-time"},un={key:0,class:"day-7-price-range"},cn=o("i",null,null,-1),dn={class:"gray"},mn={class:"time-list"},vn=["onClick"],fn={class:"right-price-h5"},pn={class:"apr-leverage"},gn={key:0,class:"position-tips"},bn=["src"],hn={class:"error"};function kn(e,v,be,ue,q,Ce){var S,Q,Le,we,w,x,n;const H=Jt,z=Ht,T=Pi,G=Ft,a=Kt("image");return R(),Z("div",Ii,[Li,o("div",Ni,[o("div",Ai,[o("div",qi,[o("div",Mi,[$i,o("div",{class:"change-price",onClick:v[0]||(v[0]=(...l)=>e.toggle&&e.toggle(...l))},Fi)]),o("div",Oi,[Nt(o("img",Ui,null,512),[[a,e.getCoinIcon(e.fromCoin)]]),o("span",null,le((S=e.fromCoin)==null?void 0:S.symbol),1)])]),o("div",zi,[ji,o("div",null,[o("span",null,le(e.poolInfo?e.direction?("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPrice,6)):("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),Z("span",Hi,le((Q=e.toCoin)==null?void 0:Q.symbol)+" per "+le((Le=e.fromCoin)==null?void 0:Le.symbol),1)):te("",!0)])])]),o("div",Xi,[e.currentTab=="liquidity"?(R(),Z("div",{key:0,class:"zoom-out",onClick:v[1]||(v[1]=(...l)=>e.zoomOut&&e.zoomOut(...l))}," + ")):te("",!0),e.currentTab=="liquidity"?(R(),Z("div",{key:1,class:"zoom-in",onClick:v[2]||(v[2]=(...l)=>e.zoomIn&&e.zoomIn(...l))}," - ")):te("",!0)])]),o("div",xi,[o("div",Ei,[o("div",Wi,[o("div",Di,[o("div",{class:"slider-ratio",style:pt(e.sliderStyle(e.currentPriceTab))},Gi,4)])]),o("div",Ki,[(R(!0),Z(gt,null,Tt(e.priceTablList,l=>(R(),Z("div",{key:l.key,class:ct(["price-tab-item",e.currentPriceTab==l.key?"price-tab-item-active":""]),onClick:d=>e.priceTab(l)},[Oe(H,{placement:"bottom","arrow-point-at-center":""},{title:bt(()=>[Rt(le(e.getPirceTabTips(l.key)),1)]),default:bt(()=>[o("img",{src:e.getPriceTabImage(l.key),alt:""},null,8,Qi),o("span",null,le(e.getPriceTabText(l.key)),1)]),_:2},1024)],10,Ji))),128))])]),o("div",Yi,[o("div",Vi,[o("div",en,[tn,o("div",null,[o("span",null,le(e.poolInfo?e.direction&&!e.needReverse?("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPrice,6)):("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.currentPriceReverse,6)):"--"),1),e.fromCoin&&e.toCoin?(R(),Z("span",nn,le(e.direction&&!e.needReverse?`${(we=e.fromCoin)==null?void 0:we.symbol} per ${(w=e.toCoin)==null?void 0:w.symbol}`:`${(x=e.toCoin)==null?void 0:x.symbol} per ${(n=e.fromCoin)==null?void 0:n.symbol}`),1)):te("",!0)])]),o("div",an,[e.currentTab=="liquidity"?(R(),Z("div",{key:0,class:"zoom-out",onClick:v[3]||(v[3]=(...l)=>e.zoomOut&&e.zoomOut(...l))}," + ")):te("",!0),e.currentTab=="liquidity"?(R(),Z("div",{key:1,class:"zoom-in",onClick:v[4]||(v[4]=(...l)=>e.zoomIn&&e.zoomIn(...l))}," - ")):te("",!0)])]),e.poolInfo?(R(),Je(z,{key:0,"pool-info":e.poolInfo,"min-price":e.minPrice,"max-price":e.maxPrice,direction:e.direction,"current-price-tab":e.currentPriceTab,"tick-list":e.tickList,"current-tick":e.currentTick,"chart-loading":e.chartLoading,zoom:e.zoom,"before7d-contract-price-lowest":e.before7dContractPriceLowest,"before7d-contract-price-highest":e.before7dContractPriceHighest,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["pool-info","min-price","max-price","direction","current-price-tab","tick-list","current-tick","chart-loading","zoom","before7d-contract-price-lowest","before7d-contract-price-highest","onOnChangeMinPrice","onOnChangeMaxPrice"])):te("",!0)])]),o("div",rn,[on,o("div",sn,[o("div",ln,[e.poolInfo&&(e.before7dContractPriceLowest||e.before7dContractPriceHighest)?(R(),Z("div",un,[cn,o("span",dn,le(e.aprRewardsParameter==7?"7D":e.aprRewardsParameter==24?"24H":"30D")+" Price Range",1),o("span",null,le(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceLowest,6)))+" - "+le(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceHighest,6))),1)])):te("",!0),o("div",mn,[(R(!0),Z(gt,null,Tt(e.timeList,l=>(R(),Z("div",{key:l.value,class:ct(["time-item",l.value==e.aprRewardsParameter?"time-item-active":""]),onClick:d=>e.aprRewardsParameter=l.value},le(l.label),11,vn))),128))])]),o("div",fn,[o("span",null,le(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceLowest,6)))+" - "+le(("addCommom"in e?e.addCommom:ce(Se))(("decimalUi"in e?e.decimalUi:ce(de))(e.before7dContractPriceHighest,6))),1)])])]),o("div",{class:ct(["apr-and-price",e.positionError&&e.poolInfo?"padding-apr-and-price":""])},[o("div",pn,[Oe(T,{lever:e.lever},null,8,["lever"])]),Oe(G,{min:e.minPrice,max:e.maxPrice,"from-coin":e.fromCoin,"to-coin":e.toCoin,direct:e.direction,"default-min-price":e.defaultMinPrice,"default-max-price":e.defaultMaxPrice,"pool-info":e.poolInfo,loading:e.chartLoading,"current-price-tab":e.currentPriceTab,onOnChangeMinPrice:e.priceRangeChangeMin,onOnChangeMaxPrice:e.priceRangeChangeMax},null,8,["min","max","from-coin","to-coin","direct","default-min-price","default-max-price","pool-info","loading","current-price-tab","onOnChangeMinPrice","onOnChangeMaxPrice"]),e.positionError&&e.poolInfo?(R(),Z("div",gn,[o("img",{src:("importIcon"in e?e.importIcon:ce(ht))("/image/icon-tips-error@2x.png"),alt:""},null,8,bn),o("p",hn,le(e.$t("tips.positionError")),1)])):te("",!0)],2)])}const Xt=nt(Si,[["render",kn]]),wn=it({components:{NewLiquidityTitle:Ot,NewLiquidityAssetsCard:Ut,NewLiquidityDepositRatio:zt},setup(){const{t:e,locale:v}=$t(),be=yt(),ue=A(()=>be),q=A(()=>ue.value.chainName),Ce=It(),H=A(()=>Ce),z=ni(),T=A(()=>z),G=wt(),a=A(()=>{let i=null;for(const c in H.value.poolsObj){const h=H.value.poolsObj[c];h.address==G.query.poolAddress&&(i=h)}return i}),S=B(!1),Q=B(!1),Le=A(()=>ue.value.theme),we=async(i,c)=>{k.value=i.needReverse?i.token_b:i.token_a,p.value=i.needReverse?i.token_a:i.token_b,y.value="",C.value=""},w=A(()=>T.value.assets&&k.value&&T.value.assets[k.value.address]?_t(T.value.assets[k.value.address].balance,k.value.decimals):"0"),x=A(()=>T.value.assets&&p.value&&T.value.assets[p.value.address]?_t(T.value.assets[p.value.address].balance,p.value.decimals):"0"),n=i=>{i==="fromCoin"?(ke.value=!0,q.value==="Aptos"?y.value=Number(w.value)>0?k.value.symbol=="APT"?new r(Number(w.value)).sub(new r(.1)).lt(new r(0))?"0":new r(Number(w.value)).sub(new r(.1)).toString():String(w.value):"":y.value=Number(w.value)>0?k.value.symbol=="SUI"?new r(Number(w.value)).sub(new r(.05)).lt(new r(0))?"0":new r(Number(w.value)).sub(new r(.05)).toString():String(w.value):""):(ke.value=!1,q.value==="Aptos"?C.value=Number(x.value)>0?p.value.symbol=="APT"?new r(Number(x.value)).sub(new r(.1)).lt(new r(0))?"0":new r(Number(x.value)).sub(new r(.1)).toString():String(x.value):"":C.value=Number(x.value)>0?p.value.symbol=="SUI"?new r(Number(x.value)).sub(new r(.05)).lt(new r(0))?"0":new r(Number(x.value)).sub(new r(.05)).toString():String(x.value):"")},l=i=>{i==="fromCoin"?(ke.value=!0,y.value=Number(w.value)>0?ft(new r(Number(w.value)).div(2).toString(),k.value.decimals).toString():""):(ke.value=!1,C.value=Number(x.value)>0?ft(new r(Number(x.value)).div(2).toString(),p.value.decimals).toString():"")},d=B(),X=B(),F=B(),Y=B(!1),ie=i=>{var c,h,ne,j;d.value=i,i==="fromCoin"?(X.value=((c=p.value)==null?void 0:c.address)||"",F.value=G.query.actions=="new-position"?(h=k.value)==null?void 0:h.address:a.value.needReverse?a.value.token_b.address:a.value.token_a.address):(X.value=((ne=k.value)==null?void 0:ne.address)||"",F.value=G.query.actions=="new-position"?(j=p.value)==null?void 0:j.address:a.value.needReverse?a.value.token_a.address:a.value.token_b.address),Y.value=!0},he=i=>{var ne,j,ae,re,ee,oe,se,pe;const c=a.value.needReverse?a.value.token_b:a.value.token_a,h=a.value.needReverse?a.value.token_a:a.value.token_b;d.value==="fromCoin"?(((ne=k.value)==null?void 0:ne.address)===(c==null?void 0:c.address)||!((j=k.value)!=null&&j.address)?(p.value&&i.address.toLowerCase()===((ae=p)==null?void 0:ae.value.address.toLowerCase())&&(p.value=null),k.value=i):(k.value&&i.address.toLowerCase()===((re=k)==null?void 0:re.value.address.toLowerCase())&&(k.value=null),p.value=i),G.query.action||(G.query.fee="")):((ee=p.value)==null?void 0:ee.address)===(h==null?void 0:h.address)||!((oe=p.value)!=null&&oe.address)?(k.value&&i.address.toLowerCase()===((se=k)==null?void 0:se.value.address.toLowerCase())&&(k.value=null),p.value=i):(p.value&&i.address.toLowerCase()===((pe=p)==null?void 0:pe.value.address.toLowerCase())&&(p.value=null),k.value=i),Y.value=!1},g=A(()=>ue.value.chainName?kt(ue.value.chainName):{}),P=A(()=>ue.value.slippage),N=B(),me=async()=>{var $e,Me,Be,Re;if(Xe.value||!O.value&&!I.value)return!1;if(!y.value&&!C.value&&!O.value&&!I.value)return;const i=a.value||{};if(Ie(i))return;const{TickUtil:c,TickMath:h,getNearestTickByTick:ne}=g.value,j=i==null?void 0:i.token_a.decimals,ae=i==null?void 0:i.token_b.decimals;let re,ee,oe,se,pe,Pe,Ee,Ze,Ae=i==null?void 0:i.current_tick_index,D;if(i.token_a.address.toLowerCase()===k.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===p.value.address.toLowerCase()?D=!0:D=!1,O.value==="0"&&I.value==="∞")oe=c.getMinIndex(Number(i.tickSpacing)),se=c.getMaxIndex(Number(i.tickSpacing)),pe=h.tickIndexToSqrtPriceX64(oe),Pe=h.tickIndexToSqrtPriceX64(se);else if(U.value=="custom"){D?(re=O.value,ee=I.value):(re=I.value!=="∞"?new r(1).div(I.value).toString():1/0,ee=new r(1).div(O.value).toString());try{Ee=new r(re).equals(new r(0))?-443636:h.priceToTickIndex(new r(re),j,ae)}catch{Ee=-443636}try{Ze=h.priceToTickIndex(new r(ee),j,ae)}catch{Ze=443636}oe=ne(Ee,Number(i.tickSpacing),!0),se=ne(Ze,Number(i.tickSpacing),!0);try{pe=h.priceToSqrtPriceX64(new r(re),j,ae)}catch{(ee===1/0||ee==="∞")&&(pe=h.tickIndexToSqrtPriceX64(c.getMinIndex(Number(i.tickSpacing))))}try{Pe=h.priceToSqrtPriceX64(new r(ee),j,ae)}catch{(ee===1/0||ee==="∞")&&(Pe=h.tickIndexToSqrtPriceX64(c.getMaxIndex(Number(i.tickSpacing))))}}else oe=($e=Ke.value[U.value])==null?void 0:$e.lower,se=(Me=Ke.value[U.value])==null?void 0:Me.upper,pe=h.tickIndexToSqrtPriceX64(oe),Pe=h.tickIndexToSqrtPriceX64(se);if(I.value!=="∞"&&oe>=se){S.value=!0,y.value="",Q.value=!0,C.value="";return}if(I.value==="∞"||Ae>=oe&&Ae<se){S.value=!1,Q.value=!1;let ge;if(y.value||C.value){if(ke.value){const ut=new r(y.value).mul(Math.pow(10,k.value.decimals)).toString();ge=new Fe(ut)}else{const ut=new r(C.value).mul(Math.pow(10,p.value.decimals)).toString();ge=new Fe(ut)}h.tickIndexToSqrtPriceX64(a.value.current_tick_index);const{liquidityAmount:We,tokenMaxA:rt,tokenMaxB:ot,tokenMaxAOrigin:Et,tokenMaxBOrigin:Wt}=g.value.estLiquidityAndcoinAmountFromOneAmounts({tokenA:i.token_a,tokenB:i.token_b,lowerTick:oe,upperTick:se,coinAmount:ge,iscoinA:D?ke.value:!ke.value,roundUp:!0,slippage:Number(P.value)/100,curSqrtPrice:new Fe(a.value.current_sqrt_price)});N.value={liquidityAmount:We,tokenMaxA:rt,tokenMaxB:ot,tokenMaxAOrigin:Et,tokenMaxBOrigin:Wt},D?ke.value?C.value=Number(ot)>0?ot:"":y.value=Number(rt)>0?rt:"":ke.value?C.value=rt:y.value=ot}}else if(Ae>=se){if(D?y.value="":C.value="",S.value=D,Q.value=!D,y.value||C.value){let ge;if(D){const We=new r(C.value).mul(Math.pow(10,(Be=p.value)==null?void 0:Be.decimals)).toString();ge=new Fe(We),N.value={liquidityAmount:g.value.estimateLiquidityForCoinB(pe,Pe,ge),tokenMaxA:0,tokenMaxB:C.value}}else{const We=new r(y.value).mul(Math.pow(10,(Re=k.value)==null?void 0:Re.decimals)).toString();ge=new Fe(We),N.value={liquidityAmount:g.value.estimateLiquidityForCoinB(pe,Pe,ge),tokenMaxA:0,tokenMaxB:y.value}}}}else if(Ae<oe){if(S.value=!D,Q.value=D,D?C.value="":y.value="",y.value||C.value){let ge;if(D){const We=new r(y.value).mul(Math.pow(10,k.value.decimals)).toString();ge=new Fe(We),N.value={liquidityAmount:g.value.estimateLiquidityForCoinA(pe,Pe,ge),tokenMaxA:y.value,tokenMaxB:0}}else{const We=new r(C.value).mul(Math.pow(10,p.value.decimals)).toString();ge=new Fe(We),N.value={liquidityAmount:g.value.estimateLiquidityForCoinA(pe,Pe,ge),tokenMaxA:C.value,tokenMaxB:0}}}}else S.value=!0,y.value="",Q.value=!0,C.value=""};qe(()=>a.value,(i,c)=>{(!c&&i&&!Ie(i)||c&&i&&c.address!==i.address)&&we(i,!c||i.address!==c.address),i&&!Ie(i)&&me()},{immediate:!0}),qe(y,(i,c)=>{i==""&&ke.value&&(C.value=""),i&&ke.value&&!Xe.value&&me()}),qe(C,(i,c)=>{i==""&&!ke.value&&(y.value=""),i&&!ke.value&&!Xe.value&&me()}),qe(()=>Ue.value,(i,c)=>{me()}),qe(()=>[k.value,p.value],([i,c])=>{i&&c&&(S.value=!1,Q.value=!1)});const b=B("--"),L=A(()=>H.value.RATES),E=()=>{const i=L.value&&L.value[k.value.address]&&L.value[k.value.address].price,c=L.value&&L.value[p.value.address]&&L.value[p.value.address].price;if(i&&c){const h=new r(y.value>0?y.value:0).mul(i),ne=new r(C.value>0?C.value:0).mul(c),j=h.add(ne).toNumber();b.value=j>0&&j<.01?"<$0.01":"$"+Se(j,2)}else b.value="--"};qe(()=>[y.value,C.value,Xe.value],([i,c,h])=>{(i||c)&&!h?E():(!i||!c)&&!h&&(b.value="--")},{immediate:!0}),qe(()=>b,i=>{},{immediate:!0});const K=B(),M=async()=>{var D,$e;if(!O.value&&!I.value)return!1;if(!y.value&&!C.value&&!O.value&&!I.value)return;const i=a.value;if(Ie(i))return;const{TickUtil:c,TickMath:h,getNearestTickByTick:ne}=g.value,j=i==null?void 0:i.token_a.decimals,ae=i==null?void 0:i.token_b.decimals;let re,ee,oe,se,pe,Pe,Ee;if(i.token_a.address.toLowerCase()===k.value.address.toLowerCase()&&i.token_b.address.toLowerCase()===p.value.address.toLowerCase()?Ee=!0:Ee=!1,O.value==="0"&&I.value==="∞")oe=c.getMinIndex(Number(i.tickSpacing)),se=c.getMaxIndex(Number(i.tickSpacing));else if(U.value=="custom"){Ee?(re=Number(O.value),ee=Number(I.value)):(re=new r(1).div(I.value).toString(),ee=new r(1).div(O.value).toString());try{pe=re==0?-443636:h.priceToTickIndex(new r(re),j,ae)}catch{pe=-443636}try{Pe=h.priceToTickIndex(new r(ee),j,ae)}catch{Pe=443636}oe=ne(pe,Number(i.tickSpacing),!0),se=ne(Pe,Number(i.tickSpacing),!0)}else oe=(D=Ke.value[U.value])==null?void 0:D.lower,se=($e=Ke.value[U.value])==null?void 0:$e.upper;const Ze=L.value[i==null?void 0:i.token_a.address].price,Ae=L.value[i==null?void 0:i.token_b.address].price;Ue.value?new Fe(i.current_sqrt_price):new Fe(1/i.current_sqrt_price);try{const{amountA:Me,amountB:Be,tokenAmountsInfo:Re}=await g.value.estCoinAmountsFromTotalAmount({lowerTick:oe,upperTick:se,decimalsA:j,decimalsB:ae,curSqrtPrice:new Fe(i.current_sqrt_price),totalAmount:b.value.replace(/[^\d.]/g,""),tokenPriceA:Ze,tokenPriceB:Ae});K.value=Re,i.needReverse?Ue.value?(y.value=Me,C.value=Be):(y.value=Be,C.value=Me):(y.value=Me,C.value=Be)}catch{}};qe([O,I],([i,c])=>{Xe.value?Xe.value&&M():me(),c!=="∞"&&Number(i)!==0&&Number(c)!==0&&Number(i)>=Number(c)?Qe.value=!0:Qe.value=!1,Number(i)==0&&Number(c)==0&&tt.value&&(Qe.value=!0)},{deep:!0,immediate:!0});const ze=i=>{const c=i.replace(/[^\d.]/g,""),h="$"+Se(c);Xe.value=!0,b.value=h,c>0?M():(y.value="",C.value="")},_=B(!1),{setTransactionTxid:V,setTransactionDesc:Ge,setIsShowWaiting:Ne,setIsShowSuccess:at,setPositiomNum:Ye,setIsShowRejected:t}=be,m=ci(),f=A(()=>H.value.currentPositionInfo),$=B(!1),J=async i=>{var pe,Pe,Ee,Ze;_.value=!1,H.value.currentPositionInfo={},V(""),Ge(e("tips.increaseLiquiditySuccess",{from:S.value?"":`${Se(y.value)} ${(pe=k.value)==null?void 0:pe.symbol}`,and:!S.value&&!Q.value?"and":"",to:Q.value?"":`${Se(C.value)} ${(Pe=p.value)==null?void 0:Pe.symbol}`})),Ne(!0);const c=Ue.value?ke.value:!ke.value;let h,ne,j,ae,re,ee;const oe=a.value.token_a.decimals,se=a.value.token_b.decimals;if(O.value==="0"&&I.value==="∞")j=g.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)),ae=g.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing));else if(U.value=="custom"){Ue.value?(h=O.value,ne=I.value):(h=new r(1).div(I.value).toString(),ne=new r(1).div(O.value).toString());try{re=h==0?g.value.TickUtil.getMinIndex(Number(a.value.tickSpacing)):g.value.TickMath.priceToTickIndex(new r(h),oe,se)}catch{re=g.value.TickUtil.getMinIndex(Number(a.value.tickSpacing))}try{ee=g.value.TickMath.priceToTickIndex(new r(ne),oe,se)}catch{ee=g.value.TickUtil.getMaxIndex(Number(a.value.tickSpacing))}j=g.value.getNearestTickByTick(re,Number(a.value.tickSpacing),!0),ae=g.value.getNearestTickByTick(ee,Number(a.value.tickSpacing),!0)}else j=Ke.value[U.value].lower,ae=Ke.value[U.value].upper;try{let Ae;Xe.value?Ae=await g.value.getCreateAddLiquidityPayload({pool:a.value,curSqrtPrice:new Fe(a.value.current_sqrt_price),tickLower:j,tickUpper:ae,slippage:Number(P.value)/100,tokenAmounts:K.value}):Ae=await g.value.getAddLiquidityTransactionPayload({pool:{poolAddress:a.value.poolAddress,token_a:a.value.token_a,token_b:a.value.token_b},amount:ke.value?y.value:C.value,fix_amount_a:c,tick_lower:j,tick_upper:ae,index:0,slippage:Number(P.value)/100,roundUp:!0,collect_fee:!1,curSqrtPrice:new Fe(a.value.current_sqrt_price)});let D;if(q.value==="Aptos")D=await T.value.currentWallet.signAndSubmitTransaction(Ae);else{const $e=await T.value.currentWallet.signAndExecuteTransactionBlock(Ae);D=g.value.handleTx($e)}if(D&&D.hash){V(D.hash),Ne(!1),at(!0);let $e;a.value.needReverse?a.value.token_a.address.toLowerCase()===k.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===p.value.address.toLowerCase()?$e=!1:$e=!0:a.value.token_a.address.toLowerCase()===k.value.address.toLowerCase()&&a.value.token_b.address.toLowerCase()===p.value.address.toLowerCase()?$e=!0:$e=!1;const Me={title:"Supplied",desc:e("tips.addLiquiditySuccessText",{from:S.value?"":`${Se(y.value)} ${(Ee=k.value)==null?void 0:Ee.symbol}`,and:!S.value&&!Q.value?"and":"",to:Q.value?"":`${Se(C.value)} ${(Ze=p.value)==null?void 0:Ze.symbol}`}),hash:D.hash,tit:"Position Created",icon:"icon-icon-Position-Created"};q.value!=="Aptos"&&(Me.res=D.res),g.value.showTransitionPending(Me);const Be=await g.value.watchTransaction(Me,!0);if(Be.status){if(at(!1),H.value.setCurrentPositionLoading(!0),$.value=!0,q.value==="Aptos"){if(await H.value.setCurrentPositionInfo(Be.nftInfo[0].data.id.creator,Be.nftInfo[0].data.id.collection,Be.nftInfo[0].data.name,q.value),i)try{await m.subscribePosition({pool_address:f.value.poolAddress,position_index:f.value.index},f.value.nftHash)}catch{}}else{const Re=Be.nftInfo,ge=await Ct(2e3);if(await H.value.setCurrentPositionInfo(Re==null?void 0:Re.pool,"","",q.value,Re==null?void 0:Re.position),await Ct(1e3),i)try{await m.subscribePosition({pool_address:f.value.poolAddress,position_index:f.value.index},f.value.nftHash)}catch{}}setTimeout(()=>{Ce.updateCurrentPools(a.value.poolAddress,q.value),g.value.getAccount(T.value.address)},3e3),setTimeout(async()=>{Pt(g,a)},3e3)}Ye()}else Ne(!1),t(!0);y.value="",C.value=""}catch{y.value="",C.value="",Ne(!1),t(!0)}},W=A(()=>!!(!y.value&&!C.value||Number(y.value)>Number(w.value)||Number(C.value)>Number(x.value)||je.value!==e("button.addLiquidity")&&je.value!==e("newAdd.preview")||a.value&&a.value&&a.value.is_pause||Number(y.value)<=0&&Number(C.value)<=0||!S.value&&Number(y.value)==0||!Q.value&&Number(C.value)==0)),ye=A(()=>!k.value||!p.value),je=A(()=>a.value&&a.value.is_pause?"Pool Closed":!k.value||!p.value||ye.value?e("modal.selectTokenModalTitle"):Number(y.value)>Number(w.value)?e("button.insufficientBalance",{name:k.value.symbol}):Number(C.value)>Number(x.value)?e("button.insufficientBalance",{name:p.value.symbol}):!Number(y.value)&&!Number(C.value)?e("button.enterAmount"):I.value!=="∞"&&Number(O.value)>=Number(I.value)?e("newAdd.invalidRange"):e("button.addLiquidity")),_e=B({}),Te=B({}),xe=B(!1),De=(i,c)=>{const h=localStorage.getItem(i.address);H.value.tokensObj&&H.value.tokensObj[i.address]&&H.value.tokensObj[i.address].isSelfBuilt&&!h&&(c=="fromCoin"&&(_e.value=i),c=="toCoin"&&(Te.value=i),xe.value=!0)};qe(()=>[k.value,p.value],([i,c])=>{i&&!Ie(i)&&De(i,"fromCoin"),c&&!Ie(c)&&De(c,"toCoin")},{immediate:!0});const s=Qt(),u=()=>{q.value!=="Aptos"?s.push("/pool/list"):s.push("/pools")},He=i=>{Xe.value,J(i)},ve=()=>{G.query.action!=="create-pool"&&G.query.actions!=="new-position"&&(Pt(g,a),me(),Ce.updateCurrentPools(a.value.poolAddress,q.value)),Ce.setPoolConfigList(q.value,ue.value.filterCoinsObj)},fe=A(()=>{var h,ne,j,ae,re,ee;const i=(j=L.value[(ne=(h=k)==null?void 0:h.value)==null?void 0:ne.address])==null?void 0:j.price,c=(ee=L.value[(re=(ae=p)==null?void 0:ae.value)==null?void 0:re.address])==null?void 0:ee.price;return!!(i&&c)});return qe(()=>[G,H.value.tokensObj],([i,c])=>{var h;c&&!Ie(c)&&(p.value||(p.value=H.value.tokensObj[(h=i==null?void 0:i.query)==null?void 0:h.toCoin]))},{immediate:!0,deep:!0}),{positionError:Qe,decimalUi:de,poolInfo:a,fromCoinAmount:y,toCoinAmount:C,fromCoin:k,toCoin:p,theme:Le,showFromCoinLock:S,showToCoinLock:Q,fromCoinBlance:w,toCoinBlance:x,maxBtnSelect:n,halfBtnSelect:l,fixedFromCoin:ke,openCoinSelect:ie,currentCoinKey:d,existingCoins:X,lastSelectCoin:F,showCoinSelect:Y,onCoinSelect:he,liquidityTotalAmount:b,toggle:jt,onInput:ze,isInputTotalAmount:Xe,isViewDetail:$,addLiquidityBtnDisabled:W,addLiquidityBtnText:je,isShowTokenWarning:xe,chainName:q,closeTokenWarning:u,warningFromCoin:_e,warningToCoin:Te,isShowLiquidityModal:_,currentPrice:tt,currentPriceReverse:lt,currentPriceTab:U,minPrice:O,maxPrice:I,toAdd:J,direction:Ue,wallet:T,getAddLiquidityType:He,clickRefresh:ve,isShowtotalAmount:fe}}});const yn={class:"new-liquidity-right"},Cn={class:"deposit-title"},_n={class:"card-container"},Tn={key:0,class:"lock"},Pn={class:"card-item"},Sn={class:"card-item"},In={key:0,class:"total-amount"},Ln=o("span",null,"Total Amount",-1);function Nn(e,v,be,ue,q,Ce){const H=Ot,z=ai,T=Ut,G=oi,a=zt,S=Yt,Q=si,Le=li,we=ui;return R(),Z("div",yn,[o("div",Cn,[Oe(H,{"pool-info":e.poolInfo,onClickRefresh:e.clickRefresh},null,8,["pool-info","onClickRefresh"])]),o("div",_n,[e.positionError?(R(),Z("div",Tn,[Oe(z)])):te("",!0),o("div",Pn,[Oe(T,{modelValue:e.fromCoinAmount,"onUpdate:modelValue":v[0]||(v[0]=w=>e.fromCoinAmount=w),"input-value":e.fromCoinAmount,"coin-symbol":e.fromCoin?e.fromCoin.symbol:null,"coin-name":e.fromCoin?e.fromCoin.name:null,balance:e.fromCoinBlance,"coin-icon":e.fromCoin?e.fromCoin.logoURI:"",address:e.fromCoin?e.fromCoin.address:"","swap-direct":"From","import-page":"deposit","has-arrow":!1,onOnMax:v[1]||(v[1]=w=>e.maxBtnSelect("fromCoin")),onOnHalf:v[2]||(v[2]=w=>e.halfBtnSelect("fromCoin")),onOnInput:v[3]||(v[3]=w=>{e.fromCoinAmount=w,e.fixedFromCoin=!0,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showFromCoinLock&&!e.positionError?(R(),Je(G,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),o("div",Sn,[Oe(T,{modelValue:e.toCoinAmount,"onUpdate:modelValue":v[4]||(v[4]=w=>e.toCoinAmount=w),"input-value":e.toCoinAmount,"coin-symbol":e.toCoin?e.toCoin.symbol:null,"coin-name":e.toCoin?e.toCoin.name:null,balance:e.toCoinBlance,"swap-direct":"To","coin-icon":e.toCoin?e.toCoin.logoURI:"",address:e.toCoin?e.toCoin.address:"","import-page":"deposit","has-arrow":!1,onOnMax:v[5]||(v[5]=w=>e.maxBtnSelect("toCoin")),onOnHalf:v[6]||(v[6]=w=>e.halfBtnSelect("toCoin")),onOnInput:v[7]||(v[7]=w=>{e.toCoinAmount=w,e.fixedFromCoin=!1,e.isInputTotalAmount=!1})},null,8,["modelValue","input-value","coin-symbol","coin-name","balance","coin-icon","address"]),e.showToCoinLock&&!e.positionError?(R(),Je(G,{key:0,"from-coin":e.fromCoin,"to-coin":e.toCoin,"pool-info":e.poolInfo},null,8,["from-coin","to-coin","pool-info"])):te("",!0)]),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme=="default"?(R(),Z("img",{key:1,class:"add",src:di,alt:"",onClick:v[8]||(v[8]=(...w)=>e.toggle&&e.toggle(...w))})):te("",!0),e.fromCoin&&e.toCoin&&!e.showToCoinLock&&!e.showFromCoinLock&&e.theme!=="default"?(R(),Z("img",{key:2,class:"add",src:mi,alt:"",onClick:v[9]||(v[9]=(...w)=>e.toggle&&e.toggle(...w))})):te("",!0)]),e.isShowtotalAmount?(R(),Z("div",In,[Ln,o("span",null,le(e.liquidityTotalAmount)+" ",1)])):te("",!0),Oe(a,{"from-coin":e.fromCoin,"to-coin":e.toCoin,"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"fixed-from-coin":e.fixedFromCoin,"is-input-total-amount":e.isInputTotalAmount,"min-price":e.minPrice,"max-price":e.maxPrice,"current-price-tab":e.currentPriceTab,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse},null,8,["from-coin","to-coin","from-coin-amount","to-coin-amount","fixed-from-coin","is-input-total-amount","min-price","max-price","current-price-tab","current-price","current-price-reverse"]),Oe(S,{class:"add-liquidity-btn",disabled:e.wallet.connected?e.addLiquidityBtnDisabled:!1,onClick:v[10]||(v[10]=w=>e.wallet.connected?e.isShowLiquidityModal=!0:e.wallet.setIsShowWalletModal(!0))},{default:bt(()=>[Rt(le(e.wallet.connected?e.addLiquidityBtnText:e.$t("button.connectWallet")),1)]),_:1},8,["disabled"]),e.showCoinSelect?(R(),Je(Q,{key:1,"existing-coins":e.existingCoins,"last-select-coin":e.lastSelectCoin,onOnSelect:e.onCoinSelect,onOnClose:v[11]||(v[11]=w=>e.showCoinSelect=!1)},null,8,["existing-coins","last-select-coin","onOnSelect"])):te("",!0),e.isViewDetail?(R(),Je(Le,{key:2,"pool-info":e.poolInfo,onOnClose:v[12]||(v[12]=w=>e.isViewDetail=!1)},null,8,["pool-info"])):te("",!0),e.isShowLiquidityModal?(R(),Je(we,{key:3,"pool-info":e.poolInfo,title:e.$t("button.addLiquidity"),"from-coin-amount":e.fromCoinAmount,"to-coin-amount":e.toCoinAmount,"from-coin":e.fromCoin,"to-coin":e.toCoin,"fixed-from-coin":e.fixedFromCoin,"current-price":e.currentPrice,"current-price-reverse":e.currentPriceReverse,"current-price-tab":e.currentPriceTab,"min-price":e.minPrice,"max-price":e.maxPrice,"show-from-coin-lock":e.showFromCoinLock,"show-to-coin-lock":e.showToCoinLock,"current-direct":e.direction,"is-increase":!1,onToAdd:e.getAddLiquidityType,onOnClose:v[13]||(v[13]=w=>e.isShowLiquidityModal=!1)},null,8,["pool-info","title","from-coin-amount","to-coin-amount","from-coin","to-coin","fixed-from-coin","current-price","current-price-reverse","current-price-tab","min-price","max-price","show-from-coin-lock","show-to-coin-lock","current-direct","onToAdd"])):te("",!0)])}const xt=nt(wn,[["render",Nn]]),An=it({components:{NewLiquidityLeft:Xt,NewLiquidityRight:xt},setup(){Bt(()=>{ri()});const e=wt();return{tickList:et,route:e}}});const qn={key:0,class:"loading-spin-liquidity loading-global"},Mn={class:"privide-liquidity"};function $n(e,v,be,ue,q,Ce){var G,a;const H=Mt,z=Xt,T=xt;return R(),Z(gt,null,[!e.tickList&&((a=(G=e.route)==null?void 0:G.query)!=null&&a.poolAddress)?(R(),Z("div",qn,[Oe(H)])):te("",!0),o("div",Mn,[Oe(z),Oe(T)])],64)}const ma=nt(An,[["render",$n],["__scopeId","data-v-fc58011a"]]);export{ma as default};
