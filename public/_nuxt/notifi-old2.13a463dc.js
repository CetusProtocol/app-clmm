import{a as I,f as N,r as _,i as E,o as O,j as D,x as n,y as u,B as P,v as l}from"./entry.7dbcdae4.js";import{u as R}from"./wallet.3fc4a512.js";import{n as H,a as B}from"./index.b7569565.js";import"./v4.78edc15a.js";const F=I({async setup(){const o=R(),v=N(()=>o),e=_(null),y=_(""),S={pool_address:"77777777777777777777777777777777",position_nft:"77777777777777777777777777777777",position_index:"7"},G=async()=>{const s=v.value.currentWallet.publicAccount,t=s.address,r=s.publicKey,f=H({address:t,publicKey:r},"cetus","Development"),p=B(f);e.value=p;const i=await p.initialize();(i==null?void 0:i.status)==="authenticated"&&await b()},a=async()=>await e.value.logIn({walletBlockchain:"APTOS",signMessage:async(t,r)=>(await v.value.currentWallet.signMessage({address:!0,message:t,nonce:`${r}`})).signature}),w=async()=>{await e.value.ensureTargetGroup({name:"Default",emailAddress:"enzihuang1991@gmail.com"})},T=async()=>{await e.value._service.createSource({type:"DIRECT_PUSH",name:JSON.stringify(S),blockchainAddress:JSON.stringify(S)})},C=async()=>{await e.value._service.createSourceGroup({name:"position",sourceIds:[]})},k=async()=>{await e.value._service.addSourceToSourceGroup({input:{sourceGroupId:"1a123b27f15944ee83d981cb1916b6a4",sourceId:"98641ee3885a4340956ffe0bb8e7a970"}})},b=async()=>{const[s,t,r,c,d,f,p]=await Promise.all([e.value._service.getAlerts(),e.value._service.getSources(),e.value._service.getSourceGroups(),e.value._service.getTargetGroups(),e.value._service.getEmailTargets(),e.value._service.getSmsTargets(),e.value._service.getTelegramTargets()]),i=new Set,m=[];return t.source&&t.source.flatMap(g=>(g==null?void 0:g.applicableFilters)??[]).forEach(g=>{i.has(g.id)||(m.push(g),i.add(g.id))}),{alerts:s,filters:m,sources:t,sourceGroups:r,targetGroups:c,emailTargets:d,smsTargets:f,telegramTargets:p}},A=async()=>{const t=(await e.value._service.getSources()).source,r=t==null?void 0:t.find(c=>c!==void 0&&c.type==="DIRECT_PUSH");if(r===void 0)throw new Error("Failed to identify direct push source");return r},h=s=>{var c;const t=(c=s.applicableFilters)==null?void 0:c.find(d=>(d==null?void 0:d.filterType)==="DIRECT_TENANT_MESSAGES");if(t===void 0)throw new Error("Failed to retrieve filter");return{filter:t,filterOptions:{directMessageType:"alarm"}}};return{initNotifi:G,logIn:a,createAlert:async()=>{const s={type:"directPush",name:"position",directPushId:{type:"value",value:"alarm"}},r=(await e.value._service.getTargetGroups()).targetGroup.filter(i=>i.name==="Default"),c=await e.value._service.getSourceGroups(),d=await A(),f=h(d),p=c.sourceGroup.filter(i=>i.name==="position");p&&p[0]&&r&&r[0]&&await e.value._service.createAlert({name:s.name,sourceGroupId:p[0].id,filterId:f.filter.id,targetGroupId:r[0].id,filterOptions:f.filterOptions?JSON.stringify(f.filterOptions):"{}",groupName:"managed"})},deleteAlert:async()=>{await e.value.deleteAlert({id:"35fce5ce0a804fc3970f1ce5484ed1ef"})},deleteSourceGroup:async()=>{await e.value._service.deleteSourceGroup({id:"bd122edb602c4fa0a4b9936f60dedddf"})},deleteTargetGroup:async()=>{await e.value._service.deleteTargetGroup({id:"4cf31f2395cb44fb90cf53a6bdd618d7"})},ensureTargetGroup:w,createSource:T,createSourceGroup:C,deleteSourceId:y,addSourceToSourceGroup:k,getNotificationHistory:async()=>{await e.value.getNotificationHistory()}}}});function M(o,v,e,y,S,G){const a=P;return O(),D("div",null,[n(a,{onClick:o.initNotifi},{default:u(()=>[l("initNotifi")]),_:1},8,["onClick"]),n(a,{onClick:o.logIn},{default:u(()=>[l("login")]),_:1},8,["onClick"]),n(a,{onClick:o.ensureTargetGroup},{default:u(()=>[l("ensureTargetGroup")]),_:1},8,["onClick"]),n(a,{onClick:o.createAlert},{default:u(()=>[l("createAlert")]),_:1},8,["onClick"]),n(a,{onClick:o.createSource},{default:u(()=>[l("createSource")]),_:1},8,["onClick"]),n(a,{onClick:o.createSourceGroup},{default:u(()=>[l("createSourceGroup")]),_:1},8,["onClick"]),n(a,{onClick:o.deleteSourceGroup},{default:u(()=>[l("deleteSourceGroup")]),_:1},8,["onClick"]),n(a,{onClick:o.deleteAlert},{default:u(()=>[l("deleteAlert")]),_:1},8,["onClick"]),n(a,{onClick:o.addSourceToSourceGroup},{default:u(()=>[l("addSourceToSourceGroup")]),_:1},8,["onClick"]),n(a,{onClick:o.getNotificationHistory},{default:u(()=>[l("getNotificationHistory")]),_:1},8,["onClick"])])}const q=E(F,[["render",M]]);export{q as default};
